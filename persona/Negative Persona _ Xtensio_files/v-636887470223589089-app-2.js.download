!function(){for(var e,t=function(){},a=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=a.length,o=window.console=window.console||{};n--;)e=a[n],o[e]||(o[e]=t)}();var app={};app.core={},app.plugin={},app.charts={},app.setup={},app.menu={},app.factory={},app.mods={},app.canvas={},app.popup={},app.managers={},app.modHelper={},app.share={},app.home={},app.dash={},app.editor={},app.common={},app.console={},app.lib={},app.charts.pie=function(){return{draw:function(e){var t=d3.layout.pie().sort(null),a=e.$el.width();if(a<1&&(e.$el.parents(".module-container").hasClass("col-sm-2")?a=170:e.$el.parents(".module-container").hasClass("col-sm-4")?a=170:e.$el.parents(".module-container").hasClass("col-sm-6")?a=270:e.$el.parents(".module-container").hasClass("col-sm-8")?a=370:e.$el.parents(".module-container").hasClass("col-sm-10")?a=390:e.$el.parents(".module-container").hasClass("col-sm-12")&&(a=390)),a>0){e.$el.empty();var n=d3.select(e.$el.get(0)).append("svg").attr("width",a).attr("height",a),o=n.append("g"),i=Math.ceil(a/2);o.attr("transform","translate("+i+","+i+")");var s=d3.svg.arc().innerRadius(.98*i).outerRadius(Math.floor(.8*i));o.text("");var r=o.selectAll("path").data(t(e.items));r.enter().append("path").attr("fill",function(t,a){return e.colorFunc(a)}).attr("d",s),r.exit().remove()}}}},app.common.main=function(e,t,a,n,o,i,s,r,l,c){var d=this;d.notification(e,t,a,n,i,s,o,r,c),d.menu(e,t,a,o,i,r,l,s,c),d.session(a,o),d.undrop(a),d.urlHash(o)},app.common.menu=function(e,t,a,n,o,i,s,r,l){function c(){l.getData(1,function(e,t,a,n){l.isBusiness()||l.ownsATeam()?g.hide():(g.show(),f.find(".plus-menu").addClass("move-left")),e.Count||e.Referrals.length?$(".user-menu-popup .billing").text("Billing"):$(".user-menu-popup .billing").text("Upgrade")},!0)}function d(){l.getData(1,function(t,a,n,o){e.UserTeams&&e.UserTeams.length>0&&e.Team&&0!=e.Team.Id&&(l.hasTeam()||l.isTeamMember()||l.isSingleFolioGuest()||l.isPremiumGuest()||l.isOwner()||l.ownsATeam)&&$("#tmp-user-menu .upgrade-btn").remove()},!0)}var u=$('<div id="logo-bar" class="header-edit container-fluid"></div>'),m=$('<div id="top-bar"></div>'),f=e.isHome?$("#tmp-dash-topbar"):$("#tmp-primary-bar"),p=f.find(e.isHome?".menu-tile .inside":".menu-tile"),h=$("#tmp-user-menu"),g=h.find(".upgrade-btn"),v=h.find(".gear-button"),b=(app.plugin.lockedTip(e,a),f.find(".user-info")),y=$('<div id="app-load-animation" style="top: 0; left: 0; position: fixed;height: 100%;width: 100%;"><div class="loading-animation"></div></div>').hide();y.find(".loading-animation").html(n.spinner),$("body").append(y),m.append(u),b.css("position","relative").append($("#tmp-user-menu-popup").html());var C=function(e){return function(){return window.location=e,!1}};setTimeout(function(){if(e.UserTeams&&e.UserTeams.length>0){if(e.Team.Id){var t="";window.location.hostname;"live"==e.Environment?t="https://app.xtensio.com/#dashboard":"dev"==e.Environment?t="https://app.xtensio.tech/#dashboard":"local"==e.Environment&&(t="https://www.localhost.com:44301/#dashboard");var a='<li class="item team-item personal-dashboard"><a href="'+t+'">Personal Dashboard</a></li>';console.log("config.DisableP",e.DisableP),e.DisableP||($(a).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .personal-dashboard.team-item").click(C(t)))}for(var o=0;o<e.UserTeams.length;o++){if(e.Team.Id!=e.UserTeams[o].Id){var i=e.UserTeams[o].TeamUrl.indexOf("http")<0?"https://":"",a='<li class="item team-item teamind-'+o+'"><a  href="'+i+e.UserTeams[o].TeamUrl+'">'+e.UserTeams[o].Name+"</a></li>";$("#top-bar .nav-setmenu .team-item a[href*='"+e.UserTeams[o].TeamUrl+"']").length<1&&($(a).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .team-item.teamind-"+o).click(C(i+e.UserTeams[o].TeamUrl)))}$("#top-bar .nav-setmenu .team-item").show()}if(e.Team&&e.Team.Id>0&&e.Team.Role<=3){if(e.Team.Role<=3){var s='<li class="item team-menu invite-people">Invite People</li>';$(s).insertBefore("#top-bar .nav-setmenu .li-sep.team-menu")}if(e.Team.Role<3){var r='<li class="item team-menu team-settings">Team Settings</li>';$(r).insertBefore("#top-bar .nav-setmenu .li-sep.team-menu")}if(e.Team.ST&&(14==e.Team.ST||19==e.Team.ST||22==e.Team.ST||25==e.Team.ST||28==e.Team.ST||31==e.Team.ST)&&1===e.Team.Role){var l='<li class="item team-menu team-edit">Manage Team Members</li> \t\t\t\t\t\t\t';$(l).insertBefore("#top-bar .nav-setmenu .li-sep.team-menu")}$("#top-bar .nav-setmenu .team-menu").show(),console.log("in menu",(new Date).getTime())}if(e.Team.Role>0&&e.Team.Role<4){var c='<li class="item team-menu import-folios">Import Folios</li>';$(c).insertBefore("#top-bar .nav-setmenu .li-sep.team-menu"),$("#top-bar .nav-setmenu .team-menu").show()}}if(e.Team&&0==e.Team.Id&&$("#top-bar .nav-setmenu .li-sep.team-menu").remove(),e.Team&&0==e.Team.Id){for(var d=!1,o=0;o<e.UserTeams.length;o++)1==e.UserTeams[o].Role&&(d=!0);if(!d){var u='<li class="item team-menu create-team"><a href="/teams/create">Create Team</a></li>';$(u).insertBefore("#top-bar .nav-setmenu .li-sep.li-sep-one"),$("#top-bar .nav-setmenu .create-team").show()}}var m=$('<li class="item style-guide">Style Guide</li>');e.Team&&0!==e.Team.Id?$(m).insertBefore("#top-bar .nav-setmenu .li-sep.team-menu"):$(m).insertAfter("#top-bar .nav-setmenu li.item.billing"),$("#top-bar .nav-setmenu .team-settings").click(function(){n.teamSettingPopup()}),$("#top-bar .nav-setmenu .invite-people").click(function(){if(3===e.Team.Role){var t="Team Members";n.teamUserActionBlocked("invite-member",t)}else n.teamManagePopup(!0)}),$("#top-bar .nav-setmenu .team-edit").click(function(){n.teamManagePopup()}),$("#top-bar .nav-setmenu .style-guide").click(function(){n.styleGuidePopup()}),$("#top-bar .nav-setmenu .import-folios").click(function(){n.importFolioPopup()}),$("#tmp-dash-topbar .nav-setmenu li.item.explore a").click(function(e){e.preventDefault(),console.log("clicked???"),$("#tmp-dash-topbar a.explore").trigger("click")})},2e3),g.click(function(){return l.getData(1,function(t,a,o,i){1==t.ST||2==t.ST||9==t.ST||10==t.ST||11==t.ST||34==t.ST||a||e.Team.Id>0?n.billing():n.payment()},!0),!1}),c();var T=function(){if(e.fullName)try{var t=e.fullName.toUpperCase().match(/\b\w/g);t=t.length>1?t.shift()+t.pop():t.shift(),v.find(".initials").text(t)}catch(a){v.find(".initials").text("")}};if(a.addListener("plusUnlocked",function(){c()}),a.addListener("plusCancelled",function(){c()}),e.plusInfo&&e.plusInfo.End>Date.now()&&a.raiseEvent("plusUnlocked"),a.addListener("nameChanged",T),T(),e.editMode){d();var w=$('<div id="folio-bar" class="header-edit container-fluid"></div>'),x=f.find(".folio-name").val(i.FolioName);m.append(w);var k=function(){var e=$.trim(x.val());e?t.renameFolio({name:e}):x.val(i.FolioName)};i.Role>1&&x.on("blur",k),a.addListener("folioRename",function(e){i.Token==e.Token&&(i.FolioName=e.NewFolioName,x.val(e.NewFolioName))})}else f.find(".fa-angle-right").remove(),f.find(".folio-name").remove();if(u.append(f),$("body").prepend(m),f.find(".folio-name").scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",ellips:0,wrapperWidth:"274px",animBack:!0,minScrollWidth:272,wrap:!0,callback:function(){$("#tmp-collaborators").css({"margin-left":"300px"})}}),e.ShowGdprConsent&&app.dash.globalAlert(e,t),p.append(h),s.popupMenu("#tmp-user-menu .gear-button","#top-bar .user-menu-popup"),n.getUserMenu(e,n,a,l),e.Team&&0!=e.Team.Id&&($("#tmp-dash-topbar .menu-tile .nav-main-menu a:eq(0)").text("Folios"),e.Team.LogoUrl?($("#logo-bar .app-title a").append('<img style="max-width: 80px; max-height: 40px; margin-top: -4px; max-height:calc(100% - 4px);" src="'+e.Team.LogoUrl+'">').css({textAlign:"center"}),$("#logo-bar .app-title a .icon-Logo").remove()):e.Team.Name&&"5"!=e.Team.Role&&($("#logo-bar .app-title a").append('<h4 style="color: #4c7ba0; font-weight: bold; text-align: center;">'+e.Team.Name+"</h4>"),$("#logo-bar .app-title a .icon-Logo").remove())),setTimeout(function(){$("#logo-bar .app-title").removeClass("hidden")},200),e.Team.Id>0&&1==e.Team.Role&&("nadeem@fakecrow.com"==e.userEmail||"ali@fakecrow.com"==e.userEmail)){var S='<li class="item team-item add-mem" style="text-decoration: underline;">Add Member</li>';$(S).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .team-item.add-mem").click(function(){n.addTeamMember()})}},app.common.notification=function(e,t,a,n,o,i,s,r,l){function c(e){for(var t=n.standardizeEmail(e),a=0;a<r.Collaborators.length;a++)if(n.standardizeEmail(r.Collaborators[a].Email)===t&&r.Collaborators[a].Privilege>0&&1==r.Collaborators[a].Accepted)return!0;return!1}function d(e){e.find(".block").each(function(){var e=$(this),t=e.data("tobj");t&&e.find(".date").text(t.format("MMMM DD"))})}function u(){K&&clearTimeout(K),K=setTimeout(function(){var t;$("#top-bar .nav-setmenu .team-item").hide(),e.Team&&e.Team.Id>0&&("live"==e.Environment?verb="https://app.xtensio.com/#dashboard":"dev"==e.Environment?verb="https://app.xtensio.tech/#dashboard":"local"==e.Environment&&(verb="https://www.localhost.com:44301/#dashboard"),t='<li class="item team-item"><a href="'+verb+'">Personal Dashboard</a></li>',$("#top-bar .nav-setmenu .team-item a[href='"+verb+"']").length<1&&$(t).insertBefore("#top-bar .nav-setmenu .li-sep.team-item"),$("#top-bar .nav-setmenu .team-item").show());for(var a=0;a<e.UserTeams.length;a++){if(e.Team.Id!=e.UserTeams[a].Id){var n=e.UserTeams[a].TeamUrl.indexOf("http")<0?"https://":"";t='<li class="item team-item"><a href="'+n+e.UserTeams[a].TeamUrl+'">'+e.UserTeams[a].Name+"</a></li>",$("#top-bar .nav-setmenu .team-item a[href*='"+e.UserTeams[a].TeamUrl+"']").length<1&&$(t).insertBefore("#top-bar .nav-setmenu .li-sep.team-item")}$("#top-bar .nav-setmenu .team-item").show()}},1e3)}function m(t){for(var a=!1,n=0;n<e.UserTeams.length;n++)t.Data.TeamID==e.UserTeams[n].Id&&(a=!0);if(!a){var o={Id:t.Data.TeamID,Name:t.Data.TeamName,LogoUrl:null,TeamUrl:t.Data.TeamURL,Status:0,Role:t.Data.Role};e.UserTeams.push(o)}u()}function f(t,a){for(var n=0;n<e.UserTeams.length;n++)if(e.UserTeams[n].Id==t){e.UserTeams.splice(n,1);break}$("#top-bar .nav-setmenu .team-item a[href*='"+a+"']").parent().remove(),u()}function p(e,a){t.loadNotifications({data:{userEmail:e,nextCount:a},success:function(){},error:function(e){}})}function h(e){return function(){s.signupPerformance(e.Data.ModId)}}function g(e){i.send(ne.bRead,{Arr:e})}function v(a,n,o,i,r,l){console.log("in processTransfer func");var c;c={verb:a,secret:n,teamId:o},t.processTransfer({data:c,success:function(){i.parent().find(".yes, .no").remove(),"accept"===a?t.getFolioCollaborators({token:r,success:function(a){console.log("response collaborators",a),t.getWorkspaceChannels({teamId:o,success:function(t){console.log("response channels",t),e.saveFolioTransferWithTeam={FolioName:l,Token:r,collaborators:JSON.parse(a.Data),labels:JSON.parse(t.Data)},console.log("saveFolioTransferWithTeam",e.saveFolioTransferWithTeam),s.saveFolio()},error:function(e){console.log("error in getWorkspaceChannels",e)}})},error:function(e){console.log("error in getFolioCollaborators",e)}}):e.isHome&&(window.location="/")},error:function(e){5==e.StatusCode?s.plusPrompt("create",null,!0):10==e.StatusCode?s.plusPrompt("create",null,!1,!0):s.error(e.Message)}})}function b(t,a){a.verb=t,1==a.Data.AllowOutside?e.UserTeams&&e.UserTeams.length>0&&a.Data.UserDefinedTeam<0?s.transferFolioToSpace(a):e.UserTeams&&e.UserTeams.length>0&&a.Data.UserDefinedTeam>-1?e.Team&&e.Team.Id==a.Data.UserDefinedTeam&&s.transferFolioToSpace(a):a.Process&&e.isHome&&v(t,a.Key,0,$this,a.Data.Token,a.Data.Folio):v(t,a.Key,a.Data.TeamID,$this,a.Data.Token,a.Data.Folio)}function y(e,a){console.log("getProcessTransferFunc request",e);var n=a.hasClass("yes")?"accept":"reject";console.log("$this",a),"accept"===n?l.checkFoliosLimitReached(t,s,function(){b(n,e)}):b(n,e)}function C(e){t.processSFG({data:{id:e.Id},success:function(t){window.location="https://"+e.teamURL},error:function(e){1002!=e.StatusCode&&2!=e.StatusCode&&s.error(e.Message,"Error Accepting Folio")}})}function T(t){e.isHome&&(t.Data.TeamID!=e.Team.Id?t.Data.TeamID>0?window.location="https://"+t.Data.TeamURL+"/edit/"+t.Data.Token:window.location=B()+"/edit/"+t.Data.Token:window.location="/")}function w(a){return function(){var n=$(this),o=n.hasClass("yes")?"accept":"reject";return t.processCollaborator({data:{verb:o,id:a.Data.Id},success:function(){n.parent().find(".yes, .no").remove(),console.log("collab func on notification"),console.log("request",a),"accept"===o?t.getFolioCollaborators({token:a.Data.Token,success:function(n){console.log("response",n),t.getWorkspaceChannels({teamId:e.Team.Id,success:function(t){console.log("response channels",t),e.saveFolioCollabItem={FolioName:a.Data.Folio,Token:a.Data.Token,collaborators:JSON.parse(n.Data),labels:JSON.parse(t.Data)},console.log("saveFolioCollabItem",e.saveFolioCollabItem),s.saveFolio()},error:function(e){console.log("in error, getWorkspaceChannels",e)}})},error:function(e){console.log("in error, processCollaborator",e)}}):T(a)},error:function(e){5==e.StatusCode?s.plusPrompt("create",null,!0):10==e.StatusCode?s.plusPrompt("create",null,!1,!0):s.error(e.Message)}}),!1}}function x(t){e.isHome&&ee.find(".folio-item-shell[data-token='"+t+"']").remove()}function k(t){e.isHome&&(ee.find(".folio-item-shell[data-token='"+t.Data.Token+"']").remove(),I())}function S(e,t){return function(){var a=t?"edit":"folio";e.Data.TeamID>0?window.open("https://"+e.Data.TeamURL+"/"+a+"/"+e.Data.Token):window.open(B()+"/"+a+"/"+e.Data.Token)}}function D(e){return function(){var t=e.indexOf("http")<0?"https://":"";window.location=t+e}}function I(){window.location="/"}function P(){s.billing(1)}function E(e,t,a,n){s.message({heading:e||"Folio Deleted",message:t||"This folio has been deleted by its owner. You can no longer view or edit it.",btnText:a||"Go To Dashboard",noClose:!0,enterAsOK:!0,handleOK:n||I})}function F(){s.billing()}function A(e){return Faltu(X).filter(function(t){return t.Data.Token&&t.Data.Token==e.Data.Token&&t.Kind==e.Kind&&t.Time>=e.Time&&t.Id!=e.Id}).get()}function M(e,t,n){e&&(clearTimeout(V[t.Kind]),V[t.Kind]=setTimeout(function(){var o=A(t);o.length>0||$.each(e.Collaborators,function(o,i){(t.User||t.Data.Email)==i.Email&&(e.Collaborators[o].Accepted=!n,e.Collaborators[o].Privilege=t.Data.Privilege||t.Data.Role||0,a.raiseEvent("collabChange",e))})},1e3))}function N(t){return r&&r.Token==t||!e.isHome?r:Faltu(e.folios).find({Token:t}).get()[0]}function O(e){M(N(e.Data.Token),e)}function U(e,t){return Date.now()-e.Time<=(t||1e4)}function R(e){return window.location.href.indexOf(e.Data.Token)>1}function L(t){X.push(t);var n,o=e.nType;if(t.Data.Folio=t.Data.Folio||"Untitled",t.Kind==o.collaboratorRequest)return n=$(Fe),n.find(".name").text(t.Data.Name),n.find(".role").text(1===parseInt(t.Privilege)?"view":"edit"),n.find(".folio").text(t.Data.Folio),t.Process&&W.indexOf(t.Data.Id)<0?(W.push(t.Data.Id),t.Data.TeamID==e.Team.Id&&a.raiseEvent("collabRequestArrived",t),n.on("click",".yes, .no",w(t))):n.find(".yes, .no").remove(),n;if(t.Kind==o.collaboratorReceive||t.Kind==o.collaboratorChange){n=$(Oe);var i=1===parseInt(t.Data.Role||t.Data.Privilege);if(t.Kind==o.collaboratorChange&&t.New&&O(t),t.New&&U(t,1e3)&&R(t)){var s=i?"changed your access to be view-only.":"granted you edit access.";E("Access Changed","Owner of this folio has "+s,"Reload Folio",function(){g([t.Id]),location.reload()})}return n.find(".role").text(i?"view-only access to":"access to edit"),n.find(".folio").text(t.Data.Folio),n.click(S(t,!0)),n}return t.Kind==o.collaboratorAccept?(n=$(Ae),n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),t.New&&O(t),n.click(S(t,!0)),n):t.Kind==o.collaboratorDecline?(n=$(Ue),n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),n):t.Kind==o.collaboratorReject?(n=$(Me),n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),r=N(t.Data.Token),t.New&&r&&r.Collaborators&&M(r,t,!0),n.click(S(t,!0)),n):t.Kind==o.collaboratorRemoveHimself?(n=$(Ne),t.Data.Email==e.userName?n.html('You have left "<span class="bold folio">'+t.Data.Folio+'</span>".'):(n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),n.click(S(t,!0))),r=N(t.Data.Token),t.New&&r&&r.Collaborators&&M(r,t,!0),n):t.Kind==o.collaboratorRemove?(n=$(Re),n.find(".folio").text(t.Data.Folio),t.New&&_&&(x(t.Data.Token),R(t)&&E("Access Changed","You no longer have access to this folio.",null,function(){g([t.Id]),I()})),n):t.Kind==o.collaboratorRemoveToAllCollaborators?(n=$(Ne),n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),r=N(t.Data.Token),t.New&&r&&r.Collaborators&&M(r,t,!0),n.click(S(t,!0)),n):t.Kind==o.collaboratorAddedToAllCollaborators?(n=$(Ae),n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),r=N(t.Data.Token),t.New&&r&&r.Collaborators&&M(r,t,!1),n.click(S(t,!0)),n):t.Kind==o.sendCollaboratorFolioArchived?(n=$(Le),n.find(".folio").text(t.Data.Folio),_&&t.New&&(R(t)&&E(),k(t)),n):t.Kind==o.folioReverted?(n=$(Be),t.Data.Email==e.userName?n.html('You have reverted to a different version of "<span class="bold folio">'+t.Data.Folio+'</span>".'):(n.find(".name").text(t.Data.Name),n.find(".folio").text(t.Data.Folio),clearTimeout(V[t.Kind]),V[t.Kind]=setTimeout(function(){var e=A(t);R(t)&&t.New&&e.length<1&&t.Data.CurrentVersion&&r.CurrentVersion!==t.Data.CurrentVersion&&E("Folio Reverted",t.Data.Name+' has reverted to a different version of "'+t.Data.Folio+'".',"Refresh Page",function(){g([t.Id]),location.reload()})},1e3)),n.click(S(t,!0)),n):void 0}function B(){return"live"==e.Environment?"https://app.xtensio.com":"dev"==e.Environment?"https://app.xtensio.tech":"local"==e.Environment?"https://www.localhost.com:44301/":void 0}function G(t){if(e.Team.Id==t.Data.TeamID&&t.New)if(e.userEmail==t.Data.Email)app.popup.message({heading:"Access Revoked",message:"You have been removed from this team<br>If you think this was a mistake please contact the team owner.",btnText:"Go to your Personal Dashboard",noClose:!0,handleOK:function(){window.location=B()}});else if(e.editMode)for(var n=0;n<r.Collaborators.length;n++)r.Collaborators[n].Email==t.Data.Email&&(r.Collaborators[n].Accepted=!1,r.Collaborators[n].Privilege=0,a.raiseEvent("collabChange",r));else e.folios&&$.each(e.folios,function(e,n){for(var e=0;e<n.Collaborators.length;e++)n.Collaborators[e].Email==t.Data.Email&&(n.Collaborators[e].Accepted=!1,n.Collaborators[e].Privilege=0,a.raiseEvent("collabChange",n))})}function H(t){for(var a=0;a<e.TeamRoles.length;a++)if(e.TeamRoles[a].Id==t)return e.TeamRoles[a].Name}function q(e){return function(){s.importFolioPopup(),g([e])}}function Y(e){return function(){s.close(),g([e])}}function z(t){var n=$("#all-labels-container .item").length;if(t.Data.Folios.length>0&&e.Team&&e.Team.Id==t.Data.TeamID&&e.isHome){for(var o=[],i=0,s=[],r={Name:t.Data.LabelName,Token:t.Data.LabelToken,FolioTokens:o,Private:!0,HasPass:!1,Indexed:!1,isLabel:!0,color:e.colors[n%e.colors.length]},l=0;l<t.Data.Folios.length;l++){for(var c=!1,d=0;d<e.folios.length;d++)e.folios[d].Token==t.Data.Folios[l].Token&&(c=!0);c||(i++,o.push(t.Data.Folios.Token),t.Data.Folios[l].Role=3,t.Data.Folios[l].Labels.push(r.Token),s.push(l))}if(i>0){e.labels.push(r),a.raiseEvent("addlabel",n);for(var l=0;l<s.length;l++)a.raiseEvent("foliosRecieved",t.Data.Folios[s[l]],!0)}}}var j,_,K,V=[],W=[],J=[],X=[],Q=$("#notify-btn"),Z=$("#n-panel"),ee=$("#folio-items-container"),te=Z.find(".contents"),ae=Z.find(".load-more"),ne=e.msgType,oe=e.nType,ie=($("#trans-folio-tile").html(),$("#plus-news").html()),se=$("#data-news").html(),re=$("#transfer-news").html(),le=$("#accept-news").html(),ce=$("#reject-news").html(),de=$("#receive-news").html(),ue=$("#decline-news").html(),me=$("#plus-added-news").html(),fe=$("#plus-started-news").html(),pe=$("#billing-saved-news").html(),he=$("#card-updated-news").html(),ge=$("#plus-cancel-news").html(),ve=$("#delinquent-downgraded-news").html(),be=$("#plus-expire-news").html(),ye=$("#added-to-team").html(),Ce=$("#team-owner-changed").html(),Te=$("#removed-from-team").html(),we=$("#added-to-team-for-owner").html(),xe=$("#removed-from-team-for-owner").html(),ke=$("#team-access-changed").html(),$e=($("#section-copy-moved").html(),$("#team-role-changed").html()),Se=$("#team-created").html(),De=[],Ie=!1,Pe=!1,Ee="",Fe=$("#collaboration-news").html(),Ae=$("#collaboration-accept-news").html(),Me=$("#collaboration-reject-news").html(),Ne=$("#collaboration-left-news").html(),Oe=$("#collaboration-receive-news").html(),Ue=$("#collaboration-decline-news").html(),Re=$("#collaboration-removed-news").html(),Le=$("#collaboration-archived-news").html(),Be=$("#collaboration-reverted-news").html(),Ge=$("#user-joined-channel").html(),He=$("#user-joined-channel-self").html(),qe=$("#joined-channel-for-owner").html(),Ye=$("#joined-channel-for-TO").html(),ze=$("#user-left-channel").html(),je=$("#user-left-channel-self").html(),_e=$("#left-channel-for-owner").html(),Ke=$("#left-channel-for-TO").html(),Ve=$("#folio-added-to-channel").html(),We=$("#folio-added-for-owner").html(),Je=$("#folio-added-for-TO").html(),Xe=$("#folio-removed-from-channel").html(),Qe=$("#folio-removed-for-owner").html(),Ze=$("#folio-removed-for-TO").html(),et=$("#channel-created-for-owner").html(),tt=$("#channel-created-for-TO").html(),at=$("#channel-created-for-member").html(),nt=$("#channel-privacy-changed-teamvisible").html(),ot=$("#channel-privacy-changed-private").html(),it=$("#channel-privacy-changed-private-owners").html(),st=$("#channel-deleted").html(),rt=$("#channel-deleted-for-owner").html(),lt=$("#channel-deleted-for-TO").html(),ct=[11,12,14,15,16,24,25,27,28,29,30,31,32,36,37],dt=function(e){for(var t=0;t<De.length;t++)De[t].Data.Token==e&&1==De[t].New&&ct.indexOf(De[t].type)&&(n.removeFromList(J,De[t].Id),De[t].New=!1)};a.addListener("hubMsg",function(t,o){var i,r,u,p,v,b,T,w,k=moment();if(Ie=!1,Ee="",Pe=!1,t==ne.bRead)for(i=0;i<o.Arr.length;i++)n.removeFromList(J,o.Arr[i]);else if(t==ne.bell||t==ne.loadMore){if(o.length>0)for(o.length>6&&Z.find(".load-more").removeClass("hidden"),te.find(".empty").remove(),n.sort(o,"Time"),t==ne.bell&&Q.addClass("active"),i=0;i<o.length;i++)if(u=o[i],w=null,ct.indexOf(u.Kind)>-1&&dt(o[i].Data.Token),De.push(o[i]),u.Kind!=oe.transferFolioRequest||u.Process){switch(u.Data.Data&&(u.Data.Data=JSON.parse(u.Data.Data)),u.New&&u.Kind!=oe.teamFirstTimeSignin&&J.push(u.Id),u.End>e.plusExpireTime&&(e.plusExpireTime=u.End),b=moment(u.Time),p=k.diff(b,"day")<1,T=te.find('[data-time="'+b.format("YYYY-MM-DD")+'"]'),p?(v="Today",r=k.diff(b,"minute"),r<60?r+=" minute"+(1==b?"":"s"):(r=k.diff(b,"hour"),r+=" hour"+(1==r?"":"s")),r+=" ago",d(te)):(v=b.format("MMMM DD"),r=b.format("hh:mm A")),T.length<1&&(T=$('<div class="block" data-time="'+b.format("YYYY-MM-DD")+'"><div class="date">'+v+"</div></div>"),T.data("tobj",b),t==ne.bell?te.prepend(T):te.append(T)),u.Kind){case oe.referralSignup:w=$(ie),w.find(".name").text(u.Data.Name),w.click(s.plusInfo);break;case oe.transferFolioRequest:case oe.transferFolioAccept:case oe.transferFolioReject:case oe.folioReceive:case oe.folioDecline:u.Kind==oe.transferFolioRequest?(w=$(re),w.find(".yes, .no").click(function(){var e=$(this);y(u,e)}),1==u.Data.AllowOutside?u.Process&&e.isHome&&a.raiseEvent("transferRequestArrived",u.Data):u.Data.TeamID==e.Team.Id&&a.raiseEvent("transferRequestArrived",u.Data)):u.Kind==oe.transferFolioAccept?(w=$(le),_&&u.Owner!=e.userName&&!c(e.userName)&&(x(u.Data.Token),window.location.href.indexOf(u.Data.Token)>0&&s.message({heading:"Folio Transferred",message:"This folio has been transferred. You no longer have access to edit.",btnText:"Return to Dashboard",noClose:1,handleOK:I})),u.New&&(console.log("item",u),g([u.Id]),setTimeout(function(){I()},200),console.log("refresh should have happened here"))):w=u.Kind==oe.transferFolioReject?$(ce):u.Kind==oe.folioReceive?$(de):$(ue),w.find(".name").text(u.Data.Name),w.find(".folio").text(u.Data.Folio||"Untitled"),u.Data.Token||w.addClass("simple");break;case oe.plusExpiring1Week:break;case oe.plusExpiringToday:break;case oe.subscribed:"DiscountYearly"==u.Data.Plan&&(u.Data.Plan="Pro"),"Month"==u.Data.Plan&&(u.Data.Plan="Pro"),"Year"==u.Data.Plan&&(u.Data.Plan="Pro"),"PlusMonth"==u.Data.Plan&&(u.Data.Plan="Plus"),"PlusYear"==u.Data.Plan&&(u.Data.Plan="Plus"),"BusinessYearly"==u.Data.Plan&&(u.Data.Plan="Business"),"ExportCredits"==u.Data.Plan?(u.Data.Plan="Export Credits",w=$("<div class='item'>You have purchased 10 credits. <div class='links'><a href='#' class='textlink'>See billing for details</a></div></div>"),w.click(F)):(w=$("<div class='item'>You've successfully upgraded to Xtensio "+u.Data.Plan+". <div class='links'><a target='_blank' href='#' class='textlink'>See Xtensio "+u.Data.Plan+" features</a></div></div>"),w=$("<div class='item'>You've successfully upgraded to Xtensio "+u.Data.Plan+". <div class='links'><a target='_blank' href='#' class='textlink'>See Xtensio "+u.Data.Plan+" features</a></div></div>"),w.find("a").attr("href","https://xtensio.com/"+u.Data.Plan+"/"));break;case oe.plusStarted:w=$(fe),w.click(F);break;case oe.billingSaved:w=$(pe),w.click(P);break;case oe.cardUpdate:w=$(he),w.click(P);break;case oe.planChange:"DiscountYearly"==u.Data.Plan&&(u.Data.Plan="DiscountYear"),"Month"==u.Data.Plan&&(u.Data.Plan="ProMonth"),"Year"==u.Data.Plan&&(u.Data.Plan="ProYear"),w=$('<div class="item">You switched to '+u.Data.Plan+"ly plan.</div>"),w.click(F);break;case oe.planCancel:w=$(ge),w.click(F);break;case oe.delinquentUserDowngraded:w=$(ve),w.click(F);break;case oe.plusExpire:w=$(be),10==u.Data.PlanName||11==u.Data.PlanName?w.find("pname").text("Plus"):w.find("pname").text("Pro"),w.click(F);break;case oe.plusTimeAdded:w=$(me),w.find(".via").text(u.Data.Via),w.click(s.plusInfo);break;case oe.dataCollectionSignup:w=$(se),u.Folio=(u.Folio||"Untitled")+".",u.Folio.length>40&&(u.Folio=u.Folio.substr(u.Folio,37)+" ..."),u.Data.Count&&u.Data.Count>1&&w.find(".count").text(u.Data.Count+" form responses"),w.find(".folio").text(u.Folio),w.click(h(u)),_&&a.raiseEvent("newSignUp",u);break;case oe.collaboratorAccept:case oe.collaboratorDecline:case oe.collaboratorReceive:u.Kind==oe.collaboratorReceive&&0!=u.Data.TeamID&&Z.find(".item.sfg-accept").each(function(){$this=$(this);$this.data("team");o.teamId==u.Data.TeamID&&$this.find(".yes, .no, br").remove()});case oe.collaboratorReject:w=L(u);break;case oe.collaboratorRequest:w=L(u),w.attr("data-token",u.Data.Token);break;case oe.collaboratorChange:case oe.collaboratorRemove:w=L(u);break;case oe.folioReverted:case oe.collaboratorRemoveHimself:case oe.sendCollaboratorFolioArchived:case oe.collaboratorRemoveToAllCollaborators:w=L(u);break;case oe.collaboratorAddedToAllCollaborators:w=L(u);break;case oe.folioUpgraded:w=L(u);break;case oe.teamMemberAdded:w=1==u.Data.Role?$(Ce):$(ye),1==u.Data.Role?w.find(".user").text("You").removeClass("bold"):e.userEmail==u.Data.Email?w.find(".user").text("You have").removeClass("bold"):e.userEmail!=u.Data.Email&&w.find(".user").text((u.Data.Name||u.Data.Email)+" has"),w.find(".role").text(H(u.Data.Role)),w.find(".team").text(u.Data.TeamName),w.find("a").attr("href","https://"+u.Data.TeamURL),e.Team&&e.Team.Id==u.Data.TeamID&&w.find(".links").remove(),w.attr("data-teamaddid",u.Data.TeamID),5==u.Data.Role&&(w.addClass("sfg-accept"),w.find("a").text("Accept"),w.find("a").data("team",{teamURL:u.Data.TeamURL,Id:u.Data.Id,teamId:u.Data.TeamID,notifId:u.Id}),u.New?w.find("a").on("click",function(e){e.preventDefault();var t=$(this).data("team");return g([t.notifId]),C(t),$(this).parent().find(".yes, .no, br").remove(),!1}):(w.find(".yes, .no, br").remove(),w.click(D(u.Data.TeamURL))),e.Team&&e.Team.Id==u.Data.TeamID&&u.New&&(g([u.Id]),C({teamURL:u.Data.TeamURL,Id:u.Data.Id,teamId:u.Data.TeamID}),w.find(".yes, .no, br").remove(),w.click(D(u.Data.TeamURL)))),e.Team.Id!=u.Data.TeamID&&_&&m(u),Ie=!0;break;case oe.teamMemberAddedToTO:w=$(ye),1==u.Data.Role?w.find(".user").text("You").removeClass("bold"):e.userEmail==u.Data.Email?w.find(".user").text("You have").removeClass("bold"):e.userEmail!=u.Data.Email&&w.find(".user").text((u.Data.Name||u.Data.Email)+" has"),w.find(".role").text(H(u.Data.Role)),w.find(".team").text(u.Data.TeamName),w.find("a").attr("href","https://"+u.Data.TeamURL),e.Team&&e.Team.Id==u.Data.TeamID&&w.find(".links").remove(),w.attr("data-teamaddid",u.Data.TeamID),Ie=!0;break;case oe.teamMemberRemoved:w=$(Te),w.find(".team").text(u.Data.TeamName),1==u.Data.Role?w.find(".user").text("You").removeClass("bold"):e.userEmail==u.Data.Email?w.find(".user").text("You have").removeClass("bold"):e.userEmail!=u.Data.Email&&w.find(".user").text((u.Data.Name||u.Data.Email)+" has"),e.userEmail==u.Data.Email&&_&&(T.find('.item[data-teamaddid="'+u.Data.TeamID+'"]').find(".links").remove(),f(u.Data.TeamID,u.Data.TeamURL)),_&&G(u),Ie=!0;break;case oe.teamMemberRemovedToTO:e.userEmail==u.Data.Email&&u.New&&(T.find('.item[data-teamaddid="'+u.Data.TeamID+'"]').find(".links").remove(),f(u.Data.TeamID,u.Data.TeamURL)),w=$(Te),w.find(".team").text(u.Data.TeamName),1==u.Data.Role?w.find(".user").text("You").removeClass("bold"):e.userEmail==u.Data.Email?w.find(".user").text("You have").removeClass("bold"):e.userEmail!=u.Data.Email&&w.find(".user").text((u.Data.Name||u.Data.Email)+" has"),u.New&&(g([u.Id]),G(u)),Ie=!0;break;case oe.folioRecievedToTO:z(u);break;case oe.teamMemberAddedToTO:w=$(we),w.find(".team").text(u.Data.TeamName),w.find(".user").text(u.Data.Name);break;case oe.teamMemberRemovedToTO:w=$(xe),w.find(".team").text(u.Data.TeamName),w.find(".user").text(u.Data.Name),Ie=!0;break;case oe.folioNameChanged:a.raiseEvent("folioRename",u.Data);break;case oe.teamMemberAccessChanged:l.updateConfig(u),a.raiseEvent("userTeamRoleChanged",u),w=$(ke),w.find(".team").text(u.Data.TeamName),w.find(".role").text(H(u.Data.Role));break;case oe.copyMoveSectionToFolio:e.editMode&&e.token==u.Data.Token&&app.popup.message({heading:"Section Added",message:"A section from another folio has been copied or moved to this folio. Please reload to get the latest changes.",btnText:"Reload",noClose:!0,handleOK:function(){permDisc=!0,window.location.reload()}}),u.New&&g([u.Id]);break;case oe.teamFirstTimeSignin:e.Team&&0!=e.Team.Id&&u.New&&e.Team.Id==u.Data.TeamID&&(5!=e.Team.Role&&4!=e.Team.Role?u.Data.NewUser||s.message({heading:"Welcome to "+e.Team.Name+"!<br><h3>Let's finalize your setup.</h3>",message:'<div style="margin: 0 -20px; text-align: center;"><h3 style="margin-bottom: 10px;">Would you like to import any folios from your personal dashboard?</h3><span style="font-family: Proxima-Bold;">Tip:</span> This option is also available under your profile menu.</div>',btnText:"Import Folios",cancelText:"Skip",noClose:!0,notMini:!0,isSwitchCta:!0,okClass:"ok-blue",handleOK:q(u.Id),handleNo:Y(u.Id)}):g([u.Id]));break;case oe.teamMemberAccessChanged:case oe.teamMemberAccessChangedToTO:w=$($e),e.userEmail==u.Data.Email?w.find(".user").text("Your").removeClass("bold"):w.find(".user").text((u.Data.Name||u.Data.Email)+"'s"),w.find(".role").text(H(u.Data.Role)),w.find(".team").text(u.Data.TeamName),w.find("a").attr("href","https://"+u.Data.TeamURL),e.Team&&e.Team.Id==u.Data.TeamID&&w.find(".links").remove(),e.userEmail==u.Data.Email&&e.Team.Id==u.Data.TeamID&&u.New&&(g([u.Id]),app.popup.message({heading:"Team Access Changed",message:"Your Access to team has been updated. Please reload.",btnText:"Reload",noClose:!0,handleOK:function(){window.location.reload()}})),Ie=!0;break;case oe.transferredFolios:if(0==e.Team.Id)for(var i=0;i<u.Data.Folios.length;i++){var S=$('#folio-items-container .folio-item-shell[data-token="'+u.Data.Folios[i].Token+'"]');S.animate({width:0,opacity:0,padding:0},500,"linear",function(){
S.remove()})}else if(e.Team.Id==u.Data.TeamID)for(var i=0;i<u.Data.Folios.length;i++)a.raiseEvent("foliosRecieved",u.Data.Folios[i],!0);u.New&&g([u.Id]);break;case oe.addedFromEditTemplate:u.New&&(s.addFolioToSpace(u.Data.FToken,""),g([u.Id]));break;case oe.teamPurchased:w=$(Se),w.find(".team").text(u.Data.TeamName),w.find("a").attr("href","https://"+u.Data.TeamURL),e.Team&&e.Team.Id==u.Data.TeamID&&w.find(".links").remove(),u.New&&g([u.Id]);break;case oe.channelCreated:w=$(at),w.find(".owner").text(u.Data.ChannelOwner.FullName),w.find(".channel").text(u.Data.LabelName),Ee="channelAdd",Ie=!0;break;case oe.channelCreatedOwner:w=$(et),w.find(".channel").text(u.Data.LabelName),Ee="channelAdd",Ie=!0;break;case oe.channelCreatedTO:w=$(tt),w.find(".owner").text(u.Data.ChannelOwner.FullName),w.find(".channel").text(u.Data.LabelName),Ee="channelAdd",Ie=!0;break;case oe.channelDeletedTO:w=$(lt),w.find(".channel").text(u.Data.LabelName),Ee="channelRemove",Ie=!0;break;case oe.channelDeletedOwner:w=$(rt),w.find(".channel").text(u.Data.LabelName),Ee="channelRemove",Ie=!0;break;case oe.channelDeleted:w=$(st),w.find(".channel").text(u.Data.LabelName),Ee="channelRemove",Ie=!0;break;case oe.userJoinedChannel:w=$(Ge);var E=e.userEmail===u.Data.Email?"You have been":u.Data.FullName;w.find(".user").text(E),w.find(".channel").text(u.Data.LabelName),Ee="userAdd",Ie=!0;break;case oe.userJoinedChannelSelf:w=$(He),w.find(".channel").text(u.Data.LabelName),Ee="userAdd",Ie=!0;break;case oe.userJoinedChannelOwner:w=$(qe);var E="undefined"==typeof u.Data.User?"User(s)":u.Data.User;w.find(".user").text(E),w.find(".channel").text(u.Data.LabelName),Ee="userAdd",Ie=!0;break;case oe.userJoinedChannelTO:w=$(Ye);var E="undefined"==typeof u.Data.User?"User(s)":u.Data.User;w.find(".user").text(E),w.find(".channel").text(u.Data.LabelName),Ee="userAdd",Ie=!0;break;case oe.userLeftChannel:w=$(ze);var E=e.userEmail===u.Data.Email?"You have been":u.Data.FullName;w.find(".user").text(E),w.find(".channel").text(u.Data.LabelName),Ee="userRemove",Ie=!0;break;case oe.userLeftChannelSelf:w=$(je),w.find(".channel").text(u.Data.LabelName),Ee="userRemove",Ie=!0;break;case oe.userLeftChannelOwner:w=$(_e);var E="undefined"==typeof u.Data.User?"User(s)":u.Data.User;w.find(".user").text(E),w.find(".channel").text(u.Data.LabelName),Ee="userRemove",Ie=!0;break;case oe.userLeftChannelTO:w=$(Ke);var E="undefined"==typeof u.Data.User?"User(s)":u.Data.User;w.find(".user").text(E),w.find(".channel").text(u.Data.LabelName),Ee="userRemove",Ie=!0;break;case oe.folioAddedToChannel:w=$(Ve),w.find(".folio").text(u.Data.FolioData.Name),w.find(".channel").text(u.Data.LabelName),Ee="folioAdd",Ie=!0;break;case oe.folioAddedToChannelOwner:w=$(We),w.find(".folio").text(u.Data.FolioData.Name),w.find(".channel").text(u.Data.LabelName),Ee="folioAdd",Ie=!0;break;case oe.folioAddedToChannelTO:w=$(Je),w.find(".folio").text(u.Data.FolioData.Name),w.find(".channel").text(u.Data.LabelName),Ee="folioAdd",Ie=!0;break;case oe.folioRemovedFromChannel:w=$(Xe),w.find(".folio").text(u.Data.FolioData.Name),w.find(".channel").text(u.Data.LabelName),Ee="folioRemove",Ie=!0;break;case oe.folioRemovedFromChannelOwner:w=$(Qe),w.find(".folio").text(u.Data.FolioData.Name),w.find(".channel").text(u.Data.LabelName),Ee="folioRemove",Ie=!0;break;case oe.folioRemovedFromChannelTO:w=$(Ze),w.find(".folio").text(u.Data.FolioData.Name),w.find(".channel").text(u.Data.LabelName),Ee="folioRemove",Ie=!0;break;case oe.channelPrivacyChangedTeamVisible:w=$(nt),w.find(".channel").text(u.Data.LabelName),Ee="channelTeam",Ie=!0;break;case oe.channelPrivacyChangedPrivate:w=$(ot),w.find(".channel").text(u.Data.LabelName),Ee="channelPrivate",Ie=!0;break;case oe.channelPrivacyChangedPrivateOwners:w=$(it),w.find(".channel").text(u.Data.LabelName),Ee="channelPrivate",Ie=!0}w&&(w.toggleClass("new",u.New),w.find(".time").text(r),T.find(".date").after(w),e.Team&&e.Team.Id>0&&e.isDashboard&&Ie&&u.New&&(a.raiseEvent("collabChanUdate",{item:u,refreshType:Ee}),g([u.Id]),Pe=!0))}_=1}Q.toggleClass("active",J.length>0),Ie&&Pe&&setTimeout(function(){Q.addClass("active")},300)}),Q.add(Z.find(".close-btn")).click(function(){return j?Z.find(".new").removeClass("new"):(Q.removeClass("active"),J.length>0&&(g(J),Z.find(".new").removeClass("new"))),j=!j,Z.toggle(),!1}),ae.click(function(){var t=$("#n-panel .block .item").length;return p(e.userEmail,t),!1}),a.addListener("docClick",function(e){j&&Z.has(e.target).length<=0&&(Z.hide(),j=!1)})},app.common.session=function(e,t){e.addListener("loggedOut",function(e){t.message({heading:"Signin Required",message:"Session expired. Please sign in again.",btnText:"Sign In",noClose:!0,handleOK:function(){t.signIn(!0,function(){t.close(),e()})}})})},app.common.undrop=function(e){e.addListener("docClick",function(e){$(".top-comp").removeClass("top-comp"),$(".drop-down-container").each(function(){var t=$(this);0===t.closest(".keep-open").length&&0===t.has(e.target).length&&(t.find(".drop-down").slideUp(150),t.find(".drop-down-open").removeClass("drop-down-open"),t.removeClass("showing"))}),$(".two-state-container.editing").each(function(){var t=$(this);0===t.has(e.target).length&&t.removeClass("editing")}),$(".edit-content.active").each(function(){var t=$(this);0===t.has(e.target).length&&t.removeClass("active")}),$(".gear-drop-down").each(function(){var t=$(this);0!==t.has(e.target).length||t.is(e.target)||t.find(".drop-down").slideUp(150)})})},app.common.urlHash=function(e){function t(){var t=$.trim(window.location.hash.substr(1));"styleguide"==t?e.styleGuidePopup():"managecolors"==t?(e.styleGuidePopup(),setTimeout(function(){$("#tmp-style-guide .popup-header .tabs span:eq(1)").trigger("click")},1e3)):"billing"==t?e.billing():"plus"==t?e.plusInfo():"manage-notifications"==t?e.emailSettings():t.indexOf("res-")>=0?(t=t.replace("res-",""),e.signupPerformance(t)):"active"==t?app.dash.changeView(0):"shared"==t?app.dash.changeView(1):"archived"==t?app.dash.changeView(2):"mytemplates"==t&&setTimeout(function(){$("#tmp-dash-topbar .nav-main-menu .template").trigger("click"),$("#tmp-my-labels-container .item:eq(0)").trigger("click")},2e3)}window.onpopstate=function(){var a=document.location.href;a=a.toLowerCase(),a.indexOf("account/teamsignup")>-1?e.signUp():a.indexOf("account/signup")>-1?e.signUp():a.indexOf("account/signin")>-1?e.signIn():a.indexOf("teams/create")>-1?e.signUpTeam():a.indexOf("#")>-1&&t()},t()},app.menu.bgPanel=function(e,t){var a,n,o,i=(e.apiHelper,e.eventManager,$("#tmp-change-bg-panel").html()),s=$("<div>"),r=$(i),l=r.find(".gallery-container"),c=r.find(".img-btn"),d=r.find(".gallery-btn"),u=r.find(".color-btn"),m=r.find(".color-buttons"),f=r.find(".reset-btn");return c.uploader({type:"bg",success:function(e){t.add(e)},imageLoaded:function(e){}}),u.on("click",function(){t.$node.hide(),n.$node.toggle()}),d.on("click",function(){n.$node.hide(),t.$node.toggle()}),f.on("click",function(){o()}),{$node:r,detach:function(){r.hide(),$("body").append(r)},setCallback:t.setCallback,mount:function(e,i){a=i.bgUrl,o=i.reset,n=i.colorPanel,s.append(m.find("> div")),m.append(n.$node),t.mount(l,i),e.append(r),n.$node.hide(),t.$node.hide(),r.hide()}}},app.menu.getColorPanelFunc=function(e){function t(e){var t=[];return e.forEach(function(e,a){t.push(e.HexCode)}),t}var a=$("#tmp-color-buttons").html(),n=".color-btn.selected",o=["#66D7C4","#FFD271","#FD9F4D","#F67157","#E95F5E","#FFFFFF","#DCBB9F","#76D5E5","#6486A5","#2E5668","#D45D77","#9D557C","#7E8589","#FFFFFF","#000000","#052B3E"];return console.log("config",e),0!==e.Team.Id&&"undefined"!=typeof e.StyleGuides?o=t(e.StyleGuides[0].TeamColors):"undefined"!=typeof e.DefaultColors&&(o=t(e.DefaultColors)),function(e,t){var i=$(a),s=i.find(".text-box"),r=i.find(".sample"),l=i.find(".btn"),c=i.find(".color-list");$.each(o,function(t,a){var n=$('<div class="color-btn col-sm-3"><i class="icon-CheckMark"></i></div>').css("background-color",a).data("color",a).addClass(a==e?"selected":"");c.append(n)});var d=function(a){var n=s.val();n=$.trim(n),n.indexOf("#")<0&&(n="#"+n),s.val(n);var o=/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(n);s.toggleClass("error",!o),o&&e!=n&&(r.css("background-color",n),a&&(t(n),i.hide(),e=n))};return c.on("click",".color-btn",function(){var e=$(this);$(n).removeClass("selected"),e.addClass("selected"),s.val(e.data("color")),t(e.data("color")),d()}),s.on("change",function(){d()}),l.on("click",function(){d(!0)}),s.val(e),r.css("background-color",e),{$node:i}}},app.menu.getColumnPicker=function(){var e=["One","Two","Three","Four","Five","Six"],t='<div class="column-picker child drop-down">';return function(a,n){var o=$(t);return $.each(e,function(e,t){var n=e+1,i=$('<div class="btn num-btn settings-btn" data-num="'+n+'"><span>'+t+"</span></div>").addClass(n==a?"selected":"");o.append(i)}),o.on("click",".num-btn",function(){var e=$(this);o.find(".selected").removeClass("selected"),e.addClass("selected"),n(e.data("num"))}),{$node:o}}},app.menu.gallery=function(e,t,a){function n(e){return g.indexOf(e.Id)>-1||e.isLibraryItem}function o(e){g.push(e)}function i(e){var t=g.indexOf(e);t>-1&&g.splice(t,1)}function s(e,t){var a=t&&t.length?t:f.find("[data-id='"+e+"']");f.find(".cover-image-thumb").each(function(){var e=$(this),t=u.obtain(c,"Id",e.data("id"));e.removeClass("selected used"),n(t)&&e.addClass("used")}),a.addClass("used selected")}function r(e){var t=f.find("[data-id="+e+"]");$.each(c,function(a,o){if(o.Id==e)return n(o)||(t.remove(),c.splice(a,1)),!1})}function l(e){c.unshift(e),y(e,!0),C(e)}var c=e.imageLibrary,d=a.apiHelper,u=a.utility,m=a.appHub,f=$('<div class="cover-image-preview"></div>'),p=u.obtain(t.Modules,"Type","DataModule"),h=t.UserBgImages||[],g=[];c.length>0&&c.unshift(c.pop()),$.each(c,function(e,t){t.isLibraryItem=!0}),c=h.concat(c);var v,b,y=function(e,t){var a=$('<div class="cover-image-thumb" data-id="'+e.Id+'"><span class="fi-x close-btn"></span><img src="'+e.ThumbUrl+'"/></div>');n(e)&&a.addClass("used"),t?f.prepend(a):f.append(a),a.on("click",function(t){a.hasClass("selected")||$(t.target).hasClass("close-btn")||(v&&v(e.ImageUrl),s(null,a))}),t&&a.click()};f.on("click",".close-btn",function(){var e=$(this).closest(".cover-image-thumb"),t=e.data("id");d.deleteImage(t,function(){r(t)},function(){}),m.sync(p,"ImageRemove",t)});var C=function(e){var t=f.find('[data-id="'+e.Id+'"]');t.toggleClass("used",n(e))},T=!0;return m.reg(p,"ImageAdd",function(e,t){l(t)}),m.reg(p,"ImageRemove",function(e,t){r(t)}),{$node:f,add:function(e){var t={Id:e.Data,ThumbUrl:e.Message,ImageUrl:e.Message};l(t),m.sync(p,"ImageAdd",t)},mount:function(e,t){if(T){for(var a=0;a<c.length;a++)f.find("[data-id='"+c[a].Id+"']").length<1&&y(c[a]);T=!1}var n=u.obtain(c,"ImageUrl",t.url);v=t.bgUrl,f.find(".selected").removeClass("selected"),n&&s(n.Id),e.append(f)},setCallback:function(e){v=e},changeImage:function(e,t){e=e!=t?e:b;var a=u.obtain(c,"ImageUrl",e);a&&(i(a.Id),C(a)),a=u.obtain(c,"ImageUrl",t),a&&(o(a.Id),s(a.Id),C(a)),b=t}}},app.menu.main=function(e,t,a,n){console.log(e);var o=app.menu,i=o.getColorPanelFunc(e),s=o.getColumnPicker(),r=o.gallery(e,t,a),l=o.bgPanel(a,r),c=o.getModButtonsFunc(t,a,n,i,l,s),d=o.getSectionButtonsFunc(a,i,l,n);return{changeImage:r.changeImage,setCallback:r.setCallback,colorPicker:i,bgPanel:l,modButtons:c,sectionButtons:d,detach:function(){l.detach()}}},app.menu.getModButtonsFunc=function(e,t,a,n,o,i){var s=t.appHub,r=(t.eventManager,$("#tmp-mod-settings").html());return function(t,l,c){function d(e,t){h.Theme=e,l.applyStyle(e),l.editObj&&l.editObj.applyStyle&&l.editObj.applyStyle(e,!0),t||s.sync(l,"Theme",e)}function u(e){z.not(e.toggle()).hide()}function m(){console.log("module.clone",l.clone),l.clone?l.clone():t.modManager.duplicateModule(l)}var f,p,h=l.Data,g=$(r),v=c.changeColumns,b=c.addModule,y=c.align,C=c.addItem,T=!1,w=n(h.Theme,d),x=g.find(".drop-down .btn"),k=g.find(".button-panel"),S=g.find(".add-mod-btn"),D=k.find(".col-btn"),I=k.find(".theme-btn"),P=k.find(".bg-panel-btn"),E=k.find(".share-btn"),F=k.find(".exp-btn"),A=k.find(".dup-btn"),M=k.find(".del-btn"),N=k.find(".adv-btn"),O=k.find(".cls-btn"),U=g.find(".mod-setting-btn"),R=g.find(".mod-top-buttons"),L=R.find(".plus"),B=R.find(".align"),G=g.find(".adv-panel"),H=g.find(".border-btn").text((1==h.Border?"Hide":"Show")+" Border"),q=g.find(".header-btn").text((1==h.Head?"Hide":"Show")+" Header"),Y=g.find(".txt-btn").text((1==h.Txt?"Hide":"Show")+" Text"),z=G.add(o.$node).add(w.$node);return f=n(h.BgColor,function(e){t.bgColor(l,e)}),g.append(w.$node),g.find(".border-btn").on("click",function(){$(this).toggleClass("is-present")}),x.on("click",function(){var e=$(this);e.closest(".drop-down").find(".btn").not(e).removeClass("active"),e.toggleClass("active")}),I.on("click",function(){u(w.$node)}),P.on("click",function(){u(o.$node)}),N.on("click",function(){u(G)}),b?S.click(b):S.remove(),y&&"Text"!=l.Type?(B.attr("class","align icon-Align"+h.Align),B.find(".align-btn").on("click",function(){var e=$(this).data("align");B.attr("class","align icon-Align"+e),h.Align=e,y(),s.sync(l,"Align",e)})):B.remove(),C?L.click(function(){C(),s.sync(l,"Items",h.Items)}):L.remove(),v?(p=i(h.Arr.length,v),g.append(p.$node),z=z.add(p.$node),D.on("click",function(){u(p.$node)})):D.remove(),H.on("click",function(){h.Theme||"#4C7BA0";h.Border=1==h.Border?2:1,H.text((1==h.Border?"Hide":"Show")+" Border"),s.sync(l,"Border",h.Border),l.$editNode.css({borderWidth:1==h.Border?"1px":"0"})}),q.on("click",function(){h.Theme||"#4C7BA0";h.Head=1==h.Head?2:1,l.editObj.$node.find("> .header-container").css({display:1==h.Head?"":"none"}),q.text((1==h.Head?"Hide":"Show")+" Header"),s.sync(l,"Head",h.Head)}),T?Y.on("click",function(){h.Txt=1==h.Txt?2:1,T(),Y.text((1==h.Txt?"Hide":"Show")+" Text"),s.sync(l,"Txt",h.Txt)}):Y.remove(),M.on("click",function(){k.slideToggle(150),t.removeModule(l,!1,function(){s.sync(l,"RemoveModule")})}),A.on("click",function(){k.slideToggle(150),t.modManager.currentAction("dup"),m(),s.sync(l,"DuplicateModule")}),l.menuCb=function(e,a){"Head"==e?(q.text((1==h.Head?"Hide":"Show")+" Header"),l.editObj.$node.find("> .header-container").css({display:1==h.Head?"":"none"})):"Txt"==e?Y.text((1==h.Txt?"Hide":"Show")+" Text"):"Col"==e||("Theme"==e?d(h.Theme,!0):"BgColor"==e?t.bgColor(l,h.BgColor,!0):"BgUrl"==e?(o.setCallback(null),t.bgUrl(l,h.BgUrl,!0)):"ResetBg"==e?t.resetBg(l,!0):"Border"==e?(H.text((1==h.Border?"Hide":"Show")+" Border"),l.$editNode.css({borderWidth:1==h.Border?"1px":"0"})):"DuplicateModule"==e?m():"RemoveModule"==e&&t.removeModule(l,!0))},F.on("click",function(){k.slideToggle(150),t.handleExport(l)}),E.on("click",function(){k.slideToggle(150),t.shareModule(e,l)}),O.on("click",function(){a.message({heading:"Format Class",message:"One or more css class names for the module. You can use these class names to provide custom styles under Folio Settings.",btnText:"Save",showInput:1,enterAsOK:1,input:h.CssClass||h.FormatClass,handleOK:function(e){l.$editNode.add(l.$previewNode).removeClass(h.CssClass).addClass(e),h.CssClass=e,s.sync(l,"CssClass",e)}})}),U.on("click",function(){k.slideToggle(150),U.toggleClass("drop-down-open"),U.closest(".drop-down-container").toggleClass("showing"),U.closest(".edit-content").addClass("active"),u($("<p>")),o.mount(g,{url:h.BgUrl,colorPanel:f,bgUrl:function(e){t.bgUrl(l,e)},reset:function(){t.resetBg(l)}}),setTimeout(function(){g.closest(".module-container, .edit-div").addClass("top-comp")},0)}),"RowBreak"==l.Type&&(I.remove(),P.remove(),E.remove(),F.remove(),N.remove()),{$node:g}}},function(e){e.fn.scrollText=function(t){function a(t,a,n){n||(n="");var o=t.get(0).tagName;"input"==o.toLowerCase()&&(o="div"),$tmp=e("<"+o+">"),$tmp.css({visibility:"hidden",position:"absolute","white-space":"pre","text-overflow":"unset","font-family":t.css("font-family"),"font-weight":t.css("font-weight"),"font-size":t.css("font-size")}).addClass(n+" tmp-calc").html(t.is("input")?t.val():t.html()),a.append($tmp);var i=a.find(".tmp-calc").outerWidth();return $tmp.remove(),m.ellips&&(i+=m.ellips),i}function n(t){if(m.minScrollWidth||(m.minScrollWidth=t.outerWidth()+m.ellips),c=a(t,e("body")),t.attr("text-width",c),t.hasClass("animate")?i(t):(m.wrap&&t.wrap('<span class="animation-wrapper" style="position:fixed; width: '+m.wrapperWidth+'">'),t.addClass("animate"),l=t.outerWidth(),t.attr("elem-width",l),t.css({"text-overflow":"unset"}),t.parent().css({overflow:"hidden"}),m.callback&&m.callback()),l=parseInt(t.attr("elem-width")),c=parseInt(t.attr("text-width")),c>m.minScrollWidth){t.css("width",c+"px"),t.css("max-width",c+"px");var n=(c-m.minScrollWidth)/100*m.speed;n<2e3&&(n=2e3),d=n;var o=c-m.minScrollWidth;s(t,o,d)}else i(t)}function o(e){e.stop()}function i(e){o(e),e.animate({"margin-left":"-="+e.css("margin-left")},{duration:d,step:function(e,t){},progress:function(e,t,a){}})}function s(e,t,a){if(!e.length)return!1;o(e);var n=parseInt(e.css("margin-left"));if(n<0){n=t-Math.abs(n);var i=a;return e.animate({"margin-left":"-="+n+"px"},{duration:i,step:function(e,t){},progress:function(e,t,a){},done:function(n,o){r(e,t,a)}}),!1}e.animate({"margin-left":"-="+t+"px"},{duration:a,step:function(e,t){},progress:function(e,t,a){},done:function(n,o){r(e,t,a)}})}function r(e,t,a){e.animate({"margin-left":"+="+t+"px"},{duration:a,step:function(e,t){},progress:function(e,t,a){},done:function(n,o){s(e,t,a)}})}var l,c,d,u,m=e.extend({speed:4e3,minScrollWidth:0,startEvent:"mouseenter",stopEvent:"mouseleave",wrap:!1,ellips:0,wrapperWidth:0,animBack:!1,callback:!1},t);this.each(function(){var t=e(this);m.startEvent&&"all"!=m.startEvent?t.on(m.startEvent,function(){n(t),m.stopEvent&&t.on(m.stopEvent,function(){o(t)})}):n(t),m.stopEvent&&t.on(m.stopEvent,function(){if(m.animBack){clearTimeout(u);var e=(c-m.minScrollWidth)/100*m.speed*.5;u=setTimeout(function(){t.animate({"margin-left":"0"},{duration:e,step:function(e,t){},progress:function(e,t,a){},done:function(e,a){i(t)}})},300)}else o(t)})})}}(jQuery),app.menu.getSectionButtonsFunc=function(e,t,a,n){var o=$("#tmp-section-settings").html();return function(e,i){var s=$(o),r=s.find(".drop-down .btn"),l=s.find(".button-panel"),c=s.find(".move-menu"),d=s.find(".add-mod-btn"),u=l.find(".bg-panel-btn"),m=l.find(".exp-btn"),f=l.find(".del-sec-btn"),p=l.find(".dup-btn"),h=l.find(".move-sec-btn"),g=l.find(".copy-to-folio-btn"),v=l.find(".move-to-folio-btn"),b=s.find(".sec-btn"),y=t(e.BgColor,i.bgColor),C=function(){l.slideToggle(150),b.toggleClass("drop-down-open"),b.closest(".drop-down-container").toggleClass("showing"),b.closest(".edit-content").addClass("active"),c.hide()};return r.on("click",function(){var e=$(this);e.closest(".drop-down").find(".btn").not(e).removeClass("active"),e.toggleClass("active")}),c.on("click","button",function(){C(),i.move($(this).data("action"))}),u.on("click",function(){c.hide(),a.$node.toggle()}),f.on("click",function(){C(),i.del()}),p.on("click",function(){C(),i.dup()}),m.on("click",function(){C(),i.handleExport()}),h.on("click",function(){a.$node.hide(),c.toggle()}),g.on("click",function(){C(),n.copySectionPopup($(this).closest(".edit-div").index(),"Copy Section")}),v.on("click",function(){C(),n.copySectionPopup($(this).closest(".edit-div").index(),"Move Section",function(){i.del(!0)})}),d.on("click",function(){i.addModule()}),b.on("click",function(){l.slideToggle(150),b.toggleClass("drop-down-open"),b.closest(".drop-down-container").toggleClass("showing"),b.closest(".edit-content").addClass("active"),c.hide(),a.$node.hide(),a.mount(s,{url:e.BgUrl,colorPanel:y,bgUrl:i.bgUrl,reset:i.resetBg})}),{$node:s}}},app.menu.xSelect=function(){function e(e,t){t.siblings().removeClass("active"),t.addClass("active");var a=t.data("name")||t.text(),n=t.data("value"),o=n||a;e.data("value",o).find(".text").text(a)}var t=$(".x-select");$.each(t,function(t,a){var n=$(a),o=n.find(".popup-menu");n.on("click",".item",function(t){var a=$(this);n.hasClass("no-select")||a.hasClass("active")||(e(n,a),n.trigger("change"))}),n.on("val",function(t,a,o){e(n,n.find(".item[data-"+a+'="'+o+'"]'))}),o.length&&app.plugin.popupMenu(n,o)})},function(e){e.fn.xautocomplete=function(t){function a(e){return!!e&&(n(e),i>=e.length&&(i=0),i<0&&(i=e.length-1),void e[i].classList.add("autocomplete-active"))}function n(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}function o(t){if(t==s.get(0))return!1;var a=e(".autocomplete-items");return!!a.length&&(r.close?(r.close(t,a),!1):void a.each(function(){t!=e(this).get(0)&&e(this).remove()}))}var i,s=this,r=e.extend({minLength:2},t);return r.source(function(t){s.get(0).addEventListener("input",function(a){var n,l,c,d=this.value;if(o(),!d||d.length<r.minLength)return!1;i=-1,n=document.createElement("DIV"),n.setAttribute("id",this.id+"autocomplete-list"),n.setAttribute("class","autocomplete-items"),n.style.width=s.css("width"),n.style.position="absolute",n.style.backgroundColor="#ffffff",this.parentNode.appendChild(n);var u=!1;for(c=0;c<t.length;c++){var m=t[c].label,f=t[c].value,p=t[c].data;if(m.substr(0,d.length).toUpperCase()==d.toUpperCase()){u=!0,l=document.createElement("DIV");var h="<strong>"+m.substr(0,d.length)+"</strong>";if(h+=m.substr(d.length),r.addElement){var g=r.addElement(a,l,h,m,f,p);g.append("<input type='hidden' title='"+m+"' value='"+f+"'>"),g.on("click",function(t){var a=e(this).get(0),n=a.getElementsByTagName("input")[0].value,i=a.getElementsByTagName("input")[0].getAttribute("title");r.select?(s.val(i),r.select(t,l,n,p)):(s.val(n),o())}),e(n).append(g)}else h+="<input type='hidden' title='"+m+"' value='"+f+"'>",l.innerHTML=h,l.addEventListener("click",function(e){var t=this.getElementsByTagName("input")[0].value,a=this.getElementsByTagName("input")[0].getAttribute("title");r.select?(s.val(a),r.select(e,l,t,p)):(s.val(t),o())}),n.appendChild(l)}}return!u&&r.errorMsg?(l=document.createElement("DIV"),l.innerHTML=r.errorMsg,n.appendChild(l),!1):void 0})}),s.get(0).addEventListener("keydown",function(e){var t=document.getElementById(this.id+"autocomplete-list");t&&(t=t.getElementsByTagName("div")),40==e.keyCode?(i++,a(t)):38==e.keyCode?(i--,a(t)):13==e.keyCode&&(e.preventDefault(),i>-1&&t&&t[i].click())}),e(document).on("click",function(e){o(e.target)}),s.closest(".app-popup .paper").on("click",function(e){o(e.target)}),this}}(jQuery),function(e){e.fn.extend({addTimedClass:function(t,a,n){var o=this;return setTimeout(function(e){o.removeClass(t),n&&n(e,o)},a),this.each(function(){e(this).addClass(t)})}})}(jQuery),function(e){e.fn.xpassword=function(t){function a(){var e="";return"undefined"!=typeof window.getSelection?e=window.getSelection().toString():"undefined"!=typeof document.selection&&"Text"==document.selection.type&&(e=document.selection.createRange().text),e}function n(e){for(var t="",a=0;a<e;a++)t+="*";return t}var o=e.extend({preview:!1,previewFontClass:"eye"},t);return this.each(function(){var t=e(this),i="",s=e('<input type="hidden" />');if(t.before(s),o.preview){var r=e('<i class="'+o.previewFontClass+'"></i>');t.after(r),r.css({cursor:"pointer"}),r.on("click",function(){t.val(s.val()),setTimeout(function(){t.val(n(t.val().length))},2e3)})}s.attr("name",t.attr("name")),s.attr("id",t.attr("id")),s.addClass(t.attr("class")),s.addClass("hiddenpass"),t.attr("type","text").removeAttr("name").removeAttr("id"),t.on("keypress",function(e){var t=e.which;if(t>=32&&t<=127){var n=String.fromCharCode(t);a().length?s.val(n):s.val(s.val()+n)}}),t.on("keyup",function(e){var a=e.which;if(8==a){var o=t.val().length;s.val(s.val().substring(0,o))}else if(37==a);else{var r=t.val().length;t.val(n(r-1)+t.val().substring(r-1))}i&&clearTimeout(i),i=setTimeout(function(){t.val(n(t.val().length))},2e3)})}),this}}(jQuery),app.core.apiHelper=function(e,t,a,n,o){function i(t){return"__RequestVerificationToken="+e.verificationToken+(t?"&"+t:"")}function s(t){$.ajax({url:"/Account/RefreshToken",type:"POST",success:function(t,n,o){var i=$("<div />").html(t).find('input[type="hidden"]').val();i&&(e.verificationToken=i,a.raiseEvent("tokenRenewed"))},complete:t})}function r(e){function t(l){return!e.noPause&&Ot?void setTimeout(function(){t(l)},3e3):(l=l||2,void(n=o++<r?$.ajax({type:"POST",url:e.url,data:i(e.data),success:function(n,i,l){$("#saving-popup").removeClass("error").hide(),o=r,1==n.StatusCode?e.success&&e.success(n):401==n.StatusCode?(Ot=!0,o--,a.raiseEvent("loggedOut",function(){Ot=!1})):1001==n.StatusCode?(o--,$("#saving-popup").show().addClass("error").find(".popup-text").text("Not logged in."),s(function(){t(1)})):e.appError&&e.appError(n)},error:function(a,n,i){if("abort"!=n)if(o==r)e.error&&e.error(a,n,i);else{var s=Math.min(6e4,1e3*(l+l));setTimeout(t,s)}},complete:function(t,a){o==r&&e.complete&&e.complete(t,a)}}):null))}var n,o=0,r=e.maxAttempts||100;return t(),{abort:function(){o=r,n&&4!=n.readystate&&n.abort()}}}function l(t){r({url:"/Apiv1/SaveModuleRecord",maxAttempts:1,data:$.param({token:e.token,moduleId:t.moduleId,data:JSON.stringify(t.dataObj)}),success:t.success,appError:t.error,error:t.error})}function c(t){t&&t.ID&&t.ID>0&&r({url:"/Apiv1/DeleteModule",maxAttempts:999,data:$.param({token:e.token,moduleId:t.ID})})}function d(t){t&&r({url:"/Apiv1/DeleteModules",maxAttempts:999,data:$.param({token:e.token,moduleIds:t})})}function u(e,t,a,n){t.addClass("error"),a.html(n),setTimeout(function(){t.fadeOut("slow")},8e3),e.error()}function m(t,n,o,i){var s=new FormData(t),r=$("#uploading-popup"),l=r.find(".popup-text"),c=$('<span class="upload-progress"></span>');r.removeClass("error").show();try{if(n.type.indexOf("image")<0)return void u(o,r,l,"Please use an image for background.");if(i&&n.size>e.FreeUserLimitPerImage)return u(o,r,l,"File size exceeds the 1MB limit,  but if you upgrade to a premium plan you can upload images up to 5MB."),void a.raiseEvent("free-exceedsize");if(n.size>e.PaidUserLimitPerImage)return void u(o,r,l,"The image is too big. <br/>Maximum size for uploads is 5MB.")}catch(d){}r.find(".upload-progress").length||l.text("Uploading image").after(c),c.show(),s.append("token",e.token),s.append("type",o.type||"image"),s.append("custom",o.custom),s.append("__RequestVerificationToken",e.verificationToken),$.ajax({url:"/Apiv1/UploadImage",type:"POST",data:s,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return r.show(),e.upload.onprogress=function(e){c.text((e.loaded&&1/e.total*100).toFixed(0)+"%")},e.upload.onload=function(){l.text("Processing image .."),c.hide()},e},success:function(e,t,a){r.show(),1==e.StatusCode?(l.text("Image uploaded"),c.hide(),setTimeout(function(){l.text("Downloading image")},300),o.success&&o.success(e),$("<img>").attr("src",e.Message).on("load",function(){r.fadeOut(),o.imageLoaded&&o.imageLoaded(e.Message),$(this).remove()})):u(o,r,l,e.Message)},error:function(e,t,a){o.error(),l.text("Image Failed to process."),c.hide(),setTimeout(function(){r.hide(),c.show(),l.text("Uploading image")},2e3)}})}function f(t,a,n){$("#saving-popup").show().find(".popup-text").text("Deleting image"),r({maxAttempts:1,url:"/Apiv1/DeleteBgImage",data:$.param({token:e.token,imageId:t}),success:function(){$("#saving-popup").show().find(".popup-text").text("Done"),a()},appError:function(e){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n(e)},error:function(e,t,a){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n("Failed to connect. Please try again.")},complete:function(){setTimeout(function(){$("#saving-popup").fadeOut()},500)}})}function p(e){r({maxAttempts:e.maxAttempts||1,url:e.url,data:$.param(e.data),success:e.success,appError:e.error,noPause:e.noPause,error:function(t,a,n){e.error&&e.error({Message:"Failed to connect. Please try again."})},complete:e.complete})}function h(e){return e.replace(/[<>]/gi,"")}function g(e){return e.replace(new RegExp("&amp;","g"),"&")}function v(a){if(!a.isAuto||!e.renameAutoSaveDisabled){var n=$("#tmp-secondary-bar").find(".nav-save-section");n.addClass("saving");var o={token:a.token||e.token,name:h(a.name),isAuto:a.isAuto||!1};p({url:"/Apiv1/RenameFolio",data:o,success:function(o){n.removeClass("saving").addClass("saved"),setTimeout(function(){n.removeClass("saved")},1500),e.renameAutoSaveDisabled=!0,t&&(t.FolioName=a.name),a.success&&a.success(o)},error:a.error})}}function b(e){p({url:"/Apiv1/ChangeCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}function y(t){var a=t.teamId||0;0!==t.teamId&&e.Team&&e.Team.Id>0&&(a=t.teamId||e.Team.Id),p({url:"/Apiv1/Duplicate",data:{token:t.token,name:t.name,CopiedFromTemplate:t.fToken,teamId:a},success:t.success,error:t.error,complete:t.complete})}function C(t){p({url:"/Apiv1/ShareFolioByEmail",data:{token:t.token||e.token,modId:t.modId,message:t.message,emails:t.addresses&&$.trim(t.addresses)},success:t.success,error:t.error,complete:t.complete})}function T(e){p({url:"/Labels/ShareByEmail",data:{token:e.token,message:e.message,emails:e.addresses&&$.trim(e.addresses)},success:e.success,error:e.error,complete:e.complete})}function w(t){p({url:"/Apiv1/SetSlug",data:{token:t.token||e.token,slug:t.slug},success:t.success,error:t.error})}function x(t,a,n,o,i,s){console.log(s),p({url:"/Account/LoginAJAX",noPause:!0,data:{Email:t,Password:a,RememberMe:n,returnUrl:e.returnUrl+"#"+window.location.hash.substr(1),FolioToken:s},success:o,error:i})}function k(t,a,n){p({url:"/Account/RegisterAJAX",data:$.extend({refToken:e.refToken},t),success:function(e){try{window.intercomSettings=e.IntercomConfig,sendIntercom(),ga("send","event",{eventCategory:"Signup",eventAction:"Form Fill",eventLabel:"app.xtensio.com"})}catch(t){}a()},error:n})}function S(t,a,n){p({url:"/Account/RegisterTeamAJAX",data:$.extend({refToken:e.refToken},t),success:function(e){try{window.intercomSettings=e.IntercomConfig,sendIntercom(),ga("send","event",{eventCategory:"Signup",eventAction:"Form Fill",eventLabel:"app.xtensio.com"})}catch(t){}a()},error:n})}function D(e){p({url:"/Account/ResendConfirmationEmailAJAX",data:{Email:e.email},success:e.success,error:e.error})}function I(e){p({url:"/Account/ForgotPassword",data:{Email:e.email},success:e.success,error:e.error,appError:e.error})}function P(e){p({url:"/Account/ChangePassword",data:{OldPassword:e.oldPassword,NewPassword:e.newPassword,ConfirmPassword:e.confirmPassword},success:e.success,error:e.error})}function E(e){p({url:"/Account/ChangeEmail",data:{email:e.email},success:e.success,error:e.error})}function F(e){p({url:"/Account/ChangeName",data:{name:e.fullName},success:e.success,error:e.error})}function A(t){p({url:"/Apiv1/Export",data:{token:e.token,html:t.html,format:t.format,settings:t.settings&&JSON.stringify(t.settings)},success:t.success,error:function(a){6==a.StatusCode&&(e.plusExpireTime=Date.now()),t.error(a)},complete:t.complete})}function M(e){p({url:"/Apiv1/GetExportCreditsLeft",data:{},success:e.success,error:e.error,complete:e.complete})}function N(e){p({url:"/Apiv1/GetCreditsLeft",data:{},success:e.success,error:e.error,complete:e.complete})}function O(t){p({url:t.isLabel?"/labels/SetPass":"/Apiv1/SetFolioPass",data:{token:t.token,pass:t.pass},success:t.success,error:function(a){6==a.StatusCode&&(e.plusExpireTime=Date.now()),t.error(a)},complete:t.complete})}function U(t){p({url:t.isLabel?"/labels/RemovePass":"/Apiv1/RemoveFolioPass",data:{token:t.token},success:t.success,error:function(a){6==a.StatusCode&&(e.plusExpireTime=Date.now()),t.error(a)},complete:t.complete})}function R(e){r({maxAttempts:1,url:"/Apiv1/GetFreePlusInfo",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function L(t){p({url:"/Apiv1/SubmitFolio",data:{token:t.token||e.token},success:t.success,appError:t.appError,error:t.error})}function B(t){p({url:"/Apiv1/ChangePresentationMode",data:{token:t.token||e.token,isPresentable:t.present},success:t.success,appError:t.appError,error:t.error})}function G(e){p({url:"/Apiv1/DeleteFolio",data:e.data,success:e.success,error:e.error,
complete:e.complete})}function H(e){p({url:"/Apiv1/EmptyTrash",data:{},success:e.success,error:e.error,complete:e.complete})}function q(e){p({url:"/Apiv1/GetFolioByToken",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}function Y(e){p({url:"/Apiv1/GetFolioFullByToken",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}function z(e,t){p({url:e.isLabel?"/labels/ChangePrivacy":"/Apiv1/ChangeFolioPrivacy",data:{token:e.Token,isPrivate:e.Private,isIndexed:e.Indexed},success:t.success,error:t.error,complete:t.complete})}function j(e){p({url:"/Apiv1/GetTemplateMods2",data:{name:e.name,id:e.token},success:e.success,error:e.error,complete:e.complete})}function _(e){p({url:"/Apiv1/GetMaxTag",data:{count:e.count,token:e.token},success:e.success,error:e.error,complete:e.complete})}function K(e){p({url:"/Apiv1/AddCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}function V(e){p({url:"/TeamApi/AddSingleFolioGuest",data:{members:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}function W(e){p({url:"/TeamApi/ReSendEmailNotificationSFG",data:e.data,success:e.success,error:e.error,complete:e.complete})}function J(t){t.teamId=0,e.Team&&e.Team.Id>0&&(t.teamId=e.Team.Id),p({url:"/Apiv1/TransferFolio",data:t.data,success:t.success,error:t.error,complete:t.complete})}function X(t){t.teamId=t.teamId||0,e.Team&&e.Team.Id>0&&(t.teamId=t.teamId||e.Team.Id),p({url:"/Apiv1/ProcessTransfer",data:t.data,success:t.success,error:t.error,complete:t.complete})}function Q(e){p({url:"/Apiv1/ProcessCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Z(e){p({url:"/TeamApi/ProcessSingleFolioGuest",data:e.data,success:e.success,error:e.error,complete:e.complete})}function ee(e){p({url:"/TeamApi/RemoveSingleFolioGuest",data:e.data,success:e.success,error:e.error,complete:e.complete})}function te(t){p({url:"/Apiv1/UpgradeFolio",data:{token:e.token||t.token},success:t.success,error:t.error,complete:t.complete})}function ae(e){p({url:"/Apiv1/GetModRecords",data:{id:e.id},success:e.success,error:e.error,complete:e.complete})}function ne(e){p({url:"/Apiv1/EmailSettings",data:e.data||{},success:e.success,error:e.error,complete:e.complete})}function oe(e){p({url:"/Apiv1/FindUser",data:{email:e.email},success:e.success,error:e.error,complete:e.complete})}function ie(e){p({url:"/Apiv1/GetUserActiveFolios",data:{},success:e.success,error:e.error,complete:e.complete})}function se(e){p({url:"/Apiv1/GetFolioDataPoints",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}function re(e){p({url:"/Apiv1/GetUserTemplateCount",data:{},success:e.success,error:e.error,complete:e.complete})}function le(e,t){p({url:e,data:t.data,success:t.success,error:t.error,complete:t.complete})}function ce(e){le("/Apiv1/ModStore",e)}function de(e){le("/Apiv1/FolioStore",e)}function ue(e){p({url:"/billing/changecard/",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}function me(e){p({url:"/billing/purchase/",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}function fe(e){p({url:"/billing/changeplan/",data:e.data,success:e.success,error:e.error,complete:e.complete})}function pe(t){var a=0;e.Team&&e.Team.Id>0&&(a=e.Team.Id),p({url:"/create/"+t.id,data:{teamId:a},success:t.success,error:t.error,complete:t.complete})}function he(e){p({url:"/labels/create",data:{name:e.name,title:e.title||"",desc:e.desc||""},success:e.success,error:e.error,complete:e.complete})}function ge(e){p({url:"/labels/change",data:{token:e.token,list:e.list},success:e.success,error:e.error,complete:e.complete})}function ve(e){p({url:"/labels/ChangeCollabChan",data:{token:e.token,labelToken:e.labelToken},success:e.success,error:e.error,complete:e.complete})}function be(e){p({url:"/labels/RemoveLableFromFolioCollabChan",data:{token:e.token,labelId:e.id},success:e.success,error:e.error,complete:e.complete})}function ye(e){p({url:"/labels/RemoveLableFromFolio",data:{token:e.token,labelId:e.id},success:e.success,error:e.error,complete:e.complete})}function Ce(e,t){p({url:"/labels/ChangeLabelProps",data:{labelId:e.Token,title:e.Title,desc:e.Description},success:t.success,error:t.error,complete:t.complete})}function Te(e){p({url:"/labels/ChangeLabelName",data:{labelId:e.token,name:e.name},success:e.success,error:e.error,complete:e.complete})}function we(e){p({url:"/labels/MakeDefault",data:{labelId:e.token},success:e.success,error:e.error,complete:e.complete})}function xe(e){p({url:"/labels/remove",data:{labelId:e.token},success:e.success,error:e.error,complete:e.complete})}function ke(e){p({url:"/labels/RemoveCollabChan",data:{labelId:e.token},success:e.success,error:e.error,complete:e.complete})}function $e(e){p({url:"/labels/getLabelOwner",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}function Se(t){var a=0;e.Team&&e.Team.Id>0&&(a=e.Team.Id),p({url:"/labels/GetWorkspaceChannels",data:{teamId:t.teamId},success:t.success,error:t.error,complete:t.complete})}function De(e){p({url:"/labels/CreateCollabChan",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Ie(e){p({url:"/labels/SaveChannelCollaborators",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Pe(e){p({url:"/labels/ChangeChannelAccess",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Ee(e){p({url:"/labels/GetLabelOwner",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Fe(e){p({url:"/labels/GetChannelCollaborators",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Ae(e){p({url:"/apiv1/GetDashboardData",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Me(e){p({url:"/labels/AddMultipleChannelCollaborators",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Ne(e){p({url:"/labels/AddRemoveChannelCollaborator",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Oe(e){p({url:"/apiv1/version",data:e.data,success:e.success,error:e.error,complete:e.complete})}function Ue(e){p({url:"/Apiv1/GetFolioCollaborators",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}function Re(e){p({url:"/Apiv1/UserInAppNotifications",data:{email:e.data.userEmail,nextCount:e.data.nextCount},success:e.success,error:e.error,complete:e.complete})}function Le(e){p({url:"/apiv1/SaveFolio",data:{data:e.data,token:t.Token},success:e.success,error:e.error,complete:e.complete})}function Be(e){p({url:"/apiv1/GetTagStore",data:{token:t.Token},success:e.success,error:e.error,complete:e.complete})}function Ge(e){p({url:"/Apiv1/Pull",data:{timestamp:e.data.timestamp,token:e.data.token,connectionId:e.data.connecId},success:e.success,error:e.error,complete:e.complete})}function He(e){p({url:"/TeamApi/CheckTeamURL",data:{data:e.data.teamUrl},success:e.success,error:e.error,complete:e.complete})}function qe(e){p({url:"/TeamApi/SaveTeam",data:{email:e.data.email,teamMem:JSON.stringify(e.data.members),teamId:e.data.teamId,imageID:e.data.imageID,data:JSON.stringify(e.data.data)},success:e.success,error:e.error,complete:e.complete})}function Ye(e){p({url:"/Billing/PurchaseTeam",data:{teamInfo:JSON.stringify(e.data.teamInfo),billingInfo:JSON.stringify(e.data.billingInfo)},success:e.success,error:e.error,complete:e.complete})}function ze(e){p({url:"/Billing/RemoveTeamMember/",data:{userEmail:e.userEmail},success:e.success,error:e.error,complete:e.complete})}function je(e){p({url:"/Billing/AddTeamMembers/",data:{teamMembers:JSON.stringify(e.data.teamMembers)},success:e.success,error:e.error,complete:e.complete})}function _e(e){p({url:"/TeamApi/DeleteTeam",data:{email:e.data.email,teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}function Ke(e){p({url:"/TeamApi/GetTeamMembers",data:{teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}function Ve(e){p({url:"/TeamApi/GetAllMembers",data:{teamId:e.data.teamId},success:e.success,error:e.error,complete:e.complete})}function We(t,a,n){var o=new FormData(t),i=$("#uploading-popup"),s=i.find(".popup-text"),r=$('<span class="upload-progress"></span>');n.isProgress&&i.removeClass("error").show();try{if(a.type.indexOf("image")<0)return void(n.isProgress?u(n,i,s,"Please use an image for background."):n.error("Please use an image for background."));if(a.size>e.PaidUserLimitPerImage)return void(n.isProgress?u(n,i,s,"The image is too big. Maximum size for uploads is 5MB."):n.error("The image is too big. Maximum size for uploads is 5MB."))}catch(l){}n.isProgress&&(i.find(".upload-progress").length||s.text("Uploading image").after(r),r.show()),o.append("token",e.teamId),o.append("type",n.type||"image"),o.append("custom",n.custom),o.append("__RequestVerificationToken",e.verificationToken),o.append("file",a),$.ajax({url:"/TeamApi/UploadTeamImage",type:"POST",data:o,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){},e.upload.onload=function(){},e},success:function(e,t,a){n.isProgress?(i.show(),1==e.StatusCode?(s.text("Image uploaded"),r.hide(),setTimeout(function(){s.text("Downloading image")},300),n.success&&n.success(e),$("<img>").attr("src",e.Message).on("load",function(){i.fadeOut(),n.imageLoaded&&n.imageLoaded(e.Message),$(this).remove()})):u(n,i,s,"Error. Please try again.")):1==e.StatusCode?n.success(e):n.error("Error. Please try again.")},error:function(e,t,a){n.isProgress?n.error():n.error(a)}})}function Je(t,a,n){$("#saving-popup").show().find(".popup-text").text("Deleting image"),r({maxAttempts:1,url:"/TeampApi/DeleteTeamImage",data:$.param({teamId:e.teamId,imageId:t}),success:function(){$("#saving-popup").show().find(".popup-text").text("Done"),a()},appError:function(e){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n(e)},error:function(e,t,a){$("#saving-popup").show().find(".popup-text").text("Error encountered"),n&&n("Failed to connect. Please try again.")},complete:function(){setTimeout(function(){$("#saving-popup").fadeOut()},500)}})}function Xe(e){p({url:"/Apiv1/GetInvoiceTabData",data:{},success:e.success,error:e.error,complete:e.complete})}function Qe(e){p({url:"/Apiv1/GetUserFolios",data:{teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}function Ze(e){p({url:"/Apiv1/GetUserOwnFolios",data:{teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}function et(e){p({url:"/Apiv1/CopySections",data:{sourceToken:e.sourceToken,destinationToken:e.destinationToken,sectionTag:e.sectionTag,order:e.order,action:e.action},success:e.success,error:e.error,complete:e.complete})}function tt(e){p({url:"/TeamApi/MoveFolios",data:{userEmail:e.userEmail,source:e.source,destination:e.destination,folios:e.folios},success:e.success,error:e.error,complete:e.complete})}function at(e){p({url:"/Apiv1/UpdateNotification",data:{id:e.notificationId,teamId:e.teamId},success:e.success,error:e.error,complete:e.complete})}function nt(e){p({url:"/Apiv1/SaveAsTemplate",data:{token:e.token,name:e.name,teamId:e.teamId,CopiedFromTemplate:e.CopiedFromTemplate},success:e.success,error:e.error,complete:e.complete})}function ot(e){p({url:"/Apiv1/DeleteTemplate",data:{token:e.token,op:e.op},success:e.success,error:e.error,complete:e.complete})}function it(e){p({url:"/TeamApi/AddResendUser",data:{userEmail:e.userEmail,userRole:e.userRole,teamId:e.teamId,folioToken:e.folioToken||"",accessType:e.accessType||""},success:e.success,error:e.error,complete:e.complete})}function st(e){p({url:"/billing/ChangeAccess",data:{userEmail:e.userEmail,userRole:e.userRole,teamId:e.teamId,folioToken:e.folioToken||"",accessType:e.accessType||""},success:e.success,error:e.error,complete:e.complete})}function rt(e){r({maxAttempts:1,type:"GET",url:"/Apiv1/SearchFont",data:$.param(e.data),success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function lt(e){r({maxAttempts:1,type:"GET",url:"/Apiv1/GetAllFonts",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function ct(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/MakeDefault",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function dt(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/AddFont",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function ut(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/RemoveFont",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function mt(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/RestoreDefaultFonts ",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function ft(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/SavePalette",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function pt(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/AddColor",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function ht(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/UpdateColor",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function gt(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/RemoveColor",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function vt(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/MakeColorDefault",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function bt(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/RestoreDefaultColors",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function yt(t,a,n,o){var i=new FormData(t);i.append("token",e.teamId),i.append("__RequestVerificationToken",e.verificationToken),i.append("file",a),i.append("swatchSource",n.source||1),$.ajax({url:"/Apiv1/UploadSwatch",type:"POST",data:i,processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){},e.upload.onload=function(){},e},success:function(e,t,a){n.success(e)},error:function(e,t,a){n.error(a)}})}function Ct(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/GetDefaultStyleGuideForTeamCreation",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function Tt(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/RemoveFoliosCurl",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function wt(e){r({maxAttempts:1,data:$.param(e.data),type:"GET",url:"/Apiv1/GetStyleGuides",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function xt(e){var t=JSON.stringify(e.data.data);p({url:"/Apiv1/SaveFrontEndLog",data:{data:t},success:e.success,error:e.error,complete:e.complete})}function kt(e){p({url:"/Apiv1/UpdateFoliosCurl",data:{curl:e.curl,token:e.token},success:e.success,error:e.error,complete:e.complete})}function $t(e){p({url:"/Apiv1/CheckCurlIsAvailable",data:{curl:e.curl,token:e.token},success:e.success,error:e.error,complete:e.complete})}function St(e){r({maxAttempts:1,type:"POST",url:"/Apiv1/SetGdprConsent",success:e.success,appError:e.error,error:function(t,a,n){e.error&&e.error("Failed to connect. Please try again.")},complete:e.complete})}function Dt(e){p({url:"/Apiv1/GetFoliosCurl",data:{token:e.token},success:e.success,error:e.error,complete:e.complete})}function It(e){p({url:"/Apiv1/CreateFolio",data:{teamId:e.teamId,token:e.folioToken,data:JSON.stringify(e),id:e.templateId},success:e.success,error:e.error,complete:e.complete})}function Pt(e){p({url:"/Apiv1/SetOnboardingStatus",data:{step:e.step,onboardingType:e.onboardingType},success:e.success,error:e.error,complete:e.complete})}function Et(e){p({url:"/billing/ChangeTeamPlan",data:{plan:e.plan},success:e.success,error:e.error,complete:e.complete})}function Ft(e){p({url:"/billing/PurchaseCredits",data:{data:JSON.stringify(e.data)},success:e.success,error:e.error,complete:e.complete})}function At(e){p({url:"/billing/PurchaseCreditsWithoutCard",data:{data:JSON.stringify(e)},success:e.success,error:e.error,complete:e.complete})}function Mt(e){p({url:"/TeamApi/GetUserTeamsAndFolios",data:{userEmail:e.userEmail},success:e.success,error:e.error,complete:e.complete})}function Nt(e){p({url:"/Billing/PurchaseTeamWithoutCheckout",data:{teamInfo:JSON.stringify(e.data.teamInfo),billingInfo:JSON.stringify(e.data.billingInfo)},success:e.success,error:e.error,complete:e.complete})}var Ot=!1;return $("#saving-popup").append($("#spinner-container > .loading-animation").clone().addClass("size-30")),{signIn:x,signUp:k,TeamSignUp:S,deleteModule:c,deleteModules:d,sendShareEmail:C,sendLabelEmail:T,uploadImage:m,deleteImage:f,saveModuleRecord:l,resendEmail:D,forgotPassword:I,changePassword:P,changeEmail:E,changeFullName:F,sanitizeText:h,cleanAmp:g,renameFolio:v,setSlug:w,duplicateFolio:y,exportFolio:A,setObjPass:O,removeObjPass:U,getFreePlusInfo:R,getFolioByToken:q,getFolioFullByToken:Y,deleteFolio:G,submitFolio:L,updatePrivacy:z,getMaxTag:_,templateMods:j,addCollaborator:K,changeCollaborator:b,transfer:J,upgradeFolio:te,getRecords:ae,emailSettings:ne,findUser:oe,processTransfer:X,processCollaborator:Q,modStore:ce,folioStore:de,card:ue,buy:me,changePlan:fe,createFolio:pe,createLabel:he,changeLabels:ge,changeCollabChan:ve,removeFromCollabChan:be,changeLabelProps:Ce,renameLabel:Te,removeLabel:xe,removeCollabChan:ke,makeLabelDefault:we,getChannelOwner:$e,getChannelCollaborators:Fe,addMultipleChannelCollaborators:Me,addRemoveChannelCollaborator:Ne,getLabelOwner:Ee,getWorkspaceChannels:Se,createCollabChan:De,saveChannelCollaborators:Ie,changeChannelAccess:Pe,getDashboardData:Ae,getFolioCollaborators:Ue,folioVersion:Oe,getTagStore:Be,changePresentMode:B,saveFolioSnapShot:Le,removeFromLabels:ye,loadNotifications:Re,getRecentMessages:Ge,checkTeamURL:He,uploadTeamImage:We,deleteTeamImage:Je,saveTeam:qe,deleteTeam:_e,listTeamMembers:Ke,listALLMembers:Ve,getExportCreditsLeft:M,getCreditsLeft:N,getUserActiveFoliosCount:ie,getStripInvoiceData:Xe,getFolioDataPoints:se,getUserFolios:Qe,getUserOwnFolios:Ze,getCopySections:et,moveUserFolios:tt,addSingleFolioGuest:V,removeSingleFolioGuest:ee,setUserDefinedTeam:at,resendSFGEmailNotification:W,processSFG:Z,saveAsTemplate:nt,deleteUserTemplate:ot,getUserTemplateCount:re,resendTeamUser:it,changeMemberAccess:st,purchaseTeam:Ye,addMembers:je,removeMember:ze,emptyTrash:H,searchFonts:rt,getAllFonts:lt,makeDefault:ct,addFont:dt,removeFont:ut,savePalette:ft,updateColor:ht,addColor:pt,removeColor:gt,makeColorDefault:vt,restoreDefaultFonts:mt,restoreDefaultColors:bt,uploadSwatch:yt,getDefaultStyleTeamCreation:Ct,getStyleGuides:wt,saveLog:xt,setGdprConsent:St,updateFolioCurl:kt,checkCurlAvailability:$t,getFolioCurl:Dt,removeFoliosCurl:Tt,saveFolio:It,setOnboardingStatus:Pt,changeTeamPlan:Et,buyCredits:Ft,getUserTeamsAndFolios:Mt,buyCreditsWithoutCard:At,purchaseTeamWithoutCheckout:Nt}},app.core.appHub=function(e,t,a,n,o,i){function s(e){console.log(e)}function r(e){}function l(e){te=!0,e&&"function"==typeof e&&e();var t=[];$.each(o.Modules,function(e,a){"EmptyModule"!==a.Type&&t.push({Tag:a.Tag||0,ModType:a.Type,ModId:a.ID||0,Data:JSON.stringify(a.Data)})}),i.saveFolioSnapShot({data:JSON.stringify(t),success:function(e){console.log("saveFolioSnapShot response",e),ee="Success"!==e.Status},error:function(e){ee=!0,console.log("saveFolioSnapshot error",e)},complete:function(e){te=!1}})}function c(){if(e.editMode){var t=ae;"undefined"!=typeof e.saveInterval&&n.isNumber(e.saveInterval)?(t=parseInt(e.saveInterval,10),console.log("config.saveInterval",e.saveInterval)):console.log("config.saveInterval is undefined or not set properly. Defaulting interval to 60 secs"),console.log("saveTimer",t),k=setInterval(function(){console.log(ee,Y,te,B),!ee||Y||te||B?B&&(console.log("Quit trying to save."),clearInterval(k)):l(function(){console.log("saveSnapShot called at timerSaveInterval")})},t)}}function d(e,t){var a=new Array;if(!e[0]||!t[0])return!1;if(e.length!=t.length)return!1;if(0==e.length&&0==t.length)return!0;for(var n=0;n<e.length;n++)key=typeof e[n]+"~"+e[n],a[key]?a[key]++:a[key]=1;for(var n=0;n<t.length;n++){if(key=typeof t[n]+"~"+t[n],!a[key])return!1;if(0==a[key])return!1;a[key]--}return!0}function u(e,t){M[e]=t}function m(e,t,a){T>5?R.server.send(e,JSON.stringify(t)).done(function(e){a&&a(e)}):setTimeout(function(){m(e,t,a)},3e3)}function f(t){$.connection.hub.start({transport:"webSockets"}).done(function(){ge&&(e.editMode&&l(function(){console.log("saveSnapShot called from start().done()")}),ge=!1),r("connection was successful SignalR"),I[$.connection.hub.id]={},T=7,t&&t(),e.editMode&&ie("on",!0),J=$.connection.hub.id}).fail(function(){s("connection failed SignalR"),T=0,r("try again in 10 sec"),setTimeout(f,1e4),s("sync lost"),e.editMode&&ie("synclost"),Y=!0})}function p(e,t){if(r("\n ----------------------------\n sending to server"),w=!0,O=!1,U(1),r("calling timertodisc 1"),se(1),!B)try{R.server.saveMods(o.Token,JSON.stringify(e)).always(function(){w=!1}).fail(function(e){s("server sending fail",e),r("rechecking connection"),ve()}).done(function(a){r("data sent to server, waiting for result",JSON.stringify(e)),r("res: from server : ",a),1==a.Status?(r("server save successful, call cb"),t&&t(a.TagMap)):(s("server returned error status : ",a.Status),console.error(a))})}catch(a){s("exception: "+a),ve()}finally{}}function h(e){o.LastSavedUtc=Date.now(),U(2,o.LastSavedUtc),r("saving done, calling timertodisc 2"),se(2),$.each(e,function(e,t){var a=n.obtain(P,"Tag",t.Tag);if(a){a.ID=t.Id,E[a.Key]=0,a.lastSavedData=a.dataToSave,n.removeFromList(N,null,"Tag",a.Tag),n.removeFromList(P,a);var o=A[a.Tag];o&&o()}})}function g(e,t){clearTimeout(x),n.pushUnique(N,{Tag:e.Tag||0,ModType:e.Type,ModId:e.ID||0,Data:e.dataToSave}),x=setTimeout(function(){r("\n\n sending to server from queue in 3 sec"),p(N,t)},3e3)}function v(e,t){E[e.Key]=1,A[e.Tag]=t,r("pushing to save queue"),g(e,h)}function b(e,t){if(r("\n\n======================================\n\n"),r("process save called"),Y){s("browser is dc");var a={type:"processSave",mod:e,success:t};return r("browser was dc, pushing to queue"),void j.push(a)}return r("browser available"),e.Tag?(ee=!0,void(E[e.Key]||e.suspend?(r("case 1"),r("in progress or suspend, try again in 1 sec"),setTimeout(function(){b(e,t)},1e3)):(r("case 2"),e.dataToSave=JSON.stringify(e.Data),e.Syncd||e.dataToSave==e.lastSavedData||o.Role<2?(r("case 2.1"),e.Syncd&&(e.Syncd=null),o.LastSavedUtc=Date.now(),U(2,o.LastSavedUtc),r("calling timer to dc 2 "),se(2),r("removeFromList pending save "),n.removeFromList(P,e),t&&t()):(r("case 2.2"),r("sync module with server, push to nunique queu"),n.pushUnique(P,e),r("save module to server"),v(e,t))))):void r("nothing to save, return")}function y(e){r("Ping an image on server");var t=new Image;t.src="https://app.xtensio.com/img/v-"+Date.now()+"-xtensio-icon.jpg",t.onload=function(){e(!0)},t.onerror=function(){e(!1),Z=!0}}function C(e,t,a){var n=e.Tag||0;n>0?(e["onReg"+t]&&e["onReg"+t](),F[n+t]=a):"EmptyModule"!=e.Type&&setTimeout(function(){C(e,t,a)},500)}var T,w,x,k,S=e.timeStamp,D=Date.now(),I={},P=[],E={},F=[],A=[],M=[],N=[],O=!0,U=app.editor.saveSpinner,R=$.connection.appHub,L=(e.msgType,$("#notify-popup")),B=!1,G=null,H=!1,q=!1,Y=!1,z=[],j=[],_=null,K=12e4,V=null,W=!1,J="",X=0,Q=!1,Z=!1,ee=!1,te=!1,ae=6e4,ne=function(){setInterval(function(){if(0==X)X=Date.now();else{var t=Date.now();t-X>13e4?(r(t-X+" > 130000"),s("unable to connect, notify popup unable"),e.editMode&&ie("unable")):X=Date.now()}},1e4)};ne();var oe=function(){return Y},ie=function(t,a){if(!Q&&(e.editMode||e.userName)&&!L.hasClass("logged-in")&&!(L.hasClass("unable")||L.hasClass(t)||L.hasClass("off")&&("synclost"==t||"stilltrying"==t)||L.hasClass("stilltrying")&&"synclost"==t||"stilltrying"==t&&L.hasClass("savingdelayed")||L.hasClass("savingdelayed")&&"on"==t&&a||L.hasClass("savingdelayed")&&"synclost"==t||(clearTimeout(_),"on"==t&&7!=T))){L.removeClass("off on unable synclost stilltrying savingdelayed gettingchanges logged-in "),L.addClass(t).show(),"synclost"==t&&(_=setTimeout(function(){e.editMode&&ie("stilltrying")},15e3));$(".add-module-button, .module-button.dup-btn, .module-button.del-btn, .module-button.del-sec-btn, .preview-bottom .white-blue-btn,.empty-module .add-btn, .settings-btn.add-mod-btn, .tag-module .tag-close, .slider-outer .item-close-btn, .images-module .close-btn, .donut-module .breakup-row .item-close-btn"),$(".settings-btn.gallery-btn, .settings-btn.img-btn");"off"!=t&&"stilltrying"!=t&&"savingdelayed"!=t||($("body").addClass("no-internet"),e.editMode&&(W=!0,V=setTimeout(function(){W&&e.editMode&&ie("unable")},K))),"on"==t&&(W=!1,clearTimeout(V),$("body").removeClass("no-internet"),$("body").removeClass("block-reload"),_=setTimeout(function(){L.fadeOut(500)},2500),e.editMode&&he()),"unable"==t&&(console.trace(),$.connection.hub.stop(),B=!0,$("body").addClass("block-reload"))}},se=function(t){r("timertodsc : "+t),e.editMode&&(1===t?(r("in timerdesc 1"),H=!1,r("call this function in 15 sec"),G=setTimeout(function(){return H?void r("every thing was good, watchstop ",H):(s(" Sync was delayed",H,console.trace()),e.editMode&&ie("savingdelayed"),void(G=setTimeout(function(){return H?void r("watchstop was true returning ",H):(r("watchstop was false ",H),s("unable to connect, show unable popup notify",H),void(e.editMode&&ie("unable")))},K)))},15e3)):2===t&&(r("timerToDisc in 2, system online "),r("clear timeout"),r("watchstop, true"),clearTimeout(G),H=!0,r("change notifyPopup on"),e.editMode&&ie("on")))};R.client.update=function(e,a){t.raiseEvent("hubMsg",e,JSON.parse(a))},R.client.editor=function(a,n,i,s){if(I[s]={email:n,name:i,time:Date.now()},t.raiseEvent("editorStatus",{email:n,status:2==a?2:1}),1==a){R.server.editorPing(e.userEmail,e.fullName,o.Token);var r=e.currentlyEditing[e.userEmail];r&&Date.now()-r.time<=6e4&&ye(r,"Editor",e.userEmail)}else 2==a&&delete I[s]};var re=null,le=null,ce=null;R.client.syncMod=function(e,t,a,n,o){var i=!1,s=!1;o&&(i=0!=o,s=2==o);var l=F[e+t];if(r("got",t,"for",e,"val",a,"timestamp",n),Y&&!i){var c={tag:e,prop:t,val:a,ts:n};z.indexOf(c)<0&&z.push(c)}else if(l){if(S>n&&!s)return void r("old message returned",S,n,e,t,a);if(S==n&&e==re&&t==le&&a==ce)return void r("old message returned",S,n,e,t,a);re=e,le=t,ce=a,"Editor"==t||s||(S=n),D=Date.now(),l(e,a)}};var de=50,ue=function(e){setTimeout(function(){"syncSend"==j[e].type?(r(j[e].mod,j[e].prop,j[e].val),ye(j[e].mod,j[e].prop,j[e].val)):(r(j[e].mod,j[e].success),b(j[e].mod,j[e].success))},de*e)},me=function(){r("afterDiscArr",j);var e=0,t=j.length;for(e=0;e<j.length;e++)ue(e);setTimeout(function(){j=[]},de*t)},fe=function(e,t){r("processRecievedMsgs",e,F);for(var a=0;a<e.length;a++)t!=e[a].ConnectionId?R.client.syncMod(e[a].Tag,e[a].Prop,e[a].Value,e[a].TimeStamp,1):r("Msg from current User Ignored");r("processing after reconnect preprocessed messages",z.length);for(var a=0;a<z.length;a++){for(var n=!1,o=0;o<e.length;o++)if(e[o].TimeStamp==z[a].ts&&(e[o].Tag==z[a].tag,e[o].Prop==z[a].prop&&(r("duplicate Check",e[o].Value,z[a].val),jQuery.type(e[o].Value)==jQuery.type(z[a].val)))){var i=jQuery.type(e[o].Value);"boolean"==i||"number"==i||"string"==i?e[o].Value==z[a].val&&(n=!0):"array"==i?d(e[o].Value,z[a].val)&&(n=!0):n=!0}n||R.client.syncMod(z[a].tag,z[a].prop,z[a].val,z[a].ts,2)}z=[]},pe=0,he=function(){var t="";r("callbacksArr",z),r("afterDiscArr",j),r("timestamp",S),r("browserwasDC",Y),r("currConnectId",J),t=J==$.connection.hub.id?$.connection.hub.id:J,setTimeout(function(){J=$.connection.hub.id},5e3),i.getRecentMessages({data:{token:e.token,timestamp:S,connecId:t},success:function(e){r(e);var a=JSON.parse(e.Data),n=a.Messages;if(pe=0,r("msgs",n),2==e.StatusCode)return void(Y=!1);for(var o=a.MaxCount,i=n.length,s=!1,l=!1,c=!1,d=!1,u=0;u<n.length;u++)n[u].TimeStamp>S&&t!=n[u].ConnectionId&&(s=!0),t==n[u].ConnectionId&&(l=!0),n[u].TimeStamp>S&&(c=!1);(n[0].TimeStamp<=S&&n[n.length-1].TimeStamp>=S||i<o||l)&&(c=!0),r("has Time Stamp",n[0].TimeStamp,S,n[n.length-1].TimeStamp,n[0].TimeStamp<=S,n[n.length-1].TimeStamp>=S),n[n.length-1].ConnectionId==t&&(d=!0),r("has Latest",t,n[n.length-1].ConnectionId),s=c&&!d,r("hasNewMsg",s),c?Y&&j.length>0&&s?app.popup.message({heading:"This folio has been updated",message:"This folio was updated when you were disconnected, would you like to merge (may overwrite their changes) or reload to discard your changes",btnText:"Merge the changes",cancelText:"Reload",noClose:!0,handleOK:function(){fe(n,t),Y=!1,me()},handleNo:function(){B=!0,window.location.reload()}}):Y&&j.length<1&&s?(fe(n,t),Y=!1):(Y=!1,me()):app.popup.message({heading:"This folio has been updated",message:"We were unable to merge changes kindly reload to continue editing.",btnText:"Reload",handleOK:function(){B=!0,window.location.reload()}})},error:function(e){e.StatusCode?pe=0:pe++;var t=Date.now()-D>3*K;return 3!=e.StatusCode||t?(2==e.StatusCode?(Y=!1,me()):e.StatusCode?app.popup.message({heading:"Error",message:"Unable to merge kindly reload to continue.",btnText:"Reload",handleOK:function(){window.location.reload()}}):e.StatusCode||setTimeout(function(){pe<3?he():app.popup.message({heading:"Error",message:"Unable to connect to Xtensio servers. Kindly reload to continue.",btnText:"Reload",handleOK:function(){window.location.reload()}})},3e3),r("next error is minor"),void console.error(e)):void app.popup.message({heading:"This folio has been updated",message:"We were unable to merge changes kindly reload to continue editing.",btnText:"Reload",handleOK:function(){B=!0,window.location.reload()}})}})};R.client.onEvent=function(e,t){r("appHub.client.onEvent",e,"data",t);var a=M[e];a&&a(t)};var ge=!1;$.connection.hub.reconnecting(function(){e.editMode&&ie("off"),s("trying to reconnect signalR, set browserwasDC"),Y=!0,T=1}),$.connection.hub.reconnected(function(){ge&&(ge=!1),T=7,setTimeout(function(){r("reconnected to signalR"),e.editMode&&ie("on",!0)},1e3)}),$.connection.hub.connectionSlow(function(){T=6,s("slow connection from signalR, synclost"),e.editMode&&ie("synclost")}),$.connection.hub.disconnected(function(){ge||(ge=!0,s("disconnected from signalR, set browserwasDC, synclost"),T=0,setTimeout(f,3e3),e.editMode&&ie("synclost"),Y=!0)}),e.editMode&&o&&(U(2,o.LastSavedUtc),r("in edit mode calling timertodisc 2"),se(2),$.connection.hub.qs={fid:o.Token},$(window).on("beforeunload",function(e){Q=!0,l(function(){console.log('saveSnapShot called from window.on("beforeunload")')})}));var ve=function(){return r("rechecking connection"),B?void s("Permanent DC, don't go furhter"):(r("check if system is online"),void y(function(t){q&&(q=!1),t?(Z&&(Z=!1),r("system is online"),e.editMode&&ie("on"),f(function(){w||(r("requeuing, send to server"),p(N,h))})):(r("system was offline, recheck every 2 sec"),setTimeout(ve,2e3))}))};if(e.editMode||e.isHome){
f(),c();var be=setInterval(function(){console.log("$.connection.hub.id",$.connection.hub.id),$.connection.hub.id?clearInterval(be):$.connection.hub.start()},2e3);r("Home page or edit mode"),r("trying to connect signal R"),$(window).on("offline",function(){return s("window offline event received"),B?void s("Permanent Disconnection was found"):(r("change notify off"),e.editMode&&ie("off"),r("set browserwasDC true"),Y=!0,r("Recheck connection"),void ve())}),$(window).on("online",function(){app.console("window online, event received "),r("window online event received, do we need to recheck connection?"),ve()})}var ye=function(e,t,a){if(r("sending sync to server "),Y){if(r("browser was DC "),"Editor"!=t){var n={type:"syncSend",mod:e,prop:t,val:a};r("pushing to queue "),j.push(n)}}else r("browser was alive "),"Editor"!=t&&(ee=!0),T>5&&e.Tag>0&&(r("sync server module  "),R.server.syncMod(o.Token,e.Tag,t,a)),r("save module "),e.save&&e.save()};return{send:m,saveMod:b,reg:C,sync:ye,raiseEvent:function(e,t){R.server.raise(o.Token,e,t)},addListener:u,getBrowserDC:oe}},app.core.configStore=function(e){function t(e){return n("folio",e),this}function a(){for(var e=0;e<r.length;e++)if(r[e]&&r[e][l])return r[e];return!1}function n(t,n){switch(l=n,t){case"folio":e.localStorage.folios||(e.localStorage.folios=[]),r=e.localStorage.folios}var o=a();o||(o={},o[l]={},r.push(o)),s=o}function o(e,t){s[e]=t,r[l]=s}function i(e){return s[e]}var s,r,l;return e.localStorage||(e.localStorage={}),{folioStorage:t,store:o,fetch:i}},app.core.eventManager=function(){var e={},t={reset:function(){$(e).each(function(e,t){t.listeners=[]})},addEvent:function(t){e[t]={listeners:[]}},addListener:function(t,a,n,o){if("string"==typeof t)e[t].listeners.push({method:a,once:n,data:o});else for(var i=0;i<t.length;i++)e[t[i]].listeners.push({method:a,once:n,data:o})},removeListener:function(t,a){for(var n=e[t].listeners.length-1;n>=0;n--)e[t].listeners[n].method===a&&e[t].listeners.splice(n,1)},raiseEvent:function(t,a,n,o){for(var i=e[t].listeners.length-1;i>=0;i--){var s=e[t].listeners[i];s.data?s.method(s.data,a,n,o):s.method(a,n,o),s.once&&e[t].listeners.splice(i,1)}}};return $.each(["resize","loggedOut","tokenRenewed","docClick","donutError","nameChanged","plusUnlocked","hubMsg","newSignUp","labelChange","transferRequestArrived","duplicateFolio","collabChange","editorStatus","collabRequestArrived","getFolio","removeCollabs","beforeunload","collabreqaccpt","plusCancelled","foliosRecieved","addlabel","fontAdded","froalaClick","froalaCmdAfter","froalaCmdBefore","userTeamRoleChanged","folioRename","collabChanUdate","collabChanFolioUpdate","collabChanFolioMixItUp","free-exceedsize"],function(e,a){t.addEvent(a)}),$(document).on("click",function(e){t.raiseEvent("docClick",e)}),$(window).on("resize",function(){var e=$(this);t.raiseEvent("resize",e.width(),e.height())}),t},app.core.folioStore=function(e,t){var a=JSON.parse(t.Store||"{}");return{get:function(e){return a[e]},set:function(n,o){a[n]=o,e.folioStore({data:{id:t.Token,data:JSON.stringify(a)}})}}},app.core.main=function(e,t){console.log("app core",app.core);var a,n=this,o=n.eventManager(),i=n.store(),s=n.utility(),r=n.apiHelper(e,t,o,i,s),l=n.appHub(e,o,i,s,t,r),c=n.pageManager(e,t,l),d=n.modStore(r),u=n.plusHelper(e,r,o),m=n.configStore(e);return t&&(a=n.folioStore(r,t)),{eventManager:o,pageManager:c,store:i,utility:s,apiHelper:r,appHub:l,modStore:d,folioStore:a,configStore:m,plusHelper:u}},app.core.modStore=function(e){var t={},a={reg:function(e,a){e&&!t[e]&&(t[e]=a||{})},get:function(a,n,o,i){t[a]?o(t[a][n]):e.modStore({data:{id:a},maxAttempts:99,success:function(e){t[a]=JSON.parse(e.Message||"{}"),o(t[a][n])},error:i})},set:function(n,o,i){a.get(n,o,function(){t[n][o]=i,e.modStore({data:{id:n,data:JSON.stringify(t[n])}})})}};return a},app.core.pageManager=function(e,t,a){var n,o={home:"home-page",edit:"edit-page"},i=e.editMode&&t.Role>1?o.edit:o.home;return{pages:o,showPage:function(e){$("#"+i).hide(),$("#"+e).show(),i=e,n.activatePreview()},hidePage:function(e){$("#"+e).hide()},setupEditPage:function(e,t,s){function r(e){var t=s.createSection({Tag:e});return s.addModule("EmptyModule"),s.saveLayout(),t}n=s;var l='<button type="button" class="btn btn-lg white-blue-btn">+ Add New Section</button>',c='<div class="preview-bottom" style="text-align: center; padding: 20px 0;"></div>',d=$(l);$("#edit-sections").after($(c).append(d)),d.on("click",function(){var e=r();a.raiseEvent("NewSection",e[0].data("Tag"))}),a.addListener("NewSection",r),i!=o.home?this.hidePage(o.home):(this.showPage(o.home),n.activatePreview())},isCurrent:function(e){return i==e},toggle:function(){i==o.home&&t.Role>1?this.showPage(o.edit):(this.showPage(o.home),n.activatePreview())},hideCurrent:function(){$("#"+i).hide()},restore:function(){$("#"+i).show()},getCurrentPage:function(){return i}}},app.core.plusHelper=function(e,t,a){function n(){return!(!e.Team||!e.Team.Role)&&e.Team.Role}function o(){return!!(D&&D.End&&Date.now()<D.End)}function i(){if(E===!1&&D&&D.ST){console.log("data.ST",D.ST);for(var e in N)for(var t in N[e])if(t==D.ST){E=e;break}}return!!o()&&E}function s(){var t=!1;for(var a in e.UserTeams){var n=e.UserTeams[a];if(1==n.Role){t=!0;break}}return!!o()&&t}function r(e,t){var a=document.createElement("script");a.addEventListener("load",t),a.src=e,a.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(a)}function l(){var t=e.Team.Role;for(var a in e.TeamRoles)if(e.TeamRoles[a].Id==t)return e.TeamRoles[a].Name}function c(t){e.userEmail==t.Data.Email&&e.Team.Id==t.Data.TeamID&&(e.Team.Role=t.Data.Role)}function d(a,n,o){P?setTimeout(function(){d(1,n)},2e3):D?u(n):(P=!0,t.getFreePlusInfo({success:function(t){D=JSON.parse(t.Message),e.plusExpireTime=D.End,u(n)},error:function(){u(n)},complete:function(){P=!1}}))}function u(e,t){var a,n="";m(),D&&D.End&&(n=moment(D.End).format("MMMM Do, YYYY"),a=D.AR,a||(a=34==D.ST)),"undefined"!=typeof e&&e(D,plusActive,a,n)}function m(){plusActive=!1,I=Date.now(),D&&D.End&&(plusActive=new Date(D.End)>I)}function f(t,a,n){console.log("exec checkFoliosLimitReached");var o=!1,i=$("#folio-items-container"),s=i.find(".folio-item-shell.active").length,r=10,l=p();return console.log("userType",l),e.IsDelinquent&&1===Faltu(e.folios).find({Status:0}).count()?(h(a,"plus"),void(o=!0)):w()&&("ProBusiness"===l||C())&&s>=r?(h(a,"pro"),void(o=!0)):e.Team&&e.Team.Id&&5==e.Team.Role?(h(a,"team"),void(o=!0)):e.Team&&e.Team.Id&&4==e.Team.Role?(h(a,"team","Premium Guests"),void(o=!0)):void(e.Team&&0===e.Team.Id&&("Free"===l||y()||T())?t.getUserActiveFoliosCount({success:function(e){if(console.log("getUserActiveFoliosCount response",e),e.Data>=1){var t=l;return"ProBusiness"===l&&(t="Pro"),h(a,"personal",t),void(o=!0)}!o&&n&&"function"==typeof n&&n()},error:function(e){console.log("getUserActiveFoliosCount error",e)}}):n())}function p(){return b()?"Free":i()}function h(e,t,a){switch(console.log("doUpgradePopup type",t,a),t){case"plus":e.plusPrompt("create",null,!0);break;case"pro":e.message({heading:"Upgrade your account",message:"Folio Limit reached for Pro User. Please upgrade to Business for unlimited folios and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){e.payment()}});break;case"team":a&&"Premium Guests"===a?e.teamUserActionBlocked("create","Premium Guests"):e.teamUserActionBlocked("create");break;case"personal":var n={heading:"Upgrade your account",message:"Folio Limit reached for Free User. Please upgrade for unlimited folios and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){e.payment()}};"Free"!==a&&(n={heading:"Switch to your team dashboard",message:"Folio Limit reached for "+a+" User on personal dashboard. Please switch to your team dashboard.",btnText:"Okay",bodyCentered:!0,notMini:!0}),e.message(n)}}function g(t,a,n){var o=$("#folio-items-container");d(1,function(i,s,r,l){var c=0,d={},u=i.ST;if(r&&(10!=i.ST&&11!=i.ST||e.IsDelinquent||(c=5,d.currUser="Plus",d.limit=5)),s&&10!=i.ST&&11!=i.ST&&3!=i.ST&&16!=i.ST?(ispro=!0,o.find(".save-template-btn").removeClass("locked")):e.Team.Id<1&&o.find(".save-template-btn").addClass("locked"),s||(c=1,d.currUser="Free",d.limit=1),e.IsDelinquent&&(c=1,d.currUser="Free",d.limit=1),!s||10!=i.ST&&11!=i.ST&&16!=i.ST&&3!=i.ST||(isplus=!0,c=5,d.currUser="Plus",d.limit=5),28===u||31===u){var m=e.Team.Id>0?10:1;c=m,d.currUser="ProBusiness",d.limit=m,o.find(".save-template-btn").removeClass("locked")}console.log("limit",c,r,s,e.IsDelinquent),console.log("params",d),e.Team&&e.Team.IsDelinquent?a(d):c>0&&t.getUserActiveFoliosCount({success:function(o){var i=o.Data;console.log("user active folios:::",i),t.getUserTemplateCount({success:function(o){var s=o.Data;if(0===e.Team.Id){if(e.IsDelinquent||i>c||s>0){var r=$(".folio-item-shell.active"),l=$("#templates-items-container .folio-item.own");d.foliosCount=o.Data,(e.IsDelinquent||r.length>d.limit||l.length>0)&&0==e.Team.Id&&a(d)}}else"ProBusiness"===d.currUser&&t.getUserTeamsAndFolios({userEmail:e.userEmail,success:function(t){console.log("getUserTeamsAndFolios response",t);var n=_.find(JSON.parse(t.Data),{Id:e.Team.Id});"undefined"!=typeof n?(n.TotalFolios>c||M)&&a(d):console.log("getUserTeamsAndFolios teamDetails ERR",e.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)},complete:function(){n&&"function"==typeof n&&n()}})},error:function(e){n&&"function"==typeof n&&n(),console.log("error: ",e)}})},error:function(e){n&&"function"==typeof n&&n(),console.log("error: ",e)}})})}function v(){k=setInterval(function(){m(),D&&D.End&&I>D.End&&!A&&(a.raiseEvent("plusCancelled"),M=!0,A=!0)},F)}function b(){var e=!o();return D&&(e=0===D.ST||34===D.ST),e}function y(){return"ProBusiness"==i()}function C(){return 28===e.Team.ST||31===e.Team.ST}function T(){return 22===D.ST||25===D.ST}function w(){return e.Team&&0!=e.Team.Id&&e.Team.Role>0}var x,k,S,D=null,I=Date.now(),P=!1,E=!1,F=2e3,A=!1,M=!1,N={Plus:{10:"PlusMonthly",11:"PlusYearly",16:"ManualPlus"},Pro:{1:"Monthly",2:"Yearly",4:"Manual"},Business:{14:"BusinessYearlyGrandFather",19:"BusinessMonthlyGrandFather",22:"BusinessYearly",25:"BusinesMonthly"},Team:{12:"TeamMemberYearlyGrandFather",13:"TeamPremiumGuestYearlyGrandFather",20:"TeamMemberMonthlyGrandFather",21:"TeamPremiumGuestMonthlyGrandFather",15:"TeamEarlyAccess",23:"TeamMemberYearly",24:"TeamPremiumGuestYearly",26:"TeamMemberMonthly",27:"TeamPremiumGuestMonthly"},Other:{3:"VersionUpgrade",5:"Campaign",6:"Referral",7:"SignUpViaReferral",8:"Failed",9:"DiscountYearly",34:"FreeUserWithCreditPurchase"},ProBusiness:{28:"ProYearly",31:"ProMonthly"}};return v(),{checkFolioRestrictions:g,checkFoliosLimitReached:f,updateConfig:c,getData:d,isFree:b,isProBusiness:y,isProTeamMember:C,isNewBusiness:T,hasTeam:w,getUserPlan:p,loadStripe:function(t){x?t&&t():r("https://js.stripe.com/v2/",function(){x=1,Stripe.setPublishableKey(e.stripePublic),t&&t()})},refresh:function(){D=null,A=!1,this.getData(1,function(e,t){var n=t?"plusUnlocked":"plusCancelled";a.raiseEvent(n)})},isPlus:function(){return"Plus"==i()},isPro:function(){var e="Pro"==i();return e},isProBusiness:function(){var e="ProBusiness"===i();return e},isBusiness:function(){return"Business"==i()},isTeam:function(){return"Team"==i()},ownsATeam:function(){return s()},isOwner:function(){return 1==n()},isAdmin:function(){return 2==n()},isTeamMember:function(){return 3==n()},isPremiumGuest:function(){return 4==n()},isSingleFolioGuest:function(){return 5==n()},getRoleName:function(){return l()},hasCredits:function(){if(e.exportLimits.LimitsImposed)return e.exportLimits.CreditsLeft>0},isSubscriptionExpired:function(){return M},setLock:function(t,a){if(e.userName){var n="https://xtensio.com/pricing/";S&&t&&!a?t(S,n):this.getData(1,function(e,a,o,i){S=e,t&&t(e,n)},!0)}}}},app.core.store=function(){var e={},t={showSignupPropmt:"ssp",refCount:"refcount"},a=function(t,a){e[t]=a,"undefined"!=typeof Storage&&localStorage.setItem(t,a)},n=function(t){return e[t]||"undefined"==typeof Storage||(e[t]=localStorage.getItem(t)),e[t]},o=function(t){delete e[t],"undefined"!=typeof Storage&&localStorage.removeItem(t)};return{keys:t,get:n,getNumber:function(e,t){return+(n(e)||t||0)},set:a,remove:o}},app.core.utility=function(){function e(e,t,a){e&&(a=a||1,e.sort(function(e,n){return e[t]>n[t]?1*a:e[t]<n[t]?a*-1:0}))}function t(e,t){var a=!0;return function(n){a&&(a=!1,e.call(this,n),setTimeout(function(){a=!0},t?t:1e3))}}function a(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return!0;return!1}function n(e,t,a,n,o){if(a){for(var i=0;i<e.length;i++)if(e[i][t]==a)return e[i];for(i=0;i<e.length;i++)if(n&&e[i][n]==a)return e[i];for(i=0;i<e.length;i++)if(o&&e[i][o]==a)return e[i]}return null}function o(e,t,a){for(var n=-1,o=0;o<a.length;o++)if(a[o][t]===e){n=o;break}return n}function i(e,t){return t.x>=e.left&&t.y>=e.top&&t.x<=e.right&&t.y<=e.bottom}function s(e,t,a){for(var n=!1,o=0;o<e.length;o++)if(a&&e[a]==t||e[o]==t){n=!0;break}n||e.push(t)}function r(e,t,a,n){for(var o=0;o<e.length;o++)if(a&&e[o][a]==n||e[o]==t)return e.splice(o,1),t}function l(e,t){for(var a=0;a<e.length;a++)if(e[a]==t)return a;return-1}function c(e,t,a){e.busy();var n=new Image;n.onload=function(){t.prepend(O.attr("class",t.attr("class")).hide()),O.css("backgroundImage","url("+a+")"),O.show(),t.css("backgroundImage","url("+a+")"),N.append(O.hide()),e.close()},n.src=a}function d(e,t){var a=null;return $.each(e,function(e,n){if(n==t)return a=e,!1}),a}function u(e){var t;try{t=e.toUpperCase().match(/\b\w/g),t=t.length>1?t.shift()+t.pop():t.shift()}catch(a){t=e.charAt(0)}return t}function m(e){return e.toString().trim().toLowerCase()}function f(){var e={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,a,n){e[a]=n});return e}function p(e){var t=/(\/?[\w-]+)(\/[\w-]+)*\/?|(((http|https):\/\/)?[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?)/gi;return t.test(e)}function h(e){return!isNaN(parseFloat(e))&&isFinite(e)}function g(e){function t(e){return("0"+parseInt(e).toString(16)).slice(-2)}return e.search("rgb")==-1?e:(e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+t(e[1])+t(e[2])+t(e[3]))}function v(){return"#"+("00000"+(Math.random()*(1<<24)|0).toString(16)).slice(-6)}function b(e){return e.toString().toLowerCase().trim()}function y(e){return e.toString().toUpperCase().trim()}function C(e){e=e.replace("#","");var t=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16);return(299*t+587*a+114*n)/1e3}function T(e){var t=C(e);return t<=123?"#ffffff":"#000000"}function w(e,t){var a=Object.prototype.toString.call(e);if(a!==Object.prototype.toString.call(t))return!1;if(["[object Array]","[object Object]"].indexOf(a)<0)return!1;var n="[object Array]"===a?e.length:Object.keys(e).length,o="[object Array]"===a?t.length:Object.keys(t).length;if(n!==o)return!1;var i=function(e,t){var a=Object.prototype.toString.call(e);if(["[object Array]","[object Object]"].indexOf(a)>=0){if(!w(e,t))return!1}else{if(a!==Object.prototype.toString.call(t))return!1;if("[object Function]"===a){if(e.toString()!==t.toString())return!1}else if(e!==t)return!1}};if("[object Array]"===a){for(var s=0;s<n;s++)if(i(e[s],t[s])===!1)return!1}else for(var r in e)if(e.hasOwnProperty(r)&&i(e[r],t[r])===!1)return!1;return!0}function x(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(a,n){var o=a[e]<n[e]?-1:a[e]>n[e]?1:0;return o*t}}function k(e,t,a){var n="color: red";console.log("%c Did not find "+e+" on "+t+". Exec at "+a,n)}function S(e,t){var a="color: red; font-weight: bold";console.log("%c "+e.toString().toUpperCase(),a),console.log(t)}function D(e,t){e?t.hide():t.show()}function I(e){return e.toString().substr(0,1).toUpperCase()+e.toString().substr(1)}function P(){window.location.hash="",setTimeout(function(){window.location.reload()},10)}function E(e,t){var a=t||.5;setTimeout(function(){e.focus(),console.log("setting focus to ",e)},1e3*a)}function F(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)}function A(e){var t=[];return e.forEach(function(e,a){t.push(e.HexCode)}),t}var M=function(){var e=0;return function(t){return e++,t?e:"_"+e}}(),N=$("body"),O=$("<div>").css({position:"absolute",width:"100%",height:"100%",left:0,top:0});return{sort:e,contains:a,obtain:n,findIndex:o,createEventFunc:t,uniqueId:M,isPointInRect:i,pushUnique:s,getInitials:u,removeFromList:r,indexOf:l,changeBg:c,standardizeEmail:m,getUrlVars:f,valToProp:d,isValidURL:p,isNumber:h,rgb2hex:g,generateRandomColor:v,trimLowercase:b,trimUppercase:y,getColorBrightness:C,getColorContrast:T,compareArrays:w,sortObjArray:x,devWarnOnID:k,devHighlightConsole:S,toggleElementViz:D,capitalizeFirstLetter:I,reloadWithoutHash:P,doSetFocus:E,isSafari:F,getColors:A}},app.lib.googleFonts=function(e){function t(e,t){if(a[e])return console.log("cache called"),t?t(a[e]):a[e];o.push("&"+e);var n=new XMLHttpRequest;n.timeout=15e3,n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var o=JSON.parse(n.responseText);if(a[e]=o,console.log("added to cache"),!t)return o;t(o)}else if(0==XMLHttpRequest.readyState){var i={error:"Network error"};if(!t)return i;t(i)}},n.ontimeout=function(e){var a={error:"Network error"};return console.log(e),t?void t(a):a},n.open("GET",o.join(""),!0),n.send(null)}var a={},n="AIzaSyDrznrgWCKE_p-WP93QvFvpPeAynvQpakY",o=[];return o.push("https://www.googleapis.com/webfonts/v1/webfonts"),o.push("?key="+n),{query:t}},app.editor.collaboratorsMenu=function(e,t,a,n,o,i,s){function r(){var t=$(this),a=t.data("email"),n=e.currentlyEditing[a];n&&n.active&&n.module.bringInView()}function l(t){p.find(".person:not(.add)").remove();var a=5,n=0;if($.each(t.Collaborators,function(t,i){if(i.Accepted&&i.Privilege>0&&i.Email!=e.userEmail)if(++n<=a){var s=$(g.html());s.on("click",r).attr("data-tip",i.FullName).attr("data-email",i.Email).find(".initials").text(o.getInitials(i.FullName||i.Email)),p.prepend(s.addClass(m[i.Email]))}else u.push(i.FullName)}),n&&(f.find(".add-new").addClass("hidden"),p.find(".add").removeClass("hidden")),n>a){var i=p.find(".person:not(.add)").last();u.unshift(i.attr("data-tip")),i.removeClass("active").attr("data-html","true").attr("data-tip",u.join("<br/>")).find(".initials").text("+"+(n-a+1))}s.isSingleFolioGuest()?h.attr("data-tip","Guests can not add/remove people"):h.attr("data-tip","Add / Remove People"),app.plugin.tooltip()}function c(e){for(var a=0;a<t.Collaborators.length;a++)if(t.Collaborators[a].Email==e)return t.Collaborators[a].FullName;return!1}var d,u=[],m=[],f=$("#tmp-collaborators"),p=f.find(".others"),h=p.find(".person"),g=$("#tmp-single-collab");f.on("click",".add-new, .add",function(){console.log(e),s.isSingleFolioGuest()?n.teamUserActionBlocked("add-remove-collab","Guests"):e.Team.Id>0&&0!==e.Team.Role&&4!==e.Team.Role&&5!==e.Team.Role?n.collaborators(t):n.message({heading:"Upgrade your account",message:"Collaboration is available only on premium plans. Please upgrade or switch to your team dashboard to add people",btnText:"See Plans",cancelText:"Nevermind",handleOK:function(){n.billing()}})}),l(t),i.addListener("collabChange",l),i.addListener("editorStatus",function(t){setTimeout(function(){var a=e.currentlyEditing[t.email],n=1==t.status?a&&a.active?"editing":"active":"";p.find('.person[data-email="'+t.email+'"]').removeClass("active editing").addClass(n),m[t.email]=n,clearTimeout(d),a&&(a.active&&(a.name=c(t.email),d=setTimeout(function(){e.currentlyEditing[t.email].active=!1,a.module.listEditors(),i.raiseEvent("editorStatus",t)},1e4)),1!=t.status&&(a.active=!1),a.module.listEditors())},500)}),$(".app-title .icon-Edit").after(f)},app.editor.froala=function(e,t,a,n,o,i,s){function r(){var e=!1;if(o.hasTeam()){var t="Needs admin access";(o.isOwner()||o.isAdmin())&&(e=!0)}C=e,e?(l(g,!0),l(h,!0),i.remove(p),i.remove(g),i.remove(h)):(l(g,!1),l(h,!1),i.add(p,t,0),i.add(g,t,0),i.add(h,t,0))}function l(e,t){e.html(b),t&&e.html(b+' <i class="icon-Color-Scheme"></i>')}function c(){p.text("Manage Fonts").on("click",function(e){return e.preventDefault(),e.stopPropagation(),$(this).hasClass("locked")?(u(),!1):void n.show(m,"styleguide")}).append('<i class="icon-Font">Aa</i>').insertAfter(v.parent()),$("#edit-page").on("click",".theme-picker .manage-color-link",function(e){return e.preventDefault(),e.stopPropagation(),$(this).hasClass("locked")?(u(),!1):void d()});var t=setInterval(function(){$(".fr-color-hex-layer").parent().length>0&&(h.text(b).on("click",function(e){return e.preventDefault(),e.stopPropagation(),$(this).hasClass("locked")?(u(),!1):void d()}).appendTo($(".fr-color-hex-layer").parent()),r(),clearInterval(t))},500),a=setInterval(function(){if($(".fr-table-colors").parent().length>0){clearInterval(a);var t=[];$(".fr-table-colors").html(""),0!==e.Team.Id&&"undefined"!=typeof e.StyleGuides?t=s.getColors(e.StyleGuides[0].TeamColors):"undefined"!=typeof e.DefaultColors&&(t=s.getColors(e.DefaultColors));var n=0,o=7;$.each(t,function(e,t){var a=$('<span class="fr-command" tabindex="-1" role="button" data-cmd="tableCellBackgroundColor"></span>').css("background-color",t).data("param1",t).html('<span class="fr-sr-only">Color '+t+" </span>");$(".fr-table-colors").append(a),n++,n===o&&(n=0,$(".fr-table-colors").append($("<br>")))}),h.text(b).on("click",function(e){return e.preventDefault(),e.stopPropagation(),$(this).hasClass("locked")?(u(),!1):void d()}).appendTo($(".fr-table-colors").parent()),r()}},500);return $("#edit-page").on("click",".bg-panel-btn",function(){console.log("check and update manage-color-link locks"),f=$("#edit-page .manage-color-link"),C?(l(f,!0),i.remove(f)):(l(f,!1),i.add(f,y,0))}),p}function d(){n.show(m,"styleguide"),setTimeout(function(){$("#tmp-style-guide .popup-header .tabs span:eq(1)").trigger("click")},1e3)}function u(){o.hasTeam()?n.message({heading:"You can not perform this action",bodyCentered:!0,message:"Only team admins can manage the style guide. Please contact the admin for more access.",btnText:"Ok",notMini:!0}):n.message({heading:"Upgrade your account",message:"Style guide is only available on premium plans. Please upgrade or switch to your team dashboard.",btnText:"Go to Billing",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){n.payment()}})}var m=$("#tmp-style-guide"),f=$("#edit-page .manage-color-link"),p=$('<div class="froala-styleguide-link">'),h=$('<div class="froala-manage-color-link">'),g=$(".theme-picker .manage-color-link"),v=$("#dropdown-menu-fontFamily-1").find(".fr-dropdown-list[role=presentation]"),b="Manage/Add Colors",y="Premium Feature",C=!1;c(),o.setLock(function(e,t){r(e,t)})},app.editor.main=function(e,t,a,n,o,i,s,r,l,c,d){e.currentlyEditing={};var u=app.plugin.lockedTip(e,n),m=this,f=$("#tmp-power-by-footer"),p=m.topBar(t,n,i);m.createSecondaryBar(e,t,a,n,l,i,o,p,c,d,u),m.templateMessage(e,t,r),m.wizardEditor(e,a,s,i),m.collaboratorsMenu(e,t,a,i,s,n,d),d.getData(1,function(t,a,n,o){var s=f.find(".power-by-footer"),r={heading:"Upgrade to premium plan",message:"By upgrading to any of our premium plans, you can remove Xtensio branding from your shared folios.",btnText:"Upgrade",cancelText:"Cancel",bodyCentered:!0,notMini:!0,handleOK:function(){i.billing()}};if(0!==t.ST&&34!==t.ST||a||0!==e.Team.Id)s.removeClass("footer-on-free"),f.find("a:not(.normal)").click(function(){return i.message(r),!1});else{console.log("user is free user!");var l='<a class="btn popup-cta see-plans" href="#billing">See Plans</a>';s.addClass("footer-on-free"),s.html("<p>Upgrade your account to remove Xtensio branding and access premium features.</p>"+l),s.find("a.see-plans").click(function(e){return e.preventDefault(),i.message(r),!1}),$("#home-page").append('<div class="watermark-on-free"></div>'),$("#home-page .watermark-on-free").hide()}$("#home-page").append(f)}),m.froala(e,a,n,i,d,u,s)},app.editor.present=function(e){function t(e){i=e,$("html").css({backgroundColor:"#fff","overflow-y":"auto"}),$("body, .preview-div").addClass("present"),$(".preview-div:first-child").addClass("current"),f&&f.call(l),$(s).on("keydown.present",o),setTimeout(function(){c.show(),a()},100),$(".preview-available").addClass("hidden"),$(s).on("mousemove.idleMouse",function(){clearTimeout(r),$("body").removeClass("idle"),r=setTimeout(function(){$("body").addClass("idle")},2e3)}),d.click(function(){a(-1)}),u.click(function(){a(1)}),m.click(n),$(window).on("resize.presentFix",a)}function a(t){t=t||0,$("html, body").scrollTop(0);var a=$(".preview-div.current").css("min-height",""),n=a.index(),o=$(".preview-div").length-1;t>0&&n<o?a.add(a.next()).toggleClass("current"):t<0&&n>0&&a.add(a.prev()).toggleClass("current"),n+=t,a=$(".preview-div.current").css("min-height",window.innerHeight),d.toggleClass("disable",n<=0),u.toggleClass("disable",n>=o),e.raiseEvent("resize")}function n(){if(s.fullscreenElement||s.mozFullScreen||s.webkitIsFullScreen){var e=s.cancelFullscreen||s.mozCancelFullScreen||s.webkitCancelFullScreen;e&&e.call(s)}c.hide(),$("html").css({backgroundColor:"","overflow-y":""}),$(".preview-div").css("min-height",""),$(".preview-available").removeClass("hidden"),$(window).off(".presentFix"),$("body, .preview-div").removeClass("present current"),clearTimeout(r),$("body").removeClass("idle"),$(s).off(".idleMouse .present"),i&&i()}function o(e){var t=e.which;32==t||39==t?a(1):37==t?a(-1):27==t&&n()}var i,s=document,r=null,l=$("body")[0],c=$("#presentation-buttons"),d=c.find(".left-btn"),u=c.find(".right-btn"),m=c.find(".exit"),f=l.requestFullscreen||l.mozRequestFullScreen||l.webkitRequestFullscreen;return{stop:n,start:t}},app.editor.createSecondaryBar=function(e,t,a,n,o,i,s,r,l,c,d){function u(){p&&p.hide()}function m(){p&&p.show()}function f(e){switch(e){case b.edit:h=!0,m(),r.toggle(1),U.removeClass("preview"),s.showPage("edit-page"),R.removeClass("visible-hidden"),T.addClass("in-edit-mode").removeClass("in-preview-mode"),$("#home-page .watermark-on-free").hide();break;case b.preview:h=!1,u(),r.toggle(0),U.addClass("preview"),s.showPage("home-page"),R.addClass("visible-hidden"),T.addClass("in-preview-mode").removeClass("in-edit-mode"),$("#home-page .watermark-on-free").show();break;case b.present:h=!1,u(),r.toggle(0),s.showPage("home-page"),T.removeClass("in-edit-mode"),y.start(function(){f(1)}),$("#home-page .watermark-on-free").show()}}var p,h=!0,g=0,v=0,b={edit:1,preview:2,present:3},y=app.editor.present(n),C=$("#tmp-secondary-bar"),T=C.find(".navs-preview"),w=C.find(".export"),x=C.find(".share"),k=C.find(".add-module-button"),S=C.find(".more-opts"),D=C.find(".transfer"),I=C.find(".present"),P=C.find(".settings"),E=C.find(".navs-archive"),F=C.find(".save-as-template"),A=C.find(".navs-delete-template"),M=C.find(".navs-revision"),N=C.find(".navs-stats"),O=C.find(".nav-save-section"),U=$("#folio-bar"),R=$("#tmp-primary-bar, #tmp-secondary-bar .left, #tmp-secondary-bar .right > *:not(.preview-available), .nav-save-section > *"),L=C.find(".nav-settings.popup-menu"),B="Premium Feature";U.append(C),setTimeout(function(){p=$("#helpcrunch-container")},3e3),n.addListener("userTeamRoleChanged",function(t){e.userEmail==t.Data.Email&&q()}),N.click(function(){if($(this).hasClass("locked")){var a={heading:"Upgrade your account",message:"Folio stats is available on business plans. Please upgrade to have access to this and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){i.billing()}};return void(c.hasTeam()?c.isProBusiness()?i.message(a):i.teamUserActionBlocked("stats","Guests"):i.message(a))}var n=t.IsUserTemplate||!1,o=t.UsedCount||0;i.folioStats(e.token,t.FolioName,{isTemplate:n,UsedCount:o})});var G=function(e,t){var a=B,n=!0;c.hasTeam()?c.isSingleFolioGuest()||c.isPremiumGuest()?(a="Guests can not create templates",n=!1):c.isProBusiness()&&(a="Folio stats is available on business plans",n=!1):(c.isFree()||c.isPlus()||c.isProBusiness())&&(n=!1),n?d.remove(N):d.add(N,a,0)},H=function(e,t){var a=B,n=!0;c.hasTeam()?(c.isSingleFolioGuest()||c.isPremiumGuest())&&(a="Guests can not create templates",n=!1):(c.isFree()||c.isPlus())&&(n=!1),n?d.remove(F):d.add(F,a,0)},q=function(){c.setLock(function(e,t){G(e,t),H(e,t)})};q(),n.addListener("plusUnlocked",function(){q()}),n.addListener("plusCancelled",function(){q()}),C.click(function(){var e=Date.now();e-v<1e3?g++:g=0,v=e,5==g&&($("body").addClass("show-adv"),$(".button-panel .cls-btn").removeClass("hidden-btn"))}),P.click(function(){i.message({heading:"Folio Styles",btnText:"Save",showArea:1,areaPlaceholder:"Folio Styles",rows:10,areaText:l.get("style"),handleOK:function(e,t){l.set("style",t);var a='<style id="folio-style">'+t+"</style>";$("head #folio-style").remove(),$("head").append(a)}})}),I.click(function(){f(3)}),T.click(function(){t.Role>1&&f(h?2:1)}),x.click(function(){i.shareLink(t)}),w.click(function(){var e,a="",n=$("#home-page"),r=o.getExport();i.exp(t,r,{$el:n,cb:function(t,i){a="",$("head").find(".module-style, #folio-style").each(function(e,t){a+="<style>"+t.innerHTML+"</style>"}),e=s.isCurrent(s.pages.home),e||s.showPage(s.pages.home),n.css("width",Math.max($(window).width(),1367)+"px"),setTimeout(function(){o.activatePreview(),a+=n.html(),i(a),n.css("width",""),e?o.activatePreview():s.showPage(s.pages.edit),o.saveData()},1e3)}})}),D.click(function(){e.Team&&e.Team.Id>0?i.transferTeamFolio():i.transferFolio()}),E.click(function(){i.archive(t,function(){window.location.href=window.location.href.replace("edit","folio")})}),t.IsUserTemplate?(E.remove(),D.remove(),N.find("span").text("Template Stats"),F.remove()):A.remove(),A.click(function(){i.message({heading:"Are you sure?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes",notMini:!0,handleOK:function(){a.deleteUserTemplate({token:t.Token,op:"del",success:function(){$("#dashboard-page > .loader").hide(),window.location=e.baseUrl},error:function(e){$("#dashboard-page > .loader").hide(),i.message({heading:"Error",message:e.Message,btnText:"Ok",enterAsOK:!0})}})},cancelText:"Cancel",handleNo:function(){i.close()}})}),F.click(function(){if(F.hasClass("locked"))return void(c.hasTeam()?i.teamUserActionBlocked("save-as-template","Guests"):i.billing());$("#app-load-animation").show();var n=t.Token,o=t.FolioName;a.saveAsTemplate({token:n,name:o,teamId:e.Team.Id,CopiedFromTemplate:!1,success:function(){$("#app-load-animation").hide(),i.message({heading:"Success",message:"This folio has been successfully saved as a template.",btnText:"Go To My Templates",enterAsOK:!0,notMini:!0,handleOK:function(){window.location=e.baseUrl+"#mytemplates"},cancelText:"Ok",handleNo:function(){i.close()}})},error:function(e){$("#app-load-animation").hide(),i.message({heading:"Error",message:e.Message,btnText:"Ok",enterAsOK:!0})}})}),k.click(function(){i.addModule(o.addModule)}),M.click(function(){i.folioVersion(e,t.Token)}),O.click(function(){t.Role>1&&i.folioVersion(e,t.Token)}),t.Role<3&&(D.hide(),M.css({marginTop:"12px"}),E.addClass("leave").html('Leave Folio <i class="icon-Transfer"></i>'),t.Role<2&&(M.addClass("hidden"),E.css({marginTop:"12px"}),O.addClass("view-only").tooltip("disable"))),app.plugin.popupMenu(S,L)},app.editor.saveSpinner=function(e,t){var a={spin:1,save:2},n=$("#tmp-secondary-bar").find(".nav-save-section").attr("class","nav-save-section info"),o=n.find(".info .saved-time");switch(e){case a.spin:n.removeClass("saved").addClass("saving");break;case a.save:n.removeClass("saving").addClass("saved"),o.text(moment(t||Date.now()).format("lll")),setTimeout(function(){n.removeClass("saved")},1500)}},app.editor.templateMessage=function(e,t,a){var n="hideTemplateMessage:"+t.ParentID;if(t.TemplateMessage&&"true"!==a.get(n)){var o=$("#template-message-wrapper"),i=$("#template-message");i.html(t.TemplateMessage);var s=$('<span class="close-btn"></span>');o.prepend(s),s.on("click",function(){a.set(n,"true"),o.slideToggle(150),setTimeout(function(){o.remove();
},1e3)})}},app.editor.topBar=function(e,t,a){var n,o=!0,i={duration:400,queue:!1},s=$(document),r=$("body"),l=$("#top-bar"),c=($("#n-panel"),86);return r.css("padding-top",c),t.addListener("resize",function(){o?setTimeout(function(){l.css("top",0),r.css({paddingTop:c})},0):l.animate({top:-$("#top-bar").height()},i)}),t.addListener("free-exceedsize",function(){$("#uploading-popup").hide(),$("#toolbarContainer").find(".fr-image-progress-bar-layer.fr-error").hide(),setTimeout(function(){a.message({heading:"The file is too big",message:"File size exceeds the 1MB limit,  but if you upgrade to a premium plan you can upload images up to 5MB.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){a.billing()}})},600)}),{toggle:function(e){if(o=e){var t=s.scrollTop();t>0&&$("html, body").animate({scrollTop:s.scrollTop()-n},i),r.animate({paddingTop:c},i),l.animate({top:n},i)}else n=parseInt(l.css("top")),r.animate({paddingTop:0},i),l.animate({top:-$("#top-bar").height()},i)}}},app.editor.viewOnly=function(e){e&&1===e.Role&&($("#edit-page").hide(),$(".folio-name").attr("readonly",!0),$(".others .person.add").remove(),$(".user-options .left").css("padding","5px 30px 3px").html('<p style="line-height: 28px;margin-bottom: 0;">You only have access to view this folio.</p>').css("font-size","14px"),$(".navs-preview").addClass("view-only").find(".preview").html("View Only"))},app.editor.addWatermark=function(e,t,a){function n(e){console.log("mode",e);var a=$("#tmp-power-by-footer");if(a.removeClass("hidden").find("upgrade"==e?".normal":".upgrade").addClass("hidden"),a.find("."+e).removeClass("hidden"),"free-user"===e){var n=a.find(".power-by-footer"),o='<a class="btn popup-cta see-plans" href="http://xtensio.com/pricing">See Plans</a>',i={heading:"Upgrade to premium plan",message:"By upgrading to any of our premium plans, you can remove Xtensio branding from your shared folios.",btnText:"Upgrade",cancelText:"Cancel",bodyCentered:!0,notMini:!0,handleOK:function(){t.billing()}};n.addClass("footer-on-free"),n.html("<p>Upgrade your account to remove Xtensio branding and access premium features.</p>"+o),n.find("a.see-plans").click(function(e){return e.preventDefault(),t.message(i),!1})}return a}function o(){var e=$("#tmp-power-by-footer");return e.addClass("hidden"),e}var i=!(e.plusExpireTime>=Date.now()||a.hasCredits()),s=$("#home-page .persona-canvas.canvas-module-container .canvas-module > .header-container"),r=$(location).attr("href"),l="/folio/"+e.token,c=r.indexOf(l)>=0,d=r.indexOf("/project/")>=0;(c||d)&&(i=!(e.PlusEnd>=Date.now()));var u=e.Team&&e.Team.Id>0,m=!e.userName;a.setLock(function(t,l){!i||e.isProject||u?i&&!u&&a.isFree()||(o(),s.length&&s.find(".watermark").remove()):(s.length&&(c||d?s.append('<div class="watermark"><a href="https://www.xtensio.com" target="_blank" ><div class="logo"></div></a></div>'):s.append('<div class="watermark"><a href="'+r+'#billing"><div class="logo"></div></a></div>')),!a.isFree()&&e.banner<1?(o(),s.length&&s.find(".watermark").remove()):c||d?n("normal"):(n("free-user"),$("#home-page").append('<div class="watermark-on-free-shared"></div>')))}),m&&e.banner>0&&!u&&n(c||d?"normal":"upgrade")},app.editor.wizardEditor=function(e,t,a,n){function o(){console.log("run edit wizard"),n.close(),r=new EnjoyHint({onSkip:i,onEnd:i}),r.setScript(T),r.runScript()}function i(){console.log("skipped wizard at step ",r.getCurrentStep()+1),t.setOnboardingStatus({step:r.getCurrentStep()+1,onboardingType:2,success:function(e){console.log("response from setOnboardingStatus",e)},error:function(e){console.log("error from setOnboardingStatus",e)}}),s()}function s(){$("#edit-sections .module-buttons.drop-down-container"+c).css({visibility:""}),$(".nav-save-section").css({color:"#4c7ba0"}),m.find(".sec-button-panel").css({display:""}),m.find(".drop-down-container").removeClass("showing")}var r,l,c,d=$("#top-bar .user-menu-popup"),u=d.find(".edit-wizard"),m=$("#edit-sections"),f=9,p='NEXT <i class="fa fa-angle-right"></i>',h=function(e){return'<text style="color: #00bd9c"><b>'+e+"</b></text><br>"},g=function(e){return'<p style="color: #ffd371">'+e+" / "+f+"</p>"},v=220,b=0,y=0,C=0,T=[{selector:".add-module-button",event:"next",description:g(1)+h("Add New Modules:")+"Choose from interactive modules or add a canvas to have more control over your layout.",nextButton:{className:"wiz-nxt-btn",text:p},showSkip:!1,showNext:!0},{onBeforeStart:function(){C=m.find(".module-container").length,console.log("num of modules",C),1===C&&setTimeout(function(){$("#tmp-add-module-popup .block.r-1:eq(0)").click(),y=500},y),setTimeout(function(){c=2===C?":eq(0)":":eq(1)",$("#edit-sections .mod-setting-btn"+c).click(),$("#edit-sections .module-buttons.drop-down-container"+c).css({visibility:"visible"})},500+y)},selector:"#edit-sections .module-buttons.drop-down-container.showing .button-panel",event:"next",description:g(2)+h("These are your Modules:")+"Drag and drop them, resize them, change backgrounds, add borders, duplicate, export or share them individually. Access even more options via the three-dot menu.",nextButton:{className:"wiz-nxt-btn",text:p},timeout:600+y,showSkip:!1,showNext:!0},{onBeforeStart:function(){b=0,l=setInterval(function(){m.find(".sec-button-panel").css({display:"block"}),m.find(".drop-down-container").addClass("showing"),b+=5,b>=v&&clearInterval(l)},5)},selector:"#edit-sections .sec-button-panel",event:"next",description:g(3)+h("Modules live inside Sections:")+"Here is your section menu. Add new modules and canvases, change backgrounds or the order. You can also move and copy sections between folios, duplicate them or share them individually. <br>Add new sections at the bottom of your folio.",timeout:200,nextButton:{className:"wiz-nxt-btn",text:p},showSkip:!1,showNext:!0},{onBeforeStart:function(){s()},selector:"#tmp-collaborators .add-new",event:"next",description:g(4)+h("Add people:")+"Add collaborators to work on your folio together from anywhere in the world (Business feature). <br>You can give them edit or view-only access.",nextButton:{className:"wiz-nxt-btn",text:p},showSkip:!1,showNext:!0},{onBeforeStart:function(){$(".nav-save-section").css({color:"#7cd0f3"})},"next .nav-save-section":g(5)+h("Auto-save and Revision History:")+"All changes save and sync across all devices in real-time. <br>Open revision history to revert to an older version of your folio.",nextButton:{className:"wiz-nxt-btn",text:p},timeout:200,showSkip:!1,showNext:!0},{onBeforeStart:function(){s()},"next .navs-preview":g(6)+h("Preview:")+"Preview the live version of your folio. <br>This is what your folio will look like when shared as a weblink.",nextButton:{className:"wiz-nxt-btn",text:p},showSkip:!1,showNext:!0},{"next .navs-buttons-container":g(7)+h("Share, present, export:")+'Your folio is private until you decide to share it:<ul class="wiz-bullets"><li><b>Present</b> it as a full-screen digital slideshow (sections become digital slides)</li><li><b>Share</b> it as a live, responsive weblink or</li><li><b>Export</b> it as a PDF or PNG file (Premium feature).</li></ul>',nextButton:{className:"wiz-nxt-btn",text:p},showSkip:!1,showNext:!0},{onBeforeStart:function(){$(".nav-image-button.more-opts").click()},"next .nav-settings":g(8)+h("Folio Menu:")+"Folio options live here. You can save a folio as a template, duplicate or leave/delete it. <br>You can also transfer the ownership of your folio or get stats.",nextButton:{className:"wiz-nxt-btn",text:p},showSkip:!1,showNext:!0},{selector:".app-title a",event:"next",description:g(9)+h("You are all set!")+"You can return to your dashboard by clicking on the logo. <br>Now it's your turn to create something awesome.",nextButton:{className:"wiz-nxt-btn",text:"DONE"},showSkip:!1,showNext:!0}];u.click(function(){o()}),"string"==typeof e.ShowOnboarding&&(e.ShowOnboarding="not-set"===e.ShowOnboarding||JSON.parse(e.ShowOnboarding.toLowerCase())),console.log("config.ShowOnboarding",e.ShowOnboarding),e.editMode&&e.ShowOnboarding&&setTimeout(function(){o()},1e3)},app.dash.archivedFolioTopBanner=function(e,t,a){a&&1==a.Status&&($("#home-page").prepend($("#tmp-archived-topbar")).on("click",".unarchive",function(){return e.IsDelinquent&&1==e.UserFolios?(t.plusPrompt("create",null,!0),!1):(t.unarchive(a,function(){window.location.href="/"}),!1)}),$("#tmp-power-by-footer").hide())},app.dash.archiveFolio=function(e,t,a){var n=$("#folio-items-container");n.on("click",".delete-folio",function(){var t=$(this).closest(".folio-item-shell");return a.archive(t.data("folio"),function(){t.animate({width:0,opacity:0,padding:0},500,"linear",function(){a.close();var o=t.toggleClass("active archived").removeClass("locked").attr("style","");$("#folio-arch-container").prepend(o),o.find(".collabs .initials:not(.add)").remove(),o.find(".edit").each(function(){console.log($(this),$(this).attr("href")),$(this).attr("href")&&$(this).attr("href",$(this).attr("href").replace("edit","folio"))}).eq(1).text("View Folio");var i=n.find(".folio-item-shell.active").length;i<1&&app.dash.emptyState(e,a).addNoFolio()})}),!1})},app.dash.changeView=function(e){return"complete"!=document.readyState?void setTimeout(function(){app.dash.changeView(e)},1e3):(0==e||2==e?(e=0==e?0:1,$(".filter-bar .filter-popup-menu .item").eq(e).click(),$(".filter-bar .filter").removeClass("menu-active"),$(".filter-bar .filter-popup-menu").hide()):1==e&&$("#tmp-sidebar .popup-menu .item").eq(2).click(),void(window.location.hash=""))},app.dash.copyFolio=function(e,t,a,n,o,i){function s(){i.getData(1,function(e,s,r,l){var c=0,d={},u=e.ST;if(console.log("inside getData:::",e,s,r,l),r&&(10!=e.ST&&11!=e.ST||o.IsDelinquent||(c=5,d.currUser="Plus",d.limit=5)),s&&10!=e.ST&&11!=e.ST&&3!=e.ST&&16!=e.ST&&(ispro=!0),s||(c=1,d.currUser="Free",d.limit=1),o.IsDelinquent&&(c=1,d.currUser="Free",d.limit=1),!s||10!=e.ST&&11!=e.ST&&16!=e.ST&&3!=e.ST||(isplus=!0,c=5,d.currUser="Plus",d.limit=5),28===u||31===u){var m=o.Team.Id>0?10:1;c=m,d.currUser="ProBusiness",d.limit=m}console.log("limit",c,r,s,o.IsDelinquent),o.Team&&o.Team.IsDelinquent?app.dash.downgrade(o,a,d,t,i,n):c>0&&(console.log("user limit:::",c),t.getUserActiveFoliosCount({success:function(e){var s=e.Data;console.log("user active folios:::",s),t.getUserTemplateCount({success:function(e){var r=e.Data,l=s+r;if(0===o.Team.Id&&(i.isProBusiness()||i.isProTeamMember()||i.isBusiness())){if((o.IsDelinquent||s>=c||r>0)&&(d.foliosCount=e.Data,1===l))return void a.message({heading:"Upgrade your account",message:"Folio Limit reached for Free User. Please upgrade for unlimited folios and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){a.payment()}})}else"ProBusiness"===d.currUser&&t.getUserTeamsAndFolios({userEmail:o.userEmail,success:function(e){console.log("getUserTeamsAndFolios response",e);var s=_.find(JSON.parse(e.Data),{Id:o.Team.Id});"undefined"!=typeof s?(s.TotalFolios>c||i.isSubscriptionExpired())&&app.dash.downgrade(o,a,d,t,i,n):console.log("getUserTeamsAndFolios teamDetails ERR",o.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)}})},error:function(e){$comp.removeClass("busy"),console.log("error: ",e)}})},error:function(e){console.log("error: ",e)}}))})}var r;$("#folio-items-container").on("click",".copy-folio-btn",function(){var e=$(this);return console.log("on copyFolio"),s(),i.checkFoliosLimitReached(t,a,function(){var t=e.data("token"),n=e.closest(".folio-item-shell"),i=n.find("h4"),s=n.data("copy-count")||1;n.data("copy-count",s+1);var l="Copy "+s+" - "+i.text();n.prepend($("#spinner-container > .loading-animation").clone()),o.duplicateFolioItem={FolioName:l,Token:t,IsDuplicate:!0},a.saveFolio(),o.saveFolioSuccess&&(r=o.saveFolioSuccess),"undefined"!==r&&""!==r?n.find(".loading-animation").remove():n.prepend($("#spinner-container > .loading-animation").clone())}),!1})},app.dash.createFolio=function(e,t,a,n,o,i){$(".folio-item").on("click",".create-btn",function(t){console.log(".create-btn clicked...");var i=$(this);o.checkFoliosLimitReached(a,n,function(){e.saveFolioTemplate={id:i.closest(".folio-item").data("template"),name:i.closest(".folio-item").data("name")},n.saveFolio()})})},app.dash.createNewMenu=function(e,t){$(".ribbon-button").on("click",function(){if(t.isPremiumGuest()||t.isSingleFolioGuest())return e.teamUserActionBlocked("create",t.getRoleName()),!1;var a=$(this).parent(".plus-menu");a.toggleClass("active"),a.hasClass("active")&&setTimeout(function(){$("body").on("click.remover",function(){a.removeClass("active"),$("body").off(".remover")})},100)})},app.dash.defaultLabel=function(e,t,a,n,o){var i=function(e){o.message({heading:"Are you sure?",message:"Set this channel as your default channel?",btnText:"Yes",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){a.makeLabelDefault({token:e.Token,success:function(){o.close(),setTimeout(function(){window.location="/"},500)},error:function(e){o.error(e.Message)}})}})};$("#all-labels-container").on("click",".default-btn",function(){return i($(this).data("label")),!1}),$(".label-details").on("click",".default",function(){return i($(this).closest(".label-details").data("label")),!1})},app.dash.delFolio=function(e,t){$("#folio-arch-container .warning span").click(function(){var a=$("#folio-arch-container .folio-item-shell"),n=[];a.each(function(e){n.push($(this).data("token"))}),a.length>0?t.message({heading:'Are you sure you want to delete </br>all folios in trash forever?<p style="padding-bottom:20px;"></p>',message:"All information, image assets, and form submissions will be deleted. Any links to this folio or its images will not be accessible.<br/>You won't be able to undo this action.",btnText:"Yes, Delete All",cancelText:"Cancel",enterAsOK:!0,notMini:!0,handleOK:function(){t.busy(),e.emptyTrash({success:function(){t.close(),$("#folio-arch-container .warning").hide(),a.each(function(e){$(this).animate({width:0,opacity:0,padding:0},500,"linear",function(){$(this).remove()})})},error:function(){t.error("There was an error. Please refresh page and try again.")}})}}):t.error("There is no folios in archived list.")}),$(".folios-container").on("click",".archived-options .delete",function(){var a=$(this).closest(".folio-item-shell");return t.message({heading:'Are you sure you want to <br/>delete forever?<p style="padding-bottom:20px;"></p>',message:"All information, image assets, and form submissions will be deleted. Any links to this folio or its images will not be accessible.<br/>You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){e.deleteFolio({data:{op:"del",token:a.data("token")},success:function(){a.animate({width:0,opacity:0,padding:0},500,"linear",function(){a.remove()})},error:function(){t.error("There was an error. Please refresh page and try again.")}})}}),!1})},app.dash.delLabel=function(e,t,a,n,o){var i=function(i,s){console.log("selected channel data",i);var r={heading:"Are you sure?",message:"All folios will be removed and the channel will be deleted. If you had any channel collaborators, they will no longer have access to this channel and may lose access to some folios. No folios will be deleted.",btnText:"Yes, Delete Channel",cancelText:"Cancel",bodyCentered:!0,notMini:!0,enterAsOK:!0},l={success:function(a){console.log(s.toString().toUpperCase()+" API response",a),$("#all-folios-button").hasClass("active")||$("#all-folios-button").click(),$("#all-labels-container").find(".item[data-name="+i.Token+"]").remove(),t.removeFromList(e.labels,i),n.raiseEvent("labelChange")},error:function(e){console.log(s.toString().toUpperCase()+" API error",e),o.error(e.Message)}},c={heading:"Upgrade your priviledges",message:"Channel members are not allowed to perform this action",btnText:"Okay",enterAsOK:!0,notMini:!0};"delete"===s?(l.token=i.Token,e.Team&&e.Team.Id>0?i.CanDelete?(r.handleOK=function(){a.removeCollabChan(l)},o.message(r)):o.message(c):(r.handleOK=function(){a.removeLabel(l)},o.message(r))):e.Team&&e.Team.Id>0&&(l.data={labelToken:i.Token,memberEmail:e.userEmail,remove:!0},r.message="Leaving this channel will only remove the channel name.<br/> No folios will be deleted.",r.btnText="Yes, Leave Channel",r.handleOK=function(){a.addRemoveChannelCollaborator(l)},o.message(r))};$("#all-labels-container").on("click",".delete-btn",function(){return i($(this).data("label"),"delete"),!1}),$(".label-details").on("click",".delete",function(){return i($(this).closest(".label-details").data("label"),"delete"),!1}),$("#all-labels-container").on("click",".leave-btn",function(){return i($(this).data("label"),"leave"),!1}),$(".label-details").on("click",".leave",function(){return i($(this).closest(".label-details").data("label"),"leave"),!1})},app.dash.downgrade=function(e,t,a,n,o,i){function s(){var i=$(".folio-item-shell.active"),r=$("#templates-items-container .folio-item.own");i.length<=a.limit&&0==r.length?e.IsDelinquent||e.Team&&e.Team.IsDelinquent?t.failedPaymentBlocker(a):o.isSubscriptionExpired()?t.expiredBlocker(a):e.Team.Id>0&&"ProBusiness"===a.currUser?n.getUserTeamsAndFolios({userEmail:e.userEmail,success:function(t){console.log("getUserTeamsAndFolios response",t);var n=_.find(JSON.parse(t.Data),{Id:e.Team.Id});"undefined"!=typeof n?n.TotalFolios<=a.limit?window.location.reload():setTimeout(s,1e3):console.log("getUserTeamsAndFolios teamDetails ERR",e.Team.Id)},error:function(e){console.log("getUserTeamsAndFolios error",e)}}):window.location.reload():setTimeout(s,1e3)}var r=$(".folio-item-shell.active"),l=$("#templates-items-container .folio-item.own");e.IsDelinquent||e.Team&&e.Team.IsDelinquent?t.failedPaymentBlocker(a):!e.IsDelinquent&&Date.now()>=e.plusInfo.End&&r.length>a.limit&&t.expiredBlocker(a);var c=$("#tmp-downgrade-bar"),d="ProBusiness"===a.currUser&&e.Team&&0===e.Team.Id?" on personal dashboard":"";c.find(".downgrade-bar .plan").text(a.currUser),c.find(".downgrade-bar .limit").text(a.limit),c.find(".downgrade-bar .s").text(a.limit>1?"s":""),c.find(".downgrade-bar .user-templates").text("Free"==a.currUser?" and no saved templates":" or saved templates"),c.find(".downgrade-bar .dashboard-text").text(d),e.Team&&c.find(".link").text("Switch to your team account"),$("#logo-bar").after(c),$("#dashboard-page").addClass("downgrade"),$(".upgrade-btn, .plus-menu").remove(),$(".sidebar #add-label").remove(),$(".folio-item.as-template .cta-btn.primary").addClass("visible-hidden"),c.find(".link").click(function(){"ProBusiness"===a.currUser||"Plus"===a.currUser?t.billing():t.payment()}),r.each(function(e,t){var a=$(t),n=a.data("folio"),o=Faltu(n.Collaborators).find({Accepted:!0}).count(),i=a.addClass("locked").find(".edit");i.eq(0).attr("href",i.eq(0).attr("href").replace("edit","folio")),i.eq(1).remove();var s=a.find(".archived-options").empty();n.Role>2&&s.append('<div class="action delete-folio" data-tip="Delete"><i class="icon-Delete"></i></div>').data("token",n.Token),o>1&&n.Role<3&&s.append('<div class="action delete-folio" data-tip="Leave"><i class="icon-Transfer"></i></div>').data("token",n.Token)}),l.each(function(e,t){var a=$(t),n=(a.data("folio"),a.addClass("locked").find(".edit"));n.eq(0).removeAttr("href"),n.eq(1).remove(),a.find(".use-template").remove();var o=a.find(".archived-options").empty();o.append('<div class="action delete-folio" data-tip="Delete"><i class="icon-Delete"></i></div>')}),l.on("click",".delete-folio",function(){var e=$(this).closest(".folio-item-shell");t.message({heading:"Delete this template?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes, Delete This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){n.deleteUserTemplate({token:e.data("token"),op:"del",success:function(){e.animate({width:0,opacity:0,padding:0},500,"linear",function(){e.remove()})},error:function(e){$("#dashboard-page > .loader").hide(),t.message({heading:"Error",message:e.Message,btnText:"Ok",enterAsOK:!0})}})}})}),s()},app.dash.emptyState=function(e,t){function a(e){$("#tmp-dash-topbar a.template").click()}function n(a,n,o,i,s){var c=$(l);c.find("h2").text(a),c.find("p.tag").text(n),o?c.find("button").text(o).on("click",i):c.find("button").hide(),e.Team&&e.Team.Id>0&&e.Team.Role<4?c.find("p.imp-folio").on("click",function(){t.importFolioPopup()}):c.find("p.imp-folio").remove(),r.append(c.addClass(s||""))}function o(){n("You don't have any folios yet.","A folio is a living document or a presentation.","Create a Folio",a,"empty")}function i(){n("You don't have any folios yet.","A folio is a living document or a presentation.","Create a Folio",a,"my-empty")}function s(){n("Looks like no one's shared folios with you yet.","When collaborators add you to their folios, you will see them here.",!1,null,"empty-shared")}var r=$("#folio-items-container"),l=$("#tmp-empty-state").html();return{addNoFolio:o,addNoShared:s,addNoMyFolio:i}},app.dash.getExploreFolio=function(e,t,a){var n=$("#tmp-dashboard-content .explore .loading-animation");n.html(a.spinner),t.getFolioFullByToken({token:e.ExploreTabFolioToken,success:function(t){console.log("Success from GetFolioByTOken",t);var a,o,i,s,r,l=JSON.parse(t.Data).FolioData,c=app.core.main(e,l),d=c.utility,u=c.apiHelper,m=c.eventManager,f=c.pageManager,p=c.store,h=c.modStore,g=c.folioStore,v=c.configStore,b=(c.appHub,c.plusHelper),y=g.get("style")||"",C='<style id="folio-style" type="text/css">'+y+"</style>";$("head").append(C),app.plugin.main(e,c,l,b),i=app.popup.main(e,m,d,u,f,b,h,p,l,g,v),a={},o=app.managers.main(e,l,c,a,i),s=o.modManager,r=o.rddm,console.log(l),app.factory.main(e,l,c,a,i,s,r),s.activatePreview(),e.EditTemplate="dash-explore",app.menutcopy(e,u,m,i,b),$("#home-page").after($("#presentation-buttons").addClass("public")),n.hide()},error:function(e){console.log("Error from GetFolioByTOken",e),$("#tmp-dash-topbar .explore").hide(),n.hide()}})},app.dash.filterBar=function(e,t,a,n,o,i,s){function r(e){return{animation:{duration:1e3},selectors:{target:e}}}function l(){a.message({heading:"Upgrade your account",message:"Channel collaboration is only available on team dashboards. Please upgrade or switch to your team dashboard to add people.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){a.billing()}})}var c,d,u,m,f,p,h=$("#folio-items-container"),g=$("#tmp-filter-bar"),v=$(g.html()),b="private",y='<i class="icon-PadlockBig"></i> Private',C='<i class="icon-UsersGroup"></i> Team Visible',T=$("#dashboard-page").find(".loader"),w=!1;h.before(v),$("#templates-items-container").before($("#tmp-temp-filter-bar").html());var x=function(){d&&d.destroy(),u&&u.destroy(),c&&c.destroy(),d=mixitup(h,r(".folio-item-shell.active")),u=mixitup($("#folio-arch-container"),r(".folio-item-shell.archived")),setTimeout(function(){c=mixitup($(".tab-content #templates-items-container"),r(".folio-item")),d.forceRefresh(),u.forceRefresh(),c.forceRefresh()},1e3)};x(),t.addListener("collabreqaccpt",function(){setTimeout(function(){x()},1e3)}),$(".filter-bar .sort").change(function(){(h.hasClass("active")?d:u).sort($(this).data("value"))}),$(".filter-bar .filter").change(function(){var e=$(this).data("value");"Deleted"==e?$("#folio-arch-container .folio-item-shell").length>0?($("#folio-arch-container .warning").show(),$("#dashboard-page").addClass("has-archived")):($("#folio-arch-container .warning").hide(),$("#dashboard-page").removeClass("has-archived")):$("#dashboard-page").removeClass("has-archived"),h.removeClass("active archived").addClass($(this).data("value").replace("Deleted","Archived").toLowerCase());var t=v.find(".label-details");t.hasClass("normal")&&t.find(".label-name").text($(this).data("value")+" Folios")}),$(".filter-bar .tmp-sort").change(function(){c.sort($(this).data("value"))}),setTimeout(function(){$(".label-details:not(.temp)").find(".label-name").scrollText({speed:2e3,startEvent:"mouseenter",minScrollWidth:190,ellips:0,animBack:!0})},1e3),m=$(".filter-bar .private-button"),f=$(".filter-bar .add-new-people"),p=$(".filter-bar .initials.add"),s.Team&&s.Team.Id>0&&s.isDashboard?(f.hide(),t.addListener("collabChanFolioMixItUp",function(){console.log("collabChanFolioMixItUp listener"),setTimeout(function(){x()},300)}),m.click(function(){if(4===s.Team.Role||5===s.Team.Role){var e=$("#all-labels-container").find(".item.active").data("name"),t=_.findIndex(s.labels,["Token",e]);t!==-1&&(console.log("config.labels[labelID]",s.labels[t]),b=2===s.labels[t].AccessType?"team":"private"),a.message({heading:"You can not perform this action",message:"Sorry, guests are not allowed to change access type of channels. Please reach out to a team admin for more access.",btnText:"Okay",bodyCentered:!0,enterAsOK:!0,notMini:!0}),setTimeout(function(){doToggleHtml(b)},300)}}),m.change(function(){function e(e){var t="private"===e?y:C;t='<span class="text-current">'+t+'</span><i class="icon-Down-Arrow"></i>',m.find(".text").html(t)}function t(e){w=e,w?(m.addClass("disable-ui"),T.show()):(T.hide(),m.removeClass("disable-ui"))}if(!w){var n=$(this).data("value"),i=$("#all-labels-container").find(".item.active").data("name"),r=_.findIndex(s.labels,["Token",i]);r!==-1&&(console.log("config.labels[labelID]",s.labels[r]),b=2===s.labels[r].AccessType?"team":"private"),console.log("private-button change",n),console.log("labelToken",i),e(n);var l="Are you sure you want to make this channel private? Your team members will be removed from folios within this channel. You can still add individual collaborators to the channel and folios.";"team"===n&&(l="Are you sure you want to make this channel team visible? All of your team members will have editing access to all folios added to this channel."),a.message({heading:"Channel Access Change",message:l,btnText:"Ok",cancelText:"Cancel",bodyCentered:!0,enterAsOK:!0,notMini:!0,handleOK:function(){t(!0),o.changeChannelAccess({data:{labelToken:i,newAccessType:"private"===n?1:2},success:function(e){b=n,console.log("changeChannelAccess response",e)},error:function(e){n=b,console.log("changeChannelAccess err",e)},complete:function(){t(!1),m.find(".item").removeClass("active"),m.find("div[data-name='"+n+"']").addClass("active"),e(n)}})},handleNo:function(){t(!1),e(b)}})}}),f.click(function(){4===s.Team.Role||5===s.Team.Role?a.message({heading:"You can not perform this action",message:"Sorry, guests are not allowed to modify collaborators to channels. Please reach out to a team admin for more access.",btnText:"Okay",bodyCentered:!0,enterAsOK:!0,notMini:!0}):a.teamChannelManagePopup(!0)}),p.click(function(){f.trigger("click")})):(m.addClass("fade-ui"),m.unbind("click"),f.addClass("fade-ui"),p.hide(),m.click(l),f.click(l))},app.dash.filter=function(e,t,a,n,o,i){function s(e){M.show(),b.forceRefresh(),y.forceRefresh(),b.filter(e),y.filter(e),setTimeout(function(){M.hide()},500)}function r(){console.log("setMixer exec"),b&&b.destroy(),y&&y.destroy(),b=mixitup(C.eq(0),O),y=mixitup(C.eq(1),O),console.log("empty-label count",$("#folio-items-container .state.empty-label").length),0===$("#folio-items-container .state.empty-label").length&&setTimeout(function(){u()},1e3)}function l(e){C.removeClass("mine shared").addClass(e)}function c(e){console.log("applyFilter target",e),T=C.find(".folio-item-shell");var t=T.filter("."+e);s(t);var a=t.filter(".active").length,n=t.filter(".archived").length;$("#folio-items-container")[a>0?"addClass":"removeClass"]("has-label-folios"),$("#folio-arch-container")[n>0?"addClass":"removeClass"]("has-label-folios")}function d(a){if(!($(a.target).closest(".options").length>0)){f=$("#tmp-sidebar .sidebar").find(".item:not(.pmenu)");var o=$(this);f.removeClass("active"),o.addClass("active");var i=o.data("name"),r=o.find(".name").text(),l=o.find(".label").attr("style");if(C.removeClass("has-label-folios"),!i)return C.removeClass("label-view"),s("all"),void w.addClass("normal").find(".label-name").text(r);C.addClass("label-view"),w.removeClass("normal").data("label",o.data("label")),w.find(".label-name").text(r),w.find(".label-name").stop(),w.find(".label-name").removeAttr("style"),w.find(".label-color").attr("style",l);var d=e.labels[t.findIndex(i,"Token",e.labels)],u=!1,b=!1,y=!1;if(console.log(d.IsDefault),w.find(".leave").hide(),d.IsDefault?(y=!0,u=!0):e.Team&&e.Team.Id>0&&(4===e.Team.Role||5===e.Team.Role?(u=!0,b=!0):2===d.AccessType?(u=!0,b=!0):d.CanDelete||(u=!0,b=!0,w.find(".leave").show())),t.toggleElementViz(y,w.find(".default")),t.toggleElementViz(u,w.find(".delete")),t.toggleElementViz(b,w.find(".rename")),e.Team&&e.Team.Id>0&&e.isDashboard){p=$(".filter-bar .private-button"),m();var T=$("#all-labels-container").find(".item.active").data("name");h=$(".filter-bar .add-new-people"),g=$(".filter-bar .initials.add"),v=$(".filter-bar .initials-list"),h.show(),g.hide(),v.empty(),n.getChannelCollaborators({data:{token:T},success:function(e){console.log("getChannelCollaborators response",e);var a=JSON.parse(e.Data);if(console.log("collaboratorsData",a),a.length>0){h.hide(),g.show();for(var n=a.length>3?3:a.length,o=0;o<n;o++){var i=$('<div data-tip="" class="initials"></div>'),s=a[o].FullName||a[o].Email;i.data("tip",s),i.text(t.getInitials(s)),v.append(i)}}},error:function(e){console.log("getChannelCollaborators response",e)}})}e.selectedChannel=i,c(i)}}function u(){M.hide(),A.find("button.view-all").on("click",function(){D.click()}),console.log("createEmptyState exec"),$("#folio-items-container").append(A.addClass("empty-label"))}function m(){var t=$("#all-labels-container").find(".item.active").data("name"),a=_.findIndex(e.labels,["Token",t]);if(console.log("config.labels",e.labels),console.log("labelID",a),a!==-1){var n="";console.log("config.labels[labelID]",e.labels[a]),2===e.labels[a].AccessType?(n=F,P="team"):(n=E,P="private"),n='<span class="text-current">'+n+'</span><i class="icon-Down-Arrow"></i>',p.find(".text").html(n),p.find(".item").removeClass("active"),p.find("div[data-name='"+P+"']").addClass("active")}else console.log("Failed to retrieve current label's details, probably on all folio filter")}var f,p,h,g,v,b,y,C=$(".folios-container:not(.templates)"),T=C.find(".folio-item-shell"),w=$(".label-details:not(.temp)"),x=$(".labels-dropdown"),k=$(".my-shared-popup-menu"),S=$("#tmp-empty-channel-state").html(),D=$("#all-folios-button"),I='<div class="loader" style="position: fixed;width: 100%;height: 100%;top: 0;left: 0;display: none;z-index: 99999;"><div class="loading-animation"></div></div>',P="private",E='<i class="icon-PadlockBig"></i> Private',F='<i class="icon-UsersGroup"></i> Team Visible',A=$(S),M=$("#dashboard-page > .loader");M.find(".loading-animation").html(a.spinner);var N=app.plugin.popupMenu(D,k,!0),O={selectors:{target:".folio-item-shell"}};D.click(function(){$(this).hasClass("active")&&N()}),k.find(".item").on("click",function(){var e=$(this);e.hasClass("active")||(e.addClass("active").siblings().removeClass("active"),D.find(".name").text(e.data("show-name")),w.addClass("normal").find(".label-name").text(e.data("show-name")),l(e.data("orderby")))}),x.on("change",function(a){var n=$(this).val(),o=t.obtain(e.labels,"Token",n);return null===o?(l("all"!=n?n:""),T.removeClass("hidden"),void w.addClass("normal")):(c(o.Token),void w.removeClass("normal").data("label",o))}),"undefined"==typeof e.filterInit&&($("#dashboard-page").append(I),$("#tmp-sidebar").on("click",".item:not(.pmenu)",d),e.selectedChannel="",e.filterInit=!0),r(),e.Team&&e.Team.Id>0&&e.isDashboard&&i.addListener("collabChanFolioMixItUp",function(){console.log("collabChanFolioMixItUp listener"),setTimeout(function(){m()},1e3),setTimeout(function(){r()},300)})},app.dash.folios=function(e,t,a,n,o,i){function s(t,a){0===e.labels.length?$("#add-label").click():n.labels(a,t,function(e){t.find(".labels >*:not(:last-child)").remove(),d(t,a)})}function r(e){return function(){return n.shareLink(e),!1}}function l(e){return function(){return n.collaborators(e),!1}}function c(t,i){var s=$(this),r=a.removeFromList(i.Labels,s.data("token"));
t.removeClass(r);var l={token:i.Token,id:$(this).data("token"),success:function(e){s.animate({width:0,opacity:0,padding:0},500,"linear",function(){s.hide()})},error:function(e){console.log(e),n.error(e.Message)}};e.Team&&e.Team.Id>0?4===e.Team.Role||5===e.Team.Role?n.message({heading:"You can not perform this action",message:"Sorry, guests are not allowed to add or remove folios to channels. Please reach out to a team admin for more access.",btnText:"Okay",bodyCentered:!0,enterAsOK:!0,notMini:!0}):o.removeFromCollabChan(l):o.removeFromLabels(l)}function d(t,n){t.find(".labels").empty(),$.each(n.Labels,function(o,i){var s=a.obtain(e.labels,"Token",i);if(s){var r=$('<div class="label"></div>').css("background-color",s.color).html(s.Name+'<div class="ghost"><i class="icon-Close"></i></div>');r.data("token",s.Token),r.find(".ghost").on("click",function(){c.call(r,t,n)}),t.addClass(s.Token),t.find(".labels").prepend(r)}})}function u(t,o){if(!(o.Version<2)){var s=t.find(".collabs"),r=5,c=0,d=[];if($.each(o.Collaborators,function(t,n){if(n.Accepted&&n.Privilege>0&&n.Email!=e.userEmail)if(++c<=r){var o=$('<div class="outer"><div class="initials">MU</div></div>');o.find(".initials").text(a.getInitials(n.FullName||n.Email)).attr("data-tip",n.FullName),s.prepend(o.find(".initials"))}else d.push(n.FullName)}),c>r){var u=s.find(".initials:last-child");d.unshift(u.attr("data-tip")),u.attr("data-html","true").text("+"+(c-r+1)).attr("data-tip",d.join("<br/>"))}var m=$('<div class="initials add"><i class="icon-AddCollaborator2"></i></div>');i.isSingleFolioGuest()?(m.attr("data-tip","Guests can not add/remove people"),m.click(function(){n.teamUserActionBlocked("add-remove-collab","Guests")})):(1===o.Role?m.addClass("hidden"):m.removeClass("hidden"),m.attr("data-tip","Add / Remove People"),m.click(l(o))),s.append(m)}}function m(e){return $("<div/>").html(e).text()}function f(a,o,l,c){var f=$(I),p=(e.baseUrl+"/folio/"+a.Token,a.FolioName||"Untitled"),h=moment(a.LastSavedUtc);a.Status<1&&(C++,a.Role>2&&y++),a.Role<3&&T++,f.attr("data-token",a.Token).attr("data-saved",a.LastSavedUtc).attr("data-name",p.toLowerCase()).data("folio",a),f.addClass(0===a.Status?"active":"archived"),f.addClass(a.Role>1?a.Role<3?"shared edit-access":"mine":"shared");var g=f.find("h4");g.text(m(p)),setTimeout(function(){g.scrollText({speed:2e3,startEvent:"mouseenter",stopEvent:"mouseleave click",minScrollWidth:268,animBack:!0,ellips:32})},1e3),f.find(".inline-title").val(p),f.find(".edit").attr("href",e.baseUrl+"/"+(0===a.Status?"edit":"folio")+"/"+a.Token);var v=1==a.Status?"View":"Edit";f.find(".options .edit").text(v+" Folio"),f.find(".delete-folio, .copy-folio-btn, .rename-folio-btn, .transfer-folio-btn").data("token",a.Token),f.find(".last-update").find("span").text(h.fromNow()).attr("title",h.format("lll")),a.Role<3&&(f.find(".delete-folio span").text("Leave"),f.find(".delete-folio i").removeClass("icon-Delete").addClass("icon-Transfer")),d(f,a),u(f,a),f.find(".manage-label").click(function(){e.Team&&e.Team.Id>0?(console.log("Role",e.Team.Role),console.log("$tempFolio",f),console.log("folio",a),4===e.Team.Role||5===e.Team.Role?n.message({heading:"You can not perform this action",message:"Sorry, guests are not allowed to add or remove folios to channels. Please reach out to a team admin for more access.",btnText:"Okay",bodyCentered:!0,enterAsOK:!0,notMini:!0}):s(f,a)):s(f,a)}),f.find(".share").click(r(a)),e.Team&&0==e.Team.Id&&!E&&(f.find(".save-template-btn").addClass("locked"),setTimeout(function(){var a=app.plugin.lockedTip(e,t);app.dash.folioStats(e,n,i,a,t)},100)),3!==a.Role&&f.find(".transfer-folio-btn").addClass("hidden"),o?($("body").animate({scrollTop:0},500),f.addClass("scaleup").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(this).removeClass("scaleup")}),S.find('.folio-item-shell:not(".transfer-item"):eq(0)').before(f)):a.Status<1?(c&&($("body").animate({scrollTop:0},500),f.addClass("scaleup").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){$(this).removeClass("scaleup")}),setTimeout(function(){f.removeClass("scaleup")},2e3)),l?S.prepend(f):S.append(f)):D.append(f),t.addListener("labelChange",function(e){f.find(".labels >*:not(:last-child)").remove(),d(f,a)})}function p(){e.folios.sort(function(e,t){return t.LastSavedUtc-e.LastSavedUtc});for(var t=0;t<e.folios.length;t++)f(e.folios[t]);S.addClass("active").removeClass("visible-hidden")}function h(){C<1&&0===e.tansFolios.length?0===S.find(".state.empty").length&&app.dash.emptyState(e,n).addNoFolio():S.find(".state.empty").remove(),C>0&&y<1?0===S.find(".state.my-empty").length&&app.dash.emptyState(e,n).addNoMyFolio():S.find(".state.my-empty").remove()}function g(){e.selectedChannel="",$("#all-folios-button").hasClass("active")||$("#all-folios-button").trigger("click")}function v(n,o,i,s){var r=[];o.forEach(function(e,t){e.Labels.forEach(function(t,a){t===n&&r.push(e.Token)})}),e.folios.forEach(function(e,t){e.Labels.forEach(function(t,a){t===n&&r.indexOf(t)===-1&&r.push(e.Token)})}),r.forEach(function(t,n){var s=_.findIndex(e.folios,["Token",t]);s!==-1?e.folios.splice(s,1):a.devWarnOnID(t,"config.folios",i+" updateAffectedFolios"),S.find('[data-token="'+t+'"]').length>0&&(S.find('[data-token="'+t+'"]').remove(),C--);var r=_.findIndex(o,["Token",t]);r!==-1?(e.folios.push(o[r]),f(o[r])):a.devWarnOnID(t,"updatedFolios",i+" updateAffectedFolios")}),b=setTimeout(function(){if(console.log("config.selectedChannel",e.selectedChannel),h(),"undefined"!=typeof e.selectedChannel&&""!==e.selectedChannel){var t=_.findIndex(s,["Token",e.selectedChannel]);t!==-1?(console.log("selectedChannel",e.selectedChannel),$("#all-labels-container").find('[data-name="'+e.selectedChannel+'"]').trigger("click")):g()}else g()},1500),t.raiseEvent("collabChanFolioMixItUp",{})}var b,y=(Date.now()>=e.plusInfo.End,0),C=0,T=0,w=($("#home-page"),$("#dashboard-page")),x=$("#tmp-sidebar"),k=$("#tmp-dashboard-content"),S=k.find("#folio-items-container"),D=k.find("#folio-arch-container"),I=$("#folio-item").html(),P=($("#single-label"),x.find("#all-labels-container"),k.find("#sidebar")),E=($("#top-bar"),!1);w.append(k),P.append(x),S.addClass("visible-hidden"),0===e.folios.length&&0===e.tansFolios.length&&e.Team&&0==e.Team.Id,p(),$(".custom-select").on("click",function(){$(this).parent(".folio-item").toggleClass("selected",$(this).is(":checked"))}),t.addListener("collabChange",function(e){var t=$('.folio-item-shell[data-token="'+e.Token+'"]');t.find(".collabs").empty(),u(t,e),app.plugin.tooltip()}),t.addListener("folioRename",function(e){$('[data-token="'+e.Token+'"]  > .folio-item > a > h4').html(e.NewFolioName)}),i.checkFolioRestrictions(o,function(a){app.dash.downgrade(e,n,a,o,i,t)}),h(),T<1&&app.dash.emptyState(e,n).addNoShared(),t.addListener("collabreqaccpt",function(e,t){f(e,!1,t)}),t.addListener("foliosRecieved",function(t,a){t.Collaborators.push({Email:e.userEmail,FullName:e.fullName,Privilege:3,Accepted:!0}),f(t,!1,a,!0)}),e.Team&&e.Team.Id>0&&e.isDashboard&&t.addListener("collabChanFolioUpdate",function(e){console.log("updatedFolios",e.updatedFolios),clearTimeout(b);var t=e.updatedFolios,a=e.updatedLabels,n=e.data,o=n.item;console.log("notifData.refreshType",n.refreshType),v(o.Data.LabelToken,t,n.refreshType,a)})},app.dash.folioStats=function(e,t,a,n,o){var i=$("#folio-items-container");o.addListener("userTeamRoleChanged",function(t){e.userEmail==t.Data.Email&&(console.log("access changed, updating logs"),c())});var s="Premium Feature",r=function(e,t){var o=i.find(".show-stats"),r=s,l=!0;a.hasTeam()?a.isSingleFolioGuest()||a.isPremiumGuest()?(r="Guests can not create templates",l=!1):a.isProBusiness()&&(r="Folio stats is available on business plans",l=!1):(a.isFree()||a.isPlus()||a.isProBusiness())&&(l=!1),l?n.remove(o):n.add(o,r,0)},l=function(e,t){var o=i.find(".save-template-btn"),r=s,l=!0;a.hasTeam()?(a.isSingleFolioGuest()||a.isPremiumGuest())&&(r="Guests can not create templates",l=!1):(a.isFree()||a.isPlus())&&(l=!1),l?n.remove(o):n.add(o,r,0)},c=function(e){a.setLock(function(e,t){r(e,t),l(e,t)},e)};c(),o.addListener("plusUnlocked",function(){c()}),o.addListener("plusCancelled",function(){c()}),i.on("click",".show-stats",function(){var e={heading:"Upgrade your account",message:"Folio stats is available on business plans. Please upgrade to have access to this and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){t.billing()}};if($(this).hasClass("locked"))return void(a.hasTeam()?a.isProBusiness()?t.message(e):t.teamUserActionBlocked("stats","Guests"):t.message(e));var n=$(this).closest(".folio-item-shell");return t.folioStats(n.data("token"),n.find(".edit h4").text()),!1})},app.dash.globalAlert=function(e,t){function a(){t.setGdprConsent({success:function(){console.log("consent closed")}});var e=o.outerHeight();o.animate({opacity:.25,left:"-1200",height:"0px"},2e3,function(){o.remove()}),$("#top-bar, #home-page, #edit-page, #dashboard-page").animate({"margin-top":"-="+e+"px"},2e3,function(){$("#n-panel").css("top","50px"),$("body").removeClass("global-alert")})}var n=$("#tmp-global-alert"),o=n.find(".global-alert-container"),i=n.find("#gdpr");$p=o.find("p.content"),$close=o.find(".closebtn"),$p.html(i.html()),$("body").addClass("global-alert").prepend(o),$close.on("click",a)},app.dash.inlineRename=function(e,t){$(" #folio-items-container, #templates-items-container").on("click",".inline-action-edit",function(){var e=$(this),t=$(this).next(".inline-action-save"),a=t.find(".inline-title"),n=e.prev(".edit").find("h4");t.removeClass("hidden"),e.addClass("inactive"),a.removeClass("error").focus().blur(function(){t.addClass("hidden"),e.removeClass("inactive")}).on("keydown",function(e){13==(e.which||e.keyCode)?t.find(".save-icon").trigger("mousedown"):27==(e.which||e.keyCode)&&a.blur()}).data("lastVal",n.text()),n.text(a.data("lastVal")),a.val(n.text())}),$("#folio-items-container, #templates-items-container").on("mousedown",".save-icon",function(){var a=$(this),n=a.parent(".inline-action-save"),o=n.closest(".folio-item").find("h4"),i=n.find(".inline-title"),s=i.val(),r=a.closest(".folio-item-shell").data("folio");return 0===s.length?void i.addClass("error"):s==i.data("lastVal")?void n.addClass("hidden"):(o.text(s),n.addClass("fadeout"),i.off("keypress"),$(".inline-action-edit").removeClass("inactive"),void e.renameFolio({token:r.Token,name:s,success:function(){r.FolioName=s,r.LastSavedUtc=Date.now(),i.val(s).data("lastVal",s),n.removeClass("fadeout").addClass("hidden")},error:function(e){o.text(i.data("lastVal")),i.val(i.data("lastVal")),t.error(e.Message)}}))})},app.dash.labels=function(e,t,a,n,o){function i(o){var i=$(m).data("label",o),s=!1,r=!1,l=!1;i.find(".label").css("background-color",o.color),i.find(".name").text(o.Name||"Untitled"),i.find(".share").click(function(){if(e.Team&&e.Team.Id>0){var i=o.Token,s=_.findIndex(e.labels,["Token",i]);console.log("currentTOken",i),console.log("currentLabelID",s),s!==-1?t.getLabelOwner({data:{token:i},success:function(t){var a=JSON.parse(t.Data);e.userEmail===a.Email?n.shareLink(o):n.message({heading:"You can not perform this action.",message:"Only channel owners can adjust the channel's link sharing settings. Reach out to the channel owner to perform this action. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})},error:function(e){console.log("getLabelOwner error",e),n.message({heading:"Error",message:"Could not process request. Please try again later. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})}}):a.devHighlightConsole("Token not found on config.labels",i)}else n.shareLink(o)}),i.find(".leave-btn").hide(),o.IsDefault?(l=!0,s=!0):e.Team&&e.Team.Id>0&&(4===e.Team.Role||5===e.Team.Role?(s=!0,r=!0):2===o.AccessType?(s=!0,r=!0):o.CanDelete||(s=!0,r=!0,i.find(".leave-btn").show())),a.toggleElementViz(l,i.find(".default-btn")),a.toggleElementViz(s,i.find(".delete-btn")),a.toggleElementViz(r,i.find(".rename-btn")),i.find(".default-btn, .delete-btn, .leave-btn, .rename-btn").data("label",o),i.attr("data-name",o.Token),u.append(i);var c=$("<option></option>");c.text(o.Name||"Untitled").val(o.Token),f.append(c)}function s(){var t,a=[];$.each(e.labels,function(e,n){n.IsDefault?t=n:a.push(n)}),t&&a.sort(function(e,t){return e.Name>t.Name}).unshift(t),e.labels=a,console.log("channels sorted")}function r(){s();for(var t=0;t<e.labels.length;t++)i(e.labels[t])}function l(s,r){var l=u.find(".item").length;e.labels.push({Name:s,Token:r.Message,FolioTokens:[],Private:!0,HasPass:!1,Indexed:!1,isLabel:!0,color:e.colors[l%e.colors.length]}),i(e.labels[e.labels.length-1]),app.dash.filter(e,a,n,t,!0,o)}function c(t,n,s){var r=n.item.Data.LabelToken;console.log("LabelToken",r);var l=_.findIndex(e.labels,["Token",r]),c=_.findIndex(t,["Token",r]);l!==-1&&d(l,r),c!==-1?(e.labels.push(t[c]),i(t[c])):a.devWarnOnID(r,"config.labels",n.refrshType+" updateChannels");var m=_.uniqBy(t,"Token");e.labels=m,console.log("config.labels",e.labels),e.labels.forEach(function(e,t){u.find('[data-name="'+e.Token+'"]').not(":first").remove()}),o.raiseEvent("collabChanFolioUpdate",{data:n,updatedFolios:s,updatedLabels:t})}function d(t,n){e.labels[t].Token===n?(e.labels.slice(t,1),u.find('[data-name="'+n+'"]').remove()):a.devHighlightConsole("removeChannelFromUI discrepancy at ",n)}var u=$("#all-labels-container"),m=$("#single-label").html(),f=$(".labels-dropdown");$("#add-label").on("click",function(){if(e.Team&&e.Team.Id>0){if(5===e.Team.Role||4===e.Team.Role)return void n.message({heading:"You can not perform this action",message:"Sorry, guests are not allowed to create new channels. Please reach out to a team admin for more access.",btnText:"Okay",bodyCentered:!0,enterAsOK:!0,notMini:!0});n.teamChannelPopup()}else n.personalChannelPopup(l);return!1}),o.addListener("addlabel",function(s){i(e.labels[s]),app.dash.filter(e,a,n,t,!1,o)}),e.Team&&e.Team.Id>0&&e.isDashboard&&o.addListener("collabChanUdate",function(a){console.log("collabChanUdate listener",a),setTimeout(function(){t.getDashboardData({data:{},success:function(t){console.log("getDashboardData response",t);for(var n=t.Data.Labels,o=t.Data.UserFolios,i=0;i<n.length;i++)n[i].isLabel=!0,n[i].color=e.colors[i%e.colors.length];c(n,a,o)},error:function(e){console.log("getDashboardData response",e)},complete:function(){}})},500)}),r()},app.dash.listRequests=function(e,t){function a(e){var t=s.find("div").data();t&&t.code==(e.Secret||e.Code)||(o=$(r),o.data("code",e.Secret||e.Code),o.data("item",e),o.find("h4").text(e.FolioName||e.Folio||"Untitled"),o.find(".description").text((e.UserName||e.Name)+" wants to transfer this folio to you."),s.prepend(o))}function n(e){o=$(r),o.addClass("collabRequest").data("Id",e.Data.Id).attr("data-token",e.Data.Token),o.find("h4").text(e.Data.Folio||"Untitled"),o.find(".description").text(e.Data.Name+" has invited you to "+(e.Privilege>1?"edit":"view")+" this folio."),s.prepend(o),$(".nav-main-menu a:eq(0)").click()}for(var o=null,i=$("#tmp-dashboard-content"),s=i.find("#folio-items-container"),r=$("#tmp-tranfer-item").html(),l=0;l<e.tansFolios.length;l++)a(e.tansFolios[l]);t.addListener("transferRequestArrived",a),t.addListener("collabRequestArrived",n)},app.dash.main=function(e,t,a,n,o,i){for(var s=this,r=e.labels,l=e.colors,c=app.plugin.lockedTip(e,t),d=0;d<r.length;d++)r[d].isLabel=!0,r[d].color=l[d%l.length];s.tabs(e),s.listRequests(e,t),s.folios(e,t,n,o,a,i),s.labels(e,a,n,o,t),s.createNewMenu(o,i),s.filterBar(app.plugin.popupMenu,t,o,i,a,n,e),s.subOptionsMenu(),s.subOptionLabelMenu(e,n,o,a),s.templateLabels(e,n),s.templates(e,n,o,a,i),s.delFolio(a,o),s.archiveFolio(e,a,o),s.saveAsTemplate(e,a,o,i),s.unarchiveFolio(a,o,e),s.createFolio(e,s,a,o,i,t),s.copyFolio(s,a,o,t,e,i),s.rename(s,a,o),s.inlineRename(a,o),s.processRequests(a,o,t,e,i),s.transferFolio(e,o),s.renameLabel(s,e,n,a,t,o),s.delLabel(e,n,a,t,o),s.defaultLabel(e,n,a,t,o),s.folioStats(e,o,i,c,t),s.filter(e,n,o,a,!0,t),s.wizardDash(e,a,n,o),app.plugin.tooltip()},app.dash.processRequests=function(e,t,a,n,o){function i(a,o){var i,s=o.data("item");i=n.UserTeams&&n.UserTeams.length>0&&s.TeamID>0?{verb:a,secret:o.data("code"),teamId:s.TeamID}:{verb:a,secret:o.data("code")},e.processTransfer({data:i,success:function(){"accept"===a?(console.log("in processTransfer",s),s.isUseTemplate=!1,n.saveFolioTransferItem=s,t.saveFolio()):window.location="/"},error:function(e){5==e.StatusCode?t.plusPrompt("create",null,!0):10==e.StatusCode?t.plusPrompt("create",null,!1,!0):t.error(e.Message)}})}$("#folio-items-container").on("click",".request-btn",function(a){console.log("on processRequests"),a.preventDefault(),t.busy();var s=$(this),r=s.hasClass("yes")?"accept":"reject",l=s.closest(".folio-item-shell");"reject"===r?l.hasClass("collabRequest")?(l.remove(),t.close(),window.location="/"):i(r,l):o.checkFoliosLimitReached(e,t,function(){l.hasClass("collabRequest")?e.processCollaborator({data:{verb:r,id:l.data().Id},success:function(){if("accept"==r){console.log("collab func on dash");var a=l.data().token;$("#folio-items-container").find(".empty-shared, .empty").remove(),e.getFolioByToken({token:a,success:function(o){var i=JSON.parse(o.Data);e.getFolioCollaborators({token:a,success:function(o){console.log("response",o),e.getWorkspaceChannels({teamId:n.Team.Id,success:function(e){console.log("response channels",e),n.saveFolioCollabItem={FolioName:i.FolioName,Token:a,collaborators:JSON.parse(o.Data),labels:JSON.parse(e.Data)},console.log("saveFolioCollabItem",n.saveFolioCollabItem),t.saveFolio()},error:function(e){console.log(e)}})},error:function(e){console.log(e)}})},error:function(e){console.log("error",e)}})}},error:function(e){5==e.StatusCode?t.plusPrompt("create",null,!0):10==e.StatusCode?t.plusPrompt("create",null,!1,!0):t.error(e.Message)}}):i(r,l)})})},app.dash.rename=function(e,t,a,n){$(".edit-link").each(function(){var t=$(this),a=t.text();t.data("name",a),e.setName(t,a)}),$(" #folio-items-container").on("click",".rename-folio-btn",function(){var e=$(this),n=e.data("token"),o=e.closest(".folio-item-shell").find("h4");return a.message({heading:"Rename Folio",showBusy:!0,showInput:!0,enterAsOK:!0,btnText:"Rename",emptyError:"Please provide a name for the folio",cancelText:"Cancel",input:o.text(),namespace:"rename-folio-popup",inputPlaceholder:"Enter name",handleOK:function(e){t.renameFolio({token:n,name:e,success:function(){o.text(e),a.close()},error:function(e){a.error(e.Message)}})}}),!1})},app.dash.renameLabel=function(e,t,a,n,o,i){var s=function(e,t,a){i.message({heading:"Rename Channel",showBusy:!0,showInput:!0,enterAsOK:!0,btnText:"Rename",cancelText:"Cancel",emptyError:"Please provide a name for the channel",namespace:"rename-label-popup",inputPlaceholder:"Enter name",input:e,handleOK:function(e){n.renameLabel({token:t.Token,name:e,success:function(){t.Name=e,o.raiseEvent("labelChange"),a(e),i.close()},error:function(e){i.error(e.Message)}})}})};$("#all-labels-container").on("click",".rename-btn",function(){var e=$(this),t=e.data("label"),a=e.closest(".item").find(".name");return s(a.text(),t,function(t){a.text(t),e.closest(".item").hasClass("active")&&$(".label-name").text(t)}),!1}),$(".label-details").on("click",".rename",function(){var e=$(this).closest(".label-details"),t=e.data("label"),a=e.find(".label-name");return s(t.Name,t,function(e){a.text(e),$("#all-labels-container").find(".item[data-name="+t.Token+"] .name").text(e),$(".labels-dropdown").find("option[value="+t.Token+"]").text(e)}),!1})},app.dash.saveAsTemplate=function(e,t,a,n){var o=$("#folio-items-container");o.on("click",".save-template-btn",function(){if($(this).hasClass("locked"))return void(n.hasTeam()?a.teamUserActionBlocked("save-as-template","Guests"):a.billing());var o=$(this).closest(".folio-item-shell"),i=o.data("token"),s=o.find("h4").text()+" - Template";return $("#dashboard-page > .loader").show(),t.saveAsTemplate({token:i,name:s,teamId:e.Team.Id,CopiedFromTemplate:!1,success:function(){window.location.hash="#mytemplates",setTimeout(function(){location.reload()},100)},error:function(e){$("#dashboard-page > .loader").hide(),a.message({heading:"Error",message:e.Message,btnText:"Ok",enterAsOK:!0})}}),!1})},app.dash.subOptionLabelMenu=function(e,t,a,n){$("#sidebar").on("click",".menu",function(e){e.preventDefault();var t=$(this);t.toggleClass("active"),t.hasClass("active")&&setTimeout(function(){$("body").on("click.labelMenuRemover",function(){t.removeClass("active"),$("body").off(".labelMenuRemover")})},100)}),$(".left-section").on("click",".share",function(){if(e.Team&&e.Team.Id>0){var o=$(this).closest(".label-details").data("label").Token,i=_.findIndex(e.labels,["Token",o]),s=$(this);console.log("currentTOken",o),console.log("currentLabelID",i),i!==-1?n.getLabelOwner({data:{token:o},success:function(n){var o=JSON.parse(n.Data);e.userEmail===o.Email?a.shareLink(t.obtain(e.labels,"Token",s.closest(".label-details").data("label").Token)):a.message({heading:"You can not perform this action.",message:"Only channel owners can adjust the channel's link sharing settings. Reach out to the channel owner to perform this action. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})},error:function(e){console.log("getLabelOwner error",e),a.message({heading:"Error",message:"Could not process request. Please try again later. ",btnText:"Ok",bodyCentered:!0,enterAsOK:!0,notMini:!0})}}):t.devHighlightConsole("Token not found on config.labels",o)}else a.shareLink(t.obtain(e.labels,"Token",$(this).closest(".label-details").data("label").Token))})},app.dash.subOptionsMenu=function(){$("#folio-items-container , #templates-items-container").on("click",".menu",function(e){e.preventDefault(),$(".more-options .menu").not(this).removeClass("active");var t=$(this);t.toggleClass("active"),t.next(".settings-btns").children().on("click",function(){t.removeClass("active")}),$("body").off(".menuRemover"),t.hasClass("active")&&setTimeout(function(){$("body").on("click.menuRemover",function(){t.removeClass("active"),$("body").off(".menuRemover")})},100)})},app.dash.tabs=function(e){var t="hidden",a="colored-dashboard",n=$(".tab-content"),o=$(".nav-main-menu a").not("a.help-center");o.on("click",function(i){o.removeClass("active");var s=$(this).addClass("active").index();return n.addClass(t).filter(":eq("+s+")").removeClass(t),$("body").toggleClass(a,!$(this).hasClass("template")),e.userTemplates.length>0&&$("#tmp-my-labels-container .item:eq(0)").trigger("click"),!1}),$(".use-template").on("click",function(e){o.filter(":eq(1)").trigger("click")}),$(".plus-menu .create-new").on("click",function(e){$('div[data-template="blank"]').find(".cta-btn.primary").trigger("click")}),$("body").addClass(a)},app.dash.templateLabels=function(e,t){function a(e){u=$("#templates-items-container .as-template"),d.filter(u.filter("."+e))}function n(){var e=$(this),t=e.data("label");return s.find(".item").removeClass("active"),e.addClass("active"),$("#templates-items-container .state").hide(),m.find(".label-name").css({paddingLeft:"0"}),t&&"own"==t.Token&&(m.find(".label-color").hide(),$("#templates-items-container").find(".own").removeClass("hidden"),$("#templates-items-container").find(".own").length<1&&$("#templates-items-container .state").show()),t?(m.removeClass("normal"),m.find(".label-name").text(t.Name),m.find(".label-color").css("background-color",t.color),void a(t.Token)):(d.filter(".xtensio"),void m.addClass("normal").find(".label-name").text("Xtensio Templates"))}function o(e){var t=$(r).data("label",e);t.find(".name").text(e.Name||"Untitled"),t.find(".options").remove(),t.on("click",n).data("label",e),c.append(t),"xtensio"==e.Token&&t.find(".new").remove();var a=$("<option></option>");a.text(e.Name||"Untitled").val(e.Token),f.append(a)}var i=$(".folios-container.templates"),s=$("#tmp-temp-sidebar"),r=$("#single-label").html(),l=$("#tmp-labels-container"),c=$("#tmp-my-labels-container");t.sort(e.templatesLabels,"Name");var d,u,m=i.find(".label-details.temp"),f=i.find(".tmp-labels-dropdown");setTimeout(function(){d=mixitup(i,{animation:{duration:900},selectors:{target:".folio-item"},callbacks:{onMixStart:function(e,t){$("#dashboard-page > .loader").show()},onMixEnd:function(e){$("#dashboard-page > .loader").hide()}},debug:{enable:!0}})},1e3),$("#tmplt-sidebar").append(s);o(e.myLabel);for(var p=0;p<e.templatesLabels.length;p++){var h=e.templatesLabels[p],g=$(r).data("label",h);h.color=e.colors[p%e.colors.length],g.find(".label").css("background-color",h.color),g.find(".name").text(h.Name||"Untitled"),g.find(".options").remove(),g.on("click",n).data("label",h),l.append(g);var v=$("<option></option>");v.text(h.Name||"Untitled").val(h.Token),f.append(v)}$("#all-temps-button").on("click",n),f.on("change",function(){var n=$(this).val(),o=t.obtain(e.templatesLabels,"Token",n);return null===o?(d.filter("all"),void m.addClass("normal")):(a(o.Token),void m.removeClass("normal"))})},app.dash.templates=function(e,t,a,n,o){function i(a,n){$.each(n.Labels,function(n,o){var i=t.obtain(e.templatesLabels,"Token",o);if(i){var s=$('<div class="label"></div>').css("background-color",i.color).text(i.Name);s.data("token",i.Token),a.addClass(i.Token),a.find(".labels").prepend(s)}})}function s(e){return function(){return a.shareLink(e),!1}}function r(t,n){return e.IsDelinquent&&1===Faltu(e.folios).find({Status:0}).count()?void a.plusPrompt("create",null,!0):function(){var n=($(this),t.Token),o="Untitled ( "+t.FolioName+" )";return e.userName?(e.saveFolioTransferItem={FolioName:o,Token:n,template:t.FolioName,isUseTemplate:!0},a.saveFolio()):a.signUp(!0),!1}}function l(e){return function(){return a.folioStats(e.Token,e.FolioName,{isTemplate:!0,UsedCount:e.UsedCount}),!1}}function c(t){return function(){return window.location=e.baseUrl+"/edit/"+t.Token,!1}}function d(e){return function(){return a.message({heading:"Are you sure?",message:"Are you sure you want to delete this template? This can not be undone.",btnText:"Yes",notMini:!0,handleOK:function(){n.deleteUserTemplate({token:e.Token,op:"del",success:function(){$("#dashboard-page > .loader").hide(),window.location.reload()},error:function(e){$("#dashboard-page > .loader").hide(),a.message({heading:"Error",message:e.Message,btnText:"Ok",enterAsOK:!0})}})},cancelText:"Cancel",handleNo:function(){a.close()}}),!1}}function u(t,a){$.each(a.Labels,function(a,n){var o=e.myLabel;if(o){var i=$('<div class="label"></div>').css("background-color",o.color).text(o.Name);i.data("token",o.Token),t.addClass(o.Token),t.find(".labels").prepend(i)}})}function m(t,a){for(var n=0;n<t.length;n++){var o=t[n],m=a?"false":"blank slate"==o.PublicName.toLowerCase();if(h=$(p),h.attr("data-template",o.TemplateName).attr("data-name",o.PublicName||o.FolioName).attr("data-used",o.UsedCount).attr("data-date",o.CreatedDate),a?u(h,o):i(h,o),o.Thumbnail&&h.find(".img").removeClass("hidden").find("img").attr("src",o.Thumbnail),o.UsedCount&&!m&&h.find(".used").text("Used "+o.UsedCount+" times"),g=e.baseUrl+"/folio/"+o.FolioToken,h.find("h4").text(o.PublicName||o.FolioName),h.find(".preview, .link").attr("href",g),o.IsNew&&h.find(".new-label").removeClass("hidden"),m&&!a&&(h.find(".primary").addClass("red").text("Create New"),h.attr("data-used","9999999999").find(".preview").addClass("hidden")),h.find(".img").hover(function(){$(this).stop().animate({scrollTop:$(this).find("img").height()},5e3)},function(){$(this).stop().animate({scrollTop:0},2e3)}),a){var v=Faltu(o.Collaborators||[]).find({Email:e.userName}).get();v[0]&&(v[0].Privilege=3),o.Collaborators=v,h.data("token",o.Token),h.data("folio",o),h.find(".link").attr("href",e.baseUrl+"/edit/"+o.Token),h.addClass("own"),h.find(".cta-buttons").remove(),h.find(".share-btn").click(s(o)),h.find(".use-template").click(r(o)),h.find(".edit-template").click(c(o)),h.find(".delete-folio").click(d(o)),h.find(".show-stats").click(l(o))}else h.find(".options").remove(),h.addClass("xtensio");m&&(h.find(".link").attr("href","#"),h.find(".link ").removeAttr("target")),a?f.prepend(h):f.append(h)}}var f=($("#tmp-dashboard-content"),$("#templates-items-container")),p=$("#template-item").html(),h=($("#my-template-item").html(),null),g=null;m(e.templates,!1),"undefined"!=typeof e&&e.isDashboard&&(setTimeout(function(){e.userTemplates.length>0?m(e.userTemplates,!0):o.getData(1,function(t,n,o,i){var s=$("#tmp-empty-state").html(),r=$(s),l=n&&10!=t.ST&&11!=t.ST||e.Team&&e.Team.Id>0,c="";r.find("p.imp-folio").remove(),r.find("h2").text("You haven't saved any templates, yet."),console.log("isTemp",l),l?(r.find("button").remove(),r.append($('<h2><a class="btn dash-button primary red" style="width: 100px;margin: 0 auto;border-radius: 0;display: block;" href="https://xtensio.com/tips-tricks-saving-templates/" target="_blank">Learn</a></h2>'))):(c=' (<span style="font-family: Proxima-Bold, Helvetica, sans-serif;">Premium Feature</span>)',r.find("button").html('See plans <span class="icon-Secure" style="vertical-align: middle;margin-left: 5px;"></span>').on("click",function(){a.billing()}),r.hide()),r.find("p.tag").html("Save your folios as Templates"+c+".<br> Use privately or share with the world."),f.append(r)})},200),setTimeout(function(){app.plugin.tooltip(),e.Team&&0==e.Team.Id&&$(".tmp-sort.x-select").click(),$(".tmp-sort.x-select .item:eq(2)").click()},1500))},app.dash.transferFolio=function(e,t){$(" #folio-items-container").on("click",".transfer-folio-btn",function(a){return e.Team&&e.Team.Id>0?t.transferTeamFolio($(this).data("token")):t.transferFolio($(this).data("token")),!1})},app.dash.unarchiveFolio=function(e,t,a){$(".folios-container").on("click",".unarchive",function(){if(a.IsDelinquent&&1===Faltu(a.folios).find({Status:0}).count())return void t.plusPrompt("create",null,!0);var e=$(this).closest(".folio-item-shell"),n=e.data("folio");return t.unarchive(n,function(){t.close(),n.Collaborators=Faltu(n.Collaborators).find({Email:a.userName}).get(),e.removeClass("archived").addClass("active").find(".edit").each(function(){$(this).attr("href",$(this).attr("href").replace("folio","edit"))}).eq(1).text("Edit Folio");var o=$("#folio-items-container");o.find(".state.empty").hide(),$("#folio-items-container").find(".collabRequest").length>0?o.find(".collabRequest").after(e):o.prepend(e),window.location.hash="active"}),!1})},app.dash.wizardDash=function(e,t,a,n){function o(){console.log("run dashboard wizard"),n.close(),$(".nav-main-menu a:eq(0)").click(),s=new EnjoyHint({onSkip:i,onEnd:i}),s.setScript(f),s.runScript()}function i(){console.log("skipped wizard at step ",s.getCurrentStep()+1),t.setOnboardingStatus({step:s.getCurrentStep()+1,onboardingType:1,success:function(e){console.log("response from setOnboardingStatus",e)},error:function(e){console.log("error from setOnboardingStatus",e)}})}var s,r=$("#top-bar .user-menu-popup"),l=r.find(".dash-wizard"),c=5,d='NEXT <i class="fa fa-angle-right"></i>',u=function(e){return'<text style="color: #00bd9c"><b>'+e+"</b></text><br>"},m=function(e){return'<p style="color: #ffd371">'+e+" / "+c+"</p>"},f=[{"next .plus-menu":m(1)+u("Start a New Project:")+"Create a new FOLIO from a template or build one from scratch.",nextButton:{className:"wiz-nxt-btn",text:d},showSkip:!1,showNext:!0},{onBeforeStart:function(){$(".gear-button").click()},"next .user-menu-popup":m(2)+u("Adjust Settings:")+"Manage account settings, find resources and help articles, <br>and check the status of the app via your profile menu.",timeout:200,nextButton:{className:"wiz-nxt-btn",text:d},showSkip:!1,showNext:!0},{"next #notify-btn":m(3)+u("Check Notifications:")+"As you add collaborators you will get <br>notifications about your team's activity here.",nextButton:{className:"wiz-nxt-btn",text:d},showSkip:!1,showNext:!0},{"next #all-labels-container":m(4)+u("Get Organized with Channels:")+"Channels let you group your folios together and share them in batches. <br>You can even customize the shareable landing page and links.",nextButton:{className:"wiz-nxt-btn",
text:d},showSkip:!1,showNext:!0},{onBeforeStart:function(){$(".gear-button").click()},selector:".user-menu-popup li:contains('Help Center')",event:"next",description:m(5)+u("You are all set!")+"You are now ready to create awesome living documents and presentations. <br>For additional info, see our help center.",timeout:200,nextButton:{className:"wiz-nxt-btn",text:"DONE"},showSkip:!1,showNext:!0}];l.click(function(){o()}),"string"==typeof e.ShowOnboarding&&(e.ShowOnboarding="not-set"===e.ShowOnboarding||JSON.parse(e.ShowOnboarding.toLowerCase())),console.log("config.ShowOnboarding",e.ShowOnboarding);var p=window.location.hash.substring(1);e.isDashboard&&e.ShowOnboarding&&""===p&&setTimeout(function(){o()},1e3)},app.modHelper.createLayoutData=function(e,t,a){var n=[],o=!0;$("#edit-sections .edit-div").each(function(i,s){var r=$(s),l={Order:i+1,Tag:r.data("Tag"),ModIds:[]};r.data("bgUrl")&&(l.BgUrl=r.data("bgUrl")),r.data("bgColor")&&(l.BgColor=r.data("bgColor")),r.find(".section-content > .module-container").each(function(n,i){var s=t.obtain(e.Modules,"Key",$(i).data("key"));if(s&&"EmptyModule"!=s.Type){if(!s.Tag)return o=!1,s.save(function(){app.modHelper.createLayoutData(e,t,a)}),!1;l.ModIds.push(s.Tag),s.editObj.saveMods&&s.editObj.saveMods()}}),n.push(l)}),o&&a(n)},app.modHelper.getGuiModules=function(e,t){for(var a=[],n=function(e){e&&$.each(e,function(e,t){t.Created=new Date(t.Created),t.Data=JSON.parse(t.Data)})},o=0;o<e.Modules.length;o++){var i=e.Modules[o];i.Key=i.Tag||t.uniqueId(),i.Data=JSON.parse(i.Data),i.lastSavedData=JSON.stringify(i.Data),n(i.Records),"DataModule"!=i.Type&&a.push(i)}return a},app.modHelper.sectionHelper=function(e,t,a,n,o,i,s,r,l,c,d,u,m){function f(){for(var e=l.Data.Sections,t=o.uniqueId(!0),n=0;n<e.length;n++)if(e[n].Tag==t||o.obtain(a.Modules,"Tag",t))return f();return t}var p=n.changeImage,h=n.setCallback,g=$("#edit-sections"),v=$("#modules-preview-main"),b=($("#modules-preview-header"),'<div class="preview-div clearfix"><div class="section-content clearfix"></div></div>'),y='<div class="edit-div clearfix"><div class="section-content clearfix"></div></div>',C=function(e){var t=$(b);return e.BgUrl&&t.css("backgroundImage","url("+e.BgUrl+")"),e.BgColor&&t.css("backgroundColor",e.BgColor),t},T=function(e,t){if("up"==e){var a=t.prev();a.length&&t.insertBefore(a)}else if("down"==e){var n=t.next();n.length&&t.insertAfter(n)}else"top"==e?t.parent().prepend(t):"bottom"==e&&t.parent().append(t)},w=function(t,l){function c(t){T(t,C),T(t,l),"move"==e.currentAction()&&$("html,body").animate({scrollTop:C.offset().top},400)}function d(e){var t=[];C.find(".module-container").each(function(e,n){var i=o.obtain(a.Modules,"Key",$(n).data("key"));if(i){var s=r[i.Type];t.push(i.ID),i.noDelete=!0,s.removeModule(i,1)}}),e||app.factory.apiHelper.deleteModules(t),C.remove(),l.remove()}function m(e){t.BgColor=e,t.BgUrl="",C.data("bgColor",e),C.data("bgUrl",""),C.css("backgroundColor",e),C.css("backgroundImage",""),l.css("backgroundColor",e),l.css("backgroundImage","")}function g(e){t.BgColor="",t.BgUrl=e;var a=C.data("bgUrl");p(a,e),C.data("bgUrl",e),C.data("bgColor",""),o.changeBg(s,C,e),l.css("backgroundImage","url("+e+")")}function v(){p(t.BgUrl,""),t.BgColor="",t.BgUrl="",C.data("bgUrl",""),C.data("bgColor",""),C.css("backgroundImage",""),C.css("backgroundColor",""),l.css("backgroundImage",""),l.css("backgroundColor","")}function b(){u.reg(t,"Sec_AddModule",function(t,a){e.addModule(a.Type,a,0,C.find(".section-content"),l.find(".section-content"))}),u.reg(t,"Sec_Move",function(e,t){c(t)}),u.reg(t,"Sec_Remove",function(){d(!0)}),u.reg(t,"Sec_Duplicate",function(a,n){t.newTag=n,e.duplicateSection(t,C,l)}),u.reg(t,"Sec_BgColor",function(e,t){m(t)}),u.reg(t,"Sec_BgURL",function(e,t){h(null),g(t)}),u.reg(t,"Sec_BgReset",v)}t.Tag=t.Tag||f();var C=$(y).data("Tag",t.Tag).data("bgUrl",t.BgUrl).data("bgColor",t.BgColor);t.BgUrl?(p("",t.BgUrl),C.css("backgroundImage","url("+t.BgUrl+")")):t.BgColor&&C.css("backgroundColor",t.BgColor),b();var w=n.sectionButtons(t,{addModule:function(){s.addModule(function(t,a){e.addModule(t,a,1,C.find(".section-content"),l.find(".section-content"))})},handleExport:function(){var t,n="",o=$("#home-page");s.exp(a,e.getExport(),{$el:l,target:"section",cb:function(a,s){n="",t=i.isCurrent(i.pages.home),t||i.showPage(i.pages.home),o.css("width",a+"px"),setTimeout(function(){e.activatePreview();var a=$('<div><div class="container-fluid"><div class="row" id="modules-preview-main">'+$("<div>").append(l.clone()).html()+"</div></div></div>");$("head").find(".module-style, #folio-style").each(function(e,t){n+="<style>"+t.innerHTML+"</style>"}),n+=a.html(),n+=$("#tmp-power-by-footer").get(0).outerHTML,s(n),o.css("width",""),t?e.activatePreview():i.showPage(i.pages.edit),e.saveData()},20)}})},move:function(a){e.currentAction("move"),c(a),u.sync(t,"Sec_Move",a),e.saveLayout()},del:function(a){a?(d(),u.sync(t,"Sec_Remove",""),setTimeout(e.saveLayout,1e3)):s.message({heading:"Delete section?",message:"You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",handleOK:function(){d(),u.sync(t,"Sec_Remove",""),setTimeout(e.saveLayout,1e3)}})},dup:function(){e.currentAction("dup");var a=e.duplicateSection(t,C,l);u.sync(t,"Sec_Duplicate",a.Tag),e.saveLayout()},bgColor:function(a){m(a),u.sync(t,"Sec_BgColor",a),e.saveLayout()},bgUrl:function(a){g(a),u.sync(t,"Sec_BgURL",a),e.saveLayout()},resetBg:function(){v(),u.sync(t,"Sec_BgReset",""),e.saveLayout()}});return C.prepend(w.$node),C};return{createSection:function(e){var t,a=e||{},n=C(a);return v.append(n),d&&(t=w(a,n),g.append(t)),[t,n]},init:function(){$.each(l.Data.Sections,function(a,n){if(!(1==t.IsMod&&n.ModIds.length<=0)){var i,s,l,u;for(u=C(n),v.append(u),d&&(l=w(n,u),g.append(l),l=l.find(".section-content")),u=u.find(".section-content"),a=0;a<n.ModIds.length;a++){var m=e.getModule(n.ModIds[a]);m&&m.Tag&&(s=o.obtain(c,"Tag",m.Tag),s&&(i=r[s.Type],i.initModule(s,1,u,l)))}e.addModule("EmptyModule")}})}}},app.managers.dragManager=function(e,t,a,n,o,i){var s,r,l=null,c=null,d=0,u=0,m=0,f=$("<div>"),p=$('<div style="background-color: gray;position: absolute; z-index: 9999999;">'),h=$('<div style="background-color: red;position: absolute; z-index: 99999;">'),g=$('<div style="position: absolute; height: 100%; z-index: 9999; left: 0; top: 0; width: 100%;">').hide(),v=$('<div style="position: absolute; z-index: 9990; left: 50%; top: 0; width: 1200px; margin-left: -600px;">'),b=$("#modules-edit-main").append(v).append(p).append(h),y=$("#modules-preview-main"),C=$('<div style="display: inline-block; background-color: #F5F6F7; border: 1px dotted #4a7aa2; margin: 12px 0;">&nbsp;</div>');t.append(g);var T=function(){var e,t,a,o,s,r;l&&(l.detach&&l.detach(),c&&"Canvas"!=l.Type?(c.dragEnd(l),r=l):(o=l.$editNode,s=l.$previewNode),l.$editNode.removeClass("active default-drag-bg-color").css({position:"",opacity:"",left:"",top:"","z-index":""}),o&&(t=C.closest(".edit-div").index(),f.append(s),C.before(o),e=o.index(),a=y.find('.preview-div:eq("'+t+'")'),a.find(".section-content").insertAt(e,s)),n.sync(l,"Pos",[e,t]),$("body").removeClass("disable-select"),i.saveLayout(),l=null,c=null,g.hide(),C.remove(),$(".empty").remove(),r&&r.resize&&r.resize())},w=function(e,t,a,n){var o=0;b.width()>1200&&(o=(b.width()-1200)/2),e.css({left:t.pageX-s-o,top:t.pageY-b.offset().top-r+14})};return e.on("touchmove mousemove",function(e){if(l){var t=Date.now();if(t-d<30)return;var a,n,s,r,f=e.pageX,p=e.pageY;d=t;var h=$(window).scrollTop();if(e.screenY>m+6&&e.clientY>window.innerHeight-140?($("html,body").animate({scrollTop:h+140},200),m=e.screenY):e.screenY<m-6&&e.clientY<140&&($("html,body").animate({scrollTop:h-140},200),m=e.screenY),w(l.$editNode,e),t-u<300)return;u=t,b.find(".edit-div").each(function(){if(n=$(this),a=n.offset(),a.bottom=a.top+n.height(),p>=a.top&&p<=a.bottom)return s=n.find("> .section-content > .module-container"),s.each(function(){if(r=$(this),a=r.offset(),a.right=a.left+r.width(),a.bottom=a.top+r.height(),f<a.right&&p<a.bottom)return l&&"Canvas"==l.Type||!o.isPointInRect(a,{x:f,y:p})||!r.hasClass("canvas-module-container")?(f<a.right-r.width()/3&&p<a.bottom-r.height()/2?r.before(C):r.after(C),c=null,!1):(c=i.getModule(r.data("key")),c.editObj.move(e),C.remove(),!1)}),s.filter(".canvas-module-container").each(function(){r=$(this);var e=i.getModule(r.data("key"));e!=c&&e.editObj.cancel()}),!1})}}),{end:T,add:function(e){var t=e.$editNode.find(".move");t.on("mousedown",function(t){var a=$(this).offset();s=t.pageX-a.left,r=t.pageY-a.top,$("body").addClass("disable-select");var n=e.$editNode;n.addClass("active").css({position:"absolute",opacity:.6,"z-index":100}),e.Data.BgColor&&n.addClass("default-drag-bg-color"),l=e;var o=2*parseInt(C.css("border-width").replace("px"))+2;return C.css({height:n.height()-o,width:n.width()-o}),n.after(C),v.append(n),w(n,t),g.show(),!1})},move:function(e,t){if(null!==t[0]){var a,n,o,i,s,r;i=e.$editNode,s=e.$previewNode,i&&(a=t[0],n=t[1],f.append(s).append(i),o=y.find('.preview-div:eq("'+n+'")'),o.find(".section-content").insertAt(a,s),r=b.find('.edit-div:eq("'+n+'")'),r.find(".section-content").insertAt(a,i))}},remove:function(e){}}},app.managers.resizeManager=function(e,t){var a=null,n=null,o=!1,i=0,s="#modules-edit-main .grid-div",r=function(){null!==a&&(t.sync(a,"Cols",a.Data.Cols),a.$editNode.removeClass("re-sizing"),a=null,n=null,$("body").removeClass("disable-select re-sizing"))};return $(s).on("mouseenter","div",function(){if(null===a)r();else{var e=2,t=0,n=a,l=n.$editNode.position().left-n.$editNode.closest(".section-content").offset().left;l>0&&(t=Math.ceil(l/($(s).width()/(12/e))));var c=$(this).index()-t;if(c*=e,c!=i){var d=c-i;n.$editNode.removeClass("col-sm-"+n.Data.Cols),n.$previewNode.removeClass("col-sm-"+n.Data.Cols),o?(n.Data.Cols=Math.max(e,Math.min(12,n.Data.Cols-d)),i=c):c+e>0&&(n.Data.Cols=Math.max(e,Math.min(12,c+e)),i=c),n.$editNode.addClass("col-sm-"+n.Data.Cols),n.$previewNode.addClass("col-sm-"+n.Data.Cols),n.resize&&n.resize(n)}}}),{end:r,add:function(e){var t=$('<div class="resize-grip right"><div class="resize-rect"></div></div>');e.$editNode.prepend(t),t.on("mousedown touchstart",function(t){t.preventDefault(),i=e.Data.Cols-1,a=e,$("body").addClass("disable-select re-sizing"),a.$editNode.addClass("re-sizing"),o=!1}),t=$('<div class="resize-grip left"><div class="resize-rect"></div></div>'),e.$editNode.prepend(t),t.on("mousedown touchstart",function(t){t.preventDefault(),i=0,a=e,$("body").addClass("disable-select re-sizing"),a.$editNode.addClass("re-sizing"),o=!0})},remove:function(e){e.$editNode.find(".resize-grip").remove()}}},app.managers.main=function(e,t,a,n,o){var i,s,r=this;return i=r.getModManager(e,t,a,n,o),s=r.getRddm(e,t,a,i),{modManager:i,rddm:s}},app.managers.getModManager=function(e,t,a,n,o){function i(e){Date.now()-1e3<=f||v.createLayoutData(t,b,function(e){x.Data.Sections=e,f=Date.now(),x.save()})}function s(){var e=t;$.each(e.Collaborators,function(t,a){C.changeCollaborator({data:{verb:"drop",role:a.Privilege,token:e.Token,email:a.Email},success:function(e){console.log(e.Message),window.location="/"},error:function(e){5==e.StatusCode&&o.error(e.Message)}})})}function r(){return Math.max.apply(null,g)}function l(){C.getTagStore({success:function(e){"Success"==e.Status&&(g=e.Data.TagStore)}})}function c(e){e=parseInt(e)||r();var a=e+1,n=a<r()||b.obtain(t.Modules,"Tag",a)||b.obtain(x.Data.Sections,"Tag",a);return n?c(a):(clearTimeout(p),p=setTimeout(l,1e4),g.push(a),parseInt(a))}function d(e,a,n,o,i,s){var r,l,c=h[e];r=a?$.extend(a,{Key:b.uniqueId()}):{Key:b.uniqueId(),Type:e,Data:{Type:e}},s&&(r.ID=s.ID,r.Tag=s.Tag),t.Modules.push(r);var d="Scale"==e||"Bar"==e||"DonutChart"==e||"DataCollection"==e,u="Scale"==e||"Bar"==e||"DonutChart"==e||"DataCollection"==e;return d&&(r.Data.Head=1),u&&(r.Data.Titlehide=1),"Scale"==e&&(r.Data.Header="Scale Chart"),"Bar"==e&&(r.Data.Header="Bar Graph"),"DonutChart"==e&&(r.Data.Header="Pie Chart"),"DataCollection"==e&&(r.Data.Header="This is a form field to collect emails."),o||($("#modules-preview-main .preview-div:last-child").find(".section-content").length||m.createSection(),o=$("#edit-sections .edit-div:last-child").find(".section-content"),i=$("#modules-preview-main .preview-div:last-child").find(".section-content")),c.initModule(r,a,i,o,l,u),n&&r.bringInView(),r}function u(e,t){y.sync({Tag:t||e.$editNode.closest(".edit-div").data("Tag")},"Sec_AddModule",{Syncd:!0,Tag:e.Tag,Type:e.Type,Data:e.Data})}var m,f,p,h={},g=t.TagStore,v=app.modHelper,b=a.utility,y=a.appHub,C=a.apiHelper,T=a.eventManager,w=a.pageManager,x=b.obtain(t.Modules,"Type","DataModule"),k=v.getGuiModules(t,b);return T.addListener("removeCollabs",s),m={getNewTag:c,removeMod:function(e){return b.removeFromList(t.Modules,b.obtain(t.Modules,"Tag",e.Tag))},currentAction:function(){var e,t=Date.now();return function(a){return a&&(e=a,t=Date.now()),e&&Date.now()-t<=3e3?e:""}}(),getModule:function(e){return b.obtain(t.Modules,"Tag",e,"Key","ID")},getFactory:function(e){return h[e.Type]},registerFactory:function(e){if(!e.type||h[e.type])throw console.log(e),{name:e.type+" is invalid."};h[e.type]=e},addModule:function(e,a,n,o,s,r){if("Canvas"==e&&a&&a.Data.Mods){$.each(a.Data.Mods,function(e,n){var o=c(),i={Key:o,Tag:o,Type:n.Type,Data:$.extend(!0,{},n.Data)};n.Tag=o,i.Syncd=a.Syncd,t.Modules.push(i)});var l=a.Tag;g.indexOf(l)<0?g.push(l):l=c(),a.Tag=l}var m=d(e,a,"EmptyModule"!=e&&void 0==n?1:n,o,s,r);return"EmptyModule"!=e&&(m.Syncd||m.CanvasMod?m.Tag=m.Tag:(m.Tag=l||c(),g.indexOf(m.Tag)<0&&g.push(m.Tag),m.factory.renderPreview(m),u(m)),m.factory.renderPreview(m),m.save(i)),m},copyModule:function(e,a){var n=(h[e.Type],$.extend(!0,{},e.Data)),o=c(e.Tag),s={Key:o,Tag:o,Type:e.Type,Data:n};return t.Modules.push(s),"Canvas"==e.Type&&$.each(n.Mods,function(e,a){var n=c(a.Tag),o=m.getModule(a.Tag);if(o){var i={Key:n,Tag:n,Type:o.Type,Data:$.extend(!0,{},o.Data)};a.Tag=n,t.Modules.push(i),y.saveMod(i)}}),a&&a(s),y.saveMod(s,i),s},duplicateModule:function(e){console.log("dubplicate",e);var t=h[e.Type],a=e.$editNode.closest(".section-content"),n=e.$previewNode.closest(".section-content"),o=m.copyModule(e,function(i){var s=o||i;t.initModule(s,0,n,a,e),t.renderPreview(s),"dup"==m.currentAction()&&s.bringInView()});return o},getExport:function(){return x.Data.Exports||(x.Data.Exports={}),x.Data.Exports},getDonutData:function(){return x.Data.Donut||(x.Data.Donut={showError:!0}),x.Data.Donut},saveData:function(e){x.save()},saveLayout:i,activatePreview:function(t){if(t&&t.modId){var a=m.getModule(t.modId);a.factory.renderPreview(a)}else $.each(x.Data.Sections,function(t,a){$.each(a.ModIds,function(t,a){var n=m.getModule(a);n&&"Videos"==n.Type?e.editMode||n.factory.renderPreview(n):n.factory.renderPreview(n)})})},duplicateSection:function(e,a,n){e=$.extend(!0,{},e),e.Tag=e.newTag,delete e.newTag;var o=m.createSection(e),i=o[0].find(".section-content"),s=o[1].find(".section-content");return m.addModule("EmptyModule"),a.find(".section-content > .module-container").each(function(e,a){var n,o,r=b.obtain(t.Modules,"Key",$(a).data("key"));r&&"EmptyModule"!=r.Type&&(o=h[r.Type],n=m.copyModule(r),o.initModule(n,0,s,i))}),a.after(o[0]),n.after(o[1]),"dup"==m.currentAction()&&$("html,body").animate({scrollTop:i.offset().top},400),e}},x.save=function(e){y.saveMod(x,e)},m=$.extend(m,v.sectionHelper(m,e,t,n,b,w,o,h,x,k,e.editMode,y,C))},app.managers.getRddm=function(e,t,a,n){var o=a.appHub,i=a.utility,s={},r=$(document),l=$("body"),c=app.managers.resizeManager(r,o),d=app.managers.dragManager(r,l,s,o,i,n);return r.on("touchend mouseup touchcancel mouseleave",function(){c.end(),d.end()}),{addModule:function(e){s[e.Key]=e,e.noResize||c.add(e),e.noDrag||(d.add(e),o.reg(e,"Pos",function(t,a){d.move(e,a)}))},removeModule:function(e){c.remove(e),d.remove(e),delete s[e.Key]},dragManager:d}},app.factory.bgColor=function(e,t,a){e.$editNode&&e.$editNode.css("backgroundImage",""),e.$previewNode.css("backgroundImage",""),delete e.Data.BgUrl,e.$editNode&&e.$editNode.css("backgroundColor",t),e.$previewNode.css("backgroundColor",t),e.Data.BgColor=t,a||this.appHub.sync(e,"BgColor",t)},app.factory.bgUrl=function(e,t,a){var n=this;e.$editNode&&n.utility.changeBg(n.popup,e.$editNode,t),e.$previewNode.css("backgroundImage","url("+t+")"),n.changeImage(e.Data.BgUrl,t),delete e.Data.BgColor,e.Data.BgUrl=t,a||n.appHub.sync(e,"BgUrl",t)},app.factory.resetBg=function(e,t){var a=this;delete e.Data.BgColor,delete e.Data.BgUrl,"Canvas"==e.Type?(e.$editNode&&e.$editNode.css("backgroundColor","rgba(0,0,0,0)"),e.$previewNode.css("backgroundColor","rgba(0,0,0,0)"),e.Data.BgColor="rgba(0,0,0,0)"):(e.$editNode&&e.$editNode.css("backgroundColor",""),e.$previewNode.css("backgroundColor","")),e.$editNode&&e.$editNode.css("backgroundImage",""),e.$previewNode.css("backgroundImage",""),t||a.appHub.sync(e,"ResetBg","")},app.factory.createStyle=function(e,t,a,n){var o="",i="#ed-"+e+" ",s=",#pr-"+e+" ",r=n||["h1","h2","h3","h4",".title > *:not(.fr-wrapper):first-child",".title .fr-view > *:first-child"],l="<style id=style"+e+' type="text/css" class="module-style">';t&&($.each(r,function(e,t){o+=i+t,o+=s+t+","}),o=o.slice(0,-1),o+="{ color: "+t+";}"),o+=i+s+"{ border-color:"+t+";border-style:solid;border-width:0;}",$.each(a,function(e,t){$.each(t.selectors,function(e,t){o+=i+t,o+=s+t+","}),o=o.slice(0,-1),o+="{"+t.prop+":"+t.value+";}"}),l+=o+"</style>",$("head #style"+e).remove(),$("#folio-style").before(l);var c,d=$("#folio-style").text().split("}"),u=d.length,m="<style id=stylefs"+e+' type="text/css" class="module-style">';for(c=0;c<u;c++)if(d[c].length){d[c]=$.trim(d[c])+"}";var f="#ed-"+e+d[c].replace(/,(\s)*./g,",#ed-"+e+"."),p="#ed-"+e+" "+d[c].replace(/,(\s)*./g,",#ed-"+e+"."),h="#pr-"+e+d[c].replace(/,(\s)*./g,",#pr-"+e+"."),g="#pr-"+e+" "+d[c].replace(/,(\s)*./g,",#pr-"+e+".");m+=f+p+h+g}m+="</style>",$("head #stylefs"+e).remove(),$("#folio-style").before(m)},app.factory.createDOMNodes=function(e,t,a,n){var o,i,s='<div class="header-container"><div class="header fr-view"></div></div>',r=e.Data,l=this,c=e.previewObj,d=e.editObj,u=e.Data.Theme||"#4C7BA0",m="module-container col-xs-12 col-sm-"+r.Cols+" "+(r.CssClass||r.FormatClass||"");e.containerClassName&&(m+=" "+e.containerClassName),o=e.$previewNode=$('<div id="pr-'+e.Key+'"></div>'),o.addClass(m),r.BgColor&&o.css("backgroundColor",r.BgColor),r.BgUrl&&o.css("backgroundImage","url("+r.BgUrl+")"),n?o.insertAfter(n.$previewNode):t&&t.append(o),o.append(c.$node),"EmptyModule"!=e.Type&&c.$node.prepend(s),c.mount&&c.mount(),l.config.editMode&&(i=e.$editNode=$('<div data-key="'+e.Key+'" id="ed-'+e.Key+'"></div>'),i.append('<div class="others"></div>'),i.css({borderWidth:1==r.Border?"1px":"0"}),i.addClass(m),r.BgColor&&i.css("backgroundColor",r.BgColor),r.BgUrl&&(i.css("backgroundImage","url("+r.BgUrl+")"),l.changeImage("",r.BgUrl)),n?i.insertAfter(n.$editNode):a&&a.append(i),"EmptyModule"!=e.Type&&d.$node.prepend(s),i.append(l.menu.modButtons(l,e,d).$node),i.append(d.$node),d.$node.find("> .header-container").css({display:1==r.Head?"":"none"}).find(".header").editor(e,r,"Header",{allowEnter:!0,cleanPTags:!0}),l.rddm.addModule(e),d.mount&&d.mount(),e.Data.Titlehide&&e.$editNode.addClass("remove-title")),e.Data.Titlehide&&e.$previewNode.addClass("remove-title"),e.applyStyle&&(e.applyStyle(u),e.editObj&&e.editObj.applyStyle&&e.editObj.applyStyle(u))},app.factory.handleExport=function(e,t){var a=this;e.$editNode.addClass("keep-open");var n,o="",i="modules-preview-main",s=$("#home-page");e.Data.Exports||(e.Data.Exports={}),a.popup.exp(a.folio,e.Data.Exports,{$el:e.$previewNode,isMod:!0,target:"module",cb:function(t,r){o="",n=a.pageManager.isCurrent(a.pageManager.pages.home),n||a.pageManager.showPage(a.pageManager.pages.home),s.css("width",t+"px"),setTimeout(function(){a.modManager.activatePreview();var t=$('<div><div class="container-fluid"><div class="row" id="'+i+'"><div class="preview-div clearfix"><div class="section-content clearfix">'+$("<div>").append(e.$previewNode.clone()).html()+"</div></div></div></div></div>");$("head").find(".module-style, #folio-style").each(function(e,t){o+="<style>"+t.innerHTML+"</style>"}),o+=t.html(),o+=$("#tmp-power-by-footer").get(0).outerHTML,r(o),s.css("width",""),n?a.modManager.activatePreview():a.pageManager.showPage(a.pageManager.pages.edit),e.save(),e.$editNode.removeClass("keep-open")},200)}})},app.factory.fixData=function(e){var t=this;$.each(e,function(e,a){$.each(a,function(e,n){"Items"==e?t.fixData(n):a[e]=t.$div.html(n).html()})})},app.factory.initModule=function(e,t,a,n,o,i){var s=this,r=e.Data;t&&$.each(r,function(e,t){t&&("Items"==e?s.fixData(t):r[e]=s.decoder&&s.decoder(s.$div,e,t)||t)}),e.factory=s,r.Cols=r.Cols||s.cols,e.save=function(t){s.appHub.saveMod(e,t)},s.setupModule&&s.setupModule(e),e.previewObj=s.getPreview(e),s.config.editMode&&(e.editObj=s.getEdit(e),e.listEditors=function(){var t,a=s.config.currentlyEditing,n=e.$editNode.find(".others");n.empty();for(var o in a)if(t=a[o],t.active&&t.module.Tag==e.Tag){$('.module-container .user[data-email="'+o+'"]').remove();var i=$('<span class="user" data-email="'+o+'" data-tip="'+t.name+'">'+app.core.utility().getInitials(t.name)+"</span>");n.append(i)}}),s.createDOMNodes(e,a,n,o),s.modules[e.Key]=e,e.showSpinner=function(){e.$editNode.prepend($("#spinner-container > .loading-animation").clone())},e.hideSpinner=function(){e.$editNode.find(".loading-animation").remove()},e.bringInView=function(){var t=$("#ed-"+e.Key),a=$("#pr-"+e.Key),n=t.length>0?t:a,o=n.offset();n.addClass("active"),o&&$("html,body").animate({scrollTop:o.top-100},600,function(){setTimeout(function(){n.removeClass("active")},2e3)})}},app.factory.main=function(e,t,a,n,o,i,s){var r=this;r.config=e,r.folio=t,r.$div=$("<div>"),r.$store=$("<div>"),r.$modItemsDiv=$("#module-items"),r.apiHelper=a.apiHelper,r.appHub=a.appHub,r.eventManager=a.eventManager,r.pageManager=a.pageManager,r.store=a.store,r.utility=a.utility,r.modStore=a.modStore,r.menu=n,r.modManager=i,r.popup=o,r.rddm=s,r.changeImage=n.changeImage,r.editBase=app.mods.getEditBase(e,a.appHub,a.eventManager),r.renderPreview=function(e){var t=e.Data,a=t.Theme||"#4C7BA0";e.$previewNode.css({border:1==t.Border?"1px solid "+a:""}),e.$previewNode.find("> .module .header-container").css({display:1==t.Head?"":"none"}).find(".header").html(t.Header),e.renderPreview()};var l=function(e){var t=$.extend({},r,{modules:{},type:e.type,options:e,cols:e.cols||12});return i.registerFactory(t),t},c=app.mods;c.dataCollectionFactory(l),c.textFactory(l),c.donutFactory(e,l),c.canvasFactory(l),c.rowBreakFactory(l),c.plainHtmlFactory(l),c.emptyModuleFactory(l),c.imagesFactory(l),c.videosFactory(l,i,o),c.barFactory(l),c.scaleFactory(l),c.tagFactory(l),c.socialFactory(l),i.init()},app.factory.shareModule=function(e,t){var a=this;a.popup.shareLink(e,[t.ID],t.Type)},app.factory.removeModule=function(e,t,a){var n=this,o=function(){if(n.rddm.removeModule(e),n.menu.detach(),e.$editNode.remove(),e.$previewNode.remove(),n.modManager.removeMod(e),e.noDelete||n.apiHelper.deleteModule(e),"Canvas"==e.Type){var t=[];$.each(e.Data.Mods,function(e,a){var o=n.modManager.getModule(a.Tag);o&&(t.push(o.ID),n.modManager.removeMod(o))}),n.apiHelper.deleteModules(t)}delete n.modules[e.Key],n.modManager.saveLayout(),a&&a()};if(t)o();else{var i="Canvas"==e.Type?"canvas":"module";n.popup.message({heading:"Delete "+i+"?",message:"You won't be able to undo this action.",btnText:"Yes, Delete This",cancelText:"Cancel",handleOK:o})}},app.mods.barFactory=function(e){var t={type:"Bar",cols:4},a=e(t);a.decoder=function(e,t,a){return a},a.setupModule=function(e){var t=e.Data;t.Head=t.Head||2,t.Txt=t.Txt||1,t.Title=t.Title||"<p>Bar Graph</p>",t.Items=t.Items||[{Name:"<p>Bar 1</p>",Val:50},{Name:"<p>Bar 2</p>",Val:75},{Name:"<p>Bar 3</p>",Val:25}],e.applyStyle=function(t){a.createStyle(e.Key,t,[{prop:"background-color",value:t,selectors:[".slider-bar"]},{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.barPreview(a),a.config.editMode&&(a.getEdit=app.mods.barEdit(a,app.mods.sliderBaseFunc(a.appHub,"width")))},app.mods.canvasFactory=function(e){function t(e,a){var i=e.Data,s=1,r=[];$.each(i.Mods,function(a,i){var l=n.modManager.getModule(i.Tag);return l.Tag?(r.indexOf(l.Tag)<0&&r.push(l.Tag),i.Tag=l.Tag,void l.save()):(clearTimeout(o),o=setTimeout(function(){t(e)},1e3),s=0,!1)}),s&&r.length==i.Mods.length&&n.appHub.saveMod(e,function(){a&&a(),e.saved&&e.saved()})}var a={type:"Canvas",cols:12},n=e(a),o=(n.utility,Date.now(),null);n.decoder=function(e,t,a){return a},n.include=function(e,a,o){var i=e.Data;o||(e.editObj.saveMods(),t(e)),a.detach=function(){a.Data.Theme=i.Theme,a.editObj.applyStyle&&(a.editObj.applyStyle(i.Theme),n.appHub.sync(a,"Theme",i.Theme));var t=n.utility.obtain(i.Mods,"Tag",a.Tag||a.Key);t&&(n.utility.removeFromList(i.Mods,t),a.detach=null,a.clone=null,n.appHub.sync(e,"Mods",i.Mods))},a.clone=function(){e.editObj.clone(a)}},n.setupModule=function(e){function a(a){e.editObj.saveMods(),t(e,a)}var o=e.Data;e.noResize=!0,e.containerClassName="canvas-module-container",o.Header=o.Header||"Title",o.Theme=o.Theme||"#4C7BA0",o.BgColor=o.BgColor||"#FFF",o.Mods=o.Mods||[],o.Arr=o.Arr||[4,4,4],o.Head=o.Head||2,o.Border=o.Border||2;var i=function(t){t.Sync=!e.New,n.modManager.addModule(t.Type,t,!1)};$.each(o.Mods,function(t,a){var o=n.modManager.getModule(a.Tag);if(o){var s=n.modManager.getFactory(o);s&&(s.initModule(o,1),n.include(e,o,!0))}else a.Module&&i(a.Module)}),e.save=a,e.applyStyle=function(t){n.createStyle(e.Key,t,[{prop:"background-color",value:t,selectors:[".canvas-module > .header-container"]},{prop:"background-color",value:t,selectors:[".canvas-module  .quote"]},{prop:"margin",value:"0 auto",selectors:[""]}],[".nope"])},n.editBase(e,{})},n.getPreview=app.mods.canvasPreview(n),n.config.editMode&&(n.getEdit=app.mods.canvasEdit(n))},app.mods.dataCollectionFactory=function(e){var t={type:"DataCollection",cols:12},a=e(t);a.decoder=function(e,t,a){return"ButtonText"==t?e.html(a).text():a},a.setupModule=function(e){e.Data.ButtonText=e.Data.ButtonText||"Join Us!",e.Data.Message=e.Data.Message||"<h3>Give them a good reason.</h3>",e.applyStyle=function(t){a.createStyle(e.Key,0,[{prop:"background-color",value:t,selectors:[".module-info-inner",".dc-join-us"]},{prop:"background-color",value:d3.rgb(t).darker(.2).toString(),selectors:[".module-info-inner:hover",".dc-join-us:hover"]},{prop:"color",value:t,selectors:[".header"]}])}},a.getPreview=app.mods.dataCollectionPreview(a),a.config.editMode&&(a.getEdit=app.mods.dataCollectionEdit(a))},app.mods.donutFactory=function(e,t){var a={type:"DonutChart",cols:8},n=$("<div>"),o=t(a);o.createColorFunc=function(e,t){var a=d3.rgb(t).brighter(3.7).toString();if(a.length<7)for(var n=7-a.length,o=0;o<n;o++)a=a.replace("#","#0");var i={colorStart:t,colorEnd:a},s=d3.interpolateRgb(i.colorStart,i.colorEnd);return function(t){var a=t/e;return s(a)}},o.decoder=function(e,t,a){return a};var i=app.mods.donutBaseFunc(e,o);o.setupModule=function(e){var t,a=e.Data;if(e.breakup=[],a.Title=a.Title||"<p>Pie Chart</p>",a.Label=a.Label||"<h2>Click to edit label</h2>",a.Theme=a.Theme||"",!a.Items)for(a.Items=[],t=1;t<=5;t++)a.Items.push({Val:"<p>20% &nbsp;Segment "+t+"</p>"});$.each(a.Items,function(t,a){var o=parseInt(n.html($.trim(a.Val)).text());isNaN(o)||e.breakup.push(o)}),e.applyStyle=function(t){e.colorFunc=o.createColorFunc(a.Items.length,t),o.createStyle(e.Key,t,[{prop:"color",value:t,selectors:[".header",".donut-label"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},o.getPreview=app.mods.donutPreview(o,i),o.config.editMode&&(o.getEdit=app.mods.donutEdit(o,i))},app.mods.emptyModuleFactory=function(e){var t={type:"EmptyModule",cols:12},a=e(t);a.setupModule=function(e){e.noResize=!0,e.noDrag=!0,e.Data.Cols=12,e.containerClassName="empty-module-container"},a.getPreview=function(e){return e.renderPreview=function(){},{$node:$('<div class="module empty-module"></div>')}},a.config.editMode&&(a.getEdit=function(e){var t=$('<button class="btn add-btn blue-btn">+ Add</button>');return t.on("click",function(){t.closest(".edit-div").find(".add-mod-btn").trigger("click")}),{$node:$('<div class="module empty-module"><p>No modules added yet.</p></div>').append(t)}})},app.mods.imagesFactory=function(e){var t={type:"Images",cols:2},a=e(t),n="/img/fakecrow-logo-lgrey.png";a.defImg=n,a.decoder=function(e,t,a){return a},a.setupModule=function(e){var t=e.Data;t.Align=t.Align||"left",t.Html=t.Html||"Images",t.Items=t.Items||[{Url:n,Val:100}],t.Head=t.Head||2,t.Txt=t.Txt||2,e.applyStyle=function(t){a.createStyle(e.Key,t,[{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.imagesPreview(a),a.config.editMode&&(a.getEdit=app.mods.imagesEdit(a))},app.mods.plainHtmlFactory=function(e){var t=$("#tmp-edit-plainhtml").html(),a=$("#tmp-prev-plainhtml").html(),n={type:"PlainHtml",cols:6},o=e(n);o.setupModule=function(e){e.Data.Html=e.Data.Html||"<p>Write your HTML and style it anyway you want!</p><p>You can also use Twitter Bootstrap classes to style your HTML!</p>"},o.getPreview=function(e){var t=$(a),n=t.find(".content-box");return e.renderPreview=function(){n.html(e.Data.Html)},{$node:t}},o.config.editMode&&(o.getEdit=function(e){var a=$(t),n=a.find(".text-area"),o="normal",i=Date.now(),s=a.find(".edit-btn");return n.val(e.Data.Html),n.on("keydown",function(){var t=Date.now();t-i>8e3&&(e.Data.Html=n.val(),e.save(),i=t)}),n.on("blur",function(){e.Data.Html=$(this).val(),o="normal",a.removeClass("edit").addClass("normal"),e.save()}),s.on("click",function(){o="edit",a.removeClass("normal").addClass("edit"),n.focus()}),{$node:a}})},app.mods.rowBreakFactory=function(e){var t=$("#tmp-edit-row-break").html(),a=$("#tmp-prev-row-break").html(),n={type:"RowBreak",cols:12},o=e(n);o.setupModule=function(e){e.noResize=!0,e.Data.Cols=12,e.containerClassName="row-break-module"},o.getPreview=function(e){return e.renderPreview=function(){},{$node:$(a)}},o.config.editMode&&(o.getEdit=function(e){var a=$(t);return o.editBase(e,{}),{$node:a}})},app.mods.scaleFactory=function(e){var t={type:"Scale",cols:4},a=e(t);a.decoder=function(e,t,a){return a},a.setupModule=function(e){var t=e.Data;t.Head=t.Head||2,t.Txt=t.Txt||1,t.Title=t.Title||"<p>Scale Chart</p>",t.Items=t.Items||[{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:30},{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:70},{Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:50}],e.applyStyle=function(t){a.createStyle(e.Key,t,[{prop:"background-color",value:t,selectors:[".slider-bar"]},{prop:"color",value:t,selectors:[".header-container .header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.scalePreview(a),a.config.editMode&&(a.getEdit=app.mods.scaleEdit(a,app.mods.sliderBaseFunc(a.appHub,"left")))},app.mods.socialFactory=function(e){var t={type:"Social",cols:4},a=e(t);a.decoder=function(e,t,a){return a},a.setupModule=function(e){var t=e.Data;t.Align=t.Align||"center",e.applyStyle=function(t){a.createStyle(e.Key,t,[{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.socialPreview(a),a.config.editMode&&(a.getEdit=app.mods.socialEdit(a))},app.mods.tagFactory=function(e){var t={type:"Tag",cols:4},a=e(t);a.decoder=function(e,t,a){return a},a.setupModule=function(e){var t=e.Data;t.Align=t.Align||"left",t.Items=t.Items||[{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"},{Name:"<p>Tag</p>"}],e.applyStyle=function(t){a.createStyle(e.Key,t,[{prop:"background-color",value:t,selectors:[".tag-inner"]},{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},a.getPreview=app.mods.tagPreview(a),a.config.editMode&&(a.getEdit=app.mods.tagEdit(a))},app.mods.textFactory=function(e){var t=$("#tmp-edit-text").html(),a=$("#tmp-prev-text").html(),n={
type:"Text",cols:4},o=e(n);o.setupModule=function(e){var t=e.Data;t.Align=t.Align||"left",t.Theme=t.Theme||"#052b3e",t.Html=t.Html||"<h2>Text Module</h2><h4>Point. Click. Type.</h4><p>This is a pretty straightforward text editor. You can even place images, videos, tables, and links.</p>",e.applyStyle=function(t){o.createStyle(e.Key,t,[{prop:"color",value:t,selectors:[".header",".text-module .name","h2 + ol","h2 + ul",".text-module .fr-view > ul",".text-module .fr-view > ol"]},{prop:"margin",value:"0 auto",selectors:[""]}])}},o.getPreview=function(e){var t=e.Data,n=$(a),o=n.find(".text-content");return e.renderPreview=function(){o.html(t.Html).css("text-align",t.Align)},{$node:n}},o.config.editMode&&(o.getEdit=function(e){var a=e.Data,n=$(t).css("text-align",a.Align),i=n.find(".editor");return o.editBase(e,{}),i.editor(e,a,"Html",{allowEnter:!0}),{changeTheme:function(){i.unstyle()},align:function(){n.css("text-align",a.Align)},$node:n}})},app.mods.videosFactory=function(e,t,a){var n={type:"Videos",cols:4},o=e(n),i="/img/fakecrow-logo-lgrey.png";o.defImg=i,o.decoder=function(e,t,a){return a},o.setupModule=function(e){var t=e.Data;t.Align=t.Align||"left",t.Html=t.Html||"Videos",t.Items=t.Items||[{Url:i,Val:100}],t.Head=t.Head||2,t.Txt=t.Txt||2,t.VideoUrl=t.VideoUrl||"",t.VideoUrl,e.applyStyle=function(t){o.createStyle(e.Key,t,[{prop:"color",value:t,selectors:[".header"]},{prop:"margin",value:"0 auto",selectors:[""]}])}};var s=function(e){for(var t,a=$.FE.VIDEO_PROVIDERS,n=0;n<a.length;n++)if(a[n].test_regex.lastIndex=0,a[n].test_regex.test(e)){var o=a[n].url_text;a[n].url_regex.lastIndex=0;var i=a[n].url_regex.exec(e)[1];o=o.replace("$1",i),t=a[n].html.replace("{url}",o)}return t};o.getPreview=app.mods.videosPreview(o,s),o.config.editMode&&(o.getEdit=app.mods.videosEdit(o,s,t,a))},app.mods.donutBaseFunc=function(e,t){return{pie:app.charts.pie(),mount:function(){var e=this;t.eventManager.addListener("resize",function(){e.drawPie()})},updateLabel:function(){var e=this,t=e.$pieDiv.height()/2||e.getVal(e.$pieDiv,0)/2;if(t){var a=e.$pieDiv.closest(".donut-module").find(".donut-label");a.css("font-size",Math.max(12,t/2)+"%"),e.stack||(t=Math.max(t,e.$breakup.height()/2)),a.css({top:t-a.height()/2})}},drawChart:function(e){e.pie.draw({$el:e.$pieDiv,items:e.module.breakup,colorFunc:e.module.colorFunc}),e.updateLabel()},getVal:function(e,t){var a,n=e.height();return e.parents(".module-container").hasClass("col-sm-2")?(n=n||170,a=!0):e.parents(".module-container").hasClass("col-sm-4")?(n=n||170,a=!1):e.parents(".module-container").hasClass("col-sm-6")?(n=n||270,a=!1):e.parents(".module-container").hasClass("col-sm-8")?(n=n||370,a=!1):e.parents(".module-container").hasClass("col-sm-10")?(n=n||390,a=!1):e.parents(".module-container").hasClass("col-sm-12")&&(n=n||390,a=!1),0==t?n:1==t?a:2==t?n:void 0},drawPie:function(){var e,a,n=this,o=n.$pieDiv.parent(),i=n.$breakup.parent(),s=n.parentPage==t.pageManager.pages.edit?".edit-content":".module";if(n.stack=n.$pieDiv.closest(s).width()<400,e=n.$pieDiv.height(),a=n.$breakup.height(),a=a||200,n.stack=n.$pieDiv.closest(s).width()<400,n.$pieDiv.parents(".module-container").hasClass("col-sm-2")?(e=e||170,n.stack=!0):n.$pieDiv.parents(".module-container").hasClass("col-sm-4")?(e=e||170,n.stack=!1):n.$pieDiv.parents(".module-container").hasClass("col-sm-6")?(e=e||270,n.stack=!1):n.$pieDiv.parents(".module-container").hasClass("col-sm-8")?(e=e||370,n.stack=!1):n.$pieDiv.parents(".module-container").hasClass("col-sm-10")?(e=e||390,n.stack=!1):n.$pieDiv.parents(".module-container").hasClass("col-sm-12")&&(e=e||390,n.stack=!1),0!=n.$pieDiv.width(),n.stack)o.add(i).css({width:"100%","max-width":"100%"}),i.css({"padding-left":"10px"}),n.$pieDiv.add(n.$breakup).css("margin-top",""),n.drawChart(n);else{o.add(i).css({width:"","max-width":"","padding-left":""}),n.drawChart(n);var r=e/2,l=0,c=n.$pieDiv.closest(".donut-module").find(".donut-label");if(r){n.stack||(r=Math.max(r,a/2));var d=n.$breakup.find(".breakup-row").length,u=n.$breakup.find(".breakup-row").height()||40,m=0;d%2?m=(d-1)*u/2:(m=d*u/2,m=(d-1)*u/2),l=r-c.height()/2-m-3}}}}},app.mods.getEditBase=function(e,t,a){return function(n,o){function i(){n.factory.renderPreview(n),n.factory.folio.Role<2&&n.save()}var s=n.Data;o.align&&t.reg(n,"Align",function(e,t){s.Align=t,n.menuCb("Align"),o.align(),i()}),t.reg(n,"Cols",function(e,t){var a=s.Cols;s.Cols=t,n.$editNode.removeClass("col-sm-"+a).addClass("col-sm-"+t),n.$previewNode.removeClass("col-sm-"+a).addClass("col-sm-"+t),"DonutChart"==n.Type&&n.factory.eventManager.raiseEvent("resize")}),t.reg(n,"Head",function(e,t){s.Head=t,n.menuCb("Head"),i()}),o.txt&&t.reg(n,"Txt",function(e,t){s.Txt=t,n.menuCb("Txt"),o.txt()}),t.reg(n,"Theme",function(e,t){s.Theme=t,n.menuCb("Theme"),o.theme&&o.theme(),i()}),o.itemVal&&t.reg(n,"Items",function(e,t){s.Items.length==t.length?$.each(t,function(e,t){s.Items[e].Val=t.Val,s.Items[e].Url=t.Url,console.log(n),"Videos"==n.Type?(s.Items[e]=t,o.itemVal(e,t)):o.itemVal(e,t.Val,t.Url)}):(o.$items.empty(),s.Items=t,$.each(t,o.addItem)),i()}),t.reg(n,"BgColor",function(e,t){s.BgColor=t,n.menuCb("BgColor")}),t.reg(n,"BgUrl",function(e,t){s.BgUrl=t,n.menuCb("BgUrl")}),t.reg(n,"ResetBg",function(e,t){n.menuCb("ResetBg")}),t.reg(n,"Border",function(e,t){s.Border=t,n.menuCb("Border"),i()}),t.reg(n,"DuplicateModule",function(e,t){n.menuCb("DuplicateModule")}),t.reg(n,"RemoveModule",function(e,t){n.menuCb("RemoveModule")}),t.reg(n,"Editor",function(t,o){e.currentlyEditing[o]={time:Date.now(),active:!0,module:n},a.raiseEvent("editorStatus",{email:o,status:1})}),setTimeout(function(){e.editMode&&n.$editNode.on("keydown click",function(){if("Canvas"!=n.Type){var a=e.currentlyEditing[e.userEmail];(!a||a.module.Tag!=n.Tag||Date.now()-a.time>=5e3)&&(t.sync(n,"Editor",e.userEmail),e.currentlyEditing[e.userEmail]={time:Date.now(),module:n})}})},50)}},app.mods.sliderBaseFunc=function(e,t){return function(e,a,n,o){var i=e.Data;e.factory.editBase(e,{addItem:a,$items:n,itemVal:function(e,a){n.find("> div:eq("+e+")").find(".slider-bar").css(t,a+"%")},txt:function(){o.css("display",1==i.Txt?"":"none")},theme:function(){o.unstyle()}})}},app.mods.barEdit=function(e,t){var a=$("#tmp-edit-bar").html(),n=$("#tmp-edit-bar-row").html();return function(o){function i(t){e.appHub.sync(o,t,s[t])}var s=o.Data,r=$(a),l=r.find(".title").css("display",1==s.Txt?"":"none"),c=r.find(".pairs");l.editor(o,s,"Title",{allowEnter:!0});var d=function(t,a){var r=$(n),l=r.find(".name"),d=r.find(".slider-container"),u=r.find(".item-close-btn");l.editor(o,a,"Name",{index:t,cleanPTags:!0}),d.percentSlider({obj:a,sync:i}),u.on("click",function(){e.utility.removeFromList(s.Items,a),l.unMount(),r.remove(),i("Items")}),c.append(r)};return $.each(s.Items,function(e,t){d(e,t)}),t(o,d,c,l),{$node:r,addItem:function(){var e={Name:"<p>Bar "+(s.Items.length+1)+"</p>",Val:50};d(s.Items.length,e),s.Items.push(e)},changeTheme:function(e){l.unstyle()},toggleTxt:function(){l.css("display",1==s.Txt?"":"none")},unMount:function(){l.unMount(),r.find(".name").unMount()}}}},app.mods.canvasEdit=function(e){function t(e){$.each(e.Data.Mods,function(e,t){var a=c.getModule(t.Tag);a&&a.resize&&a.resize()})}function a(){if(n){var e,a=n.Data,i=0,s=a.Arr[o],r=a.Arr[o+1],c=s+r,d=$(this).index();for(e=0;e<o;e++)i+=a.Arr[e];return s=1+d-i,r=c-s,s>0&&r>0&&(a.Arr[o]=s,a.Arr[o+1]=r,n.editObj.setLayout(),n.save()),t(n),l.sync(n,"CanvasColResize",{col:o,first:s,second:r}),!1}}var n,o,i="col col-sm-",s=$("#tmp-edit-canvas").html(),r=$("#tmp-canvas-resize-col").html(),l=e.appHub,c=e.modManager,d=e.utility;return function(u){function m(e){var t,a=h.Arr.length;if(a!=e){var n,o,i,s;if(a>e)for(i=b.find(".col:eq("+(e-1)+")"),n=e;n<a;n++)h.Arr[e-1]+=h.Arr[n],o=b.find(".col:eq("+n+")"),s=o.find(".module-container"),i.append(s),o.remove();else{for(n=a;n<e;n++)b.append($("<div>")),h.Arr[n]=1;t=e-a,n=-1;do n<0&&(n=a-1),h.Arr[n]>1&&(h.Arr[n]-=1,t-=1),n--;while(t>0)}h.Arr.length=e}}function f(t,a,n){var o=0,a=c.addModule(t,a,0,$("<div>"),$("<div>"));b.find(".col").length>1&&(o=1),b.find(".col:eq("+o+")").insertAt(0,a.$editNode),a.resize&&a.resize(),k.saveMods(),e.include(u,a),a.save(),n&&n(a)}var p,h=u.Data,g=$(s),v=g.find(".edit-content"),b=v.find(".mods-inner"),y=v.find(".resize-bars"),C=g.find(".grid-div-wrapper"),T=g.find(".grid-div"),w=$('<div class="empty" style="min-height: 100px; border: 1px dotted blue; margin-top: 12px;">');for(y.on("mousedown",".resize-grip",function(){n=u,o=$(this).index(),$("body").addClass("disable-select"),C.show()}),p=0;p<h.Arr.length;p++)b.append($("<div>"));for(g.on("mouseup mouseleave",function(){n&&(n=null,$("body").removeClass("disable-select"),C.hide())}),p=0;p<12;p++){var x=$('<div class="col col-xs-1"></div>)');x.on("mouseenter",a),T.append(x)}u.drag=function(e,t){t=t-g.find(".header").height()-30,b.find(".module-container").each(function(a,n){var o=$(n),i=o.closest(".col").position(),s=o.position();if(s.left+=i.left,s.top+=i.top,s.right=s.left+o.width(),s.bottom=s.top+o.height(),d.isPointInRect(s,{x:e,y:t}))return t>s.bottom/2?w.insertAfter(o):w.insertBefore(o),!1})},u.dragCancel=function(){w.remove()},u.dragEnd=function(t){var a,n;n=w.closest(".col").index(),n<0&&(n=0,b.find(".col:eq(0)").prepend(w)),a=w.index(),l.sync(u,"CanvasModPos",{col:n,index:a,Tag:t.Tag}),b.find(".col:eq("+n+")").insertAt(a,t.$editNode),$(".empty").remove(),t.editObj.applyStyle&&(t.Data.Theme=h.Theme,t.editObj.applyStyle(h.Theme),l.sync(t,"Theme",h.Theme)),t.Data.Theme=h.Theme,t.applyStyle&&t.applyStyle(h.Theme),e.include(u,t),l.sync(u,"Mods",h.Mods)},l.reg(u,"CanvasCol",function(e,t){m(t),k.setLayout()}),l.reg(u,"CanvasModPos",function(e,t){var a=$("#ed-"+t.Tag).parent(".col").index(),n=$("#ed-"+t.Tag).index();a==t.col&&n<t.index&&(t.index+=1);var o=c.getModule(t.Tag);b.find(".col:eq("+t.col+")").insertAt(t.index,o.$editNode)}),l.reg(u,"CanvasColResize",function(e,a){var n=u.Data;n.Arr[a.col]=a.first,n.Arr[a.col+1]=a.second,t(u),u.editObj.setLayout()}),l.reg(u,"CanvasAddMod",function(e,t){t.Syncd=!0,f(t.Type,t)});var k={$node:g,mount:function(){$.each(h.Mods,function(e,t){var a=c.getModule(t.Tag)||t.Module;a&&b.find(".col:eq("+t.Col+")").insertAt(t.Row,a.$editNode)})},applyStyle:function(t,a){b.css({border:1==h.Border?"":"1px dashed "+t}),a&&$.each(h.Mods,function(a,n){var o=c.getModule(n.Tag);o&&(o.Data.ThemeOverride&&(o.Data[o.Data.ThemeOverride]=t,"BgColor"==o.Data.ThemeOverride&&e.bgColor(o,t,!0)),o.Data.Theme=t,o.applyStyle(t),o.editObj&&o.editObj.applyStyle&&o.editObj.applyStyle(t),o.save())})},addModule:function(){e.popup.addModule(function(e){f(e,{Type:e,Data:{Type:e,Theme:h.Theme}},function(t){l.sync(u,"CanvasAddMod",{Tag:t.Tag,Type:e,Data:t.Data,CanvasMod:!0})})},1)},clone:function(e){var t=c.copyModule(e),a=c.getFactory(t);a.initModule(t),e.$editNode.after(t.$editNode),u.factory.include(u,t),t.save(),u.save()},setLayout:function(){var e,t=0,a="0px";y.empty(),$.each(h.Arr,function(n,o){b.find(">div:eq("+n+")").attr("class",i+o),n>0&&(t+=8.33*h.Arr[n-1],e=$(r).css("left","calc("+t+"% - "+a+")"),y.append(e))})},saveMods:function(){h.Mods=[],b.find(".col").each(function(e,t){$(t).find(".module-container:not(.empty-module-container)").each(function(t,a){a=c.getModule($(a).data("key")),a&&h.Mods.push({Tag:a.Tag||a.Key,Col:e,Row:t})})})},changeColumns:function(e){m(e),k.setLayout(),u.save(),l.sync(u,"CanvasCol",e)},move:function(e){var t,a,n,o,i=e.pageX,s=e.pageY,r={x:i,y:s};b.find("> .col").each(function(e,i){if(a=$(i),o=a.width(),t=a.offset(),t.top-=150,t.right=t.left+a.width()+10,t.bottom=t.top+b.height()+100,d.isPointInRect(t,r))return a.prepend(w),a.find(".module-container").each(function(e,a){if(n=$(a),t.top=n.offset().top,t.bottom=t.top+n.height(),s>t.top&&s<t.bottom)return s<t.top+n.height()/2?n.before(w):n.after(w),!1}),!1}),w.index()<0&&b.find(".col:eq(0)").append(w)},cancel:function(){w.remove()}};return k.setLayout(),setTimeout(t,0,u),k}},app.mods.dataCollectionEdit=function(e){var t=$("#tmp-edit-dc").html();return function(a){function n(e,t){s+=e,l+=t,m.text(s+" RESPONSE"+(1==s?"":"S")),f.text(l+" New")}function o(){a.ID?e.popup.signupPerformance.reg(a.ID,a.Records,{n:e.folio.FolioName,t:e.folio.Token}):setTimeout(o,500)}var i,s,r=a.Data,l=0,c=$(t),d=c.find(".module-info-inner"),u=c.find(".dc-join-us"),m=c.find(".total"),f=c.find(".new-items"),p=c.find(".msg");return a.Records=a.Records||[],a.Store=JSON.parse(a.Store||"{}"),a.Store.viewed=a.Store.viewed||JSON.stringify(new Date(2016,4,30).getTime()),i=new Date(JSON.parse(a.Store.viewed)),s=a.Records.length,$.each(a.Records,function(e,t){return!(t.Created<i)&&void l++}),m.text(s+" RESPONSE"+(1==s?"":"S")),f.text(l+" New"),d.on("click",function(){n(0,-l),e.popup.signupPerformance(a.ID,a.Records,{n:e.folio.FolioName,t:e.folio.Token})}),p.editor(a,r,"Message",{allowEnter:!0}),u.editor(a,r,"ButtonText",{noHtml:!0}),e.modStore.reg(a.ID,a.Store),e.eventManager.addListener("newSignUp",function(e){e.Data.ModId==a.ID&&n(1,1)}),n(0,0),o(),e.editBase(a,{}),{$node:c}}},app.mods.donutEdit=function(e,t){var a=$("#tmp-edit-donut-main").html(),n=$("#tmp-edit-donut-row").html(),o=$("<div>"),i=function(t,a,n){var i=0,s=!0,r=e.modManager.getDonutData();t.breakup=[];for(var l=0;l<a.length;l++){var c=parseFloat(o.html($.trim(a[l].Val)).text());isNaN(c)||(i+=c,t.breakup.push(c))}r.showError&&(s=100==i),n.closest(".breakup-col").find(".item-close-btn").toggleClass("hidden",1==t.breakup.length),n.toggleClass("hidden",s)},s=function(t,a){var n=t.module,o=n.Data;a&&(n.colorFunc=e.createColorFunc(o.Items.length,a)),i(n,o.Items,t.$error),t.$breakup.find(".breakup-row").each(function(e){$(this).find(".color").css("background-color",n.colorFunc(e))}),t.drawPie(),n.factory.renderPreview(n)},r=function(e,t,a){var o=e.module,i=$(n),r=i.find(".value");r.editor(o,t,"Val",{index:a,onSave:function(){s(e)},changed:function(){var a=$("<div>"+t.Val+"</div>").find("p").length;a>1&&(t.Val="<p>"+$(t.Val).text()+"</p>",r.find(".fr-view").html(t.Val)),setTimeout(function(){s(e)},500)}}),e.$breakup.append(i)};return function(n){var o=n.Data,l=o.Theme||"#4C7BA0",c=o.Items,d=$(a),u=d.find(".title"),m=d.find(".donut-pie-container"),f=d.find(".donut-label"),p=d.find(".donut-breakup"),h=d.find(".invalid-100"),g=$.extend({parentPage:e.pageManager.pages.edit,$node:d,$pieDiv:m,$breakup:p,$error:h,module:n,data:o,breakup:c,changeTheme:function(e){u.unstyle(),n.applyStyle(e),g.applyStyle(e)},applyStyle:function(e){l=e,s(g)},addItem:function(){v(),e.appHub.sync(n,"PieItems",-1)},render:function(){s(g)}},t);$.each(c,function(e,t){r(g,t,e)});var v=function(){var e={Val:"<p>10% &nbsp;Segment  "+(c.length+1)+"</p>"};r(g,e,c.push(e)-1),s(g,l)};return e.appHub.reg(n,"PieItems",function(e,t){t<0?v():(p.find(".breakup-row").eq(t).remove(),c.splice(t,1),s(g,l))}),p.on("click",".item-close-btn",function(){var t=$(this),a=t.closest(".breakup-row");e.appHub.sync(n,"PieItems",a.index()),c.splice(a.index(),1),a.remove(),s(g,l),n.save()}),h.find(".item-close-btn").on("click",function(){e.modManager.getDonutData().showError=!1,i(n,c,h),h.find(".error-check").get(0).checked&&(e.eventManager.raiseEvent("donutError"),e.modManager.saveData())}),e.eventManager.addListener("donutError",function(){i(n,c,h)}),u.editor(n,o,"Title",{allowEnter:!0}),f.editor(n,o,"Label",{allowEnter:!0,changed:function(){g.updateLabel()}}),n.resize=function(){g.drawPie()},e.editBase(n,{}),g}},app.mods.imagesEdit=function(e){var t=e.appHub,a=$("#tmp-edit-images").html(),n=$("#tmp-edit-image-item").html();return function(o){function i(){if(l){$("body").removeClass("disable-select");var e=h.width();l.Val=Math.round(100*c.width()/e),c.css("width",l.Val+"%"),l=null,t.sync(o,"Items",m.Items)}}function s(e){return e.toString().replace("&amp;","&")}function r(a,i){var r=Math.min(100,i.Val||33)+"%",f=$(n),p=f.find("img"),g=f.find(".edit-btn"),v=f.find(".link-btn"),b=f.find(".logo-resize-handle"),y=f.find(".close-btn");f.css("width",r),y.on("click",function(){e.utility.removeFromList(m.Items,i),o.save(),t.sync(o,"Items",m.Items),f.remove()}),b.on("mousedown touchstart",function(e){l=i,c=f,u=f.width(),d=e.clientX,$("body").addClass("disable-select")}),g.uploader({module:o,custom:"imgMod",success:function(e){var a=s(e.Message);i.Url=a,p.attr("src",a),t.sync(o,"Items",m.Items)}}),v.click(function(){e.popup.message({input:s(i.Url),validateFor:"url",enterAsOK:!0,emptyError:"Please provide a valid URL.",heading:"Enter Image Url",cancelText:"Cancel",handleOK:function(e){i.Url=s(e),p.attr("src",i.Url),t.sync(o,"Items",m.Items)}})});var C=s(i.Url);p.attr("src",C),h.append(f)}var l,c,d,u,m=o.Data,f=$(a),p=f.find(".title").css("display",1==m.Txt?"":"none"),h=f.find(".image-outer").css("text-align",m.Align);return p.editor(o,m,"Html",{allowEnter:!0}),$(document).on("touchend mouseup touchcancel mouseleave",i),$(document).on("touchmove mousemove",function(e){if(l){var t=h.width();c.css("width",Math.max(50,Math.min(t,u+e.clientX-d))+"px")}}),$.each(m.Items,r),e.editBase(o,{addItem:r,$items:h,itemVal:function(e,t,a){var n=s(a);h.find("> div:eq("+e+")").css("width",t+"%").find("img").attr("src",n)},align:function(){h.css("text-align",m.Align)},txt:function(){p.css("display",1==m.Txt?"":"none")},theme:function(){p.unstyle()}}),{$node:f,changeTheme:function(e){p.unstyle()},addItem:function(){var t={Url:e.defImg,Val:100};r(m.Items.length,t),m.Items.push(t)},align:function(){h.css("text-align",m.Align)},toggleTxt:function(){p.css("display",1==m.Txt?"":"none")},unMount:function(){p.unMount()}}}},app.mods.scaleEdit=function(e,t){var a=$("#tmp-edit-scale").html(),n=$("#tmp-edit-scale-row").html();return function(o){function i(t){e.appHub.sync(o,t,s[t])}var s=o.Data,r=$(a),l=r.find(".title").css("display",1==s.Txt?"":"none"),c=r.find(".pairs");l.editor(o,s,"Title",{allowEnter:!0});var d=function(t,a){var r=$(n),l=r.find(".name-1"),d=r.find(".name-2"),u=r.find(".slider-container"),m=r.find(".item-close-btn");l.editor(o,a,"Name1",{index:t,cleanPTags:!0}),d.editor(o,a,"Name2",{index:t,cleanPTags:!0}),u.thumbSlider({obj:a,sync:i}),m.on("click",function(){e.utility.removeFromList(s.Items,a),o.save(),l.unMount(),d.unMount(),r.remove(),i("Items")}),c.append(r)};return $.each(s.Items,d),t(o,d,c,l),$.extend({$node:r,changeTheme:function(e){l.unstyle()},addItem:function(){var e={Name1:"<p>Side A</p>",Name2:"<p>Side B</p>",Val:50};d(s.Items.length,e),s.Items.push(e),i("Items")},toggleTxt:function(){l.css("display",1==s.Txt?"":"none"),o.save()},unMount:function(){l.unMount(),r.find(".name-1, name-2").unMount()}})}},app.mods.socialEdit=function(e){var t=new Image,a=new Image;t.src="/img/instagramdark.png",a.src="/img/instagramhover.png";var n=$("#tmp-edit-social").html(),o=function(e,t,a,n,o,i,s){t.toggleClass("active",!!e.FacebookUrl),a.toggleClass("active",!!e.TwitterUrl),n.toggleClass("active",!!e.LinkedInUrl),o.toggleClass("active",!!e.GplusUrl),i.toggleClass("active",!!e.InstagramUrl),s.toggleClass("active",!!e.CustomUrl)},i=function(e,t,a,n,o,i,s){t.closest(".field-items").toggleClass("active",!!e.FacebookUrl),a.closest(".field-items").toggleClass("active",!!e.TwitterUrl),n.closest(".field-items").toggleClass("active",!!e.LinkedInUrl),o.closest(".field-items").toggleClass("active",!!e.GplusUrl),i.closest(".field-items").toggleClass("active",!!e.InstagramUrl),s.closest(".field-items").toggleClass("active",!!e.CustomUrl)};return function(t){var a=t.Data,s=$(n).css("text-align",a.Align),r=s.find(".social-info-box"),l=s.find(".social-info"),c=l.find(".edit-btn"),d=r.find(".social-info-close"),u=r.find(".facebook input, .twitter input, .linkedin input, .gplus input, .instagram input, .custom-link input"),m=r.find(".facebook input"),f=r.find(".twitter input"),p=r.find(".linkedin input"),h=r.find(".gplus input"),g=r.find(".instagram input"),v=r.find(".custom-link input"),b=l.find(".facebook"),y=l.find(".twitter"),C=l.find(".linkedin"),T=l.find(".gplus"),w=l.find(".instagram"),x=l.find(".custom");return o(a,b,y,C,T,w,x),i(a,m,f,p,h,g,v),m.val(a.FacebookUrl),f.val(a.TwitterUrl),p.val(a.LinkedInUrl),h.val(a.GplusUrl),g.val(a.InstagramUrl),v.val(a.CustomUrl),u.on("blur",function(){var e=$(this),n=$(this).data("name");a[n]=e.val(),o(a,b,y,C,T,w,x),i(a,m,f,p,h,g,v),t.save()}),d.add(c).on("click",function(){return $(".top-comp").removeClass("top-comp"),s.closest(".module").toggleClass("no-resize"),s.closest(".module-container").toggleClass("top-comp"),s.closest(".edit-div").toggleClass("top-comp"),r.slideToggle(150),$(".social-info-box").not(r).hide(),!1}),s.click(function(){return!1}),e.editBase(t,{}),{$node:s,align:function(){s.css("text-align",a.Align)}}}},app.mods.tagEdit=function(e){var t=$("#tmp-edit-tag").html(),a=$("#tmp-edit-tag-item").html();return function(n){function o(t){e.appHub.sync(n,t,i[t])}var i=n.Data,s=$(t),r=s.find(".tag-container").css("text-align",i.Align);i.Theme=i.Theme||"#F2F2F3";var l=function(t,s){var l=$(a),c=l.find(".tag-inner"),d=l.find(".tag-close");c.editor(n,s,"Name",{index:t,allowEnter:!1}),r.append(l),d.on("click",function(){c.unMount(),l.remove(),e.utility.removeFromList(i.Items,s),o("Items"),n.save()})};return $.each(i.Items,l),e.editBase(n,{$items:r,itemVal:function(e,t){},align:function(){r.css("text-align",i.Align)},addItem:l}),{$node:s,addItem:function(){var e={Name:"<p>Tag</p>"};l(i.Items.push(e)-1,e),o("Items")},align:function(){r.css("text-align",i.Align)},unMount:function(){r.find(".tag-inner").unMount()}}}},app.mods.videosEdit=function(e,t,a,n){var o=e.appHub,i=$("#tmp-edit-videos").html(),s=$("#tmp-edit-video-item").html();return function(r){function l(){if(d){$("body").removeClass("disable-select");var e=y.width();y.height();d.width=Math.round(100*u.width()/e),d.height=u.height(),u.css("width",d.width+"%"),d=null,o.sync(r,"Items",g.Items),a.activatePreview({modId:r.Tag}),u.removeClass("video-disable")}}function c(i,c){var v="100%",b=$(s),C=b.find(".edit-btn"),T=b.find(".link-btn"),w=b.find(".logo-resize-handle"),x=b.find(".close-btn"),k=b.find(".fr-video");b.css("width",v),x.on("click",function(){e.utility.removeFromList(g.Items,c),r.save(),o.sync(r,"Items",g.Items),b.remove(),a.activatePreview({modId:r.Tag})}),w.on("mousedown touchstart",function(e){c.$videoContainer=b,d=c,u=b,p=b.width(),h=b.height(),m=e.clientX,f=e.clientY,$("body").addClass("disable-select")}),C.uploader({module:r,custom:"videoMod",success:function(e){var n=e.Message;c.VideoUrl=n,k.html(t(n)),o.sync(r,"Items",g.Items),a.activatePreview({modId:r.Tag})}}),T.click(function(){e.popup.message({input:c.VideoUrl||" ",enterAsOK:!0,emptyError:"Please provide a valid URL.",heading:"Enter Video Url",cancelText:"Cancel",handleOK:function(e){e.length>0?k.html(t(e)):k.html(""),c.VideoUrl=e,r.VideoUrl=e,c.VideoUrl&&y.find(".video-inner").css({"background-image":""}),o.sync(r,"Items",g.Items),a.activatePreview({modId:r.Tag}),y.find(".loading-animation").show(),setTimeout(function(){y.find(".loading-animation").hide()},3e3),l()}})}),k.html(t(c.VideoUrl)),c.VideoUrl&&y.find(".video-inner").css({"background-image":""}),b.css("width",c.width+"%"),y.append(b),y.find(".loading-animation").html(n.spinner),setTimeout(function(){a.activatePreview({modId:r.Tag})},1e3),setTimeout(function(){y.find(".loading-animation").hide()},3e3)}var d,u,m,f,p,h,g=r.Data,v=$(i),b=v.find(".title").css("display",1==g.Txt?"":"none"),y=v.find(".video-outer").css("text-align",g.Align);return b.editor(r,g,"Html",{allowEnter:!0}),$(document).on("touchend mouseup touchcancel mouseleave",l),$(document).on("touchmove mousemove",function(e){if(d){u.addClass("video-disable");var t=y.width(),a=Math.max(50,Math.min(t,p+e.clientX-m));u.css("width",a+"px")}}),$.each(g.Items,c),e.editBase(r,{addItem:c,$items:y,itemVal:function(e,n){y.find("> div:eq("+e+")").css({width:n.width+"%"}),n.VideoUrl&&y.find(".video-inner").css({"background-image":""}),r.Data.Items[e].VideoUrl!=n.VideoUrl&&(y.find(".loading-animation").show(),setTimeout(function(){y.find(".loading-animation").hide()},3e3),y.find("> div:eq("+e+")").find(".fr-video").html(t(n.VideoUrl))),a.activatePreview({modId:r.Tag})},align:function(){y.css("text-align",g.Align),a.activatePreview({modId:r.Tag})},txt:function(){b.css("display",1==g.Txt?"":"none"),a.activatePreview({modId:r.Tag})},theme:function(){b.unstyle(),a.activatePreview({modId:r.Tag})}}),{$node:v,changeTheme:function(e){b.unstyle(),a.activatePreview({modId:r.Tag})},align:function(){y.css("text-align",g.Align),a.activatePreview({modId:r.Tag})},toggleTxt:function(){b.css("display",1==g.Txt?"":"none"),a.activatePreview({modId:r.Tag})},unMount:function(){b.unMount(),a.activatePreview({modId:r.Tag})}}}},app.mods.barPreview=function(e){var t=$("#tmp-prev-bar").html(),a=$("#tmp-prev-bar-row").html();return function(e){var n=$(t),o=n.find(".title"),i=n.find(".pairs"),s=e.Data;return e.renderPreview=function(){o.html(s.Title).css("display",1==s.Txt?"":"none"),i.empty(),$.each(s.Items,function(e,t){var n=$(a);n.find(".name").html(t.Name),n.find(".slider-bar").css({width:Math.ceil(t.Val)+"%"}),i.append(n)})},{$node:n}}},app.mods.canvasPreview=function(e){var t=$("#tmp-prev-canvas").html();return function(a){var n=a.Data,o="col col-sm-",i=$(t),s=i.find(".mods-inner");return a.renderPreview=function(){s.empty();for(var t=0;t<n.Arr.length;t++){var a=$("<div>").attr("class",o+n.Arr[t]);s.append(a)}$.each(n.Mods,function(t,a){var n=e.modManager.getModule(a.Tag);n&&(s.find(".col:eq("+a.Col+")").insertAt(a.Row,n.$previewNode),e.renderPreview(n))})},{$node:i}}},app.mods.dataCollectionPreview=function(e){var t=$("#tmp-prev-dc").html(),a=$("#spinner-container > .loading-animation");return function(n){var o=$(t),i=a.clone().addClass("small").hide(),s=o.find(".msg"),r=o.find(".dc-join-us"),l=o.find(".dc-email-input");return r.prepend(i),r.on("click",function(){var t=l.val();t&&validator.isEmail(t)?(r.prop("disabled",!0),l.removeClass("email-invalid"),i.show(),e.apiHelper.saveModuleRecord({moduleId:n.ID,dataObj:{email:t},success:function(){i.hide(),l.val(""),r.text("Submitted")},error:function(){i.hide(),r.text("Error. Try again."),r.prop("disabled",!1),setTimeout(function(){r.text(n.Data.ButtonText)},3e3)}})):l.addClass("email-invalid")}),n.renderPreview=function(){s.html(n.Data.Message);var e=$("<div></div>").html(n.Data.ButtonText).text();r.text(e)},{$node:o}}},app.mods.donutPreview=function(e,t){var a=$("#tmp-prev-donut-main").html(),n=$("#tmp-prev-donut-row").html();return function(o){var i=o.Data,s=i.Items,r=$(a),l=r.find(".title"),c=r.find(".donut-pie-container"),d=r.find(".donut-label"),u=r.find(".donut-breakup"),m=$.extend({$node:r,parentPage:e.pageManager.pages.home,$pieDiv:c,$breakup:u,module:o},t);return o.renderPreview=function(){l.html(i.Title),d.html(i.Label),u.empty(),$.each(s,function(e,t){var a=$(n);a.find(".value").html(t.Val),a.find(".color").css("background-color",o.colorFunc(e)),u.append(a)}),m.drawPie()},m}},app.mods.imagesPreview=function(e){var t=$("#tmp-prev-images").html();return function(e){var a=$(t),n=e.Data,o=a.find(".title"),i=a.find(".image-outer");return e.renderPreview=function(){o.html(n.Html).css("display",1==n.Txt?"":"none"),i.empty().css("text-align",n.Align),$.each(n.Items,function(e,t){var a=t.Url.toString().replace("&amp;","&"),n=$('<div class="image-inner"><img src="'+a+'"></img></div>');n.css({width:Math.min(100,t.Val||33)+"%"}),i.append(n)})},{$node:a}}},app.mods.scalePreview=function(e){var t=$("#tmp-prev-scale").html(),a=$("#tmp-prev-scale-row").html();return function(e){var n=e.Data,o=$(t),i=o.find(".title"),s=o.find(".pairs");return e.renderPreview=function(){i.html(n.Title).css("display",1==n.Txt?"":"none"),s.empty(),$.each(n.Items,function(e,t){var n=$(a);n.find(".name-1").html(t.Name1),n.find(".name-2").html(t.Name2),n.find(".slider-bar").css({left:Math.round(t.Val)+"%"}),s.append(n)})},{$node:o}}},app.mods.socialPreview=function(e){var t=$("#tmp-prev-social").html();return function(e){var a=e.Data,n=$(t),o=n.find(".social-info-static");return e.renderPreview=function(){if(n.find(".header-container .header").html(a.Header),n.css("text-align",a.Align).addClass("module"),o.empty(),a.FacebookUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.FacebookUrl)||(a.FacebookUrl="https://"+a.FacebookUrl),o.append('<a target="_blank" class="facebook active" href="'+a.FacebookUrl+'"><i class="icon-SocialFacebook"></i></a>')),a.TwitterUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.TwitterUrl)||(a.TwitterUrl="https://"+a.TwitterUrl),o.append('<a target="_blank" class="twitter active" href="'+a.TwitterUrl+'"><i class="icon-SocialTwitter"></i></a>')),a.LinkedInUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.LinkedInUrl)||(a.LinkedInUrl="https://"+a.LinkedInUrl),o.append('<a target="_blank" class="linkedin active" href="'+a.LinkedInUrl+'"><i class="icon-SocialLinkedin"></i></a>')),a.GplusUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.GplusUrl)||(a.GplusUrl="https://"+a.GplusUrl),o.append('<a target="_blank" class="gplus active" href="'+a.GplusUrl+'"><i class="icon-SocialGooglePlus"></i></a>')),a.InstagramUrl&&(/^(?:f|ht)tps?\:\/\//.test(a.InstagramUrl)||(a.InstagramUrl="https://"+a.InstagramUrl),o.append('<a target="_blank" class="instagram active" href="'+a.InstagramUrl+'"><i class="img-instagram"></i></a>')),a.CustomUrl){var e=$.trim(a.CustomUrl);a.CustomUrl.indexOf("http")<0&&(e="https://"+e),o.append('<a target="_blank" class="custom active" href="'+e+'"><i class="icon-SocialLink"></i></a>')}},{$node:n}}},app.mods.tagPreview=function(e){var t=$("#tmp-prev-tag").html(),a=$("#tmp-prev-tag-item").html();return function(e){var n=$(t),o=n.find(".tag-container"),i=e.Data;return e.renderPreview=function(){o.empty().css("text-align",i.Align),$.each(i.Items,function(e,t){var n=$(a);n.find(".tag-inner").html(t.Name),o.append(n)})},{$node:n}}},app.mods.videosPreview=function(e,t){var a=$("#tmp-prev-videos").html(),n=$("#tmp-edit-video-item").html();return function(e){var o=$(a),i=e.Data,s=o.find(".title"),r=o.find(".video-outer");return e.renderPreview=function(){s.html(i.Html).css("display",1==i.Txt?"":"none"),r.empty().css("text-align",i.Align),$.each(i.Items,function(e,a){var o=$(n);o.removeClass("edit"),o.find(".edit-btn").remove(),o.find(".link-btn").remove(),o.find(".logo-resize-handle").remove(),o.find(".loading-animation").remove(),o.find(".close-btn").remove();var i=o.find(".fr-video");o.css("width",a.width+"%"),i.html(t(a.VideoUrl)),r.append(o),console.log("preview",e,a)})},{$node:o}}};var logger=function(){try{var e=null,t={};t.enableLogger=function(){null!=e&&(window.console.log=e)},t.disableLogger=function(){e=console.log,window.console.log=function(){}}}catch(a){}return t}(),consologs=function(e){var t=[];return function(a){t.push(a),("localhost"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||e.isAdmin)&&console.log(a)}},isConsoleAllow=function(e){return function(t){return"localhost"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||e.isAdmin}};app.plugin.froalaSetup=function(e,t,a,n){function o(){if(e.StyleGuides)for(var t=0;t<e.StyleGuides.length;t++){var a=e.StyleGuides[t];if(a.TeamId==e.Team.Id)return a}return!1}function i(e,t){t.appendChild(document.createTextNode("    @font-face {        font-family: '"+e.FontJson.FontLocalName+"';        font-weight: "+e.FontJson.FontWeight+";         font-style: "+e.FontJson.FontStyle+";         src: local("+e.FontJson.FontLocalName+"), url("+e.FontJson.FontUrl+")  format('woff2');        unicode-range: "+e.FontJson.UnicodeRange+";     }    "))}function s(e){return C.html(e).html()}var r={__RequestVerificationToken:e.verificationToken,type:"froala",token:e.token},l=e.colors;!e.isHome&&l.push("REMOVE");var c,d="d575355bb0d24163871dc640ba400f2a";c="live"==e.Environment?"FC2B2G1tA6B4C2D4C7D1B1E1D4I4olasykpuI2C-21rs==":"FC2B2G1tA6B4C2D4C7D1B1E1D4I4olasykpuI2hxB-16w==",$.FroalaEditor.DEFAULTS=$.extend($.FroalaEditor.DEFAULTS,{key:c,embedlyKey:d,colorsText:l,colorsBackground:l,keepFormatOnDelete:!0,imageResizeWithPercent:!0,fontSize:["8","9","10","11","12","14","16","18","24","30","36","48","60","72","96"],
imageAllowedTypes:["jpeg","jpg","png","gif"],htmlAllowedAttrs:$.FroalaEditor.DEFAULTS.htmlAllowedAttrs.concat(["webkitallowfullscreen","mozallowfullscreen","allowfullscreen"])}),embedly("defaults",{cards:{key:d}});var u={toolbarInline:!0,toolbarVisibleWithoutSelection:!0,theme:"custom",tabSpaces:!1,placeholderText:null,embedlyKey:d,toolbarButtons:[],imageUploadURL:"/Apiv1/UploadImage",fileUploadURL:"",linkAlwaysNoFollow:!1,htmlRemoveTags:["script"],spellcheck:!0,toolbarContainer:"#toolbarContainer",htmlUntouched:!0,htmlSimpleAmpersand:!0,videoInsertButtons:["videoBack","|","videoByURL","videoEmbed"],embedlyInsertButtons:["embedlyBack","|","embedlyRemove"],listAdvancedTypes:!1,fontFamily:{},imageMaxSize:n?e.FreeUserLimitPerImage:e.PaidUserLimitPerImage};e.fontFamily&&(u.fontFamily=$.extend(u.fontFamily,e.fontFamily));var m=o(),f=!1;if(m&&m.TeamFonts.length>0){var p=document.createElement("style");m.DefaultFontFamily&&(f=m.DefaultFontFamily+",proxima-light,Helvetica,sans-serif");var h={};$.map(m.TeamFonts,function(e,t){if("Xtensio"!=e.SourceString&&"System"!=e.SourceString)return i(e,p),e.FontJson.FontLocalName});document.head.appendChild(p);for(var g=0;g<m.TeamFonts.length;g++){var v=m.TeamFonts[g];"Xtensio"==v.SourceString||"System"==v.SourceString?h["'"+v.FontJson.IdString+"',proxima-light,Helvetica,sans-serif"]=v.Name:h["'"+v.FontJson.FontLocalName+"',proxima-light,Helvetica,sans-serif"]=v.Name}}else var h={"proxima-nova,Helvetica,sans-serif":"Proxima Nova","proxima-light,Helvetica,sans-serif":"Proxima Light","proxima-bold,Helvetica,sans-serif":"Proxima Bold","Tahoma,Geneva,sans-serif":"Tahoma","Times New Roman,Times,serif":"Times New Roman","Verdana,Geneva,sans-serif":"Verdana"};h&&(u.fontFamily=$.extend(u.fontFamily,h)),f&&(u.fontFamilyDefaultSelection=f);var b=$.extend({},u,{plainPaste:!0,multiLine:!1}),y=$.extend({},u,{imageUploadParams:r,toolbarButtons:["bold","italic","underline","paragraphFormat","fontFamily","fontSize","lineHeight","insertImage","insertVideo","color","insertLink","insertTable","formatOL","formatUL","insertHR","align","html","outdent","indent","clearFormatting","undo","redo","embedly"]}),C=$("<div>");if(m&&m.TeamColors.length>0){console.log("styleGuide",m);var T="";if(m.TeamColors.forEach(function(e,t){e.IsDefault&&(T=e.HexCode)}),""!==T&&(console.log("implementing default color: ",T),!e.isDashboard)){var w="#modules-edit-main, #modules-edit-main h1, ";w+="#modules-edit-main h2, ",w+="#modules-edit-main h3, ",w+="#modules-edit-main h4, ",w+="#modules-edit-main p, ",w+="#modules-preview-main, #modules-preview-main h1, ",w+="#modules-preview-main h2, ",w+="#modules-preview-main h3, ",w+="#modules-preview-main h4, ",w+="#modules-preview-main p, ",w+="#modules-preview-main .title > *:not(.fr-wrapper):first-child, ",w+="#modules-edit-main .title > *:not(.fr-wrapper):first-child, ",w+="#modules-preview-main .title .fr-view > *:first-child, ",w+="#modules-edit-main .title .fr-view > *:first-child { ",w+="color: "+T+"; ",w+="} ",w+="#modules-edit-main .module, #modules-preview-main .module { ",w+="border-color: "+T+"; ",w+="color: "+T+"; ",w+="} ",w+="#modules-preview-main .text-module .name, ",w+="#modules-preview-main .text-module .fr-view > ul, ",w+="#modules-preview-main .text-module .fr-view > ol, ",w+="#modules-edit-main .text-module .name, ",w+="#modules-edit-main .text-module .fr-view > ul, ",w+="#modules-edit-main .text-module .fr-view > ol {",w+="color: "+T+"; ",w+="} ";var x="<style id='defaultColor' type='text/css'> "+w+" </style>";$(x).appendTo("head"),e.teamDefaultColorStyles=x}}$.fn.editor=function(o,i,l,c){function d(){var e=f.text(),t=!e&&!f.find("img, video, audio, iframe, table, embedly, lineHeight").length;t?(f.froalaEditor("html.set",p),e=p):e=v(),i[l]!=e&&(i[l]=e,o.save(),c.onSave&&c.onSave(e),C())}function u(e){if(!c.cleanPTags)return e;var t=$("<div>"+e+"</div>").find("p").length;if(t>1){var a="<p>"+$(e).text()+"</p>";return a}return e}function m(){var e=u(v());if(e=s(e),console.log(e.length),!(e.length>55e3)){var t=h.patch_make(i[l],h.diff_main(i[l],e,!0));o.Data[l]&&(o.Data[l]=e),i[l]=e,a.sync(o,l+(c.index||""),t)}}var f=this,p="",h=new diff_match_patch;c=c||{},i[l]=i[l]||p,c.url&&(c.noHtml=!0);var g=c.noHtml?b:$.extend({},y);g.multiLine=!0,g.enter=$.FroalaEditor.ENTER_BR,g.htmlAllowedEmptyTags=["textarea","a","iframe","object","video","style","script",".fa","p","br"];var v=function(){var e=f.froalaEditor("html.get");return c.noHtml&&(e=$("<div>").html(e).text()),e},C=function(){o.renderPreview(),o.factory.folio.Role<2&&o.save(),c.changed&&c.changed()};return f.unstyle=function(){var e=v(),t="h1, h2, h3, h4, h5, h6";e=$("<div>").html(e),"Title"==l&&(t+=", > p:first-child"),e.find(t).removeAttr("style").find("*").removeAttr("style"),f.froalaEditor("html.set",e.html()),d()},f.html(i[l]||p).froalaEditor(g).on("froalaEditor.contentChanged",function(){m(),C()}).on("froalaEditor.blur",d).on("froalaEditor.image.error",function(e,a,o,i){if(5==o.code){var s=a.popups.get("image.insert"),r=s.find(".fr-image-progress-bar-layer");n?(r.find("h3").text("File size exceeds the 1MB limit,  but if you upgrade to a premium plan you can upload images up to 5MB."),t.raiseEvent("free-exceedsize")):r.find("h3").text("The image is too big. Maximum size for uploads is 5MB.")}}).on("froalaEditor.image.beforeUpload",function(e,t,a){}),a.reg(o,l+(c.index||""),function(e,t){var a=v(),n=u(h.patch_apply(t,a)[0]);n=s(n),i[l]=n,f.froalaEditor("html.set",n),C()}),t.addListener("tokenRenewed",function(){r.__RequestVerificationToken=e.verificationToken,f.froalaEditor("option","imageUploadParams",r)}),t.addListener("fontAdded",function(e){}),f.data("unMountCb",function(){f.froalaEditor("destroy")}),f.on("froalaEditor.click",function(e,a,n){t.raiseEvent("froalaClick",{e:e,editor:a,clickEvent:n})}).on("froalaEditor.commands.after",function(e,a,n,o,i){switch(t.raiseEvent("froalaCmdAfter",{e:e,editor:a,cmd:n,param1:o,param2:i}),n){case"textColor":var s=f.froalaEditor("selection.blocks"),r=$(s[0]).parent(),l=r.prop("tagName");"LI"===l&&(r=$(s[0]).parent().parent(),l=r.prop("tagName")),console.log("parentTag",l),"UL"!==l&&"OL"!==l||r.css({color:o})}}).on("froalaEditor.commands.before",function(e,a,n,o,i){t.raiseEvent("froalaCmdBefore",{e:e,editor:a,cmd:n,param1:o,param2:i})}),f}},app.plugin.lockedTip=function(e,t){var a=function(e,t,a){var n=a;e.tooltip({container:"body",html:!0,trigger:"manual",placement:t,title:function(){return n}})},n=function(e,t,n){e.addClass("locked"),e.find(".fa-lock").remove(),e.append('<i class="fa fa-lock" data-html="true"></i>'),a(e.find(".fa-lock"),"bottom auto",t),setTimeout(function(){var t=null;e.mouseenter(function(){clearTimeout(t),e.tooltip("hide"),e.find(".fa-lock").tooltip("hide"),$(this).find(".fa-lock").tooltip("show")}).mouseleave(function(){$(".tooltip").remove(),$this=$(this),t=setTimeout(function(){$this.find(".fa-lock").tooltip("hide")},n)})},10),setTimeout(function(){app.plugin.tooltip()},100)};return{add:function(e,t,a){n(e,t,a)},remove:function(e){e.removeClass("locked"),e.find(".fa-lock").remove(),setTimeout(function(){app.plugin.tooltip()},100)}}},app.plugin.main=function(e,t,a,n){var o=this,i=t.apiHelper,s=t.appHub,r=t.eventManager,l=!0;l=(!e.Team||0===e.Team.Id)&&n.isFree(),o.froalaSetup(e,r,s,l),o.sliders(),o.uploader(e,i,n),o.misc(),o.social(),o.tooltip()},app.plugin.misc=function(){$.fn.unMount=function(){var e=this.data("unMountCb");e&&e()},$.fn.copier=function(){var e=this;return e.click(function(){e.select()}),e},$.fn.insertAt=function(e,t){var a=this;return e=Math.min(e,a.children().length),e<1?a.prepend(t):a.find("> :eq("+(e-1)+")").after(t),a}},!function(e){"use strict";var t=null,a=null,n=null;!function(){var t=["webkit","moz","o","ms"],a=e.document.createElement("div"),n=-1;for(n=0;n<t.length&&!e.requestAnimationFrame;n++)e.requestAnimationFrame=e[t[n]+"RequestAnimationFrame"];"undefined"==typeof a.nextElementSibling&&Object.defineProperty(e.Element.prototype,"nextElementSibling",{get:function(){for(var e=this.nextSibling;e;){if(1===e.nodeType)return e;e=e.nextSibling}return null}}),function(e){e.matches=e.matches||e.machesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){return Array.prototype.indexOf.call(this.parentElement.querySelectorAll(e),this)>-1}}(e.Element.prototype),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!1,a=[],n=-1;return t=!{toString:null}.propertyIsEnumerable("toString"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=a.length,function(o){var i=[],s="",r=-1;if("object"!=typeof o&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");for(s in o)e.call(o,s)&&i.push(s);if(t)for(r=0;r<n;r++)e.call(o,a[r])&&i.push(a[r]);return i}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return function(a,n){if(a!==Object(a)&&null!==a)throw TypeError("Argument must be an object, or null");t.prototype=a||{};var o=new t;return t.prototype=null,n!==e&&Object.defineProperties(o,n),null===a&&(o.__proto__=null),o}}()),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t,a,n,o;if(null===this)throw new TypeError;if(n=Object(this),o=n.length>>>0,0===o)return-1;if(t=0,arguments.length>1&&(t=Number(arguments[1]),t!==t?t=0:0!==t&&t!==1/0&&t!==-(1/0)&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=o)return-1;for(a=t>=0?t:Math.max(o-Math.abs(t),0);a<o;a++)if(a in n&&n[a]===e)return a;return-1}),Function.prototype.bind||(Function.prototype.bind=function(e){var t,a,n,o;if("function"!=typeof this)throw new TypeError;return t=Array.prototype.slice.call(arguments,1),a=this,n=function(){},o=function(){return a.apply(this instanceof n?this:e,t.concat(Array.prototype.slice.call(arguments)))},this.prototype&&(n.prototype=this.prototype),o.prototype=new n,o}),e.Element.prototype.dispatchEvent||(e.Element.prototype.dispatchEvent=function(e){try{return this.fireEvent("on"+e.type,e)}catch(t){}})}(),t=function(n,o,i){var s=null,r=!1,l=null,c=null,d=null,u=null,m=[],f="",p=[],h=-1;if(d=i||e.document,(r=arguments[3])&&(r="boolean"==typeof r),"string"==typeof n)p=d.querySelectorAll(n);else if(n&&"object"==typeof n&&a.isElement(n,d))p=[n];else{if(!n||"object"!=typeof n||!n.length)throw new Error(t.messages.errorFactoryInvalidContainer());p=n}if(p.length<1)throw new Error(t.messages.errorFactoryContainerNotFound());for(h=0;(s=p[h])&&(!(h>0)||r);h++)s.id?f=s.id:(f="MixItUp"+a.randomHex(),s.id=f),t.instances[f]instanceof t.Mixer?(l=t.instances[f],(!o||o&&o.debug&&o.debug.showWarnings!==!1)&&console.warn(t.messages.warningFactoryPreexistingInstance())):(l=new t.Mixer,l.attach(s,d,f,o),t.instances[f]=l),c=new t.Facade(l),o&&o.debug&&o.debug.enable?m.push(l):m.push(c);return u=r?new t.Collection(m):m[0]},t.use=function(e){t.Base.prototype.callActions.call(t,"beforeUse",arguments),"function"==typeof e&&"mixitup-extension"===e.TYPE?"undefined"==typeof t.extensions[e.NAME]&&(e(t),t.extensions[e.NAME]=e):e.fn&&e.fn.jquery&&(t.libraries.$=e,t.registerJqPlugin(e)),t.Base.prototype.callActions.call(t,"afterUse",arguments)},t.registerJqPlugin=function(e){e.fn.mixItUp=function(){var e=arguments[0],a=arguments[1],n=Array.prototype.slice.call(arguments,1),o=[],i=[];return i=this.each(function(){var i=null,s=null;e&&"string"==typeof e?(i=t.instances[this.id],s=i[e].apply(i,n),"undefined"!=typeof s&&null!==s&&"function"!=typeof s.then&&o.push(s)):t(this,a)}),o.length?o.length>1?o:o[0]:i}},t.instances={},t.extensions={},t.libraries={},a={hasClass:function(e,t){return!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){this.hasClass(e,t)||(e.className+=e.className?" "+t:t)},removeClass:function(e,t){if(this.hasClass(e,t)){var a=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(a," ").trim()}},extend:function(e,t,a,n){var o=[],i="",s=-1;a=a||!1,n=n||!1;try{if(Array.isArray(t))for(s=0;s<t.length;s++)o.push(s);else t&&(o=Object.keys(t));for(s=0;s<o.length;s++)i=o[s],!a||"object"!=typeof t[i]||this.isElement(t[i])?e[i]=t[i]:Array.isArray(t[i])?(e[i]||(e[i]=[]),this.extend(e[i],t[i],a,n)):(e[i]||(e[i]={}),this.extend(e[i],t[i],a,n))}catch(r){if(!n)throw r;this.handleExtendError(r,e)}return e},handleExtendError:function(e,a){var n=/property "?(\w*)"?[,:] object/i,o=null,i="",s="",r="",l="",c="",d=-1,u=-1;if(e instanceof TypeError&&(o=n.exec(e.message))){i=o[1];for(c in a){for(u=0;u<i.length&&i.charAt(u)===c.charAt(u);)u++;u>d&&(d=u,l=c)}throw d>1&&(r=t.messages.errorConfigInvalidPropertySuggestion({probableMatch:l})),s=t.messages.errorConfigInvalidProperty({erroneous:i,suggestion:r}),new TypeError(s)}throw e},template:function(e){for(var t=/\${([\w]*)}/g,a={},n=null;n=t.exec(e);)a[n[1]]=new RegExp("\\${"+n[1]+"}","g");return function(t){var n="",o=e;t=t||{};for(n in a)o=o.replace(a[n],"undefined"!=typeof t[n]?t[n]:"");return o}},on:function(t,a,n,o){t&&(t.addEventListener?t.addEventListener(a,n,o):t.attachEvent&&(t["e"+a+n]=n,t[a+n]=function(){t["e"+a+n](e.event)},t.attachEvent("on"+a,t[a+n])))},off:function(e,t,a){e&&(e.removeEventListener?e.removeEventListener(t,a,!1):e.detachEvent&&(e.detachEvent("on"+t,e[t+a]),e[t+a]=null))},getCustomEvent:function(t,a,n){var o=null;return n=n||e.document,"function"==typeof e.CustomEvent?o=new e.CustomEvent(t,{detail:a,bubbles:!0,cancelable:!0}):"function"==typeof n.createEvent?(o=n.createEvent("CustomEvent"),o.initCustomEvent(t,!0,!0,a)):(o=n.createEventObject(),o.type=t,o.returnValue=!1,o.cancelBubble=!1,o.detail=a),o},getOriginalEvent:function(e){return e.touches&&e.touches.length?e.touches[0]:e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e},index:function(e,t){for(var a=0;null!==(e=e.previousElementSibling);)t&&!e.matches(t)||++a;return a},camelCase:function(e){return e.toLowerCase().replace(/([_-][a-z])/g,function(e){return e.toUpperCase().replace(/[_-]/,"")})},pascalCase:function(e){return(e=this.camelCase(e)).charAt(0).toUpperCase()+e.slice(1)},dashCase:function(e){return e.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()},isElement:function(t,a){return a=a||e.document,!!(e.HTMLElement&&t instanceof e.HTMLElement)||!!(a.defaultView&&a.defaultView.HTMLElement&&t instanceof a.defaultView.HTMLElement)||null!==t&&1===t.nodeType&&"string"==typeof t.nodeName},createElement:function(t,a){var n=null,o=null;for(a=a||e.document,n=a.createDocumentFragment(),o=a.createElement("div"),o.innerHTML=t;o.firstChild;)n.appendChild(o.firstChild);return n},removeWhitespace:function(e){for(var t;e&&"#text"===e.nodeName;)t=e,e=e.previousSibling,t.parentElement&&t.parentElement.removeChild(t)},isEqualArray:function(e,t){var a=e.length;if(a!==t.length)return!1;for(;a--;)if(e[a]!==t[a])return!1;return!0},deepEquals:function(e,t){var a;if("object"==typeof e&&e&&"object"==typeof t&&t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(a in e)if(!t.hasOwnProperty(a)||!this.deepEquals(e[a],t[a]))return!1}else if(e!==t)return!1;return!0},arrayShuffle:function(e){for(var t=e.slice(),a=t.length,n=a,o=-1,i=[];n--;)o=~~(Math.random()*a),i=t[n],t[n]=t[o],t[o]=i;return t},arrayFromList:function(e){var t,a;try{return Array.prototype.slice.call(e)}catch(n){for(t=[],a=0;a<e.length;a++)t.push(e[a]);return t}},debounce:function(e,t,a){var n;return function(){var o=this,i=arguments,s=a&&!n,r=null;r=function(){n=null,a||e.apply(o,i)},clearTimeout(n),n=setTimeout(r,t),s&&e.apply(o,i)}},position:function(e){for(var t=0,a=0,n=e;e;)t-=e.scrollLeft,a-=e.scrollTop,e===n&&(t+=e.offsetLeft,a+=e.offsetTop,n=e.offsetParent),e=e.parentElement;return{x:t,y:a}},getHypotenuse:function(e,t){var a=e.x-t.x,n=e.y-t.y;return a=a<0?a*-1:a,n=n<0?n*-1:n,Math.sqrt(Math.pow(a,2)+Math.pow(n,2))},getIntersectionRatio:function(e,t){var a=e.width*e.height,n=-1,o=-1,i=-1,s=-1;return n=Math.max(0,Math.min(e.left+e.width,t.left+t.width)-Math.max(e.left,t.left)),o=Math.max(0,Math.min(e.top+e.height,t.top+t.height)-Math.max(e.top,t.top)),i=o*n,s=i/a},closestParent:function(t,a,n,o){var i=t.parentNode;if(o=o||e.document,n&&t.matches(a))return t;for(;i&&i!=o.body;){if(i.matches&&i.matches(a))return i;if(!i.parentNode)return null;i=i.parentNode}return null},children:function(t,a,n){var o=[],i="";return n=n||e.doc,t&&(t.id||(i="Temp"+this.randomHexKey(),t.id=i),o=n.querySelectorAll("#"+t.id+" > "+a),i&&t.removeAttribute("id")),o},clean:function(e){var t=[],a=-1;for(a=0;a<e.length;a++)""!==e[a]&&t.push(e[a]);return t},defer:function(a){var n=null,o=null,i=null;return o=new this.Deferred,t.features.has.promises?o.promise=new Promise(function(e,t){o.resolve=e,o.reject=t}):(i=e.jQuery||a.$)&&"function"==typeof i.Deferred?(n=i.Deferred(),o.promise=n.promise(),o.resolve=n.resolve,o.reject=n.reject):e.console&&console.warn(t.messages.warningNoPromiseImplementation()),o},all:function(a,n){var o=null;return t.features.has.promises?Promise.all(a):(o=e.jQuery||n.$)&&"function"==typeof o.when?o.when.apply(o,a).done(function(){return arguments}):(e.console&&console.warn(t.messages.warningNoPromiseImplementation()),[])},getPrefix:function(e,t,n){var o=-1,i="";if(a.dashCase(t)in e.style)return"";for(o=0;i=n[o];o++)if(i+t in e.style)return i.toLowerCase();return"unsupported"},randomHex:function(){return("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6).toUpperCase()},getDocumentState:function(t){return t="object"==typeof t.body?t:e.document,{scrollTop:e.pageYOffset,scrollLeft:e.pageXOffset,docHeight:t.documentElement.scrollHeight}},bind:function(e,t){return function(){return t.apply(e,arguments)}},isVisible:function(t){var a=null;return!!t.offsetParent||(a=e.getComputedStyle(t),"fixed"===a.position&&"hidden"!==a.visibility&&"0"!==a.opacity)},seal:function(e){"function"==typeof Object.seal&&Object.seal(e)},freeze:function(e){"function"==typeof Object.freeze&&Object.freeze(e)},compareVersions:function(e,t){var a=e.split("."),n=t.split("."),o=-1,i=-1,s=-1;for(s=0;s<a.length;s++){if(o=parseInt(a[s].replace(/[^\d.]/g,"")),i=parseInt(n[s].replace(/[^\d.]/g,"")||0),i<o)return!1;if(i>o)return!0}return!0},Deferred:function(){this.promise=null,this.resolve=null,this.reject=null,this.id=a.randomHex()},isEmptyObject:function(e){var t="";if("function"==typeof Object.keys)return 0===Object.keys(e).length;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},getClassname:function(e,t,a){var n="";return n+=e.block,n.length&&(n+=e.delineatorElement),n+=e["element"+this.pascalCase(t)],a?(n.length&&(n+=e.delineatorModifier),n+=a):n},getProperty:function(e,t){var a=t.split("."),n=null,o="",i=0;if(!t)return e;for(n=function(e){return e?e[o]:null};i<a.length;)o=a[i],e=n(e),i++;return"undefined"!=typeof e?e:null}},t.h=a,t.Base=function(){},t.Base.prototype={constructor:t.Base,callActions:function(e,t){var n=this,o=n.constructor.actions[e],i="";if(o&&!a.isEmptyObject(o))for(i in o)o[i].apply(n,t)},callFilters:function(e,t,n){var o=this,i=o.constructor.filters[e],s=t,r="";if(!i||a.isEmptyObject(i))return s;n=n||[];for(r in i)n=a.arrayFromList(n),n.unshift(s),s=i[r].apply(o,n);return s}},t.BaseStatic=function(){this.actions={},this.filters={},this.extend=function(e){a.extend(this.prototype,e)},this.registerAction=function(e,t,a){(this.actions[e]=this.actions[e]||{})[t]=a},this.registerFilter=function(e,t,a){(this.filters[e]=this.filters[e]||{})[t]=a}},t.Features=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.boxSizingPrefix="",this.transformPrefix="",this.transitionPrefix="",this.boxSizingPrefix="",this.transformProp="",this.transformRule="",this.transitionProp="",this.perspectiveProp="",this.perspectiveOriginProp="",this.has=new t.Has,this.canary=null,this.BOX_SIZING_PROP="boxSizing",this.TRANSITION_PROP="transition",this.TRANSFORM_PROP="transform",this.PERSPECTIVE_PROP="perspective",this.PERSPECTIVE_ORIGIN_PROP="perspectiveOrigin",this.VENDORS=["Webkit","moz","O","ms"],this.TWEENABLE=["opacity","width","height","marginRight","marginBottom","x","y","scale","translateX","translateY","translateZ","rotateX","rotateY","rotateZ"],this.callActions("afterConstruct")},t.BaseStatic.call(t.Features),t.Features.prototype=Object.create(t.Base.prototype),a.extend(t.Features.prototype,{constructor:t.Features,init:function(){var e=this;e.callActions("beforeInit",arguments),e.canary=document.createElement("div"),e.setPrefixes(),e.runTests(),e.callActions("beforeInit",arguments)},runTests:function(){var t=this;t.callActions("beforeRunTests",arguments),t.has.promises="function"==typeof e.Promise,t.has.transitions="unsupported"!==t.transitionPrefix,t.callActions("afterRunTests",arguments),a.freeze(t.has)},setPrefixes:function(){var e=this;e.callActions("beforeSetPrefixes",arguments),e.transitionPrefix=a.getPrefix(e.canary,"Transition",e.VENDORS),e.transformPrefix=a.getPrefix(e.canary,"Transform",e.VENDORS),e.boxSizingPrefix=a.getPrefix(e.canary,"BoxSizing",e.VENDORS),e.boxSizingProp=e.boxSizingPrefix?e.boxSizingPrefix+a.pascalCase(e.BOX_SIZING_PROP):e.BOX_SIZING_PROP,e.transitionProp=e.transitionPrefix?e.transitionPrefix+a.pascalCase(e.TRANSITION_PROP):e.TRANSITION_PROP,e.transformProp=e.transformPrefix?e.transformPrefix+a.pascalCase(e.TRANSFORM_PROP):e.TRANSFORM_PROP,e.transformRule=e.transformPrefix?"-"+e.transformPrefix+"-"+e.TRANSFORM_PROP:e.TRANSFORM_PROP,e.perspectiveProp=e.transformPrefix?e.transformPrefix+a.pascalCase(e.PERSPECTIVE_PROP):e.PERSPECTIVE_PROP,e.perspectiveOriginProp=e.transformPrefix?e.transformPrefix+a.pascalCase(e.PERSPECTIVE_ORIGIN_PROP):e.PERSPECTIVE_ORIGIN_PROP,e.callActions("afterSetPrefixes",arguments)}}),t.Has=function(){this.transitions=!1,this.promises=!1,a.seal(this)},t.features=new t.Features,t.features.init(),t.ConfigAnimation=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.enable=!0,this.effects="fade scale",this.effectsIn="",this.effectsOut="",this.duration=600,this.easing="ease",this.applyPerspective=!0,this.perspectiveDistance="3000px",this.perspectiveOrigin="50% 50%",this.queue=!0,this.queueLimit=3,this.animateResizeContainer=!0,this.animateResizeTargets=!1,this.staggerSequence=null,this.reverseOut=!1,this.nudge=!0,this.clampHeight=!0,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigAnimation),t.ConfigAnimation.prototype=Object.create(t.Base.prototype),t.ConfigAnimation.prototype.constructor=t.ConfigAnimation,t.ConfigCallbacks=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.onMixStart=null,this.onMixBusy=null,this.onMixEnd=null,this.onMixFail=null,this.onMixClick=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigCallbacks),t.ConfigCallbacks.prototype=Object.create(t.Base.prototype),t.ConfigCallbacks.prototype.constructor=t.ConfigCallbacks,t.ConfigControls=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.enable=!0,this.live=!1,this.scope="global",this.toggleLogic="or",this.toggleDefault="all",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigControls),t.ConfigControls.prototype=Object.create(t.Base.prototype),t.ConfigControls.prototype.constructor=t.ConfigControls,t.ConfigClassNames=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.block="mixitup",this.elementContainer="container",this.elementFilter="control",this.elementSort="control",this.elementMultimix="control",this.elementToggle="control",this.modifierActive="active",this.modifierDisabled="disabled",this.modifierFailed="failed",this.delineatorElement="-",this.delineatorModifier="-",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigClassNames),t.ConfigClassNames.prototype=Object.create(t.Base.prototype),t.ConfigClassNames.prototype.constructor=t.ConfigClassNames,t.ConfigData=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.uidKey="",this.dirtyCheck=!1,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigData),t.ConfigData.prototype=Object.create(t.Base.prototype),t.ConfigData.prototype.constructor=t.ConfigData,t.ConfigDebug=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.enable=!1,this.showWarnings=!0,this.fauxAsync=!1,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigDebug),t.ConfigDebug.prototype=Object.create(t.Base.prototype),t.ConfigDebug.prototype.constructor=t.ConfigDebug,t.ConfigLayout=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.allowNestedTargets=!0,this.containerClassName="",this.siblingBefore=null,this.siblingAfter=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigLayout),t.ConfigLayout.prototype=Object.create(t.Base.prototype),t.ConfigLayout.prototype.constructor=t.ConfigLayout,t.ConfigLoad=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.filter="all",this.sort="default:asc",this.dataset=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigLoad),t.ConfigLoad.prototype=Object.create(t.Base.prototype),t.ConfigLoad.prototype.constructor=t.ConfigLoad,t.ConfigSelectors=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.target=".mix",this.control="",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigSelectors),t.ConfigSelectors.prototype=Object.create(t.Base.prototype),t.ConfigSelectors.prototype.constructor=t.ConfigSelectors,t.ConfigRender=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.target=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigRender),t.ConfigRender.prototype=Object.create(t.Base.prototype),t.ConfigRender.prototype.constructor=t.ConfigRender,t.ConfigTemplates=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.ConfigTemplates),t.ConfigTemplates.prototype=Object.create(t.Base.prototype),t.ConfigTemplates.prototype.constructor=t.ConfigTemplates,t.Config=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.animation=new t.ConfigAnimation,this.callbacks=new t.ConfigCallbacks,this.controls=new t.ConfigControls,this.classNames=new t.ConfigClassNames,this.data=new t.ConfigData,this.debug=new t.ConfigDebug,this.layout=new t.ConfigLayout,this.load=new t.ConfigLoad,this.selectors=new t.ConfigSelectors,this.render=new t.ConfigRender,this.templates=new t.ConfigTemplates,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Config),t.Config.prototype=Object.create(t.Base.prototype),t.Config.prototype.constructor=t.Config,t.MixerDom=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.document=null,this.body=null,this.container=null,this.parent=null,this.targets=[],this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.MixerDom),t.MixerDom.prototype=Object.create(t.Base.prototype),t.MixerDom.prototype.constructor=t.MixerDom,t.UiClassNames=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.base="",this.active="",this.disabled="",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.UiClassNames),t.UiClassNames.prototype=Object.create(t.Base.prototype),t.UiClassNames.prototype.constructor=t.UiClassNames,t.CommandDataset=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.dataset=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandDataset),t.CommandDataset.prototype=Object.create(t.Base.prototype),t.CommandDataset.prototype.constructor=t.CommandDataset,t.CommandMultimix=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.filter=null,this.sort=null,this.insert=null,this.remove=null,this.changeLayout=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandMultimix),t.CommandMultimix.prototype=Object.create(t.Base.prototype),t.CommandMultimix.prototype.constructor=t.CommandMultimix,t.CommandFilter=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.selector="",this.collection=null,this.action="show",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandFilter),t.CommandFilter.prototype=Object.create(t.Base.prototype),t.CommandFilter.prototype.constructor=t.CommandFilter,t.CommandSort=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.sortString="",this.attribute="",this.order="asc",this.collection=null,this.next=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandSort),t.CommandSort.prototype=Object.create(t.Base.prototype),t.CommandSort.prototype.constructor=t.CommandSort,t.CommandInsert=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.index=0,this.collection=[],this.position="before",this.sibling=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandInsert),t.CommandInsert.prototype=Object.create(t.Base.prototype),t.CommandInsert.prototype.constructor=t.CommandInsert,t.CommandRemove=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.targets=[],this.collection=[],this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandRemove),t.CommandRemove.prototype=Object.create(t.Base.prototype),t.CommandRemove.prototype.constructor=t.CommandRemove,t.CommandChangeLayout=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.containerClassName="",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.CommandChangeLayout),t.CommandChangeLayout.prototype=Object.create(t.Base.prototype),t.CommandChangeLayout.prototype.constructor=t.CommandChangeLayout,t.ControlDefinition=function(e,n,o,i){t.Base.call(this),this.callActions("beforeConstruct"),this.type=e,this.selector=n,this.live=o||!1,this.parent=i||"",this.callActions("afterConstruct"),a.freeze(this),a.seal(this)},t.BaseStatic.call(t.ControlDefinition),t.ControlDefinition.prototype=Object.create(t.Base.prototype),t.ControlDefinition.prototype.constructor=t.ControlDefinition,t.controlDefinitions=[],t.controlDefinitions.push(new t.ControlDefinition("multimix","[data-filter][data-sort]")),t.controlDefinitions.push(new t.ControlDefinition("filter","[data-filter]")),t.controlDefinitions.push(new t.ControlDefinition("sort","[data-sort]")),t.controlDefinitions.push(new t.ControlDefinition("toggle","[data-toggle]")),t.Control=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.el=null,this.selector="",this.bound=[],this.pending=-1,this.type="",this.status="inactive",this.filter="",this.sort="",this.canDisable=!1,this.handler=null,this.classNames=new t.UiClassNames,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Control),t.Control.prototype=Object.create(t.Base.prototype),a.extend(t.Control.prototype,{constructor:t.Control,init:function(e,a,n){var o=this;if(this.callActions("beforeInit",arguments),o.el=e,o.type=a,o.selector=n,o.selector)o.status="live";else switch(o.canDisable="boolean"==typeof o.el.disable,o.type){case"filter":o.filter=o.el.getAttribute("data-filter");break;case"toggle":o.filter=o.el.getAttribute("data-toggle");break;case"sort":o.sort=o.el.getAttribute("data-sort");break;case"multimix":o.filter=o.el.getAttribute("data-filter"),o.sort=o.el.getAttribute("data-sort")}o.bindClick(),t.controls.push(o),this.callActions("afterInit",arguments)},isBound:function(e){var t=this,a=!1;return this.callActions("beforeIsBound",arguments),a=t.bound.indexOf(e)>-1,t.callFilters("afterIsBound",a,arguments)},addBinding:function(e){var t=this;this.callActions("beforeAddBinding",arguments),t.isBound()||t.bound.push(e),this.callActions("afterAddBinding",arguments)},removeBinding:function(e){var a=this,n=-1;this.callActions("beforeRemoveBinding",arguments),(n=a.bound.indexOf(e))>-1&&a.bound.splice(n,1),a.bound.length<1&&(a.unbindClick(),
n=t.controls.indexOf(a),t.controls.splice(n,1),"active"===a.status&&a.renderStatus(a.el,"inactive")),this.callActions("afterRemoveBinding",arguments)},bindClick:function(){var e=this;this.callActions("beforeBindClick",arguments),e.handler=function(t){e.handleClick(t)},a.on(e.el,"click",e.handler),this.callActions("afterBindClick",arguments)},unbindClick:function(){var e=this;this.callActions("beforeUnbindClick",arguments),a.off(e.el,"click",e.handler),e.handler=null,this.callActions("afterUnbindClick",arguments)},handleClick:function(e){var n=this,o=null,i=null,s=!1,r=void 0,l={},c=null,d=[],u=-1;if(this.callActions("beforeHandleClick",arguments),this.pending=0,i=n.bound[0],o=n.selector?a.closestParent(e.target,i.config.selectors.control+n.selector,!0,i.dom.document):n.el,!o)return void n.callActions("afterHandleClick",arguments);switch(n.type){case"filter":l.filter=n.filter||o.getAttribute("data-filter");break;case"sort":l.sort=n.sort||o.getAttribute("data-sort");break;case"multimix":l.filter=n.filter||o.getAttribute("data-filter"),l.sort=n.sort||o.getAttribute("data-sort");break;case"toggle":l.filter=n.filter||o.getAttribute("data-toggle"),s="live"===n.status?a.hasClass(o,n.classNames.active):"active"===n.status}for(u=0;u<n.bound.length;u++)c=new t.CommandMultimix,a.extend(c,l),d.push(c);for(d=n.callFilters("commandsHandleClick",d,arguments),n.pending=n.bound.length,u=0;i=n.bound[u];u++)l=d[u],l&&(i.lastClicked||(i.lastClicked=o),t.events.fire("mixClick",i.dom.container,{state:i.state,instance:i,originalEvent:e,control:i.lastClicked},i.dom.document),"function"==typeof i.config.callbacks.onMixClick&&(r=i.config.callbacks.onMixClick.call(i.lastClicked,i.state,e,i),r===!1)||("toggle"===n.type?s?i.toggleOff(l.filter):i.toggleOn(l.filter):i.multimix(l)));this.callActions("afterHandleClick",arguments)},update:function(e,a){var n=this,o=new t.CommandMultimix;n.callActions("beforeUpdate",arguments),n.pending--,n.pending=Math.max(0,n.pending),n.pending>0||("live"===n.status?n.updateLive(e,a):(o.sort=n.sort,o.filter=n.filter,n.callFilters("actionsUpdate",o,arguments),n.parseStatusChange(n.el,e,o,a)),n.callActions("afterUpdate",arguments))},updateLive:function(e,a){var n=this,o=null,i=null,s=null,r=-1;if(n.callActions("beforeUpdateLive",arguments),n.el){for(o=n.el.querySelectorAll(n.selector),r=0;s=o[r];r++){switch(i=new t.CommandMultimix,n.type){case"filter":i.filter=s.getAttribute("data-filter");break;case"sort":i.sort=s.getAttribute("data-sort");break;case"multimix":i.filter=s.getAttribute("data-filter"),i.sort=s.getAttribute("data-sort");break;case"toggle":i.filter=s.getAttribute("data-toggle")}i=n.callFilters("actionsUpdateLive",i,arguments),n.parseStatusChange(s,e,i,a)}n.callActions("afterUpdateLive",arguments)}},parseStatusChange:function(e,t,a,n){var o=this,i="",s="",r=-1;switch(o.callActions("beforeParseStatusChange",arguments),o.type){case"filter":t.filter===a.filter?o.renderStatus(e,"active"):o.renderStatus(e,"inactive");break;case"multimix":t.sort===a.sort&&t.filter===a.filter?o.renderStatus(e,"active"):o.renderStatus(e,"inactive");break;case"sort":t.sort.match(/:asc/g)&&(i=t.sort.replace(/:asc/g,"")),t.sort===a.sort||i===a.sort?o.renderStatus(e,"active"):o.renderStatus(e,"inactive");break;case"toggle":for(n.length<1&&o.renderStatus(e,"inactive"),t.filter===a.filter&&o.renderStatus(e,"active"),r=0;r<n.length;r++){if(s=n[r],s===a.filter){o.renderStatus(e,"active");break}o.renderStatus(e,"inactive")}}o.callActions("afterParseStatusChange",arguments)},renderStatus:function(e,t){var n=this;switch(n.callActions("beforeRenderStatus",arguments),t){case"active":a.addClass(e,n.classNames.active),a.removeClass(e,n.classNames.disabled),n.canDisable&&(n.el.disabled=!1);break;case"inactive":a.removeClass(e,n.classNames.active),a.removeClass(e,n.classNames.disabled),n.canDisable&&(n.el.disabled=!1);break;case"disabled":n.canDisable&&(n.el.disabled=!0),a.addClass(e,n.classNames.disabled),a.removeClass(e,n.classNames.active)}"live"!==n.status&&(n.status=t),n.callActions("afterRenderStatus",arguments)}}),t.controls=[],t.StyleData=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.x=0,this.y=0,this.top=0,this.right=0,this.bottom=0,this.left=0,this.width=0,this.height=0,this.marginRight=0,this.marginBottom=0,this.opacity=0,this.scale=new t.TransformData,this.translateX=new t.TransformData,this.translateY=new t.TransformData,this.translateZ=new t.TransformData,this.rotateX=new t.TransformData,this.rotateY=new t.TransformData,this.rotateZ=new t.TransformData,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.StyleData),t.StyleData.prototype=Object.create(t.Base.prototype),t.StyleData.prototype.constructor=t.StyleData,t.TransformData=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.value=0,this.unit="",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.TransformData),t.TransformData.prototype=Object.create(t.Base.prototype),t.TransformData.prototype.constructor=t.TransformData,t.TransformDefaults=function(){t.StyleData.apply(this),this.callActions("beforeConstruct"),this.scale.value=.01,this.scale.unit="",this.translateX.value=20,this.translateX.unit="px",this.translateY.value=20,this.translateY.unit="px",this.translateZ.value=20,this.translateZ.unit="px",this.rotateX.value=90,this.rotateX.unit="deg",this.rotateY.value=90,this.rotateY.unit="deg",this.rotateX.value=90,this.rotateX.unit="deg",this.rotateZ.value=180,this.rotateZ.unit="deg",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.TransformDefaults),t.TransformDefaults.prototype=Object.create(t.StyleData.prototype),t.TransformDefaults.prototype.constructor=t.TransformDefaults,t.transformDefaults=new t.TransformDefaults,t.EventDetail=function(){this.state=null,this.futureState=null,this.instance=null,this.originalEvent=null},t.Events=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.mixStart=null,this.mixBusy=null,this.mixEnd=null,this.mixFail=null,this.mixClick=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Events),t.Events.prototype=Object.create(t.Base.prototype),t.Events.prototype.constructor=t.Events,t.Events.prototype.fire=function(e,n,o,i){var s=this,r=null,l=new t.EventDetail;if(s.callActions("beforeFire",arguments),"undefined"==typeof s[e])throw new Error('Event type "'+e+'" not found.');l.state=new t.State,a.extend(l.state,o.state),o.futureState&&(l.futureState=new t.State,a.extend(l.futureState,o.futureState)),l.instance=o.instance,o.originalEvent&&(l.originalEvent=o.originalEvent),r=a.getCustomEvent(e,l,i),s.callFilters("eventFire",r,arguments),n.dispatchEvent(r)},t.events=new t.Events,t.QueueItem=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.args=[],this.instruction=null,this.triggerElement=null,this.deferred=null,this.isToggling=!1,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.QueueItem),t.QueueItem.prototype=Object.create(t.Base.prototype),t.QueueItem.prototype.constructor=t.QueueItem,t.Mixer=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.config=new t.Config,this.id="",this.isBusy=!1,this.isToggling=!1,this.incPadding=!0,this.controls=[],this.targets=[],this.origOrder=[],this.cache={},this.toggleArray=[],this.targetsMoved=0,this.targetsImmovable=0,this.targetsBound=0,this.targetsDone=0,this.staggerDuration=0,this.effectsIn=null,this.effectsOut=null,this.transformIn=[],this.transformOut=[],this.queue=[],this.state=null,this.lastOperation=null,this.lastClicked=null,this.userCallback=null,this.userDeferred=null,this.dom=new t.MixerDom,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Mixer),t.Mixer.prototype=Object.create(t.Base.prototype),a.extend(t.Mixer.prototype,{constructor:t.Mixer,attach:function(n,o,i,s){var r=this,l=null,c=-1;for(r.callActions("beforeAttach",arguments),r.id=i,s&&a.extend(r.config,s,!0,!0),r.sanitizeConfig(),r.cacheDom(n,o),r.config.layout.containerClassName&&a.addClass(r.dom.container,r.config.layout.containerClassName),t.features.has.transitions||(r.config.animation.enable=!1),"undefined"==typeof e.console&&(r.config.debug.showWarnings=!1),r.config.data.uidKey&&(r.config.controls.enable=!1),r.indexTargets(),r.state=r.getInitialState(),c=0;l=r.lastOperation.toHide[c];c++)l.hide();r.config.controls.enable&&(r.initControls(),r.updateControls({filter:r.state.activeFilter,sort:r.state.activeSort}),r.buildToggleArray(null,r.state)),r.parseEffects(),r.callActions("afterAttach",arguments)},sanitizeConfig:function(){var e=this;e.callActions("beforeSanitizeConfig",arguments),e.config.controls.scope=e.config.controls.scope.toLowerCase().trim(),e.config.controls.toggleLogic=e.config.controls.toggleLogic.toLowerCase().trim(),e.config.controls.toggleDefault=e.config.controls.toggleDefault.toLowerCase().trim(),e.config.animation.effects=e.config.animation.effects.trim(),e.callActions("afterSanitizeConfig",arguments)},getInitialState:function(){var e=this,a=new t.State,n=new t.Operation;if(e.callActions("beforeGetInitialState",arguments),a.activeContainerClassName=e.config.layout.containerClassName,e.config.load.dataset){if(!e.config.data.uidKey||"string"!=typeof e.config.data.uidKey)throw new TypeError(t.messages.errorConfigDataUidKeyNotSet());n.startDataset=n.newDataset=a.activeDataset=e.config.load.dataset.slice(),n.startContainerClassName=n.newContainerClassName=a.activeContainerClassName,n.show=e.targets.slice(),a=e.callFilters("stateGetInitialState",a,arguments)}else a.activeFilter=e.parseFilterArgs([e.config.load.filter]).command,a.activeSort=e.parseSortArgs([e.config.load.sort]).command,a.totalTargets=e.targets.length,a=e.callFilters("stateGetInitialState",a,arguments),a.activeSort.collection||a.activeSort.attribute||"random"===a.activeSort.order||"desc"===a.activeSort.order?(n.newSort=a.activeSort,e.sortOperation(n),e.printSort(!1,n),e.targets=n.newOrder):n.startOrder=n.newOrder=e.targets,n.startFilter=n.newFilter=a.activeFilter,n.startSort=n.newSort=a.activeSort,n.startContainerClassName=n.newContainerClassName=a.activeContainerClassName,"all"===n.newFilter.selector?n.newFilter.selector=e.config.selectors.target:"none"===n.newFilter.selector&&(n.newFilter.selector="");return n=e.callFilters("operationGetInitialState",n,[a]),e.lastOperation=n,n.newFilter&&e.filterOperation(n),a=e.buildState(n)},cacheDom:function(e,t){var a=this;a.callActions("beforeCacheDom",arguments),a.dom.document=t,a.dom.body=a.dom.document.querySelector("body"),a.dom.container=e,a.dom.parent=e,a.callActions("afterCacheDom",arguments)},indexTargets:function(){var e=this,n=null,o=null,i=null,s=-1;if(e.callActions("beforeIndexTargets",arguments),e.dom.targets=e.config.layout.allowNestedTargets?e.dom.container.querySelectorAll(e.config.selectors.target):a.children(e.dom.container,e.config.selectors.target,e.dom.document),e.dom.targets=a.arrayFromList(e.dom.targets),e.targets=[],(i=e.config.load.dataset)&&i.length!==e.dom.targets.length)throw new Error(t.messages.errorDatasetPrerenderedMismatch());if(e.dom.targets.length){for(s=0;o=e.dom.targets[s];s++)n=new t.Target,n.init(o,e,i?i[s]:void 0),n.isInDom=!0,e.targets.push(n);e.dom.parent=e.dom.targets[0].parentElement===e.dom.container?e.dom.container:e.dom.targets[0].parentElement}e.origOrder=e.targets,e.callActions("afterIndexTargets",arguments)},initControls:function(){var e=this,a="",n=null,o=null,i=null,s=null,r=null,l=-1,c=-1;switch(e.callActions("beforeInitControls",arguments),e.config.controls.scope){case"local":i=e.dom.container;break;case"global":i=e.dom.document;break;default:throw new Error(t.messages.errorConfigInvalidControlsScope())}for(l=0;a=t.controlDefinitions[l];l++)if(e.config.controls.live||a.live){if(a.parent){if(s=e.dom[a.parent],!s||s.length<0)continue;"number"!=typeof s.length&&(s=[s])}else s=[i];for(c=0;o=s[c];c++)r=e.getControl(o,a.type,a.selector),e.controls.push(r)}else for(n=i.querySelectorAll(e.config.selectors.control+a.selector),c=0;o=n[c];c++)r=e.getControl(o,a.type,""),r&&e.controls.push(r);e.callActions("afterInitControls",arguments)},getControl:function(e,n,o){var i=this,s=null,r=-1;if(i.callActions("beforeGetControl",arguments),!o)for(r=0;s=t.controls[r];r++){if(s.el===e&&s.isBound(i))return i.callFilters("controlGetControl",null,arguments);if(s.el===e&&s.type===n&&s.selector===o)return s.addBinding(i),i.callFilters("controlGetControl",s,arguments)}return s=new t.Control,s.init(e,n,o),s.classNames.base=a.getClassname(i.config.classNames,n),s.classNames.active=a.getClassname(i.config.classNames,n,i.config.classNames.modifierActive),s.classNames.disabled=a.getClassname(i.config.classNames,n,i.config.classNames.modifierDisabled),s.addBinding(i),i.callFilters("controlGetControl",s,arguments)},getToggleSelector:function(){var e=this,t="or"===e.config.controls.toggleLogic?", ":"",n="";return e.callActions("beforeGetToggleSelector",arguments),e.toggleArray=a.clean(e.toggleArray),n=e.toggleArray.join(t),""===n&&(n=e.config.controls.toggleDefault),e.callFilters("selectorGetToggleSelector",n,arguments)},buildToggleArray:function(e,t){var n=this,o="";if(n.callActions("beforeBuildToggleArray",arguments),e&&e.filter)o=e.filter.selector.replace(/\s/g,"");else{if(!t)return;o=t.activeFilter.selector.replace(/\s/g,"")}o!==n.config.selectors.target&&"all"!==o||(o=""),"or"===n.config.controls.toggleLogic?n.toggleArray=o.split(","):n.toggleArray=n.splitCompoundSelector(o),n.toggleArray=a.clean(n.toggleArray),n.callActions("afterBuildToggleArray",arguments)},splitCompoundSelector:function(e){var t=e.split(/([\.\[])/g),a=[],n="",o=-1;for(""===t[0]&&t.shift(),o=0;o<t.length;o++)o%2===0&&(n=""),n+=t[o],o%2!==0&&a.push(n);return a},updateControls:function(e){var n=this,o=null,i=new t.CommandMultimix,s=-1;for(n.callActions("beforeUpdateControls",arguments),e.filter?i.filter=e.filter.selector:i.filter=n.state.activeFilter.selector,e.sort?i.sort=n.buildSortString(e.sort):i.sort=n.buildSortString(n.state.activeSort),i.filter===n.config.selectors.target&&(i.filter="all"),""===i.filter&&(i.filter="none"),a.freeze(i),s=0;o=n.controls[s];s++)o.update(i,n.toggleArray);n.callActions("afterUpdateControls",arguments)},buildSortString:function(e){var t=this,a="";return a+=e.sortString,e.next&&(a+=" "+t.buildSortString(e.next)),a},insertTargets:function(e,n){var o=this,i=null,s=-1,r=null,l=null,c=null,d=-1;if(o.callActions("beforeInsertTargets",arguments),"undefined"==typeof e.index&&(e.index=0),i=o.getNextSibling(e.index,e.sibling,e.position),r=o.dom.document.createDocumentFragment(),s=i?a.index(i,o.config.selectors.target):o.targets.length,e.collection){for(d=0;c=e.collection[d];d++){if(o.dom.targets.indexOf(c)>-1)throw new Error(t.messages.errorInsertPreexistingElement());c.style.display="none",r.appendChild(c),r.appendChild(o.dom.document.createTextNode(" ")),a.isElement(c,o.dom.document)&&c.matches(o.config.selectors.target)&&(l=new t.Target,l.init(c,o),l.isInDom=!0,o.targets.splice(s,0,l),s++)}o.dom.parent.insertBefore(r,i)}n.startOrder=o.origOrder=o.targets,o.callActions("afterInsertTargets",arguments)},getNextSibling:function(e,t,a){var n=this,o=null;return e=Math.max(e,0),t&&"before"===a?o=t:t&&"after"===a?o=t.nextElementSibling||null:n.targets.length>0&&"undefined"!=typeof e?o=e<n.targets.length||!n.targets.length?n.targets[e].dom.el:n.targets[n.targets.length-1].dom.el.nextElementSibling:0===n.targets.length&&n.dom.parent.children.length>0&&(n.config.layout.siblingAfter?o=n.config.layout.siblingAfter:n.config.layout.siblingBefore?o=n.config.layout.siblingBefore.nextElementSibling:n.dom.parent.children[0]),n.callFilters("elementGetNextSibling",o,arguments)},filterOperation:function(e){var t=this,a=!1,n=-1,o="",i=null,s=-1;for(t.callActions("beforeFilterOperation",arguments),o=e.newFilter.action,s=0;i=e.newOrder[s];s++)a=e.newFilter.collection?e.newFilter.collection.indexOf(i.dom.el)>-1:""!==e.newFilter.selector&&i.dom.el.matches(e.newFilter.selector),t.evaluateHideShow(a,i,o,e);if(e.toRemove.length)for(s=0;i=e.show[s];s++)e.toRemove.indexOf(i)>-1&&(e.show.splice(s,1),(n=e.toShow.indexOf(i))>-1&&e.toShow.splice(n,1),e.toHide.push(i),e.hide.push(i),s--);e.matching=e.show.slice(),0===e.show.length&&""!==e.newFilter.selector&&0!==t.targets.length&&(e.hasFailed=!0),t.callActions("afterFilterOperation",arguments)},evaluateHideShow:function(e,t,a,n){var o=this;o.callActions("beforeEvaluateHideShow",arguments),e===!0&&"show"===a||e===!1&&"hide"===a?(n.show.push(t),!t.isShown&&n.toShow.push(t)):(n.hide.push(t),t.isShown&&n.toHide.push(t)),o.callActions("afterEvaluateHideShow",arguments)},sortOperation:function(e){var t=this;t.callActions("beforeSortOperation",arguments),e.startOrder=t.targets,e.newSort.collection?e.newOrder=e.newSort.collection:"random"===e.newSort.order?e.newOrder=a.arrayShuffle(e.startOrder):""===e.newSort.attribute?(e.newOrder=t.origOrder.slice(),"desc"===e.newSort.order&&e.newOrder.reverse()):(e.newOrder=e.startOrder.slice(),e.newOrder.sort(function(a,n){return t.compare(a,n,e.newSort)})),a.isEqualArray(e.newOrder,e.startOrder)&&(e.willSort=!1),t.callActions("afterSortOperation",arguments)},compare:function(e,t,a){var n=this,o=a.order,i=n.getAttributeValue(e,a.attribute),s=n.getAttributeValue(t,a.attribute);return isNaN(1*i)||isNaN(1*s)?(i=i.toLowerCase(),s=s.toLowerCase()):(i=1*i,s=1*s),i<s?"asc"===o?-1:1:i>s?"asc"===o?1:-1:i===s&&a.next?n.compare(e,t,a.next):0},getAttributeValue:function(e,a){var n=this,o="";return o=e.dom.el.getAttribute("data-"+a),null===o&&n.config.debug.showWarnings&&console.warn(t.messages.warningInconsistentSortingAttributes({attribute:"data-"+a})),n.callFilters("valueGetAttributeValue",o||0,arguments)},printSort:function(t,n){var o=this,i=t?n.newOrder:n.startOrder,s=t?n.startOrder:n.newOrder,r=i.length?i[i.length-1].dom.el.nextElementSibling:null,l=e.document.createDocumentFragment(),c=null,d=null,u=null,m=-1;for(o.callActions("beforePrintSort",arguments),m=0;d=i[m];m++)u=d.dom.el,"absolute"!==u.style.position&&(a.removeWhitespace(u.previousSibling),u.parentElement.removeChild(u));for(c=r?r.previousSibling:o.dom.parent.lastChild,c&&"#text"===c.nodeName&&a.removeWhitespace(c),m=0;d=s[m];m++)u=d.dom.el,a.isElement(l.lastChild)&&l.appendChild(e.document.createTextNode(" ")),l.appendChild(u);o.dom.parent.firstChild&&o.dom.parent.firstChild!==r&&l.insertBefore(e.document.createTextNode(" "),l.childNodes[0]),r?(l.appendChild(e.document.createTextNode(" ")),o.dom.parent.insertBefore(l,r)):o.dom.parent.appendChild(l),o.callActions("afterPrintSort",arguments)},parseSortString:function(e,n){var o=this,i=e.split(" "),s=n,r=[],l=-1;for(l=0;l<i.length;l++){switch(r=i[l].split(":"),s.sortString=i[l],s.attribute=a.dashCase(r[0]),s.order=r[1]||"asc",s.attribute){case"default":s.attribute="";break;case"random":s.attribute="",s.order="random"}if(!s.attribute||"random"===s.order)break;l<i.length-1&&(s.next=new t.CommandSort,a.freeze(s),s=s.next)}return o.callFilters("commandsParseSort",n,arguments)},parseEffects:function(){var e=this,a="",n=e.config.animation.effectsIn||e.config.animation.effects,o=e.config.animation.effectsOut||e.config.animation.effects;e.callActions("beforeParseEffects",arguments),e.effectsIn=new t.StyleData,e.effectsOut=new t.StyleData,e.transformIn=[],e.transformOut=[],e.effectsIn.opacity=e.effectsOut.opacity=1,e.parseEffect("fade",n,e.effectsIn,e.transformIn),e.parseEffect("fade",o,e.effectsOut,e.transformOut,!0);for(a in t.transformDefaults)t.transformDefaults[a]instanceof t.TransformData&&(e.parseEffect(a,n,e.effectsIn,e.transformIn),e.parseEffect(a,o,e.effectsOut,e.transformOut,!0));e.parseEffect("stagger",n,e.effectsIn,e.transformIn),e.parseEffect("stagger",o,e.effectsOut,e.transformOut,!0),e.callActions("afterParseEffects",arguments)},parseEffect:function(e,a,n,o,i){var s=this,r=/\(([^)]+)\)/,l=-1,c="",d=[],u="",m=["%","px","em","rem","vh","vw","deg"],f="",p=-1;if(s.callActions("beforeParseEffect",arguments),"string"!=typeof a)throw new TypeError(t.messages.errorConfigInvalidAnimationEffects());if(a.indexOf(e)<0)return void("stagger"===e&&(s.staggerDuration=0));switch(l=a.indexOf(e+"("),l>-1&&(c=a.substring(l),d=r.exec(c),u=d[1]),e){case"fade":n.opacity=u?parseFloat(u):0;break;case"stagger":s.staggerDuration=u?parseFloat(u):100;break;default:if(i&&s.config.animation.reverseOut&&"scale"!==e?n[e].value=(u?parseFloat(u):t.transformDefaults[e].value)*-1:n[e].value=u?parseFloat(u):t.transformDefaults[e].value,u){for(p=0;f=m[p];p++)if(u.indexOf(f)>-1){n[e].unit=f;break}}else n[e].unit=t.transformDefaults[e].unit;o.push(e+"("+n[e].value+n[e].unit+")")}s.callActions("afterParseEffect",arguments)},buildState:function(e){var a=this,n=new t.State,o=null,i=-1;for(a.callActions("beforeBuildState",arguments),i=0;o=a.targets[i];i++)(!e.toRemove.length||e.toRemove.indexOf(o)<0)&&n.targets.push(o.dom.el);for(i=0;o=e.matching[i];i++)n.matching.push(o.dom.el);for(i=0;o=e.show[i];i++)n.show.push(o.dom.el);for(i=0;o=e.hide[i];i++)(!e.toRemove.length||e.toRemove.indexOf(o)<0)&&n.hide.push(o.dom.el);return n.id=a.id,n.container=a.dom.container,n.activeFilter=e.newFilter,n.activeSort=e.newSort,n.activeDataset=e.newDataset,n.activeContainerClassName=e.newContainerClassName,n.hasFailed=e.hasFailed,n.totalTargets=a.targets.length,n.totalShow=e.show.length,n.totalHide=e.hide.length,n.totalMatching=e.matching.length,n.triggerElement=e.triggerElement,a.callFilters("stateBuildState",n,arguments)},goMix:function(n,o){var i=this,s=null;return i.callActions("beforeGoMix",arguments),i.config.animation.duration&&i.config.animation.effects&&a.isVisible(i.dom.container)||(n=!1),o.toShow.length||o.toHide.length||o.willSort||o.willChangeLayout||(n=!1),o.startState.show.length||o.show.length||(n=!1),t.events.fire("mixStart",i.dom.container,{state:o.startState,futureState:o.newState,instance:i},i.dom.document),"function"==typeof i.config.callbacks.onMixStart&&i.config.callbacks.onMixStart.call(i.dom.container,o.startState,o.newState,i),a.removeClass(i.dom.container,a.getClassname(i.config.classNames,"container",i.config.classNames.modifierFailed)),s=i.userDeferred?i.userDeferred:i.userDeferred=a.defer(t.libraries),i.isBusy=!0,n&&t.features.has.transitions?(e.pageYOffset!==o.docState.scrollTop&&e.scrollTo(o.docState.scrollLeft,o.docState.scrollTop),i.config.animation.applyPerspective&&(i.dom.parent.style[t.features.perspectiveProp]=i.config.animation.perspectiveDistance,i.dom.parent.style[t.features.perspectiveOriginProp]=i.config.animation.perspectiveOrigin),(i.config.animation.animateResizeContainer||o.startHeight===o.newHeight)&&(i.dom.parent.style.height=o.startHeight+"px"),(i.config.animation.animateResizeContainer||o.startWidth===o.newWidth)&&(i.dom.parent.style.width=o.startWidth+"px"),requestAnimationFrame(function(){i.moveTargets(o)}),i.callFilters("promiseGoMix",s.promise,arguments)):(i.config.debug.fauxAsync?setTimeout(function(){i.cleanUp(o)},i.config.animation.duration):i.cleanUp(o),i.callFilters("promiseGoMix",s.promise,arguments))},getStartMixData:function(a){var n=this,o=e.getComputedStyle(n.dom.parent),i=n.dom.parent.getBoundingClientRect(),s=null,r={},l=-1,c=o[t.features.boxSizingProp];for(n.incPadding="border-box"===c,n.callActions("beforeGetStartMixData",arguments),l=0;s=a.show[l];l++)r=s.getPosData(),a.showPosData[l]={startPosData:r};for(l=0;s=a.toHide[l];l++)r=s.getPosData(),a.toHidePosData[l]={startPosData:r};a.startX=i.left,a.startY=i.top,a.startHeight=n.incPadding?i.height:i.height-parseFloat(o.paddingTop)-parseFloat(o.paddingBottom)-parseFloat(o.borderTop)-parseFloat(o.borderBottom),a.startWidth=n.incPadding?i.width:i.width-parseFloat(o.paddingLeft)-parseFloat(o.paddingRight)-parseFloat(o.borderLeft)-parseFloat(o.borderRight),n.callActions("afterGetStartMixData",arguments)},setInter:function(e){var t=this,n=null,o=-1;for(t.callActions("beforeSetInter",arguments),t.config.animation.clampHeight&&(t.dom.parent.style.height=e.startHeight+"px",t.dom.parent.style.overflow="hidden"),o=0;n=e.toShow[o];o++)n.show();e.willChangeLayout&&(a.removeClass(t.dom.container,e.startContainerClassName),a.addClass(t.dom.container,e.newContainerClassName)),t.callActions("afterSetInter",arguments)},getInterMixData:function(e){var t=this,a=null,n=-1;for(t.callActions("beforeGetInterMixData",arguments),n=0;a=e.show[n];n++)e.showPosData[n].interPosData=a.getPosData();for(n=0;a=e.toHide[n];n++)e.toHidePosData[n].interPosData=a.getPosData();t.callActions("afterGetInterMixData",arguments)},setFinal:function(e){var t=this,a=null,n=-1;for(t.callActions("beforeSetFinal",arguments),t.config.animation.clampHeight&&(t.dom.parent.style.height=t.dom.parent.style.overflow=""),e.willSort&&t.printSort(!1,e),n=0;a=e.toHide[n];n++)a.hide();t.callActions("afterSetFinal",arguments)},getFinalMixData:function(t){var n=this,o=null,i=n.dom.parent.getBoundingClientRect(),s=null,r=-1;for(n.incPadding||(o=e.getComputedStyle(n.dom.parent)),n.callActions("beforeGetFinalMixData",arguments),r=0;s=t.show[r];r++)t.showPosData[r].finalPosData=s.getPosData();for(r=0;s=t.toHide[r];r++)t.toHidePosData[r].finalPosData=s.getPosData();for(t.newX=i.left,t.newY=i.top,t.newHeight=n.incPadding?i.height:i.height-parseFloat(o.paddingTop)-parseFloat(o.paddingBottom)-parseFloat(o.borderTop)-parseFloat(o.borderBottom),t.newWidth=n.incPadding?i.width:i.width-parseFloat(o.paddingLeft)-parseFloat(o.paddingRight)-parseFloat(o.borderLeft)-parseFloat(o.borderRight),t.willSort&&n.printSort(!0,t),r=0;s=t.toShow[r];r++)s.hide();for(r=0;s=t.toHide[r];r++)s.show();t.willChangeLayout&&(a.removeClass(n.dom.container,t.newContainerClassName),a.addClass(n.dom.container,n.config.layout.containerClassName)),n.callActions("afterGetFinalMixData",arguments)},getTweenData:function(e){var a=this,n=null,o=null,i=Object.getOwnPropertyNames(a.effectsIn),s="",r=null,l=-1,c=-1,d=-1,u=-1;for(a.callActions("beforeGetTweenData",arguments),d=0;n=e.show[d];d++)for(o=e.showPosData[d],o.posIn=new t.StyleData,o.posOut=new t.StyleData,o.tweenData=new t.StyleData,n.isShown?(o.posIn.x=o.startPosData.x-o.interPosData.x,o.posIn.y=o.startPosData.y-o.interPosData.y):o.posIn.x=o.posIn.y=0,o.posOut.x=o.finalPosData.x-o.interPosData.x,o.posOut.y=o.finalPosData.y-o.interPosData.y,o.posIn.opacity=n.isShown?1:a.effectsIn.opacity,o.posOut.opacity=1,o.tweenData.opacity=o.posOut.opacity-o.posIn.opacity,n.isShown||a.config.animation.nudge||(o.posIn.x=o.posOut.x,o.posIn.y=o.posOut.y),o.tweenData.x=o.posOut.x-o.posIn.x,o.tweenData.y=o.posOut.y-o.posIn.y,a.config.animation.animateResizeTargets&&(o.posIn.width=o.startPosData.width,o.posIn.height=o.startPosData.height,l=(o.startPosData.width||o.finalPosData.width)-o.interPosData.width,o.posIn.marginRight=o.startPosData.marginRight-l,c=(o.startPosData.height||o.finalPosData.height)-o.interPosData.height,o.posIn.marginBottom=o.startPosData.marginBottom-c,o.posOut.width=o.finalPosData.width,o.posOut.height=o.finalPosData.height,l=(o.finalPosData.width||o.startPosData.width)-o.interPosData.width,o.posOut.marginRight=o.finalPosData.marginRight-l,c=(o.finalPosData.height||o.startPosData.height)-o.interPosData.height,o.posOut.marginBottom=o.finalPosData.marginBottom-c,o.tweenData.width=o.posOut.width-o.posIn.width,o.tweenData.height=o.posOut.height-o.posIn.height,o.tweenData.marginRight=o.posOut.marginRight-o.posIn.marginRight,o.tweenData.marginBottom=o.posOut.marginBottom-o.posIn.marginBottom),u=0;s=i[u];u++)r=a.effectsIn[s],r instanceof t.TransformData&&r.value&&(o.posIn[s].value=r.value,o.posOut[s].value=0,o.tweenData[s].value=o.posOut[s].value-o.posIn[s].value,o.posIn[s].unit=o.posOut[s].unit=o.tweenData[s].unit=r.unit);for(d=0;n=e.toHide[d];d++)for(o=e.toHidePosData[d],o.posIn=new t.StyleData,o.posOut=new t.StyleData,o.tweenData=new t.StyleData,o.posIn.x=n.isShown?o.startPosData.x-o.interPosData.x:0,o.posIn.y=n.isShown?o.startPosData.y-o.interPosData.y:0,o.posOut.x=a.config.animation.nudge?0:o.posIn.x,o.posOut.y=a.config.animation.nudge?0:o.posIn.y,o.tweenData.x=o.posOut.x-o.posIn.x,o.tweenData.y=o.posOut.y-o.posIn.y,a.config.animation.animateResizeTargets&&(o.posIn.width=o.startPosData.width,o.posIn.height=o.startPosData.height,l=o.startPosData.width-o.interPosData.width,o.posIn.marginRight=o.startPosData.marginRight-l,c=o.startPosData.height-o.interPosData.height,o.posIn.marginBottom=o.startPosData.marginBottom-c),o.posIn.opacity=1,o.posOut.opacity=a.effectsOut.opacity,o.tweenData.opacity=o.posOut.opacity-o.posIn.opacity,u=0;s=i[u];u++)r=a.effectsOut[s],r instanceof t.TransformData&&r.value&&(o.posIn[s].value=0,o.posOut[s].value=r.value,o.tweenData[s].value=o.posOut[s].value-o.posIn[s].value,o.posIn[s].unit=o.posOut[s].unit=o.tweenData[s].unit=r.unit);a.callActions("afterGetTweenData",arguments)},moveTargets:function(e){var n=this,o=null,i=null,s=null,r="",l=!1,c=-1,d=-1,u=n.checkProgress.bind(n);for(n.callActions("beforeMoveTargets",arguments),d=0;o=e.show[d];d++)i=new t.IMoveData,s=e.showPosData[d],r=o.isShown?"none":"show",l=n.willTransition(r,e.hasEffect,s.posIn,s.posOut),l&&c++,o.show(),i.posIn=s.posIn,i.posOut=s.posOut,i.statusChange=r,i.staggerIndex=c,i.operation=e,i.callback=l?u:null,o.move(i);for(d=0;o=e.toHide[d];d++)s=e.toHidePosData[d],i=new t.IMoveData,r="hide",l=n.willTransition(r,s.posIn,s.posOut),i.posIn=s.posIn,i.posOut=s.posOut,i.statusChange=r,i.staggerIndex=d,i.operation=e,i.callback=l?u:null,o.move(i);n.config.animation.animateResizeContainer&&(n.dom.parent.style[t.features.transitionProp]="height "+n.config.animation.duration+"ms ease, width "+n.config.animation.duration+"ms ease ",requestAnimationFrame(function(){n.dom.parent.style.height=e.newHeight+"px",n.dom.parent.style.width=e.newWidth+"px"})),e.willChangeLayout&&(a.removeClass(n.dom.container,n.config.layout.ContainerClassName),a.addClass(n.dom.container,e.newContainerClassName)),n.callActions("afterMoveTargets",arguments)},hasEffect:function(){var e=this,t=["scale","translateX","translateY","translateZ","rotateX","rotateY","rotateZ"],a="",n=null,o=!1,i=-1,s=-1;if(1!==e.effectsIn.opacity)return e.callFilters("resultHasEffect",!0,arguments);for(s=0;a=t[s];s++)if(n=e.effectsIn[a],i="undefined"!==n.value?n.value:n,0!==i){o=!0;break}return e.callFilters("resultHasEffect",o,arguments)},willTransition:function(e,t,n,o){var i=this,s=!1;return s=!(!a.isVisible(i.dom.container)||!("none"!==e&&t||n.x!==o.x||n.y!==o.y)&&(!i.config.animation.animateResizeTargets||n.width===o.width&&n.height===o.height&&n.marginRight===o.marginRight&&n.marginTop===o.marginTop)),i.callFilters("resultWillTransition",s,arguments)},checkProgress:function(e){var t=this;t.targetsDone++,t.targetsBound===t.targetsDone&&t.cleanUp(e)},cleanUp:function(e){var n=this,o=null,i=null,s=null,r=null,l=-1;for(n.callActions("beforeCleanUp",arguments),n.targetsMoved=n.targetsImmovable=n.targetsBound=n.targetsDone=0,l=0;o=e.show[l];l++)o.cleanUp(),o.show();for(l=0;o=e.toHide[l];l++)o.cleanUp(),o.hide();if(e.willSort&&n.printSort(!1,e),n.dom.parent.style[t.features.transitionProp]=n.dom.parent.style.height=n.dom.parent.style.width=n.dom.parent.style[t.features.perspectiveProp]=n.dom.parent.style[t.features.perspectiveOriginProp]="",e.willChangeLayout&&(a.removeClass(n.dom.container,e.startContainerClassName),a.addClass(n.dom.container,e.newContainerClassName)),e.toRemove.length){for(l=0;o=n.targets[l];l++)e.toRemove.indexOf(o)>-1&&((i=o.dom.el.previousSibling)&&"#text"===i.nodeName&&(s=o.dom.el.nextSibling)&&"#text"===s.nodeName&&a.removeWhitespace(i),e.willSort||n.dom.parent.removeChild(o.dom.el),n.targets.splice(l,1),o.isInDom=!1,l--);n.origOrder=n.targets}e.willSort&&(n.targets=e.newOrder),n.state=e.newState,n.lastOperation=e,n.dom.targets=n.state.targets,t.events.fire("mixEnd",n.dom.container,{state:n.state,instance:n},n.dom.document),"function"==typeof n.config.callbacks.onMixEnd&&n.config.callbacks.onMixEnd.call(n.dom.container,n.state,n),e.hasFailed&&(t.events.fire("mixFail",n.dom.container,{state:n.state,instance:n},n.dom.document),"function"==typeof n.config.callbacks.onMixFail&&n.config.callbacks.onMixFail.call(n.dom.container,n.state,n),
a.addClass(n.dom.container,a.getClassname(n.config.classNames,"container",n.config.classNames.modifierFailed))),"function"==typeof n.userCallback&&n.userCallback.call(n.dom.container,n.state,n),"function"==typeof n.userDeferred.resolve&&n.userDeferred.resolve(n.state),n.userCallback=null,n.userDeferred=null,n.lastClicked=null,n.isToggling=!1,n.isBusy=!1,n.queue.length&&(n.callActions("beforeReadQueueCleanUp",arguments),r=n.queue.shift(),n.userDeferred=r.deferred,n.isToggling=r.isToggling,n.lastClicked=r.triggerElement,r.instruction.command instanceof t.CommandMultimix?n.multimix.apply(n,r.args):n.dataset.apply(n,r.args)),n.callActions("afterCleanUp",arguments)},parseMultimixArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandMultimix,s=0;s<e.length;s++)i=e[s],null!==i&&("object"==typeof i?a.extend(o.command,i):"boolean"==typeof i?o.animate=i:"function"==typeof i&&(o.callback=i));return!o.command.insert||o.command.insert instanceof t.CommandInsert||(o.command.insert=n.parseInsertArgs([o.command.insert]).command),!o.command.remove||o.command.remove instanceof t.CommandRemove||(o.command.remove=n.parseRemoveArgs([o.command.remove]).command),!o.command.filter||o.command.filter instanceof t.CommandFilter||(o.command.filter=n.parseFilterArgs([o.command.filter]).command),!o.command.sort||o.command.sort instanceof t.CommandSort||(o.command.sort=n.parseSortArgs([o.command.sort]).command),!o.command.changeLayout||o.command.changeLayout instanceof t.CommandChangeLayout||(o.command.changeLayout=n.parseChangeLayoutArgs([o.command.changeLayout]).command),o=n.callFilters("instructionParseMultimixArgs",o,arguments),a.freeze(o),o},parseFilterArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandFilter,s=0;s<e.length;s++)i=e[s],"string"==typeof i?o.command.selector=i:null===i?o.command.collection=[]:"object"==typeof i&&a.isElement(i,n.dom.document)?o.command.collection=[i]:"object"==typeof i&&"undefined"!=typeof i.length?o.command.collection=a.arrayFromList(i):"object"==typeof i?a.extend(o.command,i):"boolean"==typeof i?o.animate=i:"function"==typeof i&&(o.callback=i);if(o.command.selector&&o.command.collection)throw new Error(t.messages.errorFilterInvalidArguments());return o=n.callFilters("instructionParseFilterArgs",o,arguments),a.freeze(o),o},parseSortArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s="",r=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandSort,r=0;r<e.length;r++)if(i=e[r],null!==i)switch(typeof i){case"string":s=i;break;case"object":i.length&&(o.command.collection=a.arrayFromList(i));break;case"boolean":o.animate=i;break;case"function":o.callback=i}return s&&(o.command=n.parseSortString(s,o.command)),o=n.callFilters("instructionParseSortArgs",o,arguments),a.freeze(o),o},parseInsertArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandInsert,s=0;s<e.length;s++)i=e[s],null!==i&&("number"==typeof i?o.command.index=i:"string"==typeof i&&["before","after"].indexOf(i)>-1?o.command.position=i:"string"==typeof i?o.command.collection=a.arrayFromList(a.createElement(i).childNodes):"object"==typeof i&&a.isElement(i,n.dom.document)?o.command.collection.length?o.command.sibling=i:o.command.collection=[i]:"object"==typeof i&&i.length?o.command.collection.length?o.command.sibling=i[0]:o.command.collection=i:"object"==typeof i&&i.childNodes&&i.childNodes.length?o.command.collection.length?o.command.sibling=i.childNodes[0]:o.command.collection=a.arrayFromList(i.childNodes):"object"==typeof i?a.extend(o.command,i):"boolean"==typeof i?o.animate=i:"function"==typeof i&&(o.callback=i));if(o.command.index&&o.command.sibling)throw new Error(t.messages.errorInsertInvalidArguments());return!o.command.collection.length&&n.config.debug.showWarnings&&console.warn(t.messages.warningInsertNoElements()),o=n.callFilters("instructionParseInsertArgs",o,arguments),a.freeze(o),o},parseRemoveArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=null,r=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandRemove,r=0;r<e.length;r++)if(s=e[r],null!==s)switch(typeof s){case"number":n.targets[s]&&(o.command.targets[0]=n.targets[s]);break;case"string":o.command.collection=a.arrayFromList(n.dom.parent.querySelectorAll(s));break;case"object":s&&s.length?o.command.collection=s:a.isElement(s,n.dom.document)?o.command.collection=[s]:a.extend(o.command,s);break;case"boolean":o.animate=s;break;case"function":o.callback=s}if(o.command.collection.length)for(r=0;i=n.targets[r];r++)o.command.collection.indexOf(i.dom.el)>-1&&o.command.targets.push(i);return!o.command.targets.length&&n.config.debug.showWarnings&&console.warn(t.messages.warningRemoveNoElements()),a.freeze(o),o},parseDatasetArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandDataset,s=0;s<e.length;s++)if(i=e[s],null!==i)switch(typeof i){case"object":Array.isArray(i)||"number"==typeof i.length?o.command.dataset=i:a.extend(o.command,i);break;case"boolean":o.animate=i;break;case"function":o.callback=i}return a.freeze(o),o},parseChangeLayoutArgs:function(e){var n=this,o=new t.UserInstruction,i=null,s=-1;for(o.animate=n.config.animation.enable,o.command=new t.CommandChangeLayout,s=0;s<e.length;s++)if(i=e[s],null!==i)switch(typeof i){case"string":o.command.containerClassName=i;break;case"object":a.extend(o.command,i);break;case"boolean":o.animate=i;break;case"function":o.callback=i}return a.freeze(o),o},queueMix:function(e){var n=this,o=null,i="";return n.callActions("beforeQueueMix",arguments),o=a.defer(t.libraries),n.config.animation.queue&&n.queue.length<n.config.animation.queueLimit?(e.deferred=o,n.queue.push(e),n.config.controls.enable&&(n.isToggling?(n.buildToggleArray(e.instruction.command),i=n.getToggleSelector(),n.updateControls({filter:{selector:i}})):n.updateControls(e.instruction.command))):(n.config.debug.showWarnings&&console.warn(t.messages.warningMultimixInstanceQueueFull()),o.resolve(n.state),t.events.fire("mixBusy",n.dom.container,{state:n.state,instance:n},n.dom.document),"function"==typeof n.config.callbacks.onMixBusy&&n.config.callbacks.onMixBusy.call(n.dom.container,n.state,n)),n.callFilters("promiseQueueMix",o.promise,arguments)},getDataOperation:function(e){var n=this,o=new t.Operation,i=[];if(o=n.callFilters("operationUnmappedGetDataOperation",o,arguments),n.dom.targets.length&&!(i=n.state.activeDataset||[]).length)throw new Error(t.messages.errorDatasetNotSet());return o.id=a.randomHex(),o.startState=n.state,o.startDataset=i,o.newDataset=e.slice(),n.diffDatasets(o),o.startOrder=n.targets,o.newOrder=o.show,n.config.animation.enable&&(n.getStartMixData(o),n.setInter(o),o.docState=a.getDocumentState(n.dom.document),n.getInterMixData(o),n.setFinal(o),n.getFinalMixData(o),n.parseEffects(),o.hasEffect=n.hasEffect(),n.getTweenData(o)),n.targets=o.show.slice(),o.newState=n.buildState(o),Array.prototype.push.apply(n.targets,o.toRemove),o=n.callFilters("operationMappedGetDataOperation",o,arguments)},diffDatasets:function(e){var n=this,o=[],i=[],s=[],r=null,l=null,c=null,d=null,u=null,m={},f="",p=-1;for(n.callActions("beforeDiffDatasets",arguments),p=0;r=e.newDataset[p];p++){if("undefined"==typeof(f=r[n.config.data.uidKey])||f.toString().length<1)throw new TypeError(t.messages.errorDatasetInvalidUidKey({uidKey:n.config.data.uidKey}));if(m[f])throw new Error(t.messages.errorDatasetDuplicateUid({uid:f}));m[f]=!0,(l=n.cache[f])instanceof t.Target?(n.config.data.dirtyCheck&&!a.deepEquals(r,l.data)&&(c=l.render(r),l.data=r,c!==l.dom.el&&(l.isInDom&&(l.unbindEvents(),n.dom.parent.replaceChild(c,l.dom.el)),l.isShown||(c.style.display="none"),l.dom.el=c,l.isInDom&&l.bindEvents())),c=l.dom.el):(l=new t.Target,l.init(null,n,r),l.hide()),l.isInDom?(u=l.dom.el.nextElementSibling,i.push(f),d&&(d.lastElementChild&&d.appendChild(n.dom.document.createTextNode(" ")),n.insertDatasetFrag(d,l.dom.el,n.targets.indexOf(l),s),d=null)):(d||(d=n.dom.document.createDocumentFragment()),d.lastElementChild&&d.appendChild(n.dom.document.createTextNode(" ")),d.appendChild(l.dom.el),l.isInDom=!0,l.unbindEvents(),l.bindEvents(),l.hide(),e.toShow.push(l),s.push(l)),e.show.push(l)}for(d&&(u=u||n.config.layout.siblingAfter,u&&d.appendChild(n.dom.document.createTextNode(" ")),n.insertDatasetFrag(d,u,n.dom.targets.length,s)),p=0;r=e.startDataset[p];p++)f=r[n.config.data.uidKey],l=n.cache[f],e.show.indexOf(l)<0?(e.hide.push(l),e.toHide.push(l),e.toRemove.push(l)):o.push(f);a.isEqualArray(o,i)||(e.willSort=!0),n.callActions("afterDiffDatasets",arguments)},insertDatasetFrag:function(e,t,a,n){var o=this;for(o.dom.parent.insertBefore(e,t);n.length;)o.targets.splice(a,0,n.shift()),a++},willSort:function(e,t){var a=this,n=!1;return n=!!("random"===e.order||e.attribute!==t.attribute||e.order!==t.order||e.collection!==t.collection||null===e.next&&t.next||e.next&&null===t.next)||!(!e.next||!t.next)&&a.willSort(e.next,t.next),a.callFilters("resultWillSort",n,arguments)},show:function(){var e=this;return e.filter("all")},hide:function(){var e=this;return e.filter("none")},isMixing:function(){var e=this;return e.isBusy},filter:function(){var e=this,t=e.parseFilterArgs(arguments);return e.multimix({filter:t.command},t.animate,t.callback)},toggleOn:function(){var e=this,t=e.parseFilterArgs(arguments),a=t.command.selector,n="";return e.isToggling=!0,e.toggleArray.indexOf(a)<0&&e.toggleArray.push(a),n=e.getToggleSelector(),e.multimix({filter:n},t.animate,t.callback)},toggleOff:function(){var e=this,t=e.parseFilterArgs(arguments),a=t.command.selector,n="";return e.isToggling=!0,e.toggleArray.splice(e.toggleArray.indexOf(a),1),n=e.getToggleSelector(),e.multimix({filter:n},t.animate,t.callback)},sort:function(){var e=this,t=e.parseSortArgs(arguments);return e.multimix({sort:t.command},t.animate,t.callback)},changeLayout:function(){var e=this,t=e.parseChangeLayoutArgs(arguments);return e.multimix({changeLayout:t.command},t.animate,t.callback)},dataset:function(){var e=this,a=e.parseDatasetArgs(arguments),n=null,o=null,i=!1;return e.callActions("beforeDataset",arguments),e.isBusy?(o=new t.QueueItem,o.args=arguments,o.instruction=a,e.queueMix(o)):(a.callback&&(e.userCallback=a.callback),i=a.animate^e.config.animation.enable?a.animate:e.config.animation.enable,n=e.getDataOperation(a.command.dataset),e.goMix(i,n))},multimix:function(){var e=this,a=null,n=!1,o=null,i=e.parseMultimixArgs(arguments);return e.callActions("beforeMultimix",arguments),e.isBusy?(o=new t.QueueItem,o.args=arguments,o.instruction=i,o.triggerElement=e.lastClicked,o.isToggling=e.isToggling,e.queueMix(o)):(a=e.getOperation(i.command),e.config.controls.enable&&(i.command.filter&&!e.isToggling&&(e.toggleArray.length=0,e.buildToggleArray(a.command)),e.queue.length<1&&e.updateControls(a.command)),i.callback&&(e.userCallback=i.callback),n=i.animate^e.config.animation.enable?i.animate:e.config.animation.enable,e.callFilters("operationMultimix",a,arguments),e.goMix(n,a))},getOperation:function(e){var n=this,o=e.sort,i=e.filter,s=e.changeLayout,r=e.remove,l=e.insert,c=new t.Operation;return c=n.callFilters("operationUnmappedGetOperation",c,arguments),c.id=a.randomHex(),c.command=e,c.startState=n.state,c.triggerElement=n.lastClicked,n.isBusy?(n.config.debug.showWarnings&&console.warn(t.messages.warningGetOperationInstanceBusy()),null):(l&&n.insertTargets(l,c),r&&(c.toRemove=r.targets),c.startSort=c.newSort=c.startState.activeSort,c.startOrder=c.newOrder=n.targets,o&&(c.startSort=c.startState.activeSort,c.newSort=o,c.willSort=n.willSort(o,c.startState.activeSort),c.willSort&&n.sortOperation(c)),c.startFilter=c.startState.activeFilter,i?c.newFilter=i:c.newFilter=a.extend(new t.CommandFilter,c.startFilter),"all"===c.newFilter.selector?c.newFilter.selector=n.config.selectors.target:"none"===c.newFilter.selector&&(c.newFilter.selector=""),n.filterOperation(c),s&&(c.startContainerClassName=c.startState.activeContainerClassName,c.newContainerClassName=s.containerClassName,c.newContainerClassName!==c.startContainerClassName&&(c.willChangeLayout=!0)),n.config.animation.enable&&(n.getStartMixData(c),n.setInter(c),c.docState=a.getDocumentState(n.dom.document),n.getInterMixData(c),n.setFinal(c),n.getFinalMixData(c),n.parseEffects(),c.hasEffect=n.hasEffect(),n.getTweenData(c)),c.newState=n.buildState(c),n.callFilters("operationMappedGetOperation",c,arguments))},tween:function(e,t){var a=null,n=null,o=-1,i=-1;for(t=Math.min(t,1),t=Math.max(t,0),i=0;a=e.show[i];i++)n=e.showPosData[i],a.applyTween(n,t);for(i=0;a=e.hide[i];i++)a.isShown&&a.hide(),(o=e.toHide.indexOf(a))>-1&&(n=e.toHidePosData[o],a.isShown||a.show(),a.applyTween(n,t))},insert:function(){var e=this,t=e.parseInsertArgs(arguments);return e.multimix({insert:t.command},t.animate,t.callback)},insertBefore:function(){var e=this,t=e.parseInsertArgs(arguments);return e.insert(t.command.collection,"before",t.command.sibling,t.animate,t.callback)},insertAfter:function(){var e=this,t=e.parseInsertArgs(arguments);return e.insert(t.command.collection,"after",t.command.sibling,t.animate,t.callback)},prepend:function(){var e=this,t=e.parseInsertArgs(arguments);return e.insert(0,t.command.collection,t.animate,t.callback)},append:function(){var e=this,t=e.parseInsertArgs(arguments);return e.insert(e.state.totalTargets,t.command.collection,t.animate,t.callback)},remove:function(){var e=this,t=e.parseRemoveArgs(arguments);return e.multimix({remove:t.command},t.animate,t.callback)},getConfig:function(e){var t=this,n=null;return n=e?a.getProperty(t.config,e):t.config,t.callFilters("valueGetConfig",n,arguments)},configure:function(e){var t=this;t.callActions("beforeConfigure",arguments),a.extend(t.config,e,!0,!0),t.callActions("afterConfigure",arguments)},getState:function(){var e=this,n=null;return n=new t.State,a.extend(n,e.state),a.freeze(n),e.callFilters("stateGetState",n,arguments)},forceRefresh:function(){var e=this;e.indexTargets()},destroy:function(e){var a=this,n=null,o=null,i=0;for(a.callActions("beforeDestroy",arguments),i=0;n=a.controls[i];i++)n.removeBinding(a);for(i=0;o=a.targets[i];i++)e&&o.show(),o.unbindEvents();a.dom.container.id.match(/^MixItUp/)&&a.dom.container.removeAttribute("id"),delete t.instances[a.id],a.callActions("afterDestroy",arguments)}}),t.IMoveData=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.posIn=null,this.posOut=null,this.operation=null,this.callback=null,this.statusChange="",this.duration=-1,this.staggerIndex=-1,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.IMoveData),t.IMoveData.prototype=Object.create(t.Base.prototype),t.IMoveData.prototype.constructor=t.IMoveData,t.TargetDom=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.el=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.TargetDom),t.TargetDom.prototype=Object.create(t.Base.prototype),t.TargetDom.prototype.constructor=t.TargetDom,t.Target=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.id="",this.sortString="",this.mixer=null,this.callback=null,this.isShown=!1,this.isBound=!1,this.isExcluded=!1,this.isInDom=!1,this.handler=null,this.operation=null,this.data=null,this.dom=new t.TargetDom,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Target),t.Target.prototype=Object.create(t.Base.prototype),a.extend(t.Target.prototype,{constructor:t.Target,init:function(e,a,n){var o=this,i="";if(o.callActions("beforeInit",arguments),o.mixer=a,e||(e=o.render(n)),o.cacheDom(e),o.bindEvents(),"none"!==o.dom.el.style.display&&(o.isShown=!0),n&&a.config.data.uidKey){if("undefined"==typeof(i=n[a.config.data.uidKey])||i.toString().length<1)throw new TypeError(t.messages.errorDatasetInvalidUidKey({uidKey:a.config.data.uidKey}));o.id=i,o.data=n,a.cache[i]=o}o.callActions("afterInit",arguments)},render:function(e){var n=this,o=null,i=null,s=null,r="";if(n.callActions("beforeRender",arguments),o=n.callFilters("renderRender",n.mixer.config.render.target,arguments),"function"!=typeof o)throw new TypeError(t.messages.errorDatasetRendererNotSet());return r=o(e),r&&"object"==typeof r&&a.isElement(r)?i=r:"string"==typeof r&&(s=document.createElement("div"),s.innerHTML=r,i=s.firstElementChild),n.callFilters("elRender",i,arguments)},cacheDom:function(e){var t=this;t.callActions("beforeCacheDom",arguments),t.dom.el=e,t.callActions("afterCacheDom",arguments)},getSortString:function(e){var t=this,a=t.dom.el.getAttribute("data-"+e)||"";t.callActions("beforeGetSortString",arguments),a=isNaN(1*a)?a.toLowerCase():1*a,t.sortString=a,t.callActions("afterGetSortString",arguments)},show:function(){var e=this;e.callActions("beforeShow",arguments),e.isShown||(e.dom.el.style.display="",e.isShown=!0),e.callActions("afterShow",arguments)},hide:function(){var e=this;e.callActions("beforeHide",arguments),e.isShown&&(e.dom.el.style.display="none",e.isShown=!1),e.callActions("afterHide",arguments)},move:function(e){var t=this;t.callActions("beforeMove",arguments),t.isExcluded||t.mixer.targetsMoved++,t.applyStylesIn(e),requestAnimationFrame(function(){t.applyStylesOut(e)}),t.callActions("afterMove",arguments)},applyTween:function(e,a){var n=this,o="",i=null,s=e.posIn,r=[],l=new t.StyleData,c=-1;for(n.callActions("beforeApplyTween",arguments),l.x=s.x,l.y=s.y,0===a?n.hide():n.isShown||n.show(),c=0;o=t.features.TWEENABLE[c];c++)if(i=e.tweenData[o],"x"===o){if(!i)continue;l.x=s.x+i*a}else if("y"===o){if(!i)continue;l.y=s.y+i*a}else if(i instanceof t.TransformData){if(!i.value)continue;l[o].value=s[o].value+i.value*a,l[o].unit=i.unit,r.push(o+"("+l[o].value+i.unit+")")}else{if(!i)continue;l[o]=s[o]+i*a,n.dom.el.style[o]=l[o]}(l.x||l.y)&&r.unshift("translate("+l.x+"px, "+l.y+"px)"),r.length&&(n.dom.el.style[t.features.transformProp]=r.join(" ")),n.callActions("afterApplyTween",arguments)},applyStylesIn:function(e){var a=this,n=e.posIn,o=1!==a.mixer.effectsIn.opacity,i=[];a.callActions("beforeApplyStylesIn",arguments),i.push("translate("+n.x+"px, "+n.y+"px)"),a.mixer.config.animation.animateResizeTargets&&("show"!==e.statusChange&&(a.dom.el.style.width=n.width+"px",a.dom.el.style.height=n.height+"px"),a.dom.el.style.marginRight=n.marginRight+"px",a.dom.el.style.marginBottom=n.marginBottom+"px"),o&&(a.dom.el.style.opacity=n.opacity),"show"===e.statusChange&&(i=i.concat(a.mixer.transformIn)),a.dom.el.style[t.features.transformProp]=i.join(" "),a.callActions("afterApplyStylesIn",arguments)},applyStylesOut:function(e){var a=this,n=[],o=[],i=a.mixer.config.animation.animateResizeTargets,s="undefined"!=typeof a.mixer.effectsIn.opacity;if(a.callActions("beforeApplyStylesOut",arguments),n.push(a.writeTransitionRule(t.features.transformRule,e.staggerIndex)),"none"!==e.statusChange&&n.push(a.writeTransitionRule("opacity",e.staggerIndex,e.duration)),i&&(n.push(a.writeTransitionRule("width",e.staggerIndex,e.duration)),n.push(a.writeTransitionRule("height",e.staggerIndex,e.duration)),n.push(a.writeTransitionRule("margin",e.staggerIndex,e.duration))),!e.callback)return a.mixer.targetsImmovable++,void(a.mixer.targetsMoved===a.mixer.targetsImmovable&&a.mixer.cleanUp(e.operation));switch(a.operation=e.operation,a.callback=e.callback,!a.isExcluded&&a.mixer.targetsBound++,a.isBound=!0,a.applyTransition(n),i&&e.posOut.width>0&&e.posOut.height>0&&(a.dom.el.style.width=e.posOut.width+"px",a.dom.el.style.height=e.posOut.height+"px",a.dom.el.style.marginRight=e.posOut.marginRight+"px",a.dom.el.style.marginBottom=e.posOut.marginBottom+"px"),a.mixer.config.animation.nudge||"hide"!==e.statusChange||o.push("translate("+e.posOut.x+"px, "+e.posOut.y+"px)"),e.statusChange){case"hide":s&&(a.dom.el.style.opacity=a.mixer.effectsOut.opacity),o=o.concat(a.mixer.transformOut);break;case"show":s&&(a.dom.el.style.opacity=1)}(a.mixer.config.animation.nudge||!a.mixer.config.animation.nudge&&"hide"!==e.statusChange)&&o.push("translate("+e.posOut.x+"px, "+e.posOut.y+"px)"),a.dom.el.style[t.features.transformProp]=o.join(" "),a.callActions("afterApplyStylesOut",arguments)},writeTransitionRule:function(e,t,a){var n=this,o=n.getDelay(t),i="";return i=e+" "+(a>0?a:n.mixer.config.animation.duration)+"ms "+o+"ms "+("opacity"===e?"linear":n.mixer.config.animation.easing),n.callFilters("ruleWriteTransitionRule",i,arguments)},getDelay:function(e){var t=this,a=-1;return"function"==typeof t.mixer.config.animation.staggerSequence&&(e=t.mixer.config.animation.staggerSequence.call(t,e,t.state)),a=t.mixer.staggerDuration?e*t.mixer.staggerDuration:0,t.callFilters("delayGetDelay",a,arguments)},applyTransition:function(e){var a=this,n=e.join(", ");a.callActions("beforeApplyTransition",arguments),a.dom.el.style[t.features.transitionProp]=n,a.callActions("afterApplyTransition",arguments)},handleTransitionEnd:function(e){var t=this,a=e.propertyName,n=t.mixer.config.animation.animateResizeTargets;t.callActions("beforeHandleTransitionEnd",arguments),t.isBound&&e.target.matches(t.mixer.config.selectors.target)&&(a.indexOf("transform")>-1||a.indexOf("opacity")>-1||n&&a.indexOf("height")>-1||n&&a.indexOf("width")>-1||n&&a.indexOf("margin")>-1)&&(t.callback.call(t,t.operation),t.isBound=!1,t.callback=null,t.operation=null),t.callActions("afterHandleTransitionEnd",arguments)},eventBus:function(e){var t=this;switch(t.callActions("beforeEventBus",arguments),e.type){case"webkitTransitionEnd":case"transitionend":t.handleTransitionEnd(e)}t.callActions("afterEventBus",arguments)},unbindEvents:function(){var e=this;e.callActions("beforeUnbindEvents",arguments),a.off(e.dom.el,"webkitTransitionEnd",e.handler),a.off(e.dom.el,"transitionend",e.handler),e.callActions("afterUnbindEvents",arguments)},bindEvents:function(){var e=this,n="";e.callActions("beforeBindEvents",arguments),n="webkit"===t.features.transitionPrefix?"webkitTransitionEnd":"transitionend",e.handler=function(t){return e.eventBus(t)},a.on(e.dom.el,n,e.handler),e.callActions("afterBindEvents",arguments)},getPosData:function(a){var n=this,o={},i=null,s=new t.StyleData;return n.callActions("beforeGetPosData",arguments),s.x=n.dom.el.offsetLeft,s.y=n.dom.el.offsetTop,(n.mixer.config.animation.animateResizeTargets||a)&&(i=n.dom.el.getBoundingClientRect(),s.top=i.top,s.right=i.right,s.bottom=i.bottom,s.left=i.left,s.width=i.width,s.height=i.height),n.mixer.config.animation.animateResizeTargets&&(o=e.getComputedStyle(n.dom.el),s.marginBottom=parseFloat(o.marginBottom),s.marginRight=parseFloat(o.marginRight)),n.callFilters("posDataGetPosData",s,arguments)},cleanUp:function(){var e=this;e.callActions("beforeCleanUp",arguments),e.dom.el.style[t.features.transformProp]="",e.dom.el.style[t.features.transitionProp]="",e.dom.el.style.opacity="",e.mixer.config.animation.animateResizeTargets&&(e.dom.el.style.width="",e.dom.el.style.height="",e.dom.el.style.marginRight="",e.dom.el.style.marginBottom=""),e.callActions("afterCleanUp",arguments)}}),t.Collection=function(e){var t=null,n=-1;for(this.callActions("beforeConstruct"),n=0;t=e[n];n++)this[n]=t;this.length=e.length,this.callActions("afterConstruct"),a.freeze(this)},t.BaseStatic.call(t.Collection),t.Collection.prototype=Object.create(t.Base.prototype),a.extend(t.Collection.prototype,{constructor:t.Collection,mixitup:function(e){var n=this,o=null,i=Array.prototype.slice.call(arguments),s=[],r=-1;for(this.callActions("beforeMixitup"),i.shift(),r=0;o=n[r];r++)s.push(o[e].apply(o,i));return n.callFilters("promiseMixitup",a.all(s,t.libraries),arguments)}}),t.Operation=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.id="",this.args=[],this.command=null,this.showPosData=[],this.toHidePosData=[],this.startState=null,this.newState=null,this.docState=null,this.willSort=!1,this.willChangeLayout=!1,this.hasEffect=!1,this.hasFailed=!1,this.triggerElement=null,this.show=[],this.hide=[],this.matching=[],this.toShow=[],this.toHide=[],this.toMove=[],this.toRemove=[],this.startOrder=[],this.newOrder=[],this.startSort=null,this.newSort=null,this.startFilter=null,this.newFilter=null,this.startDataset=null,this.newDataset=null,this.startX=0,this.startY=0,this.startHeight=0,this.startWidth=0,this.newX=0,this.newY=0,this.newHeight=0,this.newWidth=0,this.startContainerClassName="",this.startDisplay="",this.newContainerClassName="",this.newDisplay="",this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.Operation),t.Operation.prototype=Object.create(t.Base.prototype),t.Operation.prototype.constructor=t.Operation,t.State=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.id="",this.activeFilter=null,this.activeSort=null,this.activeContainerClassName="",this.container=null,this.targets=[],this.hide=[],this.show=[],this.matching=[],this.totalTargets=-1,this.totalShow=-1,this.totalHide=-1,this.totalMatching=-1,this.hasFailed=!1,this.triggerElement=null,this.activeDataset=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.State),t.State.prototype=Object.create(t.Base.prototype),t.State.prototype.constructor=t.State,t.UserInstruction=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.command={},this.animate=!1,this.callback=null,this.callActions("afterConstruct"),a.seal(this)},t.BaseStatic.call(t.UserInstruction),t.UserInstruction.prototype=Object.create(t.Base.prototype),t.UserInstruction.prototype.constructor=t.UserInstruction,t.Messages=function(){t.Base.call(this),this.callActions("beforeConstruct"),this.ERROR_FACTORY_INVALID_CONTAINER="[MixItUp] An invalid selector or element reference was passed to the mixitup factory function",this.ERROR_FACTORY_CONTAINER_NOT_FOUND="[MixItUp] The provided selector yielded no container element",this.ERROR_CONFIG_INVALID_ANIMATION_EFFECTS="[MixItUp] Invalid value for `animation.effects`",this.ERROR_CONFIG_INVALID_CONTROLS_SCOPE="[MixItUp] Invalid value for `controls.scope`",this.ERROR_CONFIG_INVALID_PROPERTY='[MixitUp] Invalid configuration object property "${erroneous}"${suggestion}',this.ERROR_CONFIG_INVALID_PROPERTY_SUGGESTION='. Did you mean "${probableMatch}"?',this.ERROR_CONFIG_DATA_UID_KEY_NOT_SET="[MixItUp] To use the dataset API, a UID key must be specified using `data.uidKey`",this.ERROR_DATASET_INVALID_UID_KEY='[MixItUp] The specified UID key "${uidKey}" is not present on one or more dataset items',this.ERROR_DATASET_DUPLICATE_UID='[MixItUp] The UID "${uid}" was found on two or more dataset items. UIDs must be unique.',this.ERROR_INSERT_INVALID_ARGUMENTS="[MixItUp] Please provider either an index or a sibling and position to insert, not both",this.ERROR_INSERT_PREEXISTING_ELEMENT="[MixItUp] An element to be inserted already exists in the container",this.ERROR_FILTER_INVALID_ARGUMENTS="[MixItUp] Please provide either a selector or collection `.filter()`, not both",this.ERROR_DATASET_NOT_SET="[MixItUp] To use the dataset API with pre-rendered targets, a starting dataset must be set using `load.dataset`",this.ERROR_DATASET_PRERENDERED_MISMATCH="[MixItUp] `load.dataset` does not match pre-rendered targets",this.ERROR_DATASET_RENDERER_NOT_SET="[MixItUp] To insert an element via the dataset API, a target renderer function must be provided to `render.target`",this.WARNING_FACTORY_PREEXISTING_INSTANCE="[MixItUp] WARNING: This element already has an active MixItUp instance. The provided configuration object will be ignored. If you wish to perform additional methods on this instance, please create a reference.",this.WARNING_INSERT_NO_ELEMENTS="[MixItUp] WARNING: No valid elements were passed to `.insert()`",this.WARNING_REMOVE_NO_ELEMENTS="[MixItUp] WARNING: No valid elements were passed to `.remove()`",this.WARNING_MULTIMIX_INSTANCE_QUEUE_FULL="[MixItUp] WARNING: An operation was requested but the MixItUp instance was busy. The operation was rejected because the queue is full or queuing is disabled.",this.WARNING_GET_OPERATION_INSTANCE_BUSY="[MixItUp] WARNING: Operations can be be created while the MixItUp instance is busy.",this.WARNING_NO_PROMISE_IMPLEMENTATION="[MixItUp] WARNING: No Promise implementations could be found. If you wish to use promises with MixItUp please install an ES6 Promise polyfill.",this.WARNING_INCONSISTENT_SORTING_ATTRIBUTES='[MixItUp] WARNING: The requested sorting data attribute "${attribute}" was not present on one or more target elements which may product unexpected sort output',this.callActions("afterConstruct"),this.compileTemplates(),a.seal(this)},t.BaseStatic.call(t.Messages),t.Messages.prototype=Object.create(t.Base.prototype),t.Messages.prototype.constructor=t.Messages,t.Messages.prototype.compileTemplates=function(){var e="",t="";for(e in this)"string"==typeof(t=this[e])&&(this[a.camelCase(e)]=a.template(t))},t.messages=new t.Messages,t.Facade=function(e){t.Base.call(this),this.callActions("beforeConstruct",arguments),this.configure=e.configure.bind(e),this.show=e.show.bind(e),this.hide=e.hide.bind(e),this.filter=e.filter.bind(e),this.toggleOn=e.toggleOn.bind(e),this.toggleOff=e.toggleOff.bind(e),this.sort=e.sort.bind(e),this.changeLayout=e.changeLayout.bind(e),this.multimix=e.multimix.bind(e),this.multiMix=e.multimix.bind(e),this.dataset=e.dataset.bind(e),this.tween=e.tween.bind(e),this.insert=e.insert.bind(e),this.insertBefore=e.insertBefore.bind(e),this.insertAfter=e.insertAfter.bind(e),this.prepend=e.prepend.bind(e),this.append=e.append.bind(e),this.remove=e.remove.bind(e),this.destroy=e.destroy.bind(e),this.forceRefresh=e.forceRefresh.bind(e),this.isMixing=e.isMixing.bind(e),this.getOperation=e.getOperation.bind(e),this.getConfig=e.getConfig.bind(e),this.getState=e.getState.bind(e),this.callActions("afterConstruct",arguments),a.freeze(this),a.seal(this)},t.BaseStatic.call(t.Facade),t.Facade.prototype=Object.create(t.Base.prototype),t.Facade.prototype.constructor=t.Facade,"object"==typeof exports&&"object"==typeof module?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof e.mixitup&&"function"==typeof e.mixitup||(e.mixitup=e.mixItUp=t),(n=e.$||e.jQuery)&&n.fn.jquery&&t.registerJqPlugin(n),t.BaseStatic.call(t.constructor),t.NAME="mixitup",t.CORE_VERSION="3.1.9"}(window),app.plugin.popupMenu=function(e,t,a){function n(){o.slideToggle(200),i.toggleClass("menu-active")}var o=t.jquery?t:$(t),i=e.jquery?e:$(e);return $(document).mouseup(function(e){var t=i;t.is(e.target)||0!==t.has(e.target).length||(o.slideUp(300),i.removeClass("menu-active"))}),o.on("mouseenter.popupMenu",function(){i.addClass("over")}),o.on("mouseleave.popupMenu",function(){i.removeClass("over")}),i.off("click.popupMenu"),a?n:void i.on("click.popupMenu",n)},app.plugin.sliders=function(){var e,t,a=null,n=0,o=null,i=function(o,i){null!==a&&(e=a.offset(),n=o.pageX-e.left,t=Math.ceil(n/a.width()*100),a.find("> .slider-bar").css("width",t+"%"),i.obj.Val=t,i.sync("Items"))},s=function(a,i,s){null!==o&&(e=i.offset(),t=o.width(),n=a.pageX-e.left-t/2,t=Math.min(100-t/i.width()*100,Math.max(0,Math.ceil(n/(i.width()-t/2)*100))),o.css("left",t+"%"),s.obj.Val=t,s.sync("Items"))};$.fn.percentSlider=function(e){var t=this;return t.find(".slider-bar").css({width:Math.ceil(e.obj.Val)+"%"}),t.on("touchstart mousedown",function(n){$("body").addClass("disable-select"),a=t,i(n,e)}).on("touchmove mousemove",function(t){null!==a&&a.get(0)===this&&i(t,e)}).on("touchend mouseup touchcancel mouseleave",function(e){a=null,$("body").removeClass("disable-select")}),this},$.fn.thumbSlider=function(e){var t=this,a=t.find(".slider-bar");return a.css({left:e.obj.Val+"%"}),e.thumb&&t.css("cursor","auto"),t.on("touchstart mousedown",function(n){o=a,$("body").addClass("disable-select"),e.thumb||s(n,t,e)}).on("touchend mouseup touchcancel mouseleave",function(e){o=null}).on("touchmove mousemove",function(a){s(a,t,e)}),t},$(document).on("touchend mouseup touchcancel mouseleave",function(e){a=null,o=null,$("body").removeClass("disable-select")})},app.plugin.social=function(){$.fn.gPlus=function(e){
var t=this;return t.on("click",function(){window.open("https://plus.google.com/share?url="+encodeURIComponent(e),"height=300,width=600")}),t},$.fn.facebook=function(e){var t=this;return t.on("click",function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e),"facebook-share-dialog","width=626,height=436")}),t},$.fn.twitter=function(e,t){var a=this;return a.on("click",function(){window.open("https://twitter.com/share?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(t),"height=300,width=600")}),a},$.fn.twitterVia=function(e){var t=this;return t.on("click",function(){window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(e+" @xtensio_com"),"height=300,width=600")}),t},$.fn.linkedIn=function(e,t,a){var n=this;return n.on("click",function(){window.open("https://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(e)+"&title="+encodeURIComponent(t),"&summary="+encodeURIComponent(a),"height=300,width=600")}),n},$.fn.emailto=function(e){var t=this,a="mailto:?subject=Here's an invite for a free month of Xtensio Plus! Create one pagers, personas, lean canvases and more!&body=Hey there,%0D%0A%0D%0AI wanted to reach out to you because I just discovered Xtensio - a toolbox for smart and beautiful business documents. It comes with FREE tools to help you build one-pagers, user personas, lean canvases, and more.%0D%0A%0D%0AXtensio has been super helpful for my work, so I thought you might want to give it a try. You can sign up here:%0D%0A%0D%0A"+e+"%0D%0A%0D%0AIf you sign up with my link above, we'll both get a free month of premium features with Xtensio Plus!%0D%0A%0D%0ACheers,";t.attr("href",a)},$.socialLinks=function(e,t,a,n,o,i,s){t.find(a).gPlus(e),t.find(n).facebook(e),t.find(o).twitter(e,"I've got invites for a FREE month of Xtensio Plus. Create one pagers, personas, lean canvases for your #startup"),t.find(i).linkedIn(e,"Create an Xtensio account","Invitation to unlock a FREE month of Xtensio Plus. Looking to start a new company or restructure your business? Create dynamic one pagers, lite investor decks, lean canvases, user personas, and more."),t.find(s).emailto(e)},$.shareLinks=function(e,t,a,n,o,i,s,r){t.find(o).gPlus(e),t.find(i).facebook(e),t.find(s).twitter(e,n),t.find(r).linkedIn(e,a,n)}},app.plugin.tooltip=function(){$("[data-tip]").tooltip({delay:150,trigger:"hover",container:"body",placement:"bottom auto",title:function(){return $(this).data("tip")}}).click(function(){$(this).tooltip("hide")})},app.plugin.uploader=function(e,t,a){$.fn.uploader=function(n){var o=this,i=n.module,s=n.success,r=n.imageLoaded,l=$('<input type="file" name="file" accept="image/*"/>'),c=$('<label class="file-label"></label>').append(l),d=$('<form encType="multipart/form-data" class="image-form"></form>').append(c),u=l[0],m=d[0];return n.imageLoaded=function(e){i&&i.hideSpinner(),r&&r(e)},n.success=function(e){s&&s(e),m.reset()},n.error=function(){i&&i.hideSpinner(),m.reset()},l.on("change",function(){var o=u.files&&u.files[0];o&&(i&&i.showSpinner(),a.getData(1,function(a,i,s,r){isfree=0===a.ST||34===a.ST,isfree&&!i&&0==e.Team.Id?t.uploadImage(m,o,n,!0):t.uploadImage(m,o,n,!1)},!0))}),o.append(d)}},app.popup.main=function(e,t,a,n,o,i,s,r,l,c,d){var u=this,m=$('<div id="popup-container"></div>'),f=[],p=app.plugin.lockedTip(e,t),h=app.lib.googleFonts();$("body").append(m),$("body").append($("#notify-popup")),u.spinner=$("#spinner-container > .loading-animation").html(),u.upgrade=$("#tmp-upgrade-panel").html(),$(document).on("keydown",function(e){var t=m.find(".show");if(t.length)if(27!=(e.keyCode||e.which)||t.hasClass("no-close")){var a=t.data("keydownCb");a&&a(e)}else{var n=t.data("closeCb");u.close(),n&&n()}}),u.reg=function(e,t,a,n){e.data("closeCb",a),e.data("keydownCb",n),m.append(e),t&&(e.find(".popup-content").click(function(e){e.stopPropagation()}),e.find(".popup-wrapper").add(t).click(function(){var e=m.find(".show");e.hasClass("no-close")||(u.close(),a&&a())}))},u.push=function(e){f.push(e)},u.pop=function(){f.pop()},u.signIn=app.popup.getSignIn(u,e,a,n),u.signUp=app.popup.getSignUp(u,e,a,n,e.campaignHandle,e.campaignSettings,t),u.signUpTeam=app.popup.getSignUpTeam(u,e,n,h,i,a),u.teamSelector=app.popup.getTeamSelector(u,e,a,n,t),u.signUpDone=app.popup.getSignUpDone(u,a,n),u.signUpDoneInvited=app.popup.getSignUpDoneInvited(u,a,n),u.forgotPass=app.popup.getForgotPass(u,e,a,n),u.settings=app.popup.getSettings(u,e,t,a,n),u.emailSettings=app.popup.getEmailSettings(u,e,t,a,n),u.billing=app.popup.getBilling(u,e,a,n,i,t),u.payment=app.popup.getPayment(u,e,a,n,i),u.discPayment=app.popup.getDiscPayment(u,e,a,n,i),u.message=app.popup.getMessage(u,a),u.busy=app.popup.getBusyPopup(u),u.usermenu=app.popup.getUserMenu(e,u,t,i),u.plusPrompt=app.popup.getPlusPrompt(u,e,i),u.plusInfo=app.popup.getPlusInfo(u,e,a,i,t),u.signupPerformance=app.popup.getSignUpPerformance(e,u,a,n,t,s),u.transferFolio=app.popup.getTransferFolio(e,u,a,n,t),u.labels=app.popup.getLabelsPopup(e,u,a,n,t,s),u.collaborators=app.popup.getCollaboratorsPopup(e,u,a,n,i,p,t),u.archive=app.popup.getArchivePopup(e,u,n),u.unarchive=app.popup.getUnarchivePopup(u,n),u.shareLink=app.popup.getShareLink(n,u,e,i,p,t,d,a),u.folioVersion=app.popup.getFolioVersion(n,u,t,l,e),u.expiredBlocker=app.popup.getExpiredBlocker(e,u),u.failedPaymentBlocker=app.popup.getFailedPaymentBlocker(e,u,n,i,t),u.folioStats=app.popup.getFolioStatsPopup(e,u,n),u.copySectionPopup=app.popup.getCopySectionPopup(e,u,a,l,n),u.importFolioPopup=app.popup.getImportFolioPopup(e,u,n),u.addFolioToSpace=app.popup.getAddFolioToSpace(e,u,n,t),u.transferFolioToSpace=app.popup.getTransferFolioToSpace(e,u,n,i,t),u.saveFolio=app.popup.getSaveFolio(e,u,a,n,t,i),u.personalChannelPopup=app.popup.getPersonalChannelPopup(e,u,n,a),e.Team&&(u.teamSettingPopup=app.popup.getTeamSettingPopup(e,u,n,a),u.teamManagePopup=app.popup.getTeamManagePopup(e,u,n,p,a,i,t),u.sfgUpgradePopup=app.popup.getSfgUpgradePopup(e,u,n,a),u.teamChannelManagePopup=app.popup.getTeamChannelManagePopup(e,u,n,p,a,i,t),u.styleGuidePopup=app.popup.getStyleGuidePopup(e,u,n,t,i,h,p,a),u.addTeamMemberPopup=app.popup.getAddTeamMemberPopup(e,u,n),u.setupTeamPopup=app.popup.getSetupTeamPopup(e,u),u.choosePlanPopup=app.popup.getChoosePlanPopup(e,u,n,i),u.teamUserActionBlocked=app.popup.getTeamUserActionBlocked(e,u),u.teamCollaborationPopup=app.popup.getTeamCollaborationPopup(e,u,a,n,i,p,t),u.addTeamMember=app.popup.getAddMembers(e,u,n),u.transferTeamFolio=app.popup.getTransferTeamFolio(e,u,a,n,t),u.teamChannelPopup=app.popup.getTeamChannelPopup(e,u,n,a),e.Team.Id>0&&(u.failedPaymentBlocker=app.popup.getFailedPaymentTeamBlocker(e,u,n,i,t))),e.editMode&&(u.addModule=u.getAddModule(u,n,e,c,i),u.exp=app.popup.getExport(e,u,a,n,t,i),u.expOption=app.popup.getExpOption(u,a,r)),u.error=function(e,t,a){u.message({heading:t||"Error",message:e||"There was an error, please try again.",btnText:"Close",bodyCentered:a||!1})};var g=m.find(".app-popup");return u.close=function(){m.hide(),o.restore();var e=f.pop();e&&u.show(e),location.hash&&history.pushState("","",location.pathname)},u.show=function(e,t){g.filter(".show").removeClass("show"),e.addClass("show"),e.hasClass("normal")&&o.hideCurrent(),m.show().toggleClass("normal",e.hasClass("normal")),m.show().toggleClass("solid",e.hasClass("solid")),m.show().toggleClass("dark",e.hasClass("dark")),t&&history[location.hash?"replaceState":"pushState"]("","","#"+t)},u},app.popup.getAddFolioToSpace=function(e,t,a,n){function o(n,o,i){console.log("on addFolioId func on addFolioToSpace popup"),console.log("id name url",n,o,i),console.log("fToken fName",d,u),a.getWorkspaceChannels({teamId:n,success:function(a){console.log("response from getWorkspaceChannels on addFolioToSpace popup",a),t.close(),e.saveFolioEditPreview={teamId:n,FolioName:u,Token:d,labels:JSON.parse(a.Data),isUseTemplate:!0},t.saveFolio()},error:function(e){console.log("error",e)}})}function i(e,t,a){return function(){console.log("getFolioToIdFunc func..."),o(e,t,a)}}var s=$("#tmp-add-folio-to-space"),r=s.find(".no-show"),l=s.find(".cancel, .icon-Close"),c=s.find(".teams"),d=null,u=null;if(s.find(".loading-animation").html(t.spinner),e.UserTeams&&e.Team){var m=$(r.html());m.find("h3").text("Personal Account");var f="https://app.xtensio.com";"dev"==e.Environment?f="https://app.xtensio.tech":"local"==e.Environment&&(f="https://www.localhost.com:44301"),console.log("domain",f),m.on("click",i(0,"Personal Account",f)),c.append(m);for(var p=0;p<e.UserTeams.length;p++)5!=e.UserTeams[p].Role&&(m=$(r.html()),4!=e.UserTeams[p].Role&&5!=e.UserTeams[p].Role||(m.find("h3").hide(),m.find(".left").hide(),m.find(".right").hide(),m.find("h3").text(e.UserTeams[p].Name).hide()),m.find("h3").text(e.UserTeams[p].Name),m.on("click",i(e.UserTeams[p].Id,e.UserTeams[p].Name,e.UserTeams[p].TeamUrl)),c.append(m))}return t.reg(s,l),function(a,n){console.log(a,n),u=n,d=a,e.UserTeams.length>0?t.show(s):o(0,"","")}},app.popup.getArchivePopup=function(e,t,a){function n(){r.removeClass("sfg-leave");var t=0;m.empty(),$.each(i.Collaborators,function(a,n){if(n.Privilege>0&&n.Privilege<3&&n.Accepted){var i=$("<option></option>");if(i.val(n.Email).text(n.FullName),e.Team&&e.Team.Id>0){var s=o(n.Email);s<4&&m.append(i)}else m.append(i);t++}}),t>0?(l.hasClass("single")&&l.removeClass("single"),e.Team&&e.Team.Id>0&&5==e.Team.Role?(console.log("in team"),l.addClass(i.Role<3?"single":"").removeClass("archive leave"),r.addClass("sfg-leave"),r.find(".leave-sfg-section").find(".msg .team").text(e.Team.Name)):l.addClass("leave "+(i.Role<3?"single":"")).removeClass("archive")):l.addClass("archive").removeClass("leave single"),p.prop("checked",""),f.prop("disabled",!0).text("Leave Folio")}function o(e){if(v)for(var t=0;t<v.length;t++)if(v[t].Email==e)return v[t].Role;return 0}var i,s,r=$("#tmp-leave-popup"),l=r.find(".popup-content"),c=r.find(".loading-animation"),d=r.find(".archive-section"),u=r.find(".leave-section"),m=u.find("select"),f=u.find(".btn.ok"),p=u.find("input"),h=r.find(".leave-single-section .btn.ok"),g=r.find(".leave-sfg-section .btn.ok"),v=null;return c.html(t.spinner),d.find(".btn.ok").click(function(){t.busy(),a.deleteFolio({data:{token:i.Token},success:s,error:function(e){t.error("There was an error. Please refresh page and try again.")}})}),m.on("change",function(){$(this).closest("label").find("input").click()}),p.click(function(){f.prop("disabled","").text("archive"==$(this).val()?"Delete Folio":"Transfer Folio")}),f.click(function(){if("archive"==u.find("input:checked").val())d.find(".btn.ok").click();else{c.show();var e=m.find("option:checked"),n=e.val(),o=e.text();a.transfer({data:{token:i.Token,name:o,email:n},success:function(){c.hide(),t.message({heading:"Transfer Requested",message:"Folio transfer request has been sent to "+o+".<br/>Folio will be transfered once they accept.",btnText:"OK",handleOK:function(){t.close()}})},error:function(e){t.error(e.Message||"There was an error. Please try later.")}})}}),g.click(function(){a.removeSingleFolioGuest({data:{userEmail:e.userEmail,teamId:e.Team.Id},success:function(){var t="";"live"==e.Environment?t="https://app.xtensio.com/#dashboard":"dev"==e.Environment?t="https://app.xtensio.tech/#dashboard":"local"==e.Environment&&(t="https://www.localhost.com:44301/#dashboard"),window.location=t},error:function(e){showStatus(e.Message,"error")}})}),h.click(function(){c.show(),a.changeCollaborator({data:{verb:"drop",role:i.Role,token:i.Token,email:e.userEmail},success:function(){window.location.href="/"},error:function(e){c.hide(),t.error(e.Message)}})}),t.reg(r,r.find(".icon-Close, .btn.no")),function(o,l){v=null,e.Team&&e.Team.Id>0?(c.show(),a.listTeamMembers({data:{teamId:e.Team.Id},success:function(e){c.hide(),v=e.Data.Data,i=o,s=l,n(),t.show(r)},error:function(e){c.hide()}})):(i=o,s=l,n(),t.show(r))}},app.popup.getBusyPopup=function(e){var t=$("#tmp-busy");t.find(".busy, .anim").html(e.spinner);var a,n,o=t.find(".message"),i=t.find("h1"),s=t.find(".msg"),r=t.find(".anim"),l=function(){a?(r.hide(),o.show(),i.text(a),s.text(n).show()):(o.hide(),r.show())};return e.reg(t),function(o,i){a=o||"",n=i||"",l(),e.show(t)}},app.popup.getCollaboratorsPopup=function(e,t,a,n,o,i,s){function r(){var e=fe?"OK":"See Plans",a=fe?null:"Nevermind";t.push(L),t.message({heading:"Upgrade your account",message:"Collaboration is available only on premium plans. Please upgrade or switch to your team dashboard to add people",btnText:e,cancelText:a,notMini:!fe,handleOK:function(){fe?t.close():t.payment()}})}function l(e){switch(e){case U.main:z.removeClass("selected"),L.find(".popup-header h1.am-h").removeClass("hidden"),L.find(".popup-header p.am-h").removeClass("hidden"),ne.removeClass("hidden"),oe.removeClass("hidden"),L.find(".popup-header h1.sfg-h").addClass("hidden"),L.find(".popup-header p.sfg-h").addClass("hidden"),ie.addClass("hidden"),se.addClass("hidden");break;case U.sfgUser:L.find(".popup-header p.sfg-h .email").text(ge),L.find(".popup-header h1.am-h").addClass("hidden"),L.find(".popup-header p.am-h").addClass("hidden"),ne.addClass("hidden"),oe.addClass("hidden"),L.find(".popup-header h1.sfg-h").removeClass("hidden"),L.find(".popup-header p.sfg-h").removeClass("hidden"),ie.removeClass("hidden"),se.removeClass("hidden")}}function c(n,o,i,s){switch(L.removeClass("belong-to-team"),he=o?a.standardizeEmail(o.email):"",W.removeClass("not-user"),L.removeClass("team-deny-non-xtensio add-paidmem add-guest add-sfg-upgrade"),W.find(".not-user input.email").attr("readonly",!1),l(n),n){case U.main:z.removeClass("selected");break;case U.notUser:if(z.addClass("selected"),e.Team&&0!=e.Team.Id&&!i.teamMember){if(e.Team.Role>2){if(3!==e.Team.Role){var r=4===e.Team.Role?"Premium Guests":"Team Member";return void t.teamUserActionBlocked("invite-member",r)}re.find(".r1").addClass("locked"),re.find(".r2").addClass("locked")}else re.find(".r1").removeClass("locked"),re.find(".r2").removeClass("locked");s?(L.addClass(s),W.find(".username").text(ge)):L.addClass("add-mem"),ne.text(e.Team.Name),oe.text(o.email),re.find(".email").text(he),re.find(".team").text(e.Team.Name),W.find(".email").val(ge),W.find(".full-name").val(""),W.addClass("not-user").removeClass("a-user pending-user sfg-user"),W.find(".not-user input.email").attr("readonly",!0)}else W.find(".email").val(he),W.addClass("not-user").removeClass("a-user pending-user sfg-user");break;case U.aUser:if(z.addClass("selected"),e.Team&&0!=e.Team.Id&&!i.teamMember){if(e.Team.Role>2){if(3!==e.Team.Role){var r=4===e.Team.Role?"Premium Guests":"Team Member";return void t.teamUserActionBlocked("invite-member",r)}re.find(".r1").addClass("locked"),re.find(".r2").addClass("locked")}else re.find(".r1").removeClass("locked"),re.find(".r2").removeClass("locked");s?(L.addClass(s),W.find(".username").text(ge)):L.addClass("add-mem"),ne.text(e.Team.Name),oe.text(he),re.find(".email").text(he),re.find(".team").text(e.Team.Name),z.addClass("selected"),W.find(".email").val(ge),W.addClass("a-user").removeClass("not-user pending-user sfg-user"),W.find(".a-user input.email").attr("readonly",!0)}else e.Team&&0!=e.Team.Id&&i.teamMember&&(L.addClass("belong-to-team"),W.find(".team-role").text(" ("+i.RoleName+")"),W.find(".acc-lvl-txt").hide()),W.data("email",he).find(".username").text(o.name||he),W.find(".email").val(he),W.addClass("a-user").removeClass("not-user pending-user sfg-user");break;case U.pendingUser:z.addClass("selected"),W.data("email",he).find(".username").text(o.name),W.addClass("pending-user").removeClass("not-user a-user sfg-user");break;case U.sfgUser:if(z.addClass("selected"),e.Team&&0!=e.Team.Id&&!i.teamMember){if(e.Team.Role>2)return void t.teamUserActionBlocked("existing-sfg");s?(L.addClass(s),W.find(".username").text(ge)):L.addClass("add-mem"),se.text(o.email),re.find(".email").text(he),re.find(".team").text(e.Team.Name),W.find(".email").val(ge),W.find(".full-name").val(""),W.addClass("not-user").removeClass("a-user pending-user sfg-user"),W.find(".not-user input.email").attr("readonly",!0)}else{if(e.Team.Role>2)return void t.teamUserActionBlocked("existing-sfg");W.find(".email").val(he),W.addClass("sfg-user").removeClass("not-user pending-user a-user")}e.Team&&0!=e.Team.Id&&i.teamMember&&(L.addClass("add-sfg-upgrade"),W.find(".team-role").text(" ("+i.RoleName+")"),W.find(".acc-lvl-txt").hide()),W.data("email",he).find(".username").text(o.name||he),W.find(".email").val(he),W.addClass("sfg-user").removeClass("not-user pending-user a-user")}}function d(e){W.addClass(e),u("",{email:ge},e)}function u(o,i,s){if(ee.find("input").val(""),L.removeClass("add-mem add-sfg contact-supp non-user-add add-sfg-upgrade"),e.Team&&i&&0!=e.Team.Id){var r=a.standardizeEmail(i.email);n.findUser({email:r,success:function(l){if(l.Message)o=C(r)?U.pendingUser:U.aUser,n.listALLMembers({data:{teamId:e.Team.Id},success:function(n){var l={};l.isXUser=!0,l.teamMember=!1;for(var d=0;d<n.Data.Data.length;d++)a.standardizeEmail(n.Data.Data[d].Email)===r&&(l.teamMember=!0,l.RoleName=n.Data.Data[d].RoleName,l.Role=n.Data.Data[d].Role);e.Team&&4===e.Team.Role&&!l.teamMember&&t.teamUserActionBlocked("non-team-member","Premium Guests"),5===l.Role?(o=U.sfgUser,c(o,i,l,s)):c(o,i,l,s),L.find(".loading-animation").hide()},error:function(e){L.find(".loading-animation").hide()}});else{o=U.notUser;var d={};d.teamMember=!1,d.RoleName="",d.Role=0,d.isXUser=!1,c(o,i,d,s)}},error:function(e){m(e.Message,"error")}})}else c(o,i,null,s)}function m(e,t,a){t=t||"success",Z.hide(),a||u(U.main),G.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){G.addClass("hidden")},3e3)}function f(e){for(var t=0;t<O.Collaborators.length;t++)if(a.standardizeEmail(O.Collaborators[t].Email)===e&&O.Collaborators[t].Privilege>0)return O.Collaborators[t];return null}function p(e,t){n.addMembers({data:{teamMembers:e},success:t,error:function(e){m(e.Message,"error")}})}function h(e,t){n.addSingleFolioGuest({data:e,success:t,error:function(e){m(e.Message,"error")}})}function g(e,t){n.addCollaborator({data:e,success:t,error:function(e){m(e.Message,"error")}})}function v(t,a,n,o){if(L.hasClass("belong-to-team"))g({name:a,token:O.Token,role:n,email:t,message:o},function(e){Z.hide(),m("A request has been sent to "+a),w({Email:t,Accepted:null,FullName:a,Privilege:parseInt(n)})});else if(L.hasClass("add-guest")){var i=[],s={email:t,fullName:a,teamId:e.Team.Id,message:o,folioToken:O.Token,accessType:n,role:5};i.push(s),h(i,function(e){Z.hide(),w({Email:t,Accepted:null,FullName:a,Privilege:parseInt(n)}),m(t+" has been added as a Single Folio Guest.")})}else if(L.hasClass("add-paidmem")||L.hasClass("add-pg")||L.hasClass("add-sfg-upgrade")){var r;L.hasClass("add-paidmem")?r=3:L.hasClass("add-pg")&&(r=4);var i=[],s={email:t,fullName:a,teamId:e.Team.Id,message:o,folioToken:O.Token,accessType:n,role:ve};i.push(s),p(i,function(e){Z.hide(),w({Email:t,Accepted:null,FullName:a,Privilege:parseInt(n)}),L.find(".success-panel .list-mems span").text(ge),L.addClass("success")})}}function b(e,a,n,o){var i="";5==n||5==a?(5==a?i="<br><b>You will be charged a prorated amount minus any credits on your account.</b>":5==n&&(i="<br><b>You will be credited a prorated amount on your account.</b>"),t.push(L),t.message({heading:"Change Team Member Access ",message:"Do you really want to change access for <b>"+e+"</b> to <b>"+ke(n)+"</b>?"+i,btnText:"Confirm",notMini:!0,cancelText:"Cancel",handleOK:function(){y(e,n,O.token,o)}})):y(e,n,O.token,o)}function y(a,o,i,s){n.changeMemberAccess({userEmail:a,userRole:o,teamId:e.Team.Id,folioToken:i,accessType:s,success:function(e){setTimeout(function(){Z.hide(),F(O),Z.hide(),t.message({heading:"Success",message:a+" has been successfully upgraded to "+ke(o),btnText:"Ok",notMini:!0})},3e3)},error:function(e){Z.hide(),m(e.Message,"error")}})}function C(e){for(var t=0;t<O.Collaborators.length;t++)if(O.Collaborators[t].Email==e&&null===O.Collaborators[t].Accepted&&O.Collaborators[t].Privilege>0)return!0;return!1}function T(e){for(var t=a.standardizeEmail(e.Email),n=0;n<O.Collaborators.length;n++)if(a.standardizeEmail(O.Collaborators[n].Email)===t&&O.Collaborators[n].Privilege>0&&1==O.Collaborators[n].Accepted)return!0;return!1}function w(e){var t=a.standardizeEmail(e.Email),n=Faltu(O.Collaborators).find({Email:t}).count();if(n)$.each(O.Collaborators,function(n,o){o&&a.standardizeEmail(o.Email)===t&&(O.Collaborators[n].Privilege=e.Privilege,O.Collaborators[n].Accepted=e.Accepted||null)});else{var o=e;O.Collaborators.push(o)}s.raiseEvent("collabChange",O)}function x(e){$.each(O.Collaborators,function(t,a){a&&a.Email==e.Email&&(O.Collaborators[t].Privilege=0,O.Collaborators[t].Accepted=null)}),s.raiseEvent("collabChange",O),$e()}function k(t,a){n.removeSingleFolioGuest({data:{userEmail:t.Email,teamId:e.Team.Id},success:function(){Z.hide(),a.remove(),x(t),m((t.FullName||t.Email)+" has been removed from folio.")},error:function(e){m(e.Message,"error")}})}function S(a,o){var i=a.Email==e.userEmail;return i?void(e.isHome?$(".folio-item-shell[data-token="+O.Token+"]").find(".delete-folio").click():t.archive(O,function(){window.location.href="/"})):(Z.show(),void n.changeCollaborator({data:{verb:"drop",role:a.Privilege,token:O.Token,email:a.Email},success:function(){Z.hide(),o.remove(),x(a),m(a.Accepted?(a.FullName||a.Email)+" has been removed from folio.":"Invitation for "+(a.FullName||a.Email)+" has been cancelled.")},error:function(e){m(e.Message,"error")}}))}function D(a){return function(){var o=!1,i=$(this).closest(".person");return e.Team&&e.Team.Id?(Z.show(),void n.listALLMembers({data:{teamId:e.Team.Id},success:function(n){for(var s=0;s<n.Data.Data.length;s++)n.Data.Data[s].Email==a.Email&&5==n.Data.Data[s].Role&&(k(a,i),o=!0);!o&&e.Team&&5==e.Team.Role?(t.teamUserActionBlocked("collab"),Z.hide()):o||S(a,i)},error:function(e){Z.hide(),m(err.Message,"error")}})):void S(a,i)}}function I(a){return function(){if(e.Team&&5==e.Team.Role)return t.teamUserActionBlocked("collab"),!1;var o=$(this);n.changeCollaborator({data:{role:o.data("value"),token:O.Token,email:a.Email},success:function(){a.Privilege=o.data("value"),m((a.FullName||a.Email)+" can "+(1==a.Privilege?"now view only.":"view and edit now."))},error:function(e){m(e.Message,"error")}})}}function P(e){if(be)for(var t=0;t<be.length;t++)if(be[t].Email==e)return be[t].Role;return 0}function E(t){var a=9;if(e.Team&&e.Team.Id>0&&(a=P(t.Email)),0!==t.Privilege&&t.Accepted!==!1){L.find(".popup-header h1.sfg-h").addClass("hidden"),L.find(".popup-header p.sfg-h").addClass("hidden"),ie.addClass("hidden"),se.addClass("hidden");var n=t.Privilege<3&&t.Email==e.userEmail,o=$(R.html());if(o.data("person",t).addClass(t.Privilege>2||n?"owner":"collabo").find(".isOnwer").text(n?"You":"Owner"),o.addClass(null===t.Accepted&&t.Privilege>0?"pending":""),o.addClass("team-role-"+a).attr("team-role",a),o.find(".name").text(t.FullName||t.Email),o.find(".email").text(t.Email||t.FullName),setTimeout(function(){o.find(".role").trigger("val",["value",t.Privilege]).on("change",I(t))},500),o.find(".remove").on("click",D(t)).attr("data-tip",t.Accepted?t.Privilege>2||n?"Leave Folio":"Remove Collaborator":"Cancel Invitation"),3===t.Privilege)_.append(o),o.find(".actions span.remove").hide();else if(e.Team&&e.Team.Id>0&&e.isDashboard){var i=!1;e.labels.forEach(function(e,a){e.FolioTokens.indexOf(O.Token)!==-1&&e.ChannelMembers.indexOf(t.Email)!==-1&&(i=!0,o.find(".actions span.remove").hide())}),i?V.append(o):K.append(o),V.find(".person").length>0&&j.find(".chan.header").show(),K.find(".person").length>0&&j.find(".folio.header").show()}else K.append(o)}}function F(t){var a=0;_.empty(),K.empty(),V.empty(),j.find("p.header").hide(),$.each(t.Collaborators,function(e,t){t.Privilege>0&&t.Accepted&&a++,t.Privilege=void 0===t.Privilege?1:t.Privilege,E(t)}),a>(e.isHome?0:1)&&j.addClass("hasCollabs"),app.plugin.tooltip(),app.menu.xSelect()}function A(e){return function(){me&&pe?(ge=e.Email||e.FullName,u(U.aUser,{name:e.FullName,email:e.Email})):r()}}function M(e){N(e,!0)}function N(t,a){var o=a||!1,i={getValue:function(e){return e.Email+" "+e.FullName},data:be,theme:"bootstrap",list:{match:{enabled:!0},onClickEvent:function(){var e=te.getSelectedItemData();console.log(e),te.val(e.Email)}}};F(t),$e(),o&&e.Team&&e.Team.Id>0?(L.find(".loading-animation").show(),n.listALLMembers({data:{teamId:e.Team.Id},success:function(e){L.find(".loading-animation").hide(),be=e.Data.Data,te.easyAutocomplete(i)},error:function(e){L.find(".loading-animation").hide()}})):te.easyAutocomplete(i)}var O,U={main:1,notUser:2,aUser:3,pendingUser:4,sfgUser:5},R=$("#tmp-single-person"),L=$("#tmp-collaborators-popup"),B=L.find(".toggle"),G=L.find(".changes-applied"),H=$("#tmp-single-recent"),q=$(".recently-added"),Y=L.find(".header-collaboration-blocker"),z=L.find(".popup-content"),j=z.find(".list"),_=j.find(".owner-list"),K=j.find(".folio-collab-list"),V=j.find(".channel-collab-list"),W=z.find(".selected"),J=W.find(".a-user"),X=W.find(".not-user"),Q=W.find(".sfg-user"),Z=L.find(".loading-animation"),ee=L.find("#collab-search"),te=ee.find("#collab_search"),ae=L.find(".search-btn"),ne=L.find(".popup-header h1.am-h .team"),oe=L.find(".popup-header p.am-h .email"),ie=L.find(".popup-header h1.sfg-h"),se=L.find(".popup-header p.sfg-h"),re=L.find(".team-add"),le=L.find(".add-team-member"),ce=L.find(".add-team-member"),de=ce.find(".custom-msg"),ue=ce.find(".msg-content .icon-Close"),me=!0,fe=!1,pe=!1,he="",ge="",ve=0,be=null,ye="Premium Feature";ae.on("click",function(){me&&pe||r()});var Ce=function(t,a){var n=L.find(".search-btn"),s=ye;o.getData(1,function(t,a,r,l){console.log("data.ST",t.ST),14!==t.ST&&19!==t.ST||(fe=!0),e.Team.Id>0&&4!==e.Team.Role&&5!==e.Team.Role&&(pe=!0),o.hasTeam()?(o.isSingleFolioGuest()||o.isPremiumGuest())&&(s="Guests can not add collaborators.",me=!1):(o.isFree()||o.isPlus())&&(me=!1),me?i.remove(n):i.add(n,s,0)},!0)},Te=function(e){o.setLock(function(e,t){Ce(e,t)},e)};Te();var we=function(){var e=me?"15px":"130px";me?(L.find(".popup-content").removeClass("remove-top-border"),Y.addClass("hidden"),te.removeClass("disable-btns")):(L.find(".popup-content").addClass("remove-top-border"),Y.removeClass("hidden"),te.addClass("disable-btns")),L.find(".icon-Close").css({top:e})};if(Y.find("a.btn").on("click",function(e){e.preventDefault(),window.location.hash="billing"}),de.click(function(){ce.find(".msg-content").show("slow")}),ue.click(function(){ce.find(".msg-content").hide("slow")}),le.find(".invite-confirm").click(function(){var e=le.find(".block:eq(1) .left input").val(),t=le.find(".block:eq(1) .right input").val(),a=le.find(".block:eq(2) .role .popup-menu .item.active").data("value"),n=le.find(".opts .msg-content textarea").val();return validator.isEmail(e)?(Z.show(),void v(e,t,a,n)):void m("Please provide an valid email address.","error",1)}),e.recentCollaborators)for(var xe=0;xe<e.recentCollaborators.length;xe++)!e.recentCollaborators[xe].Email&&e.recentCollaborators[xe].FullName&&(e.recentCollaborators[xe].Email=e.recentCollaborators[xe].FullName);Z.html(t.spinner),re.find(".get-in-touch").click(function(){HelpCrunch("sendUserMessage","I would like to add a new team member.")}),re.find(".add-single-folio-guest").click(function(){d("add-guest")}),re.find(".add-member").click(function(){t.teamManagePopup(!0)}),z.on("click",".pending-user .btn.yes",function(){var e=f(a.standardizeEmail(W.data("email")));g({name:e.FullName,email:a.standardizeEmail(e.Email),role:e.Privilege,token:O.Token},function(){m("An invitation has been sent again to "+e.FullName)})}),z.on("click",".pending-actions .b",function(){var e=$(this),t=e.closest(".person"),a=t.data("person");Z.show(),e.text("Sending ...").css("cursor","default"),g({name:a.FullName,email:a.Email,role:a.Privilege,token:O.Token},function(){Z.hide(),e.text("Invitation Sent!"),t.find(".actions").addClass("active"),setTimeout(function(){e.text("Resend Invitation").css("cursor","pointer"),t.find(".actions").removeClass("active")},3e3)})}),W.find(".cancel").click(function(){u(U.main)}),X.find(".add-collab").on("click",function(){var t=X.find(".full-name").val(),a=X.find(".email").val(),n=X.find(".role").data("value")?X.find(".role").data("value"):2,o=X.find(".msg-area.open").length?X.find("textarea").val():"";return validator.isEmail(a)?(Z.show(),e.Team&&e.Team.Id>0?void v(a,t,n,o):void g({name:t,token:O.Token,role:n,email:a,message:o},function(e){Z.hide(),m("A request has been sent to "+t),w({Email:a,Accepted:null,FullName:t,Privilege:parseInt(n)})})):void m("Please provide a valid email address.","error",1)}),J.find(".add-collab").on("click",function(){Z.show();var t=J.find(".username").text(),a=J.find(".role").data("value")?J.find(".role").data("value"):2,n=W.data("email")||ge,o=J.find(".msg-area.open").length?X.find("textarea").val():"";return e.Team&&e.Team.Id>0?void v(n,t,a,o):void g({token:O.Token,role:a,email:n,message:J.find(".msg-area.open").length?J.find("textarea").val():""},function(e){m("A request has been sent to "+t),w({Email:n,Accepted:null,FullName:t,Privilege:parseInt(a)})})});var ke=function(t){if(e.TeamRoles)for(var a=0;a<e.TeamRoles.length;a++)if(t===e.TeamRoles[a].Id)return e.TeamRoles[a].Name;return"Error in Team ID"};Q.find(".add-collab").on("click",function(){Z.show();var t=2,a=5,n=Q.find(".username").text(),o=Q.find(".role").data("value")?Q.find(".role").data("value"):3,i=W.data("email")||ge;Q.find(".msg-area.open").length?X.find("textarea").val():"";return ve=o,ge=i,e.Team&&e.Team.Id>0?void b(i,a,o,t):void g({token:O.Token,role:t,email:i,message:Q.find(".msg-area.open").length?J.find("textarea").val():""},function(e){m("A request has been sent to "+n),w({Email:i,Accepted:null,FullName:n,Privilege:parseInt(t)})})}),ee.on("submit",function(o){if(!me)return event.preventDefault(),!1;if(ge=a.standardizeEmail(ee.find("input").val()),e.Team&&5==e.Team.Role)return t.teamUserActionBlocked("collab"),!1;var i=a.standardizeEmail($(o.target[0]).val());return Z.show(),validator.isEmail(i)?n.findUser({email:i,success:function(e){Z.hide(),u(e.Message?C(i)?U.pendingUser:U.aUser:U.notUser,{name:e.Message,email:i})},error:function(e){m(e.Message,"error")}}):m("Please provide a valid email address.","error"),!1});var $e=function(){q.empty(),ee.removeClass("hasRecent");var t=0;$.each(e.recentCollaborators,function(e,a){if(!(t>=3||T(a)||C(a.Email))){var n=$(H.html());n.find(".name").text(a.FullName||a.Email),n.find(".email").text(a.Email||a.FullName),n.on("click",A(a)),q.append(n),ee.addClass("hasRecent"),t++}})};return z.on("click",".team-role-5 .resend-team-inv, .team-role-0 .resend-team-inv",function(){var t=$(this),a=t.closest(".person"),o=a.data("person");Z.show(),t.text("Sending ...").css("cursor","default"),n.resendSFGEmailNotification({data:{userEmail:o.Email,teamId:e.Team.Id,folioToken:O.Token,accessType:o.Privilege},success:function(e){Z.hide(),t.text("Invitation Sent!"),a.find(".actions").addClass("active"),setTimeout(function(){t.text("Remind").css("cursor","pointer"),a.find(".actions").removeClass("active")},3e3)},error:function(e){t.text("Remind").css("cursor","pointer"),a.find(".actions").removeClass("active"),m(e.Message,"error")}})}),re.find(".r1").click(function(){if($(this).hasClass("locked")){var a=4==e.Team.Role?"Premium Guests":"Team Member";t.teamUserActionBlocked("invite-member",a,function(e,a){t.show(L)})}else 4==e.Team.Role?t.teamUserActionBlocked("non-team-member","Premium Guests"):(L.find(".popup-header h1.am-h .mem").text("Team Member "),L.find(".popup-header p.am-h").addClass("hidden"),e.Team&&e.Team.ST&&(14==e.Team.ST||19==e.Team.ST||22==e.Team.ST||25==e.Team.ST||28==e.Team.ST||31==e.Team.ST)?(le.find(".block:eq(1) .left input").val(ge),ve=3,d("add-paidmem")):L.addClass("contact-supp"))}),re.find(".r2").click(function(){if($(this).hasClass("locked")){var a=4==e.Team.Role?"Premium Guests":"Team Member";t.teamUserActionBlocked("invite-member",a,function(e,a){t.show(L)})}else 4==e.Team.Role?t.teamUserActionBlocked("non-team-member","Premium Guests"):(L.find(".popup-header h1.am-h .mem").text("Premium Guest "),
L.find(".popup-header p.am-h").addClass("hidden"),e.Team&&e.Team.ST&&(14==e.Team.ST||19==e.Team.ST||22==e.Team.ST||25==e.Team.ST||28==e.Team.ST||31==e.Team.ST)?(le.find(".block:eq(1) .left input").val(ge),ve=4,d("add-paidmem")):L.addClass("add-pg"))}),re.find(".r3").click(function(){4==e.Team.Role?t.teamUserActionBlocked("non-team-member","Premium Guests"):(L.find(".popup-header h1.am-h .mem").text("Single Folio Guest "),re.find(".add-single-folio-guest").trigger("click"))}),t.reg(L,L.find(".popup-close, .btn-close, .back-to"),function(){B.off("click"),s.removeListener("collabChange",N)}),function(o){L.removeClass("success"),be=null,L.find(".loading-animation").show(),O=o,Z.show();for(var i=0;i<O.Collaborators.length;i++)!O.Collaborators[i].Email&&O.Collaborators[i].FullName&&(O.Collaborators[i].Email=O.Collaborators[i].FullName);L.find(".popup-header h1.am-h .mem").text(""),L.find(".popup-header p.am-h").removeClass("hidden"),L.find(".popup-header h1.sfg-h").addClass("hidden"),L.find(".popup-header p.sfg-h").addClass("hidden"),ie.addClass("hidden"),se.addClass("hidden"),e.Team&&e.Team.Id>0?n.listALLMembers({data:{teamId:e.Team.Id},success:function(e){L.find(".loading-animation").hide();var t=e.Data.Data;be=[],t.forEach(function(e,t){var a=e.FullName||"";e.search=e.Email+" "+a,be.push(e)}),u(1),N(o),s.addListener("collabChange",M),B.parent().removeClass("open"),B.on("click",function(){$(this).parent().toggleClass("open")}),Z.hide()},error:function(e){L.find(".loading-animation").hide()}}):(L.find(".loading-animation").hide(),u(1),F(o),$e(),s.addListener("collabChange",N),B.parent().removeClass("open"),B.on("click",function(){$(this).parent().toggleClass("open")}),Z.hide()),we(),l(U.main),a.doSetFocus(te),t.show(L)}},app.popup.getEmailSettings=function(e,t,a,n,o){function i(){s&&$.each(s,function(e,t){d.find("."+n.valToProp(r,t.eType)).val(t.sType)})}var s,r,l,c=$("#tmp-email-settings"),d=c.find(".paper"),u=c.find(".yes"),m=c.find(".icon-Close , .no");return d.find(".loading-animation").html(e.spinner),e.reg(c,m),i(),u.on("click",function(){d.addClass("busy");var t={Digest:d.find(".digest").val(),PlusExtended:d.find(".plusExtended").val(),PlusReminder:d.find(".plusReminder").val(),FormResponse:d.find(".formResponse").val(),TransferRequest:d.find(".transferRequest").val(),TransferResult:d.find(".transferResult").val(),CollaboratorRequest:d.find(".collaboratorRequest").val(),CollaboratorResult:d.find(".collaboratorResult").val(),CollaboratorRevoke:d.find(".collaboratorRevoke").val(),CollaboratorReminder:d.find(".collaboratorReminder").val(),CollaborationChannelUpdate:d.find(".collaborationChannel").val(),OwnerLeave:d.find(".ownerLeave").val()};o.emailSettings({data:{verb:"set",pairs:JSON.stringify(t)},success:function(t){d.removeClass("busy"),e.close()},error:function(){e.error(),d.removeClass("busy")}})}),function(){s||o.emailSettings({success:function(e){s=e.Data.Settings,r=e.Data.EmailTypes,l=e.Data.SettingTypes,i(),d.removeClass("busy")},error:function(){e.error()}}),e.show(c,"manage-notifications")}},app.popup.getExpiredBlocker=function(e,t){var a=$("#tmp-expired-blocker-popup"),n=a.find(".loading-animation"),o=a.find(".upgrade"),i=a.find(".downgrade");return n.html(t.spinner),o.click(function(){t.payment(t.expiredBlocker,!0)}),i.click(function(){t.close(),e.isHome||(location.href="/")}),t.reg(a,a.find(".close-popup-btn, .no")),function(e){e&&e.limit&&e.currUser&&(a.find(".left .plan").text(e.currUser),a.find(".left .limit").text(e.limit)),n.hide(),t.show(a)}},app.popup.getFailedPaymentBlocker=function(e,t,a,n,o){function i(e,n){a.changePlan({data:{plan:e,renew:e?1:0},success:function(e){n(e)},error:function(e){t.error(e.Message||"There was an error. Please try later.")},complete:function(){}})}var s=$("#tmp-failed-payment-blocker-popup"),r=s.find(".loading-animation"),l=(s.find(".paper"),s.find(".upgrade"));s.find(".success-panel");return currPlan=e.Plan,$downgradeBtn=s.find(".downgrade"),$anim=r.html(t.spinner),l.click(function(){t.push(s),t.billing(1,!1)}),$downgradeBtn.click(function(){$anim.show();return t.push(s),n.getData(1,function(n,r,l,c){a.getUserActiveFoliosCount({success:function(n){var r=n.Data;a.getUserTemplateCount({success:function(a){var n,l,c=a.Data,d=r>1||c>0;if(d&&(r>1&&c<1?(n="Uh oh - You have more than 1 folio!",l="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):r>1&&c>0?(n="Uh oh - You have more than 1 folio and saved templates",l="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):r<2&&c>0&&(n="Uh oh - You have saved templates!",l="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),$anim.hide(),d)t.message({heading:n,message:l,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){t.close()}});else{var u="";2==currPlan?u="Pro":1==currPlan&&(u="Plus"),t.push(s),t.message({heading:'<span style="font-size: 26px;">Are you sure you want to cancel?</br><span style="font-size: 18px;">These changes will take effect immediately.</span></span>',message:"You will be downgraded to Free Forever plan and will be limited to 1 active folio and 3 exports per month.<br><br>Are you sure you want to change your current plan?",btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,handleOK:function(){$anim.show(),i(0,function(){$anim.hide(),o.raiseEvent("plusCancelled"),t.message({heading:'<h1 class="emphasize">Downgrade Successful</h1>',message:'<h3>Current Plan: <span class="prox-bold">Xtensio Free Forever</span></h3>',btnText:"Ok",notMini:!0,handleOK:function(){t.close(),window.location=e.baseUrl}})})}})}},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1}),t.reg(s,s.find(".close-popup-btn, .no")),function(e){e&&e.limit&&e.currUser&&(s.find(".left .plan").text(e.currUser),s.find(".left .limit").text(e.limit)),r.hide(),t.show(s)}},app.popup.getFailedPaymentTeamBlocker=function(e,t,a,n,o){function i(){t.push(r),t.billing(1,!1)}function s(){window.HelpCrunch?HelpCrunch("showChatWidget"):t.message({heading:"Please wait",message:"Please wait a few moments while the help window loads and try again.",btnText:"OK"})}if(n.isOwner()){if(e.IsDelinquent){var r=$("#tmp-failed-payment-team-blocker-owner-popup"),l=r.find(".upgrade");l.click(i)}}else if(e.Team.IsDelinquent)var r=$("#tmp-failed-payment-team-blocker-popup");if(r){var c=r.find(".contact-support");c.click(s),t.reg(r,r.find(".close-popup-btn, .no"))}return function(e){r&&t.show(r)}},app.popup.getFolioVersion=function(e,t,a,n,o){function i(){d>h&&D.removeClass("hidden"),v||C.find(".v-table-row:eq(0)").removeClass("previous").addClass("current").find(".actions").text("Currently Live"),I()}function s(n){var o=function(){S.show(),e.folioVersion({data:{id:n.Id,token:c,verb:"revert"},success:function(e){t.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully reverted. You need to refresh this page.",handleOK:function(){a.raiseEvent("removeCollabs")}})},error:function(e){t.error(e.Message)}})};return"Last revision before update"==n.Notes?function(){t.message({heading:"Warning",message:"You are going to revert folio to older version so your collaborators would be removed.",btnText:"Go ahead",cancelText:"Cancel",handleOK:o})}:function(){S.show(),e.folioVersion({data:{id:n.Id,token:c,verb:"revert"},success:function(e){t.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully reverted. You need to refresh this page.",handleOK:function(){location.reload()}})},error:function(e){t.error(e.Message)}})}}function r(){$.each(p.splice(0,h),function(e,t){var a,o;a=$(w),o=moment(t.Time),a.data("item",t),a.find(".date").text(o.format("MM/DD/YY")),a.find(".time").text(o.format("h:mm a")),a.find(".note-container input").val(t.Notes||""),t.IsCurrent&&(v=!0,a.removeClass("previous").find(".actions").text("Currently Live")),a.find(".preview-btn").prop("href","/version-preview/"+c+"/"+t.Id),a.find(".revert-btn").on("click",s(t)),"Last revision before update"==t.Notes&&n.Role<3||C.append(a)}),0===p.length&&D.addClass("hidden"),I()}function l(){r(),i()}var c,d,u,m,f,p,h=6,g=!1,v=!1,b=$("#tmp-folio-version"),y=b.find(".icon-Close"),C=b.find(".v-table"),T=$("#tmp-folio-version-table"),w=T.html(),x=$('<div class="nonplus hidden"></div>'),k=$('<div class="overlay"></div>'),S=b.find(".loading-animation"),D=b.find(".showmore");S.html(t.spinner);var I=function(){v&&C.find(".v-table-row:eq(0)").removeClass("previous").addClass("current").find(".note-edit").remove(),u=b.find(".note-edit"),m=b.find(".note-save"),f=b.find(".note-container input"),u.click(function(){$(this).parent().addClass("editable"),f=$(this).parent().find("input"),f.prop("readonly",!1).focus()}),m.click(function(){var t=$(this).closest(".v-table-row").data("item").Id;$(this).parent().removeClass("editable"),f=$(this).parent().find("input"),f.prop("readonly",!0),e.folioVersion({data:{id:t,verb:"note",note:f.val(),token:c},success:function(){},error:function(){}})}),f.on("keydown",function(e){13==(e.which||e.keyCode)&&m.click()})};return D.click(r),k.append("<p class='plus-note'>You need <a href='https://www.xtensio.com/plus'>Xtensio Plus</a> to revert to an older version.</p>"),t.reg(b,y),function(a,n){S.show(),c=n,g=a.plusExpireTime>=Date.now(),C.find(".v-table-row").remove(),x.empty(),e.folioVersion({data:{token:c},success:function(e){p=JSON.parse(e.Message),d=p.length,l(),S.hide()}}),t.show(b)}},app.popup.getFolioStatsPopup=function(e,t,a){function n(e){var t=JSON.parse(e),a=moment.utc(t.Created).format("L").replace(new RegExp("/","g"),".");c.find(".dp-created").text(a),d>-1?c.find(".dp-used").text(d).parent().show():c.find(".dp-used").parent().hide();var n=m(t.LastEdited);c.find(".dp-lastEdited").text(n);var o=m(t.LastViewed);c.find(".dp-lastViewed").text(o),c.find(".dp-edits").text(t.Edits),u?c.find(".dp-collaborators").parent().hide():c.find(".dp-collaborators").text(t.Collaborators).parent().show(),c.find(".dp-revisions").text(t.Revisions),c.find(".dp-exports").text(t.Exports),c.find(".dp-private").text(t.Private),c.find(".dp-views").text(t.Views),c.find(".dp-password").text(t.Password),setTimeout(function(){i.find(".loading-animation").hide(),s.find(".folio-stats-section").css({opacity:1})},500)}function o(e){s.find(".folio-stats-section").css({opacity:0}),i.find(".loading-animation").show(),a.getFolioDataPoints({token:e,success:function(e){null!=e.Data&&n(e.Data)},error:function(e){console.log("error stats: ",e)}})}var i=$("#tmp-folio-stats-popup"),s=i.find(".paper"),r=i.find(".popup-cta.cancel"),l=i.find(".icon-Close"),c=s.find(".folio-stats-section"),d=-1,u=!1;t.reg(i,r),t.reg(i,l);var m=function(e){if(""==e)return"never";var t=moment().valueOf();e=moment.utc(e).valueOf(),e=moment(e).local().valueOf(),console.log(e,t,t-e);var a=Math.round((t-e)/36e5),n=Math.round(a/24),o=Math.round(n/7),i=Math.round(n/30),s=Math.round(i/12);return a<1?"Less than an hour ago":a<24?a+" hour"+(a<2?"":"s")+" ago":n<7?n+" day"+(n<2?"":"s")+" ago":o<5?o+" week"+(o<2?"":"s")+" ago":i<12?i+" month"+(i<2?"":"s")+" ago":s<12?s+" year"+(s<2?"":"s")+" ago":void 0};return i.find(".loading-animation").html(t.spinner),function(e,a,n){n&&(d=n.UsedCount,u=n.isTemplate),o(e),i.find(".popup-header h1").text(a),t.show(i)}},app.popup.getImportFolioPopup=function(e,t,a){var n=$("#tmp-import-folios"),o=(n.find(".paper"),n.find(".popup-header")),i=n.find(".list-of-folios"),s=n.find(".select-all"),r=n.find(".select-folios .ok"),l=n.find(".team-name"),c=[],d=!1,u=n.find(".error"),m=n.find(".confirm-move .back"),f=n.find(".confirm-move .ok"),p=n.find(".succ .ok"),h=n.find(".icon-Close"),g=n.find(".confirm-move .team-url"),v=n.find(".loading-animation");v.html(t.spinner),s.click(function(){$(this).hasClass("selected")?($(this).removeClass("selected"),i.find(".select").removeClass("selected")):($(this).addClass("selected"),i.find(".select").addClass("selected"))});var b=function(e){u.text(e).show("slow"),setTimeout(function(){u.hide("slow")},3e3)};r.click(function(){if(c=[],d){if($moveables=i.find(".selected"),$moveables.length<1)return void b("Please Select a Folio to move.");for(var a=0;a<$moveables.length;a++)c.push($moveables[a].getAttribute("data-token"));console.log(c),o.find("h3 .number").text(c.length),o.find("h3 .verb").text(c.length>1?"folios":"folio"),g.attr("href","https://"+e.Team.TeamUrl).text(e.Team.TeamUrl),y("confirmation")}else t.close()}),m.click(function(){y("")}),f.click(function(){v.show(),a.moveUserFolios({userEmail:e.userEmail,source:0,destination:e.Team.Id,folios:c,success:function(e){n.find(".succ .message").text(e.Message),v.hide(),y("complete"),$("#folio-items-container").find(".empty").remove(),$("#folio-items-container").find(".my-empty").remove()},error:function(e){b(e.Message),v.hide()}})}),p.click(function(){window.location=e.baseUrl});var y=function(e){n.removeClass("no-folio"),n.removeClass("complete"),n.removeClass("confirmation"),n.addClass(e)};return t.reg(n,n.find(".icon-Close, .cancel, .succ .ok")),h.click(function(){window.location=e.baseUrl}),function(){y(""),console.log(l,e.Team.Name),l.text(e.Team.Name),v.show(),t.show(n),a.getUserOwnFolios({success:function(t){i.empty();var a=JSON.parse(t.Data);if(a.length>0){d=!0,console.log("folio list",a);for(var o=0;o<a.length;o++){var s='<a href="#" class="select" data-token="'+a[o].Token+'"><span class="check"></span><span class="name">'+a[o].FolioName+"</span></a>";i.append(s),i.find(".select:last-child").click(function(e){$(this).toggleClass("selected"),e.preventDefault()})}r.text("Move to "+e.Team.Name)}else d=!1,y("no-folio"),n.find(".msg .cancel").text("Cancel");v.hide()},error:function(e){v.hide()}})}},app.popup.getLabelsPopup=function(e,t,a,n,o,i){function s(){if(v.addClass("hidden"),e.Team&&e.Team.Id>0)n.changeCollabChan({token:c.Token,labelToken:T,success:function(){v.removeClass("hidden"),d(),setTimeout(function(){v.addClass("hidden")},3e3)},error:function(e){t.error(e.Message)},complete:function(){l(!0)}});else{var a=c.Labels.join();a!=c.lastSaved&&(c.lastSaved=a,n.changeLabels({token:c.Token,list:a,success:function(){v.removeClass("hidden"),d(),setTimeout(function(){v.addClass("hidden")},3e3)},error:function(e){t.error(e.Message)},complete:function(){l(!0)}}))}}function r(a){v.addClass("hidden");var o={token:c.Token,id:a,success:function(){v.removeClass("hidden"),d(),setTimeout(function(){v.addClass("hidden")},3e3)},error:function(e){t.error(e.Message)},complete:function(){l(!0)}};e.Team&&e.Team.Id>0?n.removeFromCollabChan(o):n.removeFromLabels(o)}function l(e){C=!e,e?(y.hide(),g.removeClass("disable-ui")):(y.show(),g.addClass("disable-ui"))}var c,d,u,m,f,p=$("#tmp-label-item").html(),h=($("#all-labels-container"),$("#single-label").html(),$(".labels-dropdown"),$("#tmp-labels")),g=h.find(".labels"),v=$(".changes-applied"),b=$(".add-missing-label"),y=h.find(".loading-animation"),C=!1,T="";y.html(t.spinner),g.on("click",".label-check",function(){if(!C){l(!1),clearTimeout(u);var e=$(this),t=e.data("id");e[0].checked?(a.pushUnique(c.Labels,t),T=t,u=setTimeout(s,800)):(f.removeClass(a.removeFromList(c.Labels,t)),currentRemovedChannel=t,u=setTimeout(r(t),800))}});var w=function(e){if(13==(e.which||e.keyCode))return void b.click();var t=$.trim($(this).val()).replace(/ +/g," ").toLowerCase(),a=m.show().filter(function(){var e=$(this).text().replace(/\s+/g," ").toLowerCase();return!~e.indexOf(t)}).hide();a.length==m.length?(b.removeClass("hidden").find("span").text($(this).val()),g.hide()):(b.addClass("hidden"),g.show())};return $("#add-label-from-popup").on("click",function(){if(e.Team&&e.Team.Id>0){if(5===e.Team.Role||4===e.Team.Role)return void t.teamUserActionBlocked("label");t.teamChannelPopup()}else t.personalChannelPopup(function(){window.location.reload()});return!1}),t.reg(h,h.find(".icon-Close")),function(n,o,i){if(e.Team&&e.Team.Id>0&&5==e.Team.Role)return void t.teamUserActionBlocked("label");c=n,f=o,d=i,c.lastSaved=c.Labels.join(),g.empty().show();for(var s=0;s<e.labels.length;s++){var r=e.labels[s],l=$(p),u=l.find(".label-check").data("id",r.Token);l.find(".label-name").css("background-color",r.color).text(r.Name);var v=a.indexOf(c.Labels,r.Token);v>=0&&(u[0].checked=!0),g.append(l)}m=g.find("label"),$("#labels-search").keyup(w).val(""),b.on("click",function(){$(this).off("click"),$("#add-label-from-popup").data("suggestedName",$(this).find("span").text()).click()}).addClass("hidden"),t.show(h)}},app.popup.getMessage=function(e,t){var a,n,o,i,s,r,l,c,d,u,m,f,p,h,g,v,b,y,C,T=$("#tmp-message"),w=!1,x=T.find("h1"),k=T.find(".msg"),S=T.find(".text-area"),D=T.find(".input").not("#valid-popup-ok"),I=T.find(".ok"),P=T.find(".no"),E=T.find(".popup-content"),F=T.find(".icon-Close"),A=T.find(".cta-btns"),M=!1,N=function(){T.toggleClass("no-close",d),x.html(a),P.toggleClass("hidden",!l&&!r).text(l),F.toggleClass("hidden",d),D.toggleClass("hidden",!u).val(o),I.text(i).attr("href",c||"#"),k.removeClass("error").html(n),M&&k.addClass("text-center"),S.toggleClass("hidden",!h),E.toggleClass("mini",!y)};return $(".popup-validation-message").removeClass("error"),I.on("click",function(){if(C){if(!C())return $(".popup-validation-message").addClass("error").html(b),!1;$(".popup-validation-message").removeClass("error")}if(s){var a=!0,n=D.val(),o=S.val();v&&!n?k.addClass("error").html(v):"email"==m?(a=validator.isEmail(n),a||k.addClass("error").html("Invalid email. Please provide a valid email address.")):"url"===m&&(a=t.isValidURL(n),console.log("isValid",a),a||k.addClass("error").html("Invalid url. Please provide a valid url.")),a&&(e.close(),p&&e.busy(),s(n,o))}else e.close();return!!c}),e.reg(T,P.add(F),0,function(e){w&&13==(e.keyCode||e.which)&&I.click()}),P.click(function(){r&&r()}),F.click(function(){r&&r(),e.close()}),function(t){a=t.heading,n=t.message||"",o=t.input,i=t.btnText||"Save",h=t.showArea,s=t.handleOK,C=t.beforeHandle,l=t.cancelText,c=t.url,d=!!t.noClose,m=t.validateFor,p=t.showBusy,r=t.handleNo,u=t.showInput||o,w=t.enterAsOK,f=t.defaultInputValue,v=t.emptyError,b=t.validationError,g=t.handleError,y=t.notMini,M=t.bodyCentered,I.addClass(t.okClass),t.isSwitchCta?A.addClass("is-switch"):A.removeClass("is-switch"),D.attr("placeholder",t.inputPlaceholder||""),S.val(t.areaText||"").attr({rows:t.rows||3,placeholder:t.areaPlaceholder||"Message (Optional)"}),T.attr("class","app-popup "+(t.namespace||"")),N(),e.show(T)}},app.popup.getPlusInfo=function(e,t,a,n,o){var i=$(e.spinner),s=$("#tmp-xtensio-plus"),r=s.find(".icon-Close"),l=(s.find(".ends-text"),s.find(".earned"),s.find(".percent-inner"),s.find(".joined"),s.find("input"));s.find(".unlock-head");return l.val(t.sharePlusLink).copier(),s.find(".loading-animation").append(i),$.socialLinks(t.sharePlusLink,s,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),s.find(".invite-link").attr("href",t.sharePlusLink),e.reg(s,r),s.find(".upgrade-btn").click(function(){e.payment(function(){e.plusInfo()})}),function(){e.message({heading:"Sorry",message:"This campaign is no longer available.",btnText:"OK"})}},app.popup.getPlusPrompt=function(e,t,a){t.plusInfo?t.plusExpireTime=t.plusInfo.End:t.plusExpireTime=Date.now();var n=$("#tmp-plus-prompt"),o=n.find(".msg");return n.find(".upgrade-panel").html(e.upgrade),n.find(".invite-link").val(t.sharePlusLink).copier(),$.socialLinks(t.sharePlusLink,n,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),e.reg(n,n.find(".icon-Close")),n.find(".ok").click(function(){e.payment()}),function(i,s,r,l){var c=Date.now();if("pass"==i){a.getData(1,function(t,a,n,o){a?10==t.ST||11==t.ST||3==t.ST||16==t.ST?e.billing():s():e.payment()})}else if((t.autoRenew||c<t.plusExpireTime)&&s)s();else{if(r)return void("create"==i?a.getData(1,function(t,a,n,o){var i=1,s="Free Forever";(a&&10==t.ST||11==t.ST)&&(i=5,s="Xtensio Plus"),(a&&16==t.ST||3==t.ST)&&(i=5,s="Free Plus"),e.message({heading:"Upgrade for more!",message:"The "+s+" plan has a limit of "+i+" active folio"+(i>1?"s":"")+".  To work on more folios, please delete/leave some old folios or upgrade to premium plans.",btnText:"See Plans",cancelText:"Nevermind",notMini:!0,handleOK:function(){10==t.ST||11==t.ST?(console.log("From here..."),e.billing()):e.payment()}})}):e.payment());if(l)return void e.billing();var d='Unlock <a class="x-plus" target="_blank" href="//xtensio.com/plus">Xtensio Plus</a> ',u="Xtensio Plus allows you to export your folio as PDF or PNG";o.show(),"export"==i?d+="to export this folio":"export-mod"==i?d+="to export this module":"export-sec"==i?d+="to export this section":"pass"==i?(d+="for password protection",u="Xtensio Plus enables you to password protect any of your folios"):"create"==i?(d+="to create more folios",u="With a free account, you're limited to 1 folio"):(d+="to access this feature",o.hide()),n.find("h1").html(d),n.find(".desc").text(u),e.show(n)}}},app.popup.getSaveFolio=function(e,t,a,n,o,i){function s(){var e=K?"OK":"See Plans",a=K?null:"Nevermind";t.push(E),t.message({heading:"Upgrade your account",message:"Collaboration is available only on premium plans. Please upgrade or switch to your team dashboard to add people",btnText:e,cancelText:a,notMini:!K,handleOK:function(){K?t.close():t.billing()}})}function r(e){var t=a.standardizeEmail(e.Email),n=Faltu(j).find({Email:t}).count();n?$.each(j,function(n,o){o&&a.standardizeEmail(o.Email)===t&&(j[n].Privilege=e.Privilege,j[n].Accepted=e.Accepted||null)}):j.push(e)}function l(e){var t=a.standardizeEmail(e.Email),n=Faltu(_).find({Email:t}).count();n?$.each(_,function(n,o){o&&a.standardizeEmail(o.Email)===t&&(_[n].Privilege=e.Privilege,_[n].Accepted=e.Accepted||null)}):_.push(e)}function c(){var n=5,o=0,s=null,r=[];if(L.empty(),J=0,showCollabButton=!1,1===q.length&&(showCollabButton=!0),q.forEach(function(t){if(3===parseInt(t.Privilege,10)&&(s=t),t.Privilege>0&&t.Email!=e.userEmail)if(++o<=n){var i=$('<div class="outer"><div class="initials">MU</div></div>');i.find(".initials").text(a.getInitials(t.FullName||t.Email)).attr("data-tip",t.FullName),L.prepend(i.find(".initials"))}else r.push(t.FullName)}),o>n){var l=L.find(".initials:last-child");r.unshift(l.attr("data-tip")),l.attr("data-html","true").text("+"+(o-n+1)).attr("data-tip",r.join("<br/>"))}var c=$('<div class="initials add"><i class="icon-AddCollaborator2"></i></div>');i.isSingleFolioGuest()?(c.attr("data-tip","Guests can not add/remove people"),c.click(function(){t.teamUserActionBlocked("add-remove-collab","Guests")})):(c.show(),c.attr("data-tip","Add / Remove People"),c.click(b())),0===J&&showCollabButton===!1?(L.append(c),J+=1):0===J&&showCollabButton===!0&&B.show()}function d(e,t){t=t||"success",A.hide(),N.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){N.addClass("hidden"),F=!1},3e3)}function u(){O.val("Untitled"),R.empty(),L.empty(),E.removeClass("no-close"),y&&($(".fgroup").find("div.selectize-input div.item").each(function(){var e=$(this).attr("data-value");y[0].selectize.removeItem(e)}),y[0].selectize.refreshItems(),y[0].selectize.refreshOptions()),V.selectize()[0].selectize.destroy(),U.hide(),L.hide(),B.show()}function m(e){return"Untitled ("+e+")"}function f(t){var n,o=[],i=[],s=$('<div class="selectize-custom-err"><div class="custom-msg">Channel does not exist.</div></div>');if(t){t.length;t.forEach(function(t,a){var n=t.ID||null,i=t.Token||t.LabelToken,s=t.color||e.colors[a];o.push({id:n,name:t.Name,color:s,IsDefault:t.IsDefault,token:i})});var r=a.findIndex(!0,"IsDefault",t);console.log("defIndex",r),r!==-1&&i.push(t[r].Name)}P=o,console.log(P,i),y=V.selectize({maxItems:null,valueField:"name",labelField:"name",searchField:"name",options:o,render:{item:function(e,t){var a=e.color?'style="background-color:'+e.color+'"':"";return'<div class="item" '+a+">#"+t(e.name)+'<i class="fa fa-times" aria-hidden="true"></i></div>'}},items:i,create:!1,disableDelete:!0,onType:function(e){E.find(".selectize-control .selectize-custom-err").hide(),clearTimeout(n),e.toString().length>=3&&(this.currentResults.items.length||(clearTimeout(n),E.find(".selectize-control .selectize-custom-err").show(),hideInterval=setTimeout(function(){E.find(".selectize-control .selectize-custom-err").hide()},3e3)))}}),E.find(".selectize-control").append(s)}function p(e){var t=null;q=[],e.forEach(function(e){("undefined"!==q||q.length>0)&&q.indexOf(e.Email)===-1&&(3===parseInt(e.Privilege,10)?(console.log("existing owner:",e),t=e):(console.log("loggin collab before push:",e),q.push(e)))});var n=a.findIndex(I,"Email",e);I!==t.Email&&1===parseInt(e[n].Privilege,10)&&(O.addClass("disable"),B.addClass("disable"),H.addClass("disable"),R.addClass("disable"))}function h(){M.click(function(){window.location="/"}),E.addClass("no-close")}function g(e,t){n.addSingleFolioGuest({data:e,success:t,error:function(e){d(e.Message,"error")}})}function v(e,t){n.addMembers({data:{teamMembers:e},success:t,error:function(e){d(e.Message,"error")}})}function b(){return function(){return t.teamCollaborationPopup(q),!1}}var y,C,T,w,x,k,S,D,I,P,E=$("#tmp-save-folio"),F=!1,A=E.find(".loading-animation").html(t.spinner),M=E.find(".popup-close"),N=E.find(".changes-applied"),O=($("#tmp-single-email"),$("#folio_name")),U=$("#collab-cont"),R=$("#collab-list"),L=$(".collabs"),B=E.find(".add-new"),G=(E.find(".add-btn"),E.find(".team-add")),H=$("#collab"),q=[],Y=[],z=!1,j=[],_=[],K=!1,V=$("#channels"),W=E.find(".save-folio");B.click(function(){z?(U.show(),L.show(),B.hide(),e.saveCurrentStep=1,t.teamCollaborationPopup(q)):s()}),G.find(".r3").click(function(){5==e.Team.Role&&(E.find(".popup-header h1.am-h .mem").text("Single Folio Guest "),G.find(".add-single-folio-guest").trigger("click"))}),$(".fgroup").on("click","div.selectize-input div.item",function(e){var t=E.find(".selectize-input.has-items").children(".item").length;if(console.log("channel items number",t),t>1){var a=(y[0].selectize,$(this).attr("data-value"));y[0].selectize.removeItem(a),y[0].selectize.refreshItems(),y[0].selectize.refreshOptions()}else d("A Folio must be included in at least one channel. Add a different channel if you want to remove this one.","error"),console.log("need to have at least 1")}),W.click(function(t){if(!F){A.show(),F=!0,W.addClass("disable");var o=n.sanitizeText(O.val().trim()),i=[],s=[];if(O.val(o),o.length<3)return d("Please provide a valid folio name.","error"),void W.removeClass("disable");E.find(".selectize-input.has-items").children(".item").each(function(){if($(this).attr("style")){var e=a.findIndex($(this).data("value"),"name",P);e!==-1&&s.push(P[e])}else i.push({name:$(this).data("value")})});var c=null;w?c=w.Token:x?c=x.Token:S?c=S.Token:C&&(c=C.Token),!c&&e.token&&(c=e.token);var u=!1;w&&null!==w.isUseTemplate?u=w.isUseTemplate:k&&null!==k.isUseTemplate&&(u=k.isUseTemplate);var m=!1;C&&null!==C.IsDuplicate&&(m=C.IsDuplicate);var f=0;if(k&&"undefined"!=typeof k.teamId)f=k.teamId;else if(e.Team&&e.Team.Id>0&&e.UserTeams.length>0){var p=a.findIndex(e.Team.Id,"Id",e.UserTeams);console.log("teamIdIndex",p),p>-1&&(f=e.Team.Id)}console.log("saveFolio teamUsersList:::",q),console.log("saveFolio newTeamUsersList:::",Y);var h={teamId:f,folioToken:c,templateId:T?T.id:null,isUserTemplate:u,isDuplicate:m,data:{folioName:o,collaborators:q,newTeamUsers:Y,channels:s,newChannels:i},success:function(t){var a=e.baseUrl;x&&"undefined"!=typeof x.baseUrl&&""!==x.baseUrl&&e.Team&&e.Team.Id>0&&f===e.Team.Id&&(a=x.baseUrl),Y.forEach(function(e){e.Privilege>0&&0!==e.Role&&(0!==e.Role&&5===e.Role?(e.FolioToken=t.Message,r(e)):l(e))}),j.length>0&&g(j),_.length>0&&v(_),window.location=a+"/edit/"+t.Message+"#new",e.editMode&&setTimeout(function(){window.location.reload()},300),e.saveFolioSuccess={Result:!0},console.log("saveFolioSuccess",e.saveFolioSuccess)},error:function(t){A.hide(),W.removeClass("disable"),d(t.Message,"error"),e.saveFolioSuccess={Result:!0}}};console.log(h),n.saveFolio(h)}});var J=0;return t.reg(E,M),function(o,s,r){return q=[],1===o?(s.forEach(function(e){q.push(e)}),r.forEach(function(e){Y.push(e)}),c(),void t.show(E)):(E.find(".icon-Close").css({top:"15px"}),A.hide(),W.removeClass("disable"),O.removeClass("disable"),B.removeClass("disable"),H.removeClass("disable"),R.removeClass("disable"),u(),teamMemList=null,e.userEmail?I=a.standardizeEmail(e.userEmail):e.userName&&(I=a.standardizeEmail(e.userName)),e.Team&&e.Team.Id>0&&n.listALLMembers({data:{teamId:e.Team.Id},success:function(e){teamMemList=e.Data.Data},error:function(e){}}),void i.getData(1,function(n,o,i,s){if(console.log("data.ST",n.ST),14!==n.ST&&19!==n.ST||(K=!0),e.Team.Id>0&&4!==e.Team.Role&&5!==e.Team.Role&&(z=!0),e.saveFolioTemplate)console.log("using config for xtensio template flow"),O.val(m(e.saveFolioTemplate.name)),T=e.saveFolioTemplate,e.saveFolioTemplate=null,f(e.labels);else if(e.saveFolioTransferItem){console.log("using config for transfer folio or user template"),w=e.saveFolioTransferItem;var r=w.FolioName?w.FolioName:w.Folio;O.val(r),w.isUseTemplate||h();var l=w.labels?w.labels:e.labels;f(l),e.saveFolioTransferItem=null}else if(e.saveFolioTransferWithTeam)console.log("using config for transfer folio with team context"),x=e.saveFolioTransferWithTeam,O.val(x.FolioName),f(x.labels),p(x.collaborators);else if(e.saveFolioEditPreview){if(console.log("using config for edit folio on preview"),k=e.saveFolioEditPreview,O.val(k.FolioName),f(k.labels),k&&"undefined"!=typeof k.teamId&&(z=!1,k.teamId>0)){var c=a.findIndex(k.teamId,"Id",e.UserTeams);if(c!==-1){var d=e.UserTeams[c];4!==d.Role&&5!==d.Role&&(z=!0)}}}else e.sfgButtonClicked?(D=e.sfgButtonClicked,e.sfgButtonClicked=null,f(e.labels)):e.saveFolioCollabItem?(console.log("using config for collaboration request"),S=e.saveFolioCollabItem,O.val(S.FolioName),f(S.labels),p(S.collaborators),h()):e.duplicateFolioItem&&(console.log("using config for duplicate folio."),C=e.duplicateFolioItem,O.val(C.FolioName),f(e.labels));F=!1,t.show(E),a.doSetFocus(O)},!0))}},app.popup.getSignUpPerformance=function(e,t,a,n,o,i){function s(t,a,n){var o="viewed";i.get(t,o,function(s){var r=0;s=new Date(JSON.parse(s||JSON.stringify(new Date(2016,4,30).getTime()))),b.removeClass("busy"),n.t!=e.token?(g.text(n.n).attr("href","/edit/"+n.t),h.show()):h.hide(),f.html(a.length+(1==a.length?" Response":" Total Responses")),v.empty(),$.each(a,function(e,t){var a="</td><td>";t.Created>s&&(a="<span></span></td><td>",r++);var n=t.Created.getMonth()+1;n=n<10?"0"+n:n;var o=t.Created.getDate();o=o<10?"0"+o:o,v.append("<tr><td>"+a+n+"/"+o+"/"+t.Created.getFullYear()+"</td><td>"+t.Data.email+"</td></tr>")}),p.html(r+" New"),r&&i.set(t,o,JSON.stringify(new Date))})}function r(e,a,o){l=e;var u=c[l];u?s(l,u.list,u.data):a?(c[l]={list:a,data:o},r(l,a,o)):(b.addClass("busy"),n.getRecords({id:l,success:function(t){a=JSON.parse(t.Message),$.each(a,function(e,t){t.Created=new Date(t.Created),t.Data=JSON.parse(t.Data)}),i.reg(e,JSON.parse(t.Data.s)),r(l,a,t.Data)},error:function(e){t.error()}})),t.show(d,u?"res-"+e:"")}var l,c={},d=$("#tmp-sign-up-performance"),u=d.find(".icon-Close"),m=d.find(".export"),f=d.find(".total-count"),p=d.find(".new-items"),h=d.find(".f-name"),g=h.find("a"),v=d.find(".performance-table tbody"),b=d.find(".paper");return b.find(".loading-animation").html(t.spinner),t.reg(d,u),m.on("click",function(){var e=c[l];if(e){e=e.list;var t="data:text/csv;charset=utf-8,Date,Email\n",a=e.length;$.each(e,function(e,n){var o=1+n.Created.getMonth()+"/"+n.Created.getDate()+"/"+n.Created.getFullYear()+","+n.Data.email;t+=e<a?o+"\n":o});var n=encodeURI(t);window.open(n)}}),o.addListener("newSignUp",function(e){var t=c[e.Data.ModId];t&&t.list.unshift({ID:e.Data.RecId,Created:new Date(e.Time),Data:e.Data.Data})}),r.reg=function(e,t,a){c[e]={list:t,data:a
}},r},app.popup.getTransferFolio=function(e,t,a,n,o){function i(e){var t=m.height()+16;switch(r=e,p.prop("readonly",!0),m.css("min-height",""),m.removeClass("busy search sent found not-found"),r){case d.busy:m.css("min-height",t).addClass("busy");break;case d.found:m.addClass("found"),T.text(l),S.text("Transfer");break;case d.notFound:m.addClass("not-found"),x.text(c),S.text("Invite & Transfer");break;case d.sent:m.addClass("sent"),S.addClass("no").removeClass("yes").text("Close"),D.find(".name").text(l||I.val()+" signs up and");break;default:m.addClass("search"),p.prop("readonly",!1),S.text("Search")}}function s(){i(d.busy),n.transfer({data:{token:E,name:l||I.val(),email:c,message:g.val(),AllowOutside:!0},success:function(e){i(d.sent)},error:function(e){i(d.search),y.show().text(e.Message||"There was an error. Please try later.")}})}var r,l,c,d={search:1,busy:2,found:3,notFound:4,sent:5},u=$("#tmp-transfer"),m=u.find(".paper"),f=u.find(".popup-header h1"),p=m.find(".email").val(""),h=m.find(".msg-box"),g=h.find(".msg"),v=h.find(".msg-content"),b=h.find(".close-msg-btn"),y=m.find(".error"),C=m.find(".found"),T=C.find(".name"),w=m.find(".not-found"),x=w.find(".name"),k=m.find(".add-msg"),S=m.find(".popup-cta"),D=m.find(".result"),I=m.find(".full-name").val(""),P=m.find(".back-btn"),E=e.token,F=!1;return m.find(".loading-animation").html(t.spinner),k.click(function(){k.hide(),v.show()}),b.click(function(){k.show(),v.hide(),g.val("")}),P.click(function(){p.val(""),i(d.search)}),S.click(function(){switch(r){case d.search:c=$.trim(p.val());var a=validator.isEmail(c);a&&c==e.userEmail&&e.Team&&e.Team.Id>0&&1==e.Team.Role?t.transferFolioToSpace({sameUser:!0,Data:{Token:E,TeamID:e.Team.Id,Owner:c}}):a&&c==e.userEmail&&e.Team&&0==e.Team.Id?y.show().text("You can not transfer to yourself!"):a?(y.hide(),i(d.busy),n.findUser({email:c,success:function(a){e.Team&&e.Team.Id>0&&e.Team.Role<4&&a.Message&&(F?i(d.found):n.listTeamMembers({data:{teamId:e.Team.Id},success:function(e){for(var a=!1,n=!1,o=0;o<e.Data.Data.length;o++)e.Data.Data[o].Email==c&&(a=!0,l=e.Data.Data[o].UserName,5==e.Data.Data[o].Role&&(a=!1,i(d.search),y.show().text(e.Message||"This user is a Single Folio User on this team."),n=!0));a?i(d.found):t.message({heading:"Can not transfer folio",message:"You can transfer your folio's ownership only to another team member. Please contact your team admin if you need to transfer your folio over to someone outside your team.",btnText:"Ok",notMini:!0})},error:function(e){y.show().text(e.Message||"There was an error. Please try later.")}})),e.Team&&e.Team.Id>0&&e.Team.Role<4&&!a.Message?t.message({heading:"User Not found",message:"Team folios can only be transferred to existing Xtensio users. Please ask this person to create a free Xtensio account and try again.",btnText:"Ok",notMini:!0}):(l=a.Message||l,i(a.Message?d.found:d.notFound))},error:function(){i(d.search),y.show().text("There was an error. Please try later.")}})):y.show().text("Invalid Email");break;case d.found:s();break;case d.notFound:l=I.val(),w.toggleClass("no-name",!l),l&&s();break;default:t.close()}}),u.find(".is-team-admin").click(function(){t.transferTeamFolio(E,{allowOutside:!0})}),t.reg(u,u.find(".icon-Close"),function(){$(document).off(".enterOnTransfer")}),function(a,n){return F=!1,n&&(F=n.allowOutside||!1),F?f.html('Transfer Ownership<br><span style="font-size: 16px;">Outside Team</span>'):f.html("Transfer Ownership"),e.Team&&e.Team.Id>0&&5==e.Team.Role?void t.teamUserActionBlocked("transfer"):e.Team&&e.Team.Id>0&&4==e.Team.Role?void t.teamUserActionBlocked("transfer","Premium Guests"):(e.Team&&e.Team.Id>0&&(1==e.Team.Role||2==e.Team.Role)&&!F?u.addClass("team-allow-out"):u.removeClass("team-allow-out"),E=a||E,y.hide(),i(d.search),p.val(""),S.addClass("yes"),b.trigger("click"),$(document).on("keydown.enterOnTransfer",function(e){13==(e.keyCode||e.which)&&S.click()}),void t.show(u))}},app.popup.getUnarchivePopup=function(e,t){return function(a,n){e.message({heading:"Are you sure you want to recover?",message:"This folio will return to your dashboard as an active folio. You will be able to edit and share this folio again.",btnText:"Yes, Recover This",cancelText:"Cancel",enterAsOK:!0,handleOK:function(){e.busy(),t.deleteFolio({data:{op:"undo",token:a.Token},success:n,error:function(t){5==t.StatusCode?e.plusPrompt("create",null,!0):10==t.StatusCode?e.plusPrompt("create",null,!1,!0):e.error("There was an error. Please refresh page and try again.")}})}})}},app.popup.upgradePrompt=function(e,t,a,n,o,i){e.plusInfo?e.plusExpireTime=e.plusInfo.End:e.plusExpireTime=Date.now();var s=$("#tmp-upgrade-prompt"),r=s.find(".msg");return s.find(".upgrade-panel").html(t.upgrade),t.reg(s,s.find(".icon-Close")),s.find(".ok").click(function(){t.payment()}),function(a,n,i,l){var c=Date.now();if("pass"==a){o.getData(1,function(e,a,o,i){a?10==e.ST||11==e.ST||3==e.ST||16==e.ST?t.billing():n():t.payment()})}else if((e.autoRenew||c<e.plusExpireTime)&&n)n();else{if(i)return void("create"==a?o.getData(1,function(e,a,n,o){var i=1,s="Free Forever";(a&&10==e.ST||11==e.ST)&&(i=5,s="Xtensio Plus"),(a&&16==e.ST||3==e.ST)&&(i=5,s="Free Plus"),t.message({heading:"Upgrade for more!",message:"The "+s+" plan has a limit of "+i+" active folio"+(i>1?"s":"")+".  To work on more folios, please delete/leave some old folios or upgrade to premium plans.",btnText:"See Plans",cancelText:"Nevermind",notMini:!0,handleOK:function(){10==e.ST||11==e.ST?(console.log("From here..."),t.billing()):t.payment()}})}):t.payment());if(l)return void t.billing();var d='Unlock <a class="x-plus" target="_blank" href="//xtensio.com/plus">Xtensio Plus</a> ',u="Xtensio Plus allows you to export your folio as PDF or PNG";r.show(),"create"==a?(d+="to create more folios",u="With a free account, you're limited to 1 folio"):(d+="to access this feature",r.hide()),s.find("h1").html(d),s.find(".desc").text(u),t.show(s)}}},app.popup.getUserMenu=function(e,t,a,n){function o(){e.isTeam&&e.Team&&1!==e.Team.Role&&u.hide()}function i(){n.getData(0,function(a,n,o,i){console.log(o,n,e.everPlus,a);var s=!1;if(e.UserTeams)for(var r=0;r<e.UserTeams.length;r++)1==e.UserTeams[r].Role&&(s=!0);1==a.ST||2==a.ST||9==a.ST||10==a.ST||11==a.ST||e.everPlus||n||s?t.billing():t.payment()})}function s(){(r||e.everPlus)&&u.text("Billing")}var r=Date.now()<e.plusExpireTime,l=$("#top-bar .user-menu-popup"),c=l.find(".e-settings"),d=l.find(".logout"),u=l.find(".billing"),m=l.find(".plus"),f=l.find(".settings");l.find(".nav-setmenu li");o(),s(),a.addListener("plusUnlocked",s),f.click(function(){t.settings()}),m.click(function(){t.plusInfo()}),c.click(function(){t.emailSettings()}),d.click(function(){$("#logoutForm").submit()}),u.click(i)},app.popup.getBilling=function(e,t,a,n,o,i){function s(e){e=e||"Error - Please review the highlighted fields.",x.text(e).addClass("show")}function r(t,a){w.addClass("busy"),n.changePlan({data:{plan:t,renew:t?1:0},success:function(e){o.refresh(),ce(1),a(e)},error:function(t){e.push(w),e.error(t.Message||"There was an error. Please try later.")},complete:function(){w.removeClass("busy")}})}function l(e){for(var a=0;a<t.TeamRoles.length;a++)if(t.TeamRoles[a].Id==e)return t.TeamRoles[a].Name}function c(){C?o.getData(1,function(e,t,a,n){h=e,I.find("section.team-member").remove(),console.log("planDetails",h);var o=d(h.ST);19===h.ST||25===h.ST||31===h.ST?(I.find("section.team-owner h2:eq(0) span.bold:eq(0)").text(o),I.find("section.team-owner .is-yearly").hide(),I.find("section.team-owner p:eq(0) span.bold:eq(0)").text("monthly")):14!==h.ST&&22!==h.ST&&28!==h.ST||(I.find("section.team-owner h2:eq(0) span.bold:eq(0)").text(o),I.find("section.team-owner .is-monthly").hide(),I.find("section.team-owner p:eq(0) span.bold:eq(0)").text("yearly"))}):I.find("section.team-owner").remove()}function d(e){var t="";switch(e){case 14:t="Business Yearly (GrandFathered)";break;case 22:t="Business Yearly";break;case 28:t="Pro Yearly";break;case 19:t="Business Monthly (GrandFathered)";break;case 25:t="Business Monthly";break;case 31:t="Pro Monthly"}return t}function u(){return o.isProBusiness()?"Pro":"Business"}function m(t,a){w.addClass("busy");var i="Xtensio"+t+" "+a+"ly";console.log("planCycle",a),console.log("planType",t),console.log("planName",i),a===y&&t===b?(w.removeClass("busy"),e.push(w),e.error("You are already in "+i,"Error",!0)):(e.push(w),e.message({heading:"Change Plan",message:"Are you sure you want to change your current plan to "+i+"?",btnText:"Yes, I am sure",bodyCentered:!0,cancelText:"Nevermind",notMini:!0,handleOK:function(){n.changeTeamPlan({plan:t+a,success:function(e){w.removeClass("busy"),console.log("ChangeTeamPlan res",e),o.refresh(),w.find(".popup-content").addClass("success"),w.find(".success-panel").addClass("plan-changed"),w.find(".success-panel .plan-change .plan-name").text(i),w.find(".success-panel .plan-change h3 span").text(i)},error:function(t){w.removeClass("busy"),console.log("ChangeTeamPlan error",t),e.push(w),e.error(t.Message||"There was an error. Please try later.")}})},handleNo:function(){w.removeClass("busy")}}))}var f,p,h,g,v,b,y,C=!1,T="selected",w=$("#tmp-billing"),x=w.find(".error-msg"),k=w.find(".save-card"),S=w.find(".save-plan"),D=w.find(".paper"),I=w.find(".status-tab"),P=(I.find(".expire"),I.find(".date")),E=(I.find(".upgrade-panel"),I.find(".user-plan"),I.find(".discount")),F=(E.find(".claim-offer"),I.find(".unlock"),w.find(".pay-tab")),A=F.find(".credit-card"),M=w.find(".invoice-tab"),N=(I.find(".right"),I.find(".details")),O=F.find(".month"),U=F.find(".year"),R=F.find(".existing"),L=F.find(".change-card"),B=F.find(".change-plan"),G=w.find(".radios a"),H=F.find(".change-renew"),q=F.find("input, select"),Y=M.find(".history"),z=w.find(".tabs span"),j=w.find(".card-change-status"),_=w.find(".plan-change-status"),K=A.find(".num"),V=A.find(".cvc"),W=A.find(".name"),J=!1,X=!1,Q=!1,Z=!1,ee=!0,te=w.find(".choose-plan"),ae=w.find(".circular-switch"),ne=0,oe=w.find("section .plan-cont"),ie=w.find(".success-panel"),se="";ie.find(".no").click(function(){w.find(".popup-content").removeClass("success"),e.close(),window.location=t.baseUrl});var re=function(e){e||ee?(ae.attr("title","Yearly"),ae.toggleClass("off",!e),ae.find(".button-switch").text("Yearly"),ee=!0):(ae.attr("title",ee?"Yearly":"Monthly"),ae.toggleClass("off",!ee),ae.find(".button-switch").text("Monthly"),ee=!1),ae.find(".button-switch").text(ee?"Yearly":"Monthly"),ee?ae.addClass("off"):ae.removeClass("off"),$("#tmp-billing .paper section .button p").removeClass("selected"),$("#tmp-billing .paper section .button p:eq("+(ee?0:1)+")").addClass("selected"),ee?($("#tmp-billing .plan-block:eq(1) .plan-head h1 span.num").text("25"),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small-inline").text("/user/mo"),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small").text("$300/user/year"),$("#tmp-billing .plan-block:eq(1) .plan-head a").attr("href","/teams/create/?plan=year"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.num").text("15"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small-inline").text("/user/mo"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small").text("$180/user/year"),$("#tmp-billing .plan-block:eq(0) .plan-head a").attr("href","/teams/create/?plan=proyear")):($("#tmp-billing .plan-block:eq(1) .plan-head h1 span.num").text("30"),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small-inline").text(""),$("#tmp-billing .plan-block:eq(1) .plan-head h1 span.small").text("/user/mo"),$("#tmp-billing .plan-block:eq(1) .plan-head a").attr("href","/teams/create/?plan=month"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.num").text("20"),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small-inline").text(""),$("#tmp-billing .plan-block:eq(0) .plan-head h1 span.small").text("/user/mo"),$("#tmp-billing .plan-block:eq(0) .plan-head a").attr("href","/teams/create/?plan=promonth")),ee?(oe.addClass("yearly"),oe.removeClass("monthly")):(oe.addClass("monthly"),oe.removeClass("yearly"))};ae.on("click",function(){ee=!ee,re()}),re();var le={Plusmonthly:10,Plusyearly:8,Promonthly:14,Proyearly:10};for(te.click(function(){$("#tmp-payment .plan-banner").hide();var a="",i="",s=$(this).attr("data-plan");if("Team"!=s){if("Credits"===s)return void e.payment(null,null,{planName:s,isYearly:ee});var l=(le[s+(ee?"yearly":"monthly")],("Pro"==s?"":"Plus")+(ee?"Year":"Month"));o.getData(1,function(c,d,u,m){if(!u){var f={planName:s,isYearly:ee};return void e.payment(null,null,f)}i="Are you sure you want to change your current plan to <b>Xtensio ",i+="Pro"==s?"Pro ":"Plus ",i+=ee?"Yearly":"Monthly",i+="</b>?",1==ne&&"Pro"==s?a="Upgrade Plan":2==ne&&"Plus"==s?(a='<span style="font-size: 26px;">Are you sure you want to downgrade?</br><span style="font-size: 18px;">These changes will take effect immediately.</span></span>',i="By downgrading your plan, you'll no longer have unlimited folios and exports.</br></br>Are you sure you want to change your current plan?"):a="Change Plan";var p="Xtensio ";p+="Pro"==s?"Pro ":"Plus ",p+=ee?"Yearly":"Monthly",w.addClass("busy"),n.getUserActiveFoliosCount({success:function(c){w.removeClass("busy");var d=c.Data;n.getUserTemplateCount({success:function(n){var c=n.Data,u=d>5||c>0;if(2==ne&&"Plus"==s&&u){var m,f;d>5&&c<1?(m="Uh oh - You have more than 5 folios!",f="The Xtensio Plus plan has a limit of 5 folios. In order to downgrade your account, please delete extra folios on your dashboard."):d>5&&c>0?(m="Uh oh - You have more than 5 folios and saved templates",f="The Xtensio Plus plan has a limit of 5 folios and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):d<6&&c>0&&(m="Uh oh - You have saved templates!",f="The Xtensio Plus plan does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard."),e.push(w),e.message({heading:m,message:f,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){window.location=t.baseUrl}})}else e.push(w),e.message({heading:a,message:i,btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,handleOK:function(){r(l,function(){ce(0),o.refresh(),console.log("inside"),w.find(".popup-content").addClass("success"),w.find(".success-panel").addClass("plan-changed"),w.find(".success-panel .plan-change .plan-name").text(p),w.find(".success-panel .plan-change h3 span").text(p)})}})},error:function(e){w.removeClass("busy"),console.log("error: ",e)}})},error:function(e){w.removeClass("busy"),console.log("error: ",e)}})},!0)}}),w.find(".expire .not-charged").hide(),w.find(".expire .prox-bold").text(""),w.find(".loading-animation").html(e.spinner),e.reg(w,w.find(".icon-Close")),w.find(".icon-Close").click(function(){e.close(),a.reloadWithoutHash()}),k.find(".loading-animation").html(e.spinner),S.find(".loading-animation").html(e.spinner),p=1;p<=12;p++)O.append('<option value="'+p+'">'+p+"</option>");for(p=(new Date).getFullYear();p<=2030;p++)U.append('<option value="'+p+'">'+p+"</option>");var ce=function(a,n){I.find(".right").show(),w.find("section .plan-cont .plan-block").removeClass("selected"),t.hasDiscount&&I.css({visibility:"hidden"});var i="Xtensio ";I.removeClass("paying").find(">div").hide(),w.addClass("busy"),B.add(L).removeClass("cancel"),o.getData(0,function(o,s,r,l){C&&I.find("section.team-owner .date").text(l),w.removeClass("busy"),w.find(".existing").toggleClass("yearly",2==o.ST);var c=":eq("+a+")",d="selected";if(z.removeClass(d).filter(c).addClass(d),D.removeClass(d).filter(c).addClass(d),w.find(".tabs span:eq(1)").toggleClass("disable",!r),w.find(".tabs span:eq(2)").toggleClass("disable",!r&&!t.everPlus),(r||o.Count)&&de(),F.find(".auto-on, .auto-off").hide(),W.val(o.Name),Y.empty(),$.each(o.Invoices,function(e,t){Y.append('<p class="clearfix"><span class="time">'+moment(t.Time).format("MMMM DD, YYYY")+'</span><span class="gray">$'+t.Price+'</span><a target="_blank" href="/billing/invoice/'+t.Id+'">PDF</a></p>')}),o.Invoices.length<1&&Y.append('<p class="clearfix">No invoices yet.</p>'),s||r){if(f.text("Add Billing Information"),i+="Plus ",1==o.ST||2==o.ST||9==o.ST||10==o.ST||11==o.ST||14==o.ST||19==o.ST||22==o.ST||25==o.ST||28==o.ST||31==o.ST||34==o.ST){se="xxxx xxxx xxxx "+o.Last4,K.val(se),F.find(".left .existing").html("<h3>"+o.Brand+'</h3><p><span class="stars">**** **** **** </span>'+o.Last4+"</p>");var u=I.addClass("paying").find(".user-plan").show(),m=2==o.ST||11==o.ST||9==o.ST?"year":"month";u.find(".type").text(m+"ly"),u.find(".time").text(m),F.find(".date").text(l),I.find(".plan-verb").text("will renew on"),w.find("section .date").text(l),9==o.ST?F.find(".package").text("Student"):1==o.ST||2==o.ST?F.find(".package").text("Pro"):10==o.ST||11==o.ST?F.find(".package").text("Plus"):F.find(".package").text("Free"),F.find(".period").text(2==o.ST||9==o.ST||11==o.ST?"Yearly":"Monthly"),o.AR?F.find(".auto-on").show():F.find(".auto-off").show(),w.find("section .plan-cont .plan-block:eq(0) button").text("Purchase Export Credits"),w.find("section .plan-cont .plan-block:eq(0) .plan-bot").removeClass("downgrade"),w.find("section .plan-cont .plan-block:eq(1) button").text("Upgrade to Pro");var p="Xtensio ";9==o.ST?p+="Student ":1==o.ST||2==o.ST?(p+="Pro (GrandFathered)",w.find("section .plan-cont .plan-block:eq(1)").addClass("selected"),w.find("section .plan-cont .plan-block:eq(0) button").text("Downgrade to Plus"),w.find("section .plan-cont .plan-block:eq(0) .plan-bot").addClass("downgrade"),ne=2):10!=o.ST&&11!=o.ST||(console.log("planName",p),p+="Plus ",w.find("section .plan-cont .plan-block:eq(0)").addClass("selected"),ne=1),1==o.ST||10==o.ST?(p+="Monthly (GrandFathered)",ee=!0,w.find("section .plan-cont .plan-block.selected").removeClass("yearly monthly"),w.find("section .plan-cont .plan-block.selected").addClass("monthly"),w.find("section .plan-cont .plan-block.selected .plan-bot button").text("Switch to Yearly"),w.find("section .plan-cont .plan-block.selected .plan-bot button").removeClass("gray")):2!=o.ST&&9!=o.ST&&11!=o.ST||(p+="Yearly (GrandFathered)",ee=!1,w.find("section .plan-cont .plan-block.selected").removeClass("yearly monthly"),w.find("section .plan-cont .plan-block.selected").addClass("yearly"),w.find("section .plan-cont .plan-block.selected .plan-bot button").text("Switch to Monthly"),w.find("section .plan-cont .plan-block.selected .plan-bot button").addClass("gray")),re(n),w.find("section .plan-name").text(p)}else I.find(".expire").show().find(".verb").text("will expire"),I.find(".upgrade-panel").show(),F.find(".auto-off").show().find(".date").text(l);w.find(".no-charge").toggleClass("hidden",o.CST<3)}else f.text("Upgrade"),I.find(".upgrade-panel").show(),(o.Count||o.Referrals.length)&&(I.find(".expire").show().find(".verb").text("expired"),w.find(".expire .prox-bold").text("Upgrade to regain access to Plus features."));J=1==o.ST||10==o.ST,1==o.ST||10==o.ST||2==o.ST||11==o.ST||9==o.ST||(I.find(".right").hide(),w.find(".plan-block .plan-bot").removeClass("downgrade"),w.find(".plan-block").removeClass("yearly"),w.find(".plan-block").removeClass("monthly"),w.find("section .plan-cont .plan-block:eq(0) button").text("Purchase Export Credits"),w.find("section .plan-cont .plan-block:eq(1) button").text("Upgrade to Pro"),i="Xtensio (Free)",w.find(".upgrade-panel .right").css({marginTop:"0"}),w.find("section p .plan-name").text("Xtensio (Free)"),I.find(".plan-verb").text("has expired on"),s?(w.find(".expire .prox-bold").text("Add billing information to retain access to Plus features."),w.find(".expire .not-charged").show(),w.find(".upgrade-panel .right").css({marginTop:"20px"}),i="Xtensio Pro (Free)",Q=!0,w.find("section p .plan-name").text("free Xtensio"),I.find(".plan-verb").text("will expire on")):o.Count||o.Referrals.length||(w.find(".expire .prox-bold").text("Unlock more features with Xtensio Plus."),w.find(".expire").show(),w.find(".expire .exp-txt").hide(),i="Xtensio (Free)",Z=!0,X||t.everPlus||!t.Team||0!=t.Team.Id||e.payment()),"Xtensio (Free)"===i&&w.find(".team-member .plans-det p").hide(),w.find("section h3 .plan-name").text(i),s&&4==o.ST?(w.find("section p .plan-name").text("Free Pro"),w.find("section h3 .plan-name").text("Free Pro")):!s||16!=o.ST&&3!=o.ST||(w.find("section p .plan-name").text("Free Plus"),w.find("section h3 .plan-name").text("Free Plus"))),I.find(".plan").text(i),0!=o.ST||s?P.text(l):P.text(moment(Date(t.planCancel)).format("MMMM Do, YYYY")),I.css({visibility:"visible"})})};z.click(function(){var e=$(this);return e.hasClass("disable")||ce(e.index()),!1}),f=w.find(".upgrade-panel").html(e.upgrade).find(".ok"),w.find(".invite-link").val(t.sharePlusLink).copier(),$.socialLinks(t.sharePlusLink,w,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin",".share-emailto a"),f.click(function(){e.payment()}),k.click(function(e){var a=0,i=K.val(),r=V.val(),l=O.val(),c=U.val(),d=W.val();return i==se?(j.html('<i class="fi-check"></i> Changes saved.').removeClass("hidden"),setTimeout(function(){j.html("").addClass("hidden")},3e3),!1):(q.removeClass("error"),x.removeClass("show"),Stripe.card.validateCardNumber(i)||(a=1,K.addClass("error")),Stripe.card.validateCVC(r)||(a=1,V.addClass("error")),Stripe.card.validateExpiry(l,c)||(a=1,O.add(U).addClass("error")),d||(a=1,W.addClass("error")),void(a?s():(k.find(".loading-animation").removeClass("hidden"),k.find("span").text("Saving ..."),k.prop("disabled",!0),Stripe.card.createToken({number:i,cvc:r,exp_month:l,exp_year:c,name:d},function(e,a){if(a.error)s(a.error.message);else{var i=a.card,r=a.id;n.card({data:{Token:r,CardId:i.id,Last4:i.last4,Brand:i.brand,Name:d},success:function(e){o.refresh(),L.trigger("click"),K.val(""),k.find(".loading-animation").addClass("hidden"),k.find("span").text("Save"),k.prop("disabled",!1),j.html('<i class="fi-check"></i> Credit card changed successfuly.').removeClass("hidden"),setTimeout(function(){j.html("").addClass("hidden"),window.location=t.baseUrl},3e3)},error:function(e){s(e.Message)},complete:function(){w.removeClass("busy")}})}}))))}),S.click(function(){var e=G.filter("."+T).data("time"),a=$(this);a.find(".loading-animation").removeClass("hidden"),a.find("span").text("Saving ..."),a.prop("disabled",!0),r(e,function(){R.toggleClass("yearly","Year"==e),F.find(".period").text(e+"ly"),B.trigger("click"),S.find(".loading-animation").addClass("hidden"),S.find("span").text("Save"),S.prop("disabled",!1),_.html('<i class="fi-check"></i> Plan changed successfuly.').removeClass("hidden"),setTimeout(function(){_.html("").addClass("hidden"),window.location=t.baseUrl},3e3)})}),L.click(function(){w.find(".pay-tab").find(".change-card span:last-child").css({display:""}),w.find(".pay-tab").find(".change-card span:first-child").css({display:""}),w.find(".pay-tab").find(".change-card").hasClass("cancel")?(w.find(".pay-tab").find(".change-card span:last-child").css({display:"inline"}),w.find(".pay-tab").find(".change-card span:first-child").css({display:"none"})):(w.find(".pay-tab").find(".change-card span:last-child").css({display:"none"}),w.find(".pay-tab").find(".change-card span:first-child").css({display:"inline"})),$(this).toggleClass("cancel"),F.find(".left").toggleClass("edit")}),B.click(function(){$(this).toggleClass("cancel"),F.find(".right").toggleClass("edit")}),I.find(".plus-btn").click(function(){e.plusInfo()});var de=function(){n.getStripInvoiceData({success:function(e){if("Success"==e.Status){$("#billingUserInvoices").html(""),data=JSON.parse(e.Data);var t="https://static.accountdock.com/app.min.js";if(("localhost"==window.location.hostname||"www.localhost.com"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||window.location.hostname.indexOf("xtensio.tech")>-1||window.location.hostname.indexOf("localhost.com")>-1)&&(t="https://sandbox.accountdock.com/app.min.js"),"undefined"==typeof AccountDock){var a=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=t,a.appendChild(n)}if("undefined"!=typeof AccountDock){var o=AccountDock.configure({key:data.AccountDockKey,customer:data.StripeCustomerId});$(function(){o.open({container:"#billingUserInvoices"})})}}}})};I.find(".cancel-plan-btn").click(function(){return o.getData(1,function(a,s,l,c){e.push(w),n.getUserActiveFoliosCount({success:function(a){var s=a.Data;n.getUserTemplateCount({success:function(a){var n,l,c=a.Data,d=s>1||c>0;if(d&&(s>1&&c<1?(n="Uh oh - You have more than 1 folio!",l="The Free Forever plan has a limit of 1 folio. In order to downgrade your account, please delete extra folios on your dashboard."):s>1&&c>0?(n="Uh oh - You have more than 1 folio and saved templates",l="The Free Forever has a limit of 1 folio and does not support saving templates. In order to downgrade your account, please delete extra folios and all saved templates on your dashboard."):s<2&&c>0&&(n="Uh oh - You have saved templates!",l="The Free Forever does not support saving templates. In order to downgrade your account, please delete all saved templates on your dashboard.")),d)e.push(w),e.message({heading:n,message:l,btnText:"Go to Dashboard",cancelText:"Nevermind",notMini:!0,handleOK:function(){window.location=t.baseUrl}});else{var u="";2==ne?u="Pro":1==ne&&(u="Plus");var m=new Date(t.plusInfo.End+1);e.message({heading:'<span style="font-size: 26px;">                                                 Are you sure you want to cancel? </br>                                                 <span style="font-size: 18px;">                                                     Please confirm to proceed                                                 </span>                                             </span>',message:'<div class="row" style="margin-bottom: 10px;"><div class="col-md-1">      <input type="checkbox" name="confirm" id="cancel-premium-features">            </div>  <div class="col-md-11">     <label for="cancel-premium-features">I understand that I will be downgraded immediately and I will not have    access to premium features anymore.     </label>    </div></div><div class="clearfix"></div><div class="row">   <div class="col-md-1">      <input type="checkbox" name="confirm" id="cancel-refund">           </div>  <div class="col-md-11">      <label for="cancel-refund">I understand that there are no refunds or credits for cancellations.</label>    </div></div><div class="row">   <div class="col-md-12"> <br><br>    PS. If you intend to keep using Xtensio, we suggest canceling your subscription the day before it renews. Your next billing cycle begins on '+m.toDateString()+'.    </div></div><p class="popup-validation-message"></p>',btnText:"Yes, I am sure",cancelText:"Nevermind",notMini:!0,validationError:"Please confirm that you have read and understood the above.",beforeHandle:function(){var e=$("#cancel-premium-features"),t=$("#cancel-refund");return!(!e.is(":checked")||!t.is(":checked"))},handleOK:function(){w.find(".popup-content").hide(),$("#barecancel-trigger").trigger("click"),setTimeout(function(){var e=setInterval(function(){0!==$(".bm-cancel").length?(clearInterval(e),$(".bm-cancel").css("z-index",9999),$(".bm-cancel .bm-action-submit").click(function(){r(0,function(){w.find(".success-panel").removeClass("plan-changed"),w.find(".popup-content").addClass("success"),o.refresh(),i.raiseEvent("plusCancelled"),w.find(".popup-content").show()})}),$(".bm-cancel .bm-nevermind").click(function(){w.find(".popup-content").show()})):console.log("Retrying... waiting for baremetrics DOM to be available.")},300)},100)}})}},error:function(){}})},error:function(e){console.log("error: ",e)}})}),!1}),N.click(function(){ce(1)}),G.click(function(e){e.preventDefault();var t="selected";$(this).hasClass(t)||G.toggleClass(t)}),H.click(function(){$(this).toggleClass("selected")});if(t.UserTeams&&t.UserTeams.length>0){for(var ue=0;ue<t.UserTeams.length;ue++)w.find(".team-list").append('<span class="bold">'+t.UserTeams[ue].Name+" ("+l(t.UserTeams[ue].Role)+")</span><br>");I.find(".button span.team-mem").css("display","inline-block")}else w.find(".team-list").remove(),I.find("button span.team-mem").hide();if(t.UserTeams)for(var ue=0;ue<t.UserTeams.length;ue++)1==t.UserTeams[ue].Role&&(C=!0);return I.find("section.team-owner .see-payment").click(function(){ce(2)}),I.find("section.team-owner .contact span").click(function(){window.Intercom&&window.Intercom("showNewMessage","I would like to DELETE my team.")}),I.find("section.team-owner .is-yearly .switch-biz-plan").click(function(e){e.preventDefault();var t=u();console.log("change "+t+" yearly to monthly"),m(t,"Month")}),I.find("section.team-owner .is-monthly .switch-biz-plan").click(function(e){e.preventDefault();var t=u();console.log("change "+t+" monthly to yearly"),m(t,"Year")}),$("[name=plan_type]").click(function(){console.log("$(this).val()",$(this).val()),g=$(this).val()}),$("[name=plan_cycle]").click(function(){console.log("$(this).val()",$(this).val()),v=$(this).val()}),I.find("section.team-owner .change-plan .switch-biz-plan").click(function(e){e.preventDefault(),g=u(),b=u(),19===h.ST||25===h.ST||31===h.ST?(y="Month",v="Month"):14!==h.ST&&22!==h.ST&&28!==h.ST||(y="Year",v="Year"),console.log("planChangeCycle",v),console.log("planChangeType",g),$("[name=plan_type][value="+g+"]").prop("checked",!0),$("[name=plan_cycle][value="+v+"]").prop("checked",!0),I.find(".plan-change-status").hide(),I.find(".team-change-plan").show()}),I.find(".team-change-plan .change-plan-btn").click(function(e){e.preventDefault(),m(g,v)}),function(a,n){ae.hasClass("off")||ae.trigger("click"),$("#tmp-billing").find(".status-tab").find(".discount").css({display:"none"}),w.find(".popup-content").removeClass("success"),w.addClass("busy"),X=n||0,o.loadStripe(function(){ce(a||0,!0)}),t.IsDelinquent&&(w.find(".pay-tab").find(".left").addClass("edit"),w.find(".pay-tab").find(".change-card span:first-child").css({display:"none"}),w.find(".pay-tab").find(".change-card span:last-child").css({display:"inline"})),c(),e.show(w,"billing")}},app.popup.getDiscPayment=function(e,t,a,n,o){function i(e){e=e||"Error - Please review the highlighted fields.",d.text(e).addClass("show")}function s(t,a){c.addClass("busy"),n.changePlan({data:{plan:t,renew:t?1:0},success:function(e){o.refresh(),o.getData(0,function(e,t,a,n){y.find(".time").text(n)}),c.find(".popup-content").addClass("success"),y.find(".period").text("year"),y.find(".plan-time").text("Yearly"),T.data("plus")?(T.text("Discount Applied!"),y.find(".msg-plus").hide(),y.find(".msg-free .act").text("updated")):(T.text("Welcome to Xtensio Plus"),y.find(".msg-free").hide()),a(e)},error:function(t){e.push(c),e.error(t.Message||"There was an error. Please try later.")},complete:function(){c.removeClass("busy")}})}var r,l,c=$("#tmp-disc-payment"),d=c.find(".error-msg"),u=c.find(".checkout-btn"),m=c.find(".card-num"),f=c.find(".cvc"),p=c.find(".user-name"),h=(c.find(".radios a"),c.find(".month")),g=c.find(".year"),v=c.find("input, select"),b=c.find(".detail-btn"),y=c.find(".success-panel"),C=u.find(".txt"),T=c.find("h1"),w=!1;for(l=1;l<=12;l++)h.find(".filter-popup-menu").append('<div class="item" data-value="'+l+'">'+l+"</div>");for(l=(new Date).getFullYear();l<=2030;l++)g.find(".filter-popup-menu").append('<div class="item" data-value="'+l+'">'+l+"</div>");c.find(".loading-animation").html(e.spinner),e.reg(c,c.find(".icon-Close, .no"),function(){r&&r()}),b.click(function(){e.billing(1,!0)});var x=function(){c.addClass("busy");var e="DiscountYearly",t=$(this);t.find(".loading-animation").removeClass("hidden"),s(e,function(){setTimeout(function(){t.find(".loading-animation").removeClass("hidden")},3e3)})};return u.click(function(e){if(w)return void x();var t=0,a=m.val(),s=f.val(),r=parseInt(h.find(".item.active").attr("data-value")),l=parseInt(g.find(".item.active").attr("data-value")),u=p.val(),b="DiscountYearly";console.log(r+" y "+l),v.removeClass("error"),d.removeClass("show"),
Stripe.card.validateCardNumber(a)||(t=1,m.addClass("error")),Stripe.card.validateCVC(s)||(t=1,f.addClass("error")),Stripe.card.validateExpiry(r,l)||(t=1,h.add(g).addClass("error")),u||(t=1,p.addClass("error")),t?i():(c.addClass("busy"),Stripe.card.createToken({number:a,cvc:s,exp_month:r,exp_year:l,name:u},function(e,t){if(t.error)c.removeClass("busy"),i(t.error.message);else{var a=t.card,s=t.id;b.toLowerCase();n.buy({data:{Token:s,CardId:a.id,Last4:a.last4,Brand:a.brand,Plan:b,Name:u},success:function(e){o.refresh(),c.removeClass("busy"),c.find(".popup-content").addClass("success"),y.find(".time").text(moment(+e.Message).format("MMMM Do, YYYY")),y.find(".period").text("year"),y.find(".plan-time").text("Yearly"),T.data("plus")?(T.text("Billing Information Saved!"),y.find(".msg-plus").hide()):(T.text("Welcome to Xtensio Plus"),y.find(".msg-free").hide()),console.log(w+"sd ")},error:function(e){c.removeClass("busy"),i(e.Message)}})}}))}),$("#billing-link").click(function(){e.payment(null,!0)}),function(a){c.find(".filter-popup-menu").hide();var n=t.hasDiscount;n?(r=a,c.addClass("busy").find(".popup-content").removeClass("success"),T.text("Students and Faculty, Save 50%"),C.text("Upgrade"),o.loadStripe(function(){o.getData(1,function(e,t,a,n){c.removeClass("busy"),c.find(".msg").toggleClass("hidden",!t).find(".time").text(n),T.data("plus",t),T.data("end",n),a||e.Referrals.length||!t||C.text("Add Billing Information"),1==e.ST&&(C.text("Upgrade to Yearly"),c.find(".card-box").hide(),c.find(".item").hide(),w=!0,u.css({marginTop:0}),$(".total  ul li:nth-child(3)").hide())})}),e.show(c,"studentbilling")):e.payment()}},app.popup.getForgotPass=function(e,t,a,n){var o,i,s,r=$("#tmp-fpass"),l=r.find(".email"),c=(r.find(".popup-cta"),r.find(".msg")),d=function(){c.attr("class","msg"+(i?" error":"")).text(s)},u=function(){o=l.val(),i=!validator.isEmail(o),empty=!o,s=i?"Please provide a valid email address.":"Sending Email. Please wait.",d(),empty&&c.html("Email  cannot be  Blank.").addClass("error"),i||n.forgotPassword({email:o,success:function(e){i=!1,s=e.Message,d()},error:function(e){i=!0,s=e.Message||"There was an error. Please try again.",d()}})};return r.find(".sign-in").on("click",function(){e.signIn()}),l.on("keyup",function(e){13==e.which&&u(),d()}),r.find(".popup-cta").on("click",u),e.reg(r),function(t){o=t,l.val(o),d(),e.show(r)}},app.popup.getPayment=function(e,t,a,n,o){function i(e){e?(H.find(".exist-card-cont h2").text(U.Brand),H.find(".exist-card-cont span.four-digits").text(U.Last4),G.find("input.card-num").val("**** **** **** "+U.Last4),G.find("input.user-name").val(U.Name),g.val("***"),G.hide(),H.show()):(G.show(),H.hide())}function s(){w.text(".")}function r(e){e=e||"Error - Please review the highlighted fields.",f.text(e).addClass("show")}function l(e,t,i,s){var l={success:function(e){o.refresh(),n.getCreditsLeft({success:function(e){console.log("getCreditsLeft response",e);var t=JSON.parse(e.Data);x.find(".credits").text(t.CreditsLeft),m.find(".popup-content").addClass("success"),setTimeout(function(){a.reloadWithoutHash()},4e3)},error:function(e){console.log("getCreditsLeft error",e),r(e.Message)},complete:function(){busy=!1,m.removeClass("busy")}})},error:function(e){m.removeClass("busy"),r(e.Message)}};L?n.buyCreditsWithoutCard(l):(l.data={Token:e,CardId:t.id,Last4:t.last4,Brand:t.brand,Plan:i,Name:s},n.buyCredits(l))}var c,d,u,m=$("#tmp-payment"),f=m.find(".error-msg"),p=m.find(".checkout-btn"),h=m.find(".card-num"),g=m.find(".cvc"),v=(m.find(".month-radio"),m.find(".year-radio"),m.find(".user-name")),b=(m.find(".radios a"),m.find(".month")),y=m.find(".year"),C=m.find("input, select"),T=m.find(".detail-btn"),w=(m.find(".charged"),m.find(".msg-end")),x=m.find(".success-panel"),k=p.find(".txt"),S=m.find(".popup-header h1").first(),D=m.find(".checkout-title-box"),I=D.find(".chk-back-btn"),P=!1,E=m.find(".circular-switch"),F=(E.find(".button-out"),E.find(".button-in"),m.find(".choose-plan")),A=!0,M=m.find(".select.confirm"),N=!1,O="",U={},R=!1,L=!1,B=m.find(".card-details"),G=B.find(".new-card-details"),H=B.find(".existing-card-details");$backBtn=m.find(".back-btn"),I.click(function(){window.location.reload()});var q=function(e){e||A?(E.attr("title","Yearly"),E.toggleClass("off",!e),$("#tmp-payment .card-panel .paper").removeClass("monthly"),$("#tmp-payment .card-panel .paper").addClass("yearly"),E.find(".button-switch").text("Yearly"),A=!0):(E.attr("title",A?"Yearly":"Monthly"),E.toggleClass("off",!A),$("#tmp-payment .card-panel .paper").removeClass("yearly"),$("#tmp-payment .card-panel .paper").addClass("monthly"),E.find(".button-switch").text("Monthly"),A=!1),E.find(".button-switch").text(A?"Yearly":"Monthly"),A?E.addClass("off"):E.removeClass("off"),$("#tmp-payment .card-panel .popup-header p").removeClass("selected"),$("#tmp-payment .card-panel .popup-header p:eq("+(A?0:1)+")").addClass("selected"),A?($("#tmp-payment .plan-cont:eq(2) .plan-head h1 span.num").text("25"),$("#tmp-payment .plan-cont:eq(2) .plan-head h1 span.small-inline").text("/user/mo"),$("#tmp-payment .plan-cont:eq(2) .plan-head h1 span.small").text("$300/user/year"),$("#tmp-payment .plan-cont:eq(2) .plan-head a").attr("href","/teams/create/?plan=year"),$("#tmp-payment .plan-cont:eq(1) .plan-head h1 span.num").text("15"),$("#tmp-payment .plan-cont:eq(1) .plan-head h1 span.small-inline").text("/user/mo"),$("#tmp-payment .plan-cont:eq(1) .plan-head h1 span.small").text("$180/user/year"),$("#tmp-payment .plan-cont:eq(1) .plan-head a").attr("href","/teams/create/?plan=proyear")):($("#tmp-payment .plan-cont:eq(2) .plan-head h1 span.num").text("30"),$("#tmp-payment .plan-cont:eq(2) .plan-head h1 span.small-inline").text(""),$("#tmp-payment .plan-cont:eq(2) .plan-head h1 span.small").text("/user/mo"),$("#tmp-payment .plan-cont:eq(2) .plan-head a").attr("href","/teams/create/?plan=month"),$("#tmp-payment .plan-cont:eq(1) .plan-head h1 span.num").text("20"),$("#tmp-payment .plan-cont:eq(1) .plan-head h1 span.small-inline").text(""),$("#tmp-payment .plan-cont:eq(1) .plan-head h1 span.small").text("/user/mo"),$("#tmp-payment .plan-cont:eq(1) .plan-head a").attr("href","/teams/create/?plan=promonth")),console.log("isYearly",A)};E.on("click",function(){A=!A,q()}),q();var Y={Plusmonthly:10,Plusyearly:8,Promonthly:14,Proyearly:10,Credits:10};F.click(function(){if(u=$(this).attr("data-plan"),"Credits"===u){var e=Y[u+(A?"yearly":"monthly")];z(u,e),j(u,e)}});var z=function(e,t){console.log("plusData",U),console.log("typeof plusData.Brand",typeof U.Brand),console.log("typeof plusData.Last4",typeof U.Last4),"undefined"!=typeof U.Last4&&"undefined"!=typeof U.Brand?(R=!0,i(!0)):i(!1);var a=t||Y[e];m.find(".plan-cont , .feat-cont, .popup-header p, .popup-header div").hide(),m.find(".plan-banner").hide(),B.show(),D.show(),S.hide(),console.log("planPrice",a),console.log("planName",e),j(e,a)};H.find(".btn-card-update").click(function(e){e.preventDefault(),i(!1)});var j=function(e,t){m.find(".plan-det .div-l h3:eq(0)").text("Xtensio "+e),m.find(".plan-det .div-l h3:eq(1)").text("Billed "),A?m.find(".plan-det .div-r h1").html("$"+12*t+"<span>/year</span>"):m.find(".plan-det .div-r h1").html("$"+t+"<span>/mo</span>");var a="",n="";A?(a="$"+12*t+"/year",n="$"+12*t+" every year"):(a="$"+t+"/month",n="$"+t+" every month"),console.log("priceText",a),console.log("priceTextBot",n)};for(M.click(function(e){e.preventDefault(),N=!N,M.toggleClass("selected",N),console.log("isConfirmed",N)}),m.find(".pass-protect").toggleClass("selected"),d=1;d<=12;d++)b.find(".filter-popup-menu").append('<div class="item" data-value="'+d+'">'+d+"</div>");for(d=(new Date).getFullYear();d<=2030;d++)y.find(".filter-popup-menu").append('<div class="item" data-value="'+d+'">'+d+"</div>");m.find(".loading-animation").html(e.spinner),e.reg(m,m.find(".icon-Close, .no"),function(){c&&c()}),x.find(".no").click(function(){m.find(".popup-content").removeClass("success"),e.close(),a.reloadWithoutHash()}),m.find(".icon-Close").click(function(){m.find(".popup-content").removeClass("success"),e.close(),a.reloadWithoutHash()}),T.click(function(){e.billing(1)}),p.click(function(e){var t=0,a=h.val(),n=g.val(),o=parseInt(b.find(".item.active").attr("data-value"))||1,i=parseInt(y.find(".item.active").attr("data-value"))||(new Date).getFullYear(),s=v.val(),c=O+(A?"Year":"Month");if(L=!1,C.removeClass("error"),f.removeClass("show"),b.add(y).removeClass("error"),M.find("span.check").removeClass("error"),M.find("h3").removeClass("error"),console.log("hasCardOnFile",R),R){var d="************"+U.Last4,u=a.toString().replace(/ /g,""),p="***";console.log("numberOnFile",d),console.log("numNoSpaces",u),console.log("name",s),console.log("plusData.Name",U.Name),console.log("cvc",n),s===U.Name&&d===u&&n===p&&(L=!0)}console.log("useCardOnFile",L),L||(Stripe.card.validateCardNumber(a)||(t=1,h.addClass("error")),Stripe.card.validateCVC(n)||(t=1,g.addClass("error")),Stripe.card.validateExpiry(o,i)||(t=1,b.add(y).addClass("error")),s||(t=1,v.addClass("error"))),N||(t=1,M.find("h3").addClass("error"),M.find("span.check").addClass("error")),t?r():(m.addClass("busy"),L?l():Stripe.card.createToken({number:a,cvc:n,exp_month:o,exp_year:i,name:s},function(e,t){if(t.error)m.removeClass("busy"),r(t.error.message);else{var a=t.card,n=t.id;l(n,a,c,s)}}))});return function(t,a,n){A=!0,c=t,m.addClass("busy").find(".popup-content").removeClass("success"),S.text("Upgrade your Xtensio account"),P=a||!1,m.find(".filter-popup-menu").hide(),o.loadStripe(function(){o.getData(1,function(e,t,a,o){U=e,m.removeClass("busy"),m.find(".msg").toggleClass("hidden",!t).find(".time").text(o),S.data("plus",t),S.data("end",o),t&&(S.text("Add Billing Information"),k.text("Save")),m.find(".plan-cont").removeClass("selected"),t||a?!a||10!=e.ST&&11!=e.ST?!a||1!=e.ST&&2!=e.ST||m.find(".plan-cont:eq(2)").addClass("selected"):m.find(".plan-cont:eq(1)").addClass("selected"):m.find(".plan-cont:eq(0)").addClass("selected"),2==e.ST||11==e.ST||9==e.ST?A=!0:0!=e.ST&&(A=!1),m.find(".plan-cont , .feat-cont, .popup-header p, .popup-header div").show(),m.find(".plan-banner").show(),S.show(),B.hide(),D.hide(),s(),n&&(A=n.isYearly,u=n.planName,z(n.planName)),q(!0)})}),e.show(m,"billing")}},app.popup.getSettings=function(e,t,a,n,o){function i(e,t){t=t||"success",b.text(e).addClass(t),setTimeout(function(){b.removeClass("success error")},3e3)}function s(){var e=$.trim(f.val());e?e!=t.userEmail?validator.isEmail(e)?o.changeEmail({email:e,success:function(){i("Email saved."),t.userEmail=e},error:function(e){i(e.Message,"error")}}):i("Invalid email.","error"):i("Email saved"):i("Email cannot be empty.","error")}var r=0,l=$("#tmp-settings"),c=l.find(".tabs > span"),d=l.find(".tab"),u=l.find(".save"),m=l.find(".icon-Close , .cancel"),f=l.find(".email-text").val(t.userEmail),p=l.find(".full-n").val(t.fullName),h=l.find(".current-pass"),g=l.find(".new-pass"),v=l.find(".repeat-pass"),b=l.find(".msg"),y=function(){var e=/[^a-zA-Z0-9\s\-\/]/,n=$.trim(p.val());n?n!=t.fullName?e.test(n)?i("Name Cannot Have Special characters","error"):o.changeFullName({fullName:n,success:function(){t.fullName=n,i("Name saved."),a.raiseEvent("nameChanged")},error:function(e){i(e,"error")}}):i("Name saved"):i("Name cannot be empty.","error")},C=function(){var e=h.val(),t=g.val(),a=v.val(),n="";e||(n+="<p>Please provide your current password.</p>"),(!t||t.length<8)&&(n+="<p>New Password must be at least 8 characters long.</p>"),t!=a&&(n+="<p>New password and password confirm do not match</p>"),n?b.addClass("error").html(n):o.changePassword({oldPassword:e,newPassword:t,confirmPassword:a,success:function(){i("Password saved")},error:function(e){i(e.Message,"error")}})},T=function(){switch(b.text("Saving ...").attr("class","msg"),r){case 1:s();break;case 2:C();break;default:y()}};return c.on("click",function(){var e=$(this).addClass("selected");c.not(e).removeClass("selected"),r=e.index(),b.text(""),d.removeClass("selected").filter(":eq("+r+")").addClass("selected")}),u.on("click",T),l.find(".popup-footer .contact span").click(function(){HelpCrunch("sendUserMessage","Email: ("+t.userEmail+") I would like to DELETE my account and data.")}),e.reg(l,m),function(){b.removeClass("error success"),e.show(l),n.doSetFocus(p)}},app.popup.getSignIn=function(e,t,a,n){var o=null,i=$("#tmp-sign-in"),s=i.find(".popup-header"),r=i.find(".sign-up"),l=i.find(".forgot-btn"),c=i.find(".msg"),d=i.find(".sign-in"),u=i.find("form"),m=u.find(".email"),f=u.find(".pass"),p=i.find(".actions"),h=i.find(".select"),g=!1;return h.on("click",function(){$(this).toggleClass("selected").parent().toggleClass("selected")}),c.on("click",".resend",function(e){return c.html("Resending verification email. Please wait.").attr("class","msg"),n.resendEmail({email:m.val(),success:function(){c.html("Verification email was resent.").attr("class","msg success")},error:function(){c.html("There was an error. Check your connection and try again.").attr("class","msg error")}}),!1}),"EmailConfirm"==t.loginState?(s.html('<h1>Email address confirmed.</h1><h3 class="message" style="font-size: 20px;">Please sign in to pick up where you left off.</h3>'),p.remove()):"PassReset"==t.loginState?(s.html('<h1>Password was reset.</h1><h3 class="message" style="font-size: 20px;">Please sign in to continue.</h3>'),p.remove()):s.html("<h1>Sign In</h1>"),r.on("click",function(){window.history.pushState("","","/account/signup"),e.signUp()}),l.on("click",function(){return e.forgotPass(m.val()),!1}),u.submit(function(e){var a=m.val(),o=f.val(),i="";return g&&(i=t.token),a&&o?!o||o.length<8?c.html("Password must be at least 8 characters long.").addClass("error"):validator.isEmail(a)?!validator.isEmail(a)&&!o||o.length<8?c.html("Please provide a valid email and Password.").addClass("error"):(d.prop("disabled",!0),n.signIn(a,o,h.hasClass("selected"),function(e){window.location=e.Message||"/"},function(e){d.prop("disabled",!1),c.attr("class","msg error"),3==e.StatusCode?c.html('Please first verify your email address. <a href="#" class="resend">Resend verification email.</a>'):c.html("Email or password was not valid. Please try again.")},i)):c.html("Please provide a valid email.").addClass("error"):c.html("Email and Password cannot be  Blank.").addClass("error"),!1}),t.Team&&0!=t.Team.Id&&(s.html("<h1>Sign in to "+t.Team.Name+"</h1><p>"+t.Team.TeamUrl+"</p>"),i.addClass("is-team")),e.reg(i),function(t,n,s){o=n,g=!!s,e.show(i),a.doSetFocus(m)}},app.popup.getSignUp=function(e,t,a,n,o,i,s){var r=$("#xtensio-refer-info"),l=r.length,c=$("#tmp-sign-up"),d=c.find(".sign-in"),u=c.find(".msg"),m=c.find(".popup-cta"),f=c.find("form"),p=f.find(".email").val(t.userEmail),h=f.find(".name").val(t.fullName),g=f.find(".pass"),v=f.find(".coupon"),b=c.find(".popup-header"),y=!1;if("True"==t.isInvite&&(p.val(t.inviteEmail),p.prop("readonly",!0),p.css({"background-color":"#f0f0f0"}),h.val(t.inviteFullName)),(l||o)&&c.find(".sign-in-container").hide(),l&&(c.find(".xtensio-agreement").append(r.find(".agreement")),c.find(".xtensio-refer-info").append(r.find("> a, .list")),b.after(b.find("h2")),b.append(r.find(".name-sender"))),o){var C=c.find(".popup-content");b.html(i.PopupTitle).css("padding-top","35px"),m.text(i.SubmitText),C.before(i.Header),C.after(i.Footer),$("head").append('<style type="text/css">'+i.Css+"</style>")}return t.getCoupon&&v.removeClass("hidden"),d.on("click",function(){window.history.pushState("","","/account/signin"),"true"==t.EditTemplate?e.signIn(!1,null,!0):e.signIn()}),f.submit(function(a){var i=g.val(),s=p.val(),r=h.val(),l=v.val(),c="";if(y&&(c=t.token),s&&i&&r)if(!i||i.length<8)u.html("Password must be at least 8 characters long.").addClass("error");else if(s&&validator.isEmail(s))if(!r||r.length<3||/[^a-zA-Z0-9\s\-\/]/.test(r))u.html("Please provide Valid  name.").addClass("error");else if(t.getCoupon&&!l)u.html("Please provide activation code.").addClass("error");else{m.prop("disabled",!0);var d={Email:s,Password:i,FullName:r,coupon:l,campaign:o,FolioToken:c},f=document.location.href;f=f.toLowerCase(),t.isTeam?n.TeamSignUp(d,function(){e.message({heading:"All set!",message:"Your account is successfully created.",btnText:"Go To Your Dashboard",noClose:!0,bodyCentered:!0,notMini:!0,handleOK:function(){t.Team&&(window.location=t.baseUrl)}})},function(e){m.prop("disabled",!1),u.html(e.Message).addClass("error")}):n.signUp(d,function(){"True"==t.isInvite?window.location="/":e.signUpDone(s)},function(e){m.prop("disabled",!1),u.html(e.Message).addClass("error")})}else u.html("Please provide a valid email.").addClass("error");else u.html("Fields cannot be left Blank.").addClass("error");return!1}),e.reg(c),function(n){v.val("");try{var o=new URL(location.href),i=o.searchParams.get("email")}catch(s){if("TypeError"==s.name)var r=window.location.href.match(new RegExp(/email=([^&]*)/)),i=r?r[1]:""}"False"==t.isInvite&&p.val(i),y=!!n,e.show(c),a.doSetFocus(h)}},app.popup.getSignUpDone=function(e,t,a){var n=$("#tmp-sign-up-done"),o=n.find(".msg"),i=n.find(".email"),s=n.find(".popup-cta");return s.on("click",function(){s.attr("disabled",!0),o.html("Re-sending verification email. Please wait ...").removeClass("success error"),a.resendEmail({email:i.text(),success:function(){s.attr("disabled",!1),o.html("The verification email was re-sent.").addClass("success")},error:function(){s.attr("disabled",!1),o.html("Could not connect to the server. Please try again.").addClass("error")}})}),e.reg(n),function(t){i.text($.trim(t)),e.show(n)}},app.popup.getSignUpDoneInvited=function(e,t,a){var n=$("#tmp-sign-up-done-invited"),o=(n.find(".msg"),n.find(".popup-cta"));return e.reg(n),o.on("click",function(){return e.signIn(),!1}),function(){e.show(n)}},app.popup.getSignUpTeam=function(e,t,a,n,o,i){function s(e,t){t.siblings().removeClass("active"),t.addClass("active");var a=t.data("name")||t.text(),n=t.data("value"),o=n||a;e.data("value",o).find(".text").text(a)}function r(e){return D==e}function l(e){var t=document.createElement("style");t.appendChild(document.createTextNode("\t    @font-face {\t        font-family: '"+e.FontLocalName+"';\t        font-weight: "+e.FontWeight+"; \t        font-style: "+e.FontStyle+"; \t        src: local("+e.FontLocalName+"), url("+e.FontUrl+")  format('woff2');\t        unicode-range: "+e.UnicodeRange+"; \t    }\t    ")),document.head.appendChild(t)}function c(e){return!re[e.IdString]&&(re[e.IdString]="Loaded",void l(e))}function d(){var e=$(".autocomplete-items");return e.length||(e=$("<div>"),e.addClass("autocomplete-items").css({width:ae.css("width")}),ae.parent().append(e)),e}function u(){x=ae.xautocomplete({source:function(e){console.log(e),a.getAllFonts({success:function(t){var a=JSON.parse(t.Data),n=$.map(a,function(e){var t=JSON.parse(e.FontJson);return"Xtensio"==e.SourceString||"System"==e.SourceString?{label:e.Name,value:t.IdString,data:{data:t,id:e.SourceIdentifier,title:e.Name,"default":r(e.SourceIdentifier),owner:e.SourceString,family:t.IdString}}:{label:e.Name,value:t.FontLocalName,data:{data:t,id:e.SourceIdentifier,title:e.Name,"default":r(e.SourceIdentifier),owner:e.SourceString,family:t.FontLocalName}}});e(n)},error:function(e){return console.log(e),!1}})},minLength:3,errorMsg:de,select:function(e,t,a,n){},close:function(e,t){t.each(function(){$(e).closest(".autocomplete-items").get(0)!=$(this).get(0)&&$(this).remove()})},addElement:function(e,t,a,n,o,i){c(i.data);var s=$(ee.html());return s.find(".owner").text(i.owner),$family=s.find(".title .family"),$family.html(n),$family.css("font-family",i.family),$default=s.find(".default"),$default.append(ze()),s.find(".add-font").on("click",function(e){b($(this),i,1,e)}),s}})}function m(t,a,n){return t.find(".loading-animation").html(e.spinner),t.find(".owner").text(a.owner),$family=t.find(".title .family"),$family.text(a.title),$family.css({"font-family":a.family}),t}function f(e,t){c(e.data),$template=m($(ee.html()),e,t),$template.addClass("search-font-entry"),$default=$template.find(".default"),$default.append(ze()),$template.find(".add-font").on("click",function(a){b($(this),e,t,a)}),S=d(),S.append($template)}function p(e,t,a){le[e.id]=e,e.owner&&"Xtensio"!=e.owner&&"System"!=e.owner&&(console.log("fonts added by search fonts "),c(e.data)),$template=m($(Z.html()),e,t),$template.addClass("user-font-entry"),$template.attr("id",e.id),$template.attr("data-default",e["default"]),$default=$template.find(".default"),r(e.id)?(g(e),$default.append(Ke())):$default.append(Ve()),$template.find(".make-default").on("click",function(e){var a=$(this).closest(".user-font-entry").attr("id");h($(this),a,t,e)}),$template.find(".remove").on("click",function(a){v($(this),e,t,a)}),te.append($template)}function h(e,t,a,n){Ie=!1;var o=e.closest(".font-entry"),i=o.closest("#user-font-list"),s=le[t];o.addClass("loading"),$("[data-default]").attr("data-default",!1),o.attr("data-default",!0),D=s.id,Qe(s.title+" is now default font for the style guide.",o),g(s),o.removeClass("loading").addTimedClass("done",3e3),$fontDefaultEntry=i.find(".default .default").parent(),$fontDefaultEntry.empty().html(Ve()),$fontDefaultEntry.find(".make-default").on("click",function(e){var t=$(this).closest(".user-font-entry").attr("id");h($(this),t,a,e)}),o.find(".default:eq(0)").empty().html(Ke()),Object.keys(le).forEach(function(e,t){le[e]["default"]=e===D})}function g(e){$("#edit-sections, #modules-preview-main").css({"font-family":"'"+e.family+"', "+ce})}function v(e,t,a,n){var o=t.id,i=e.closest(".font-entry");return i.addClass("loading"),"true"==i.attr("data-default")?(i.removeClass("loading"),Xe("Default font can not be removed from the style guide.",i),!1):(Ie=!1,Qe(t.title+" is removed from the style guide.",i),le[o]&&delete le[o],setTimeout(function(){i.remove()},2e3),void i.removeClass("loading"))}function b(e,t,a,n){var o=t.id,i=e.closest(".font-entry");return Object.keys(le).length>=Ce?(Je("You can't add more than "+Ce+" fonts to style guide.",i),!1):!le[o]&&(Ie=!1,i.addClass("loading"),le[o]=t,Qe(t.family+" is added to the style guide.",i),void p(t,a,"search"))}function y(){return ke+xe.charAt(0).toUpperCase()+xe.substr(1)}function C(){P.addClass("busy");var e=[];Q=[];for(var n=P.find(".each-mem.added.removeable"),o=0;o<n.length;o++)Q.push(P.find(".each-mem.added.removeable:eq("+o+") input").val());for(var o=0;o<Q.length;o++)e.push({email:Q[o],Role:parseInt(t.DefautTeamRoleId),name:""});var i=null;Ie||(i=[],Object.keys(le).forEach(function(e,t){i.push(e)})),console.log(i),console.log("Submitted user plan: ",y()),a.purchaseTeam({data:{teamInfo:{Id:0,Name:W,LogoUrl:X,TeamUrl:J,Status:1,OwnerEmail:"",TeamMembers:e,ImageID:k,TeamFonts:i},billingInfo:{plan:y(),MembersCount:e.length}},success:function(e){console.log(e),P.find(".goto-dashboard").attr("href","https://"+J),P.removeClass("busy"),M.removeClass("checkpoint6"),M.removeClass("checkpoint7"),M.addClass("checkpoint8")},error:function(e){Je(e.Message)}})}function T(){a.getDefaultStyleTeamCreation({data:{},success:function(e){var t=JSON.parse(e.Data),a=t[0].TeamFonts;if(a.length>1){le={},te.empty(),Ie=!0;for(var n=0;n<a.length;n++)w(a[n],1,"styleguide");console.log(le)}},error:function(e){Je(e.Message)}})}function w(e,t,a){console.log(e);var n={id:e.SourceIdentifier,owner:e.SourceString,title:e.SourceIdentifier,"default":e.IsDefaultFontAppWide,data:e.FontJson};le[n.id]=n,c(n.data),$template=m($(Z.html()),n,t),$template.addClass("user-font-entry"),$template.attr("id",n.id),$template.attr("data-default",n["default"]),$default=$template.find(".default"),n["default"]?(g(n),$default.append(Ke())):$default.append(Ve()),$template.find(".make-default").on("click",function(e){var a=$(this).closest(".user-font-entry").attr("id");h($(this),a,t,e)}),$template.find(".remove").on("click",function(e){v($(this),n,t,e)}),te.append($template)}var x,k,S,D,I,P=$("#tmp-sign-up-team"),E=P.find(".btn-next"),F=1,A=$("#team-progress-bar .fill"),M=P.find(".paper"),N=P.find(".btn-upload"),O=P.find(".addmem-btn"),U=$("#tmp-sign-up-teammember"),R=P.find(".members"),L=P.find(".step7"),B=L.find(".month"),G=L.find(".year"),H=L.find(".name"),q=L.find(".number"),Y=P.find(".btn-pay"),z=P.find(".btn-pay-1"),j=P.find("#uploadimage-form")[0],_=P.find("p.error"),K=$("#tsu-back-button"),V=$(".btn-update"),W="",J="",X="",Q=[],Z=$("#template-user-font-entry"),ee=$("#template-search-font-entry"),te=(P.find("#font-list"),P.find("#user-font-list")),ae=P.find(".search-font"),ne=P.find(".popup-cta"),oe=(P.find(".tabs > span[data-to]"),P.find(".tab"),P.find(".msg"),P.find("#team-name"),P.find("#restore-defaults")),ie=P.find(".loading-animation.forpopup"),se=P.find(".color-hl"),re={},le={},ce="Proxima-Light, Helvetica, sans-serif",de="No fonts found matching search keywords",ue=30,me=30,fe=300,pe=300,he=20,ge=20,ve=180,be=180,ye=$("#option-monthly"),Ce=15,Te=0,we=0,xe="year",ke="Business",$e=P.find(".select.confirm"),Se=!1,De=!0,Ie=!0,Pe={},Ee=!1,Fe=!1,Ae=!0,Me=!1,Ne=P.find(".x-select");for("www.localhost.com"==window.location.hostname,$.each(Ne,function(e,t){var a=$(t),n=a.find(".popup-menu");a.on("click",".item",function(e){var t=$(this);a.hasClass("no-select")||t.hasClass("active")||(s(a,t),a.trigger("change"))}),a.on("val",function(e,t,n){s(a,a.find(".item[data-"+t+'="'+n+'"]'))}),n.length&&app.plugin.popupMenu(a,n)}),index=1;index<=12;index++)B.find(".popup-menu").append('<div class="item'+(1==index?" active":"")+'" data-value="'+index+'">'+index+"</div>");for(index=(new Date).getFullYear();index<=2030;index++)G.find(".popup-menu").append('<div class="item'+(2019==index?" active":"")+'" data-value="'+index+'">'+index+"</div>");O.click(function(){U.find("span").text(R.find(".each-mem").length+1+".");var e=$("#tmp-sign-up-teammember").html();R.append(e),P.find(".members .each-mem:last-child button").click(function(){Re($(this).parent(".each-mem"))}),P.find(".members .each-mem:last-child .icon-Close").click(function(){$(this).parent(".each-mem").removeClass("added"),Ue()})}),P.find(".loading-animation").html(e.spinner),P.find(".btn-add-mem").click(function(){Re($(this).parent(".each-mem"))}),P.find(".each-mem .icon-Close").click(function(){$(this).parent(".each-mem").removeClass("added"),Ue()});var Oe=function(){var e=(P.find('.add-options .plan[data-plan="yearly"]').hasClass("selected")?300:30,P.find(".each-mem.removeable.added"));"Business"==ke?(we=pe+e.length*fe,Te=me+e.length*ue,se.html("(Save up to 20%!)")):(we=ve+e.length*be,Te=ge+e.length*he,se.html("(Save up to 25%!)"))},Ue=function(){var e=P.find(".add-options .price .money"),t=P.find(".add-options .price .duration"),a=P.find('.add-options .plan[data-plan="yearly"]').hasClass("selected")?"Year":"Month";qe(),e.text(we+"$"),t.text(a),ye.text("$"+Te),$(".top-section h1").text("Upgrade to "+ke);var n="Xtensio "+ke+" ("+i.capitalizeFirstLetter(xe)+"ly)";console.log("confPlanText",n),P.find(".step-action .step8 h2").text(n)},Re=function(e){P.addClass("busy");var a=/.+\@.+\..+/,n=e.find("input").val();if(n)if(n.match(a)){if(n==t.SignedInEmail)return void Je("You can not add yourself.");for(var o=P.find(".each-mem.added"),i=0;i<o.length;i++)if(console.log(P.find(".each-mem.added:eq("+i+")").find("p").text(),n),P.find(".each-mem.added:eq("+i+")").find("p").text()==n)return void Je("User already Added.");e.find("p").text(n),e.addClass("added"),Ue(),P.removeClass("busy")}else Je("Invalid email address.");else Je("Add a valid Email.")};P.find(".skip").click(function(){var e="",t="";switch(console.log(F),F){case 3:e="#fonts",t="Fonts";break;case 4:e="#team-members",t="Team Members";break;case 5:e="#checkout",t="Checkout"}console.log(t,e),I++,history.pushState({step:I,name:t,url:e},t,e),console.log(history.state),Ge(!0)}),K.click(function(){Le(),console.log("back button historyState",I),history.back()});var Le=function(){P.addClass("busy");for(var e=$("#tmp-sign-up-team .paper")[0].className.split(/\s+/),t=0;t<e.length;t++)if(e[t].indexOf("checkpoint")>-1){var a=parseInt(e[1].substr(10,11));F=a-1,setTimeout(function(){P.removeClass("busy");var e=100*(a-1)/6;A.css({width:e+"%"}),6!=F||Me?(M.removeClass("checkpoint"+a),M.addClass("checkpoint"+(a-1)),Be(F-1)):(M.removeClass("checkpoint"+a),M.addClass("checkpoint"+(a-2)),Be(F-2)),a>2?K.show():K.hide()},1e3)}},Be=function(e){console.log("step is "+e);var t="Next",a='<i class="fa fa-angle-right"></i>';switch(e){case 0:t="Next: TEAM URL "+a;break;case 1:t="Next: TEAM LOGO "+a;break;case 3:t="Next: ADD MEMBERS "+a;break;case 4:if(Ae===!1){t="Finish ";break}t="Next: CHECKOUT "+a}E.html(t)},Ge=function(e,t){P.addClass("busy"),K.html('<i class="fa fa-angle-left"></i> BACK');for(var a=$("#tmp-sign-up-team .paper")[0].className.split(/\s+/),n=0;n<a.length;n++)if(a[n].indexOf("checkpoint")>-1){var i=parseInt(a[1].substr(10,11));F=i+1,i=t="undefined"!=typeof t?t:i,console.log("currStep new",F),6===F&&o.getData(1,function(e,t,a,n){Pe=e,Pe.hasPaidPlus=a,console.log("API",e,t,a,n),Ye(),a&&(Ee=!0,Me=a,H.val(e.Name),q.val("**** **** **** "+e.Last4),L.find(".code").val("***"))}),setTimeout(function(){P.removeClass("busy");var t=100*(i+1)/6;A.css({width:t+"%"}),6!=F||Me?(M.removeClass("checkpoint"+i),M.addClass("checkpoint"+(i+1)),console.log(i),3===i&&($(".step-action #team-name").html($(".step-action .step1 input").val()),De&&(T(),De=!1)),Be(i)):(M.removeClass("checkpoint"+i),M.addClass("checkpoint"+(i+2))),i>0&&i<6?K.show():K.hide(),5==i&&e&&(P.find(".each-mem.added").removeClass("added"),P.find(".each-mem.self").addClass("added"),Ue()),P.find(".paper >div:visible input:visible:first").focus()},1e3)}};P.find(".add-options .plan").click(function(){P.find(".add-options .plan").removeClass("selected"),$(this).addClass("selected"),Ue()}),P.find(".uploader").change(function(){var e=this,t=e.files&&e.files[0];t&&(P.addClass("busy"),j=P.find("#uploadimage-form")[0],a.uploadTeamImage(j,t,{type:"logo",isProgress:!1,success:function(e){console.log("res",e),X=e.Message,k=e.Data,$(".team-signup .top-section .team-name").replaceWith('<img src="'+X+'" title ="'+W+'">'),E.click()},error:Je}))}),$("[name=plan_radio]").click(function(){He($(this).val(),"[name=plan_radio2]")}),$("[name=plan_radio2]").click(function(){He($(this).val(),"[name=plan_radio]")}),$("[name=plan_name_radio]").click(function(){He($(this).val(),"[name=plan_name_radio2]")}),$("[name=plan_name_radio2]").click(function(){He($(this).val(),"[name=plan_name_radio]")});var He=function(e,t){"year"===e||"month"===e?xe=e:"promonth"===e?(xe="month",ke="Pro",e="month",$("[name=plan_name_radio][value="+ke+"]").prop("checked",!0),$("[name=plan_name_radio2][value="+ke+"]").prop("checked",!0)):"proyear"===e?(xe="year",ke="Pro",e="year",$("[name=plan_name_radio][value="+ke+"]").prop("checked",!0),$("[name=plan_name_radio2][value="+ke+"]").prop("checked",!0)):ke=e,console.log("plan selected is",xe,ke),$(t+"[value="+e+"]").prop("checked",!0),qe(),Ue()},qe=function(){Oe(),Ye();var e="year"===xe?we:Te,t='I understand that I will be charged <span class="charged prox-bold d-inline">$'+e+"</span> each "+xe+" and all payments are non-refundable.";P.find(".step6 .charge span").html("$"+e),P.find(".step7 .charge .d-inline").html(t)},Ye=function(){var e=new Date,t="month"===xe?e.setMonth(e.getMonth()+1):e.setFullYear(e.getFullYear()+1);P.find(".step6 .date span").text(moment(t).format("MMMM Do, YYYY"))};$e.click(function(e){e.preventDefault(),Se=!Se,$e.toggleClass("selected",Se),console.log("isConfirmed",Se)}),N.click(function(){P.find(".uploader").click()}),Y.click(function(){P.addClass("busy");var e,n,o,i,s,r=[],l=!1;if(e=L.find(".name").val(),n=L.find(".code").val(),o=L.find(".number").val(),s=parseInt(L.find(".month .item.active").attr("data-value")),i=parseInt(L.find(".year .item.active").attr("data-value")),Fe=!1,console.log("hasCardOnFile",Ee),Ee){var c="************"+Pe.Last4,d="***",u=o.toString().replace(/ /g,"");console.log("numberOnFile",c),console.log("numNoSpaces",u),console.log("name",e),console.log("plusData.Name",Pe.Name),console.log("ccode",n),e===Pe.Name&&c===u&&n===d&&(Fe=!0)}if(L.find(".number").removeClass("error"),
L.find(".code").removeClass("error"),L.find(".month").removeClass("error"),L.find(".year").removeClass("error"),Fe||(Stripe.card.validateCardNumber(o)||(L.find(".number").addClass("error"),l=!0),Stripe.card.validateCVC(n)||(L.find(".code").addClass("error"),l=!0),Stripe.card.validateExpiry(s,i)||(L.find(".month").addClass("error"),L.find(".year").addClass("error"),l=!0)),console.log("useCardOnFile",Fe),console.log("checkpoint7? ",P.find(".paper").hasClass("checkpoint7")),P.find(".paper").hasClass("checkpoint7")&&(Se?$e.removeClass("error"):($e.addClass("error"),l=!0)),L.find(".name").toggleClass("error",!e),l||!e)return void Je("Please make sure you added correct values.");if(Fe)return void C();var m=P.find(".each-mem.added.removeable");Q=[];for(var f=0;f<m.length;f++)Q.push(P.find(".each-mem.added.removeable:eq("+f+") input").val());for(var f=0;f<Q.length;f++)r.push({email:Q[f],Role:parseInt(t.DefautTeamRoleId),name:""});var p=null;Ie||(p=[],Object.keys(le).forEach(function(e,t){p.push(e)})),console.log(p),Stripe.card.createToken({number:o,cvc:n,exp_month:s,exp_year:i,name:e},function(t,n){if(n.error)P.removeClass("busy"),Je(n.error.message);else{var o=n.card,i=n.id;console.log("Submitted user plan: ",y()),a.purchaseTeam({data:{teamInfo:{Id:0,Name:W,LogoUrl:X,TeamUrl:J,Status:1,OwnerEmail:"",TeamMembers:r,ImageID:k,TeamFonts:p},billingInfo:{Token:i,CardId:o.id,Last4:o.last4,Brand:o.brand,Name:e,plan:y(),MembersCount:r.length}},success:function(e){console.log(e),P.find(".goto-dashboard").attr("href","https://"+J),Ge()},error:function(e){Je(e.Message)}})}})}),window.addEventListener("popstate",function(e){if(console.log(history.state),5==F?E.text("Next: ADD MEMBERS"):3==F?E.text("Next: TEAM LOGO"):2==F?E.text("Next: TEAM URL"):console.log(F),!e.state)return!1;var t=e.state;console.log(t),console.log("historyState",I,"== data state ",t.step),I>t.step?I>1&&(I--,Le()):t.step>I?(I++,Ge()):console.log("step equals")}),E.click(function(e){if(console.log("next",W,J,X,Q,F),_.hide(),P.addClass("busy"),M.hasClass("checkpoint1")){W=P.find(".step1 input").val();var n=P.find(".step1 input").val().toLowerCase(),o=/^\w+(\s\w+)*$/;if(n.length<3)Je("Name has to be atleast 3 characters long.");else if(n.match(o)){var i="#team-url";history.pushState({step:2,name:"Team Url",url:i},"Team Url",i),I=2,console.log(history.state),Ge(),$(".team-signup .top-section .team-name").length?$(".team-signup .top-section .team-name span").html(W):$(".team-signup .top-section a").replaceWith('<div class="team-name"><span>'+W+"</span></div>")}else Je("Name may only contain alphabetical and numerical values");P.removeClass("busy")}else if(M.hasClass("checkpoint2")){var s=P.find(".step2 input").val().toLowerCase(),o=/^[0-9a-zA-Z]+$/;s.length<3?(P.removeClass("busy"),Je("A url has to be 3 characters long.")):s.match(o)?a.checkTeamURL({data:{teamUrl:s},success:function(e){if(1==e.Data)Je("This url is already taken. Please choose another Url."),P.removeClass("busy");else{"live"==t.Environment?J=s+".xtensio.com":"dev"==t.Environment?J=s+".xtensio.tech":"local"==t.Environment&&(J=s+".localhost.com:44301");var a="#team-logo";history.pushState({step:3,name:"Team Logo",url:a},"Team Logo",a),I=3,console.log(history.state),Ge()}},error:function(e){console.log("error: ",e)}}):(P.removeClass("busy"),Je("URL may only contain alphabetical and numerical values"))}else if(M.hasClass("checkpoint3")){var i="#fonts";history.pushState({step:4,name:"Fonts",url:i},"Fonts",i),I=4,console.log(history.state),Ge()}else if(M.hasClass("checkpoint4")){var i="#team-members";history.pushState({step:5,name:"Team Members",url:i},"Team Members",i),I=5,console.log(history.state),Ge()}else if(M.hasClass("checkpoint5")){var i="#checkout";history.pushState({step:6,name:"Checkout",url:i},"Checkout",i),I=6,console.log(history.state),console.log("going to cc payment"),Ae===!1?Ze():Ge()}});var ze=function(){return'<span class="add-font"><i class="icon icon-CheckMark"></i> Add</span>'},je=function(){e.show(P),T()},_e=function(){e.show(P)};oe.on("click",function(){e.message({heading:"Warning",message:"You are going to restore fonts for style guide.",btnText:"Go ahead",cancelText:"Cancel",handleOK:je,handleNo:_e})});var Ke=function(){return'<span class="default"><i class="icon icon-Star"></i> Default Font</span>'},Ve=function(){return'<span class="make-default"><i class="icon icon-Star"></i> Make Default</span>'};ne.on("click",function(e){e.stopPropagation(),S=d(),S.empty(),P.addClass("busy");var t=ae.val();a.searchFonts({data:{searchQuery:t},success:function(e){var t=JSON.parse(e.Data);if(fonts=$.map(t,function(e){var t=JSON.parse(e.FontJson);return{data:t,id:e.SourceIdentifier,title:e.Name,"default":r(e.SourceIdentifier),owner:e.SourceString,family:t.FontLocalName}}),fonts.length)for(var a=0;a<fonts.length;a++){var n=fonts[a];f(n,a)}else S.html(de);P.removeClass("busy")},error:function(){return ie.hide(),!1}})});var We=null,Je=function(e){_.stop(!0,!0),P.removeClass("busy"),_.text(e).show(),clearTimeout(We),We=setTimeout(function(){_.hide("slow")},1e4)},Xe=function(e,t){var a=t.find(".inline-msg");a.html(e).removeClass("success").addClass("error").show("slow"),setTimeout(function(){a.hide("slow").removeClass("error")},5e3)},Qe=function(e,t){if(t)var a=t.find(".inline-msg");a.html(e).addClass("success").removeClass("error").show("slow"),setTimeout(function(){a.hide("slow").removeClass("success")},5e3),ie.hide()};V.click(function(){P.addClass("busy"),M.removeClass("checkpoint6"),M.addClass("checkpoint7"),P.removeClass("busy")}),z.click(function(){C()});var Ze=function(){if(Ae===!1){console.log("checkOut",Ae),P.addClass("busy");var e=[];Q=[];for(var n=P.find(".each-mem.added.removeable"),o=0;o<n.length;o++)Q.push(P.find(".each-mem.added.removeable:eq("+o+") input").val());for(var o=0;o<Q.length;o++)e.push({email:Q[o],Role:parseInt(t.DefautTeamRoleId),name:""});var i=null;Ie||(i=[],Object.keys(le).forEach(function(e,t){i.push(e)})),a.purchaseTeamWithoutCheckout({data:{teamInfo:{Id:0,Name:W,LogoUrl:X,TeamUrl:J,Status:1,OwnerEmail:"",TeamMembers:e,ImageID:k,TeamFonts:i},billingInfo:{MembersCount:e.length}},success:function(e){console.log(e),P.find(".goto-dashboard").attr("href","https://"+J),Ae===!1?(P.removeClass("busy"),console.log("here"),M.removeClass("checkpoint5"),M.addClass("checkpoint8")):Ge()},error:function(e){Je(e.Message)}})}};return e.reg(P),function(){history.replaceState({step:1,teamname:"Team Name",teamurl:"#team-name"},"Team Name","#team-name"),I=1;var a=i.getUrlVars(),n=a.plan?a.plan.toString().replace("#team-name",""):"year";console.log("preplan",n),Ae=!a.checkout,He(n,"[name=plan_radio2]"),He(n,"[name=plan_radio]"),Ue(),P.find(".each-mem.self p").text(t.SignedInUserName+" (you)"),o.loadStripe(function(){e.show(P),u()})}},app.popup.getAddModule=function(e,t,a,n,o){var i,s,r=(app.wType,$("#tmp-add-module-popup")),l=(r.find("input"),r.find("h1")),c=r.find(".icon-Close"),d=r.find(".addModule-moduleblock"),u=r.find(".addModule-canvasblock"),m=(r.find(".addModule-importblock"),r.find(".addModule-eachfoliocont"),r.find("#addModule-select-folio-dropdown")),f=r.find("#addModule-select-folio-dropdown  li"),p=r.find("#addModule-select-folio-dropdown .addModule-textholder"),h=r.find(".tabs span"),g=r.find(".paper"),v=$("#tmp-add-mod-item").html(),b="app.xtensio.tech"==location.hostname?1:0,y=a.token,C=function(){var t=$(this).data("item");s(t.name),e.close()},T=function(){var i,r=$(this).data("item"),l=[],c=[],d={};if(r.template)t.templateMods({name:r.template,token:y,success:function(t){$.each(t.Data,function(r,u){if(u.Data=JSON.parse(u.Data),"DataModule"==u.Type)l=u.Data.Sections[0].ModIds;else if(l.indexOf(u.Tag)>-1){if(c.push(u),u.Store){var m=JSON.parse(u.Store).style;if(b&&console.log(m),m!=i){$("#folio-style").append(m),i=m;var f=n.get("style")||"";f=f.indexOf(m)>-1?f:f+m,n.set("style",f)}}}else d[u.Tag]=u;r==t.Data.length-1&&$.each(c,function(e,t){t.Data.Mods&&$.each(t.Data.Mods,function(e,t){var a=d[t.Tag];t.Type=a.Type,t.Data=a.Data}),t.New=!0,s(t.Type,t)}),app.editor.addWatermark(a,e,o)})},error:function(t){e.error(t.Message)}});else{var u=[{Col:0,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 1</h3><p>Just like the rest of your folio, you can add and remove modules to your canvas, drag them in and out.</p>',Head:2}},{Col:1,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 2</h3><p>You can even change the number of columns and adjust their widths.</p>',Head:2}},{Col:2,Row:0,Tag:0,Type:"Text",Data:{Type:"Text",Html:'<h3 class="text-center fr-tag">Column 3</h3><p>Changing the color scheme updates all modules within this canvas.</p>',Head:2}}],m={Tag:0,New:!0,Type:"Canvas",Data:{BgColor:"rgba(0,0,0,0)",Cols:"12",Type:"Canvas",Mods:u}};s(r.name,m)}e.close()},w=function(e,t,a){$.each(t,function(t,n){i=$(v),i.data("item",n),n.img&&i.find("i").addClass(n.img),"Videos"==n.name&&(i.prepend('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25.55 27.68"><defs><style>.cls-av-1{fill:none;stroke-width: 0;}.cls-av-1,.cls-av-2{fill-rule:evenodd;}.cls-av-2{fill:#fff;}</style></defs><title>0Asset 36</title><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path class="cls-av-1" d="M0,26.42c0,1.1.79,1.57,1.75,1L24.83,14.8c1-.53,1-1.39,0-1.92L1.75.22C.79-.31,0,.16,0,1.26Z"/><polygon class="cls-av-2" points="2.24 24.81 22.24 13.84 2.24 2.87 2.24 24.81"/></g></g></svg>'),i.find("i").remove()),i.find("p").text(n.text),i.click(a).addClass(t<4?"r-1":"").addClass(3==t||7==t?"c-last":""),e.append(i)})},x=[{name:"Text",text:"Text",img:"text"},{name:"Images",text:"Image",img:"img"},{name:"Videos",text:"Video",img:"img"},{name:"DonutChart",text:"Pie Chart",img:"pie"},{name:"Scale",text:"Scale Chart",img:"scale"},{name:"Bar",text:"Bar Graph",img:"bar"},{name:"Tag",text:"Tags",img:"tags"},{name:"DataCollection",text:"Email Form",img:"form"},{name:"Social",text:"Social",img:"social"},{name:"RowBreak",text:"Row Break",img:"row"}],k=[{name:"Canvas",text:"Blank",img:"blank",template:"blank-canvas"},{name:"Persona",text:"Persona",img:"persona",template:"user-persona"},{name:"Business",text:"Business Canvas",img:"canvas",template:"business-model-canvas"},{name:"Lean",text:"Lean Canvas",img:"canvas",template:"lean-canvas"},{name:"SWOT",text:"SWOT Analysis",img:"swot",template:"swot-analysis"}];w(d,x,C),w(u,k,T),d.append($("#tmp-new-mod-req"));var S=function(e){g.add(h).removeClass("selected"),h.filter(":eq("+e+")").addClass("selected"),g.filter(":eq("+e+")").addClass("selected")};return h.click(function(){S($(this).index())}),m.click(function(){$(this).toggleClass("active")}),f.click(function(){p.text($(this).text())}),e.reg(r,c),function(t,a){s=t,a?(S(0),h.css("visibility","hidden"),d.find("> div:eq(8)").hide(),l.text("Add Module")):(l.text("Add"),d.find("> div:eq(8)").show(),h.css("visibility","")),e.show(r)}},app.popup.getCopySectionPopup=function(e,t,a,n,o){var i=$("#tmp-copy-move-section"),s=i.find(".destination .filter-popup-menu"),r=s.find(".item"),l=i.find(".order .filter-popup-menu"),c=i.find(".popup-cta.ok"),d=i.find(".destination .x-select .text"),u=0,m=null,f=null,p=i.find(".go-to-folio"),h=p.find(".gotofolio"),g=p.find(".name"),v=p.find(".verb"),b=!1;i.find(".loading-animation").html(t.spinner);var y=function(e){l.html("");for(var t=1;t<=e+1;t++)l.append('<div class="item" data-count="'+t+'">'+t+"</div>");l.find(".item:eq(0)").addClass("active")},C=function(t,a){console.log(a),s.html("");for(var n=0;n<a.length;n++)e.token!=a[n].Token&&(itemHtml='<div class="item" data-totalsec = "'+a[n].TotalSections+'" data-token="'+a[n].Token+'">'+a[n].FolioName+"</div>",s.append(itemHtml));r=s.find(".item"),r.click(function(){$this=$(this),y($this.data("totalsec")),c.removeClass("disabled")})};return c.click(function(){i.addClass("busy"),o.getCopySections({sourceToken:e.token,destinationToken:s.find(".active").data("token"),sectionTag:u,order:l.find(".active").data("count"),action:f,success:function(t){i.removeClass("busy"),h.attr("href",e.baseUrl+"/edit/"+s.find(".active").data("token")),g.text(s.find(".active").text());var a=b?"copied":"moved";v.text(a),i.addClass("success"),m&&m()},error:function(e){i.removeClass("busy"),t.message({heading:"Error",message:e.Message,btnText:"Ok"})}})}),t.reg(i,i.find(".icon-Close, .popup-cta.cancel")),function(r,l,p){s.html(""),i.removeClass("success"),f=l.indexOf("Move")>-1?"move":"copy",b=!(l.indexOf("Move")>-1),m=p?p:null,i.addClass("busy"),i.find(".popup-header h1").text(l),d.html("<span>Copy Section</span> To:"),d.find("span").text(l),c.text(l),c.addClass("disabled");var h=a.obtain(n.Modules,"Type","DataModule").Data.Sections;o.getUserFolios({teamId:e.Team.Id,success:function(e){i.removeClass("busy");var t=JSON.parse(e.Data);t.length>0&&C(h[r].Tag,t),u=h[r].Tag},error:function(e){i.removeClass("busy"),t.message({heading:"Error",message:e.Message,btnText:"Ok"})}}),t.show(i)}},app.popup.getExpOption=function(e,t,a){var n,o=$("#tmp-exp-option"),i=o.find(".ok"),s=o.find(".scale"),r=o.find(".page-margin"),l=o.find(".sec-margin"),c=o.find(".mod-margin"),d=o.find(".msg");return i.on("click",function(){var t,i,u,m,f=0,p=n.expOpt;return t=s.val(),i=r.val(),u=l.val(),m=c.val(),o.find(".error").removeClass("error"),validator.isInt(i)||(r.addClass("error"),f=1),validator.isInt(u)||(l.addClass("error"),f=1),validator.isInt(m)||(c.addClass("error"),f=1),d.toggleClass("error",f>0),!f&&(p.Scale=t,p.Margin=i,p.SecMargin=u,p.ModMargin=m,a.set("exp-opt-"+n.Token,JSON.stringify(p)),void e.close())}),e.reg(o,o.find(".icon-Close, .no")),function(t){n=t;var i={Scale:1,Margin:15,SecMargin:12,ModMargin:12},d=a.get("exp-opt-"+n.Token);if(d)try{i=JSON.parse(d)}catch(u){}n.expOpt=i,s.val(i.Scale),r.val(i.Margin),l.val(i.SecMargin),c.val(i.ModMargin),e.show(o)}},app.popup.getExport=function(e,t,a,n,o,i){function s(){u=!0,i.getData(1,function(t,a,n,o){e.Team.Id>0?i.hasTeam()&&(K=!0,V=!1):i.isFree()&&ie()})}var r,l,c,d,u,m,f,p,h,g,v,b=$("#tmp-export"),y=b.find(".popup-header"),C=y.find("h1"),T=y.find(".tabs"),w=T.find("span"),x=w.filter(".pdf"),k=w.filter(".png"),S=b.find(".js-pdf"),D=b.find(".x-select"),I=b.find(".no, .icon-Close"),P=b.find(".yes"),E=b.find(".cta-btns"),F=b.find(".loading-animation").html(t.spinner),A=b.find(".exp-option"),M=b.find(".png-msg"),N=b.find(".pdf-msg"),O=b.find(".gen-msg"),U=$("#pdf-col"),R=$("#thumb-col"),L=b.find(".popup-header-note"),B=b.find(".popup-header-free"),G=$(".thumbnail-controls"),H=$(".thumbnail-container"),q=b.find(".spinner-cont"),Y=b.find(".png-spinner"),z=250,j=0,_=0,K=!0,V=!1,W=!0;o.addListener("plusUnlocked",function(){s()}),o.addListener("plusCancelled",function(){s()}),w.click(function(){u||(l.format=$(this).hasClass("png")?"PNG":"PDF",Z())}),A.click(function(){t.push(b),t.expOption(r)});var J=function(e){b.find(".x-select span"),b.find(".x-select .item").removeClass("active");var t=b.find('.x-select .item[data-value="'+e+'"]').addClass("active").text();b.find(".x-select .text").text(t)},X=function(){1===r.Role?(b.find(".readonly").removeClass("hidden"),b.find(".edit").addClass("hidden")):(b.find(".readonly").addClass("hidden"),b.find(".edit").removeClass("hidden"))};G.find(".arr-left").on("click",function(e){e.preventDefault(),$(".carousel").carousel("prev"),Q()}),G.find(".arr-right").on("click",function(e){e.preventDefault(),$(".carousel").carousel("next"),Q()});var Q=function(){j=H.find(".active").index()+1,G.find("#thumb-counter").text(j+" / "+_)},Z=function(){if(console.log("ExportPreviewEnabled",e.ExportPreviewEnabled),console.log("ExportPreviewInitialLoadEnabled",e.ExportPreviewInitialLoadEnabled),console.log(typeof e.ExportPreviewInitialLoadEnabled),console.log("ExportPreviewSaveToBlobEnabled",e.ExportPreviewSaveToBlobEnabled),W&&e.ExportPreviewEnabled&&(l.format="PDF",l.mode="screen",l.orient="portrait",u=!0,e.ExportPreviewInitialLoadEnabled&&setTimeout(function(){P.click()},500),W=!1),l.format=l.format||"PDF",P.removeAttr("target"),w.removeClass("selected"),H.removeClass("cont-landscape"),G.hide(),N.hide(),M.hide(),O.hide(),oe(),b.find(".paper").hasClass("hide-cancel")||(e.ExportPreviewEnabled?P.attr("href","#").html("Preview and Export "+l.format).removeClass("download"):P.attr("href","#").html("Export "+l.format).removeClass("download")),C.text("Export "+l.format),c.target?b.find(".break").hide():b.find(".break").show(),"PNG"==l.format){H.hide(),k.addClass("selected"),S.hide();var t="<div class='thumbnail-container'><div class='img'><img src='/img/thumb-placeholder.jpg' class='placeholder' /> </div></div>";t+="Export your "+(c.target||"folio")+" as a single PNG",M.html(t).show()}else l.orient=l.orient||"landscape",S.show(),x.addClass("selected"),b.find(".selection, .select, .radio").removeClass("selected"),b.find(".for-"+(l.mode||"screen")).addClass("selected").find(".change-mode").addClass("selected"),b.find(".break .sec").addClass(l.sec?"selected":""),b.find(".break .rb").addClass(l.rb?"selected":""),b.find('.radio[data-val="'+(l.orient||"landscape")+'"]').addClass("selected"),J(l.paper||"612x792"),e.ExportPreviewEnabled?(H.show(),R.show(),U.removeClass("do-full"),N.html("Click the Preview and Export button to generate preview").show(),l.mode&&"screen"!==l.mode&&"landscape"===l.orient?(H.html('<div class="img"><img src="/img/thumb-placeholder_landscape.jpg" class="placeholder" /></div>'),H.addClass("cont-landscape")):(H.html('<div class="img"><img src="/img/thumb-placeholder.jpg" class="placeholder" /></div>'),H.removeClass("cont-landscape"))):(R.hide(),U.addClass("do-full"));return!1},ee=function(e,t){$(e).hover(function(e){$(this).stop().animate({scrollTop:$(this).find(t).height()},5e3)},function(e){$(this).stop().animate({scrollTop:0},2e3)})};b.find(".change-mode").on("click",function(){if(!u)return l.mode=$(this).data("mode"),Z()}),b.find(".orientation .radio").on("click",function(){if(!u)return l.orient=$(this).data("val"),l.mode="print",Z()}),b.find(".break .select").on("click",function(){if(!u){var e=$(this).data("val");return l[e]=!l[e],l.mode="print",Z()}}),b.find(".dropdown").on("change",function(){if(!u)return l.paper=this.value,l.mode="print",Z()}),b.find(".x-select .item").on("click",function(){if(!u)return l.paper=$(this).attr("data-value"),l.mode="print",b.find(".x-select .text").text($(this).text()),Z(),!0});var te=function(e){var t="Still working on it...";"PNG"===e&&(t="<div class='thumbnail-container'><div class='img'><img src='/img/thumb-placeholder.jpg' class='placeholder' /> </div></div>",t+="Still working on it..."),h=setTimeout(function(){"PNG"===e?M.html(t):N.html(t)},1e4)},ae=function(t){if(u=!0,E.addClass("disable-btns"),"undefined"!=typeof e.teamDefaultColorStyles&&""!==e.teamDefaultColorStyles){console.log("implementing team default color");var a=t.replace('<div class="container-fluid">',e.teamDefaultColorStyles.toString()+'<div class="container-fluid">');t=a}var o=".watermark-on-free, .watermark-on-free-shared {";o+=" opacity: 0 !important; display: none;",o+=" }";var i="<style id='watermark' type='text/css'> "+o+" </style>";t=i.toString()+t,console.log("str",t),n.exportFolio({format:l.format,html:t,settings:d,success:function(t){console.log("exportFolio response",t),p=t.Message.replace("/get-export/","");var a=e.ExportPreviewSaveToBlobEnabled?t.Data.exportPreviewThumbPath:"/get-preview-thumbnail/"+p,n=e.ExportPreviewSaveToBlobEnabled?t.Data.exportPreviewPath:"/get-preview/"+p;if(clearTimeout(h),"PDF"===l.format)if(e.ExportPreviewEnabled)if("print"===l.mode){Tiff.initialize({TOTAL_MEMORY:167772160});var o=new XMLHttpRequest;o.open("GET",n),console.log("on TIFF, using: ",n),o.responseType="arraybuffer",o.onload=function(e){var a=o.response,n=new Tiff({buffer:a}),i='<div id="carousel-" class="carousel slide" data-ride="carousel">';i+='<div class="carousel-inner" role="listbox"></div>',i+="</div>",H.html(i);for(var s=0,r=n.countDirectory();s<r;++s){n.setDirectory(s);var c=n.toCanvas(),d=0===s?"item active":"item",u=$("<div />",{"class":"img"}).append(c),m=$("<div />",{"class":d}).append(u),f=u.find("canvas").width(),p=u.find("canvas").height(),h=z/f,g=p*h;m.find("canvas").css({width:z+"px",height:g+"px"}),H.find(".carousel-inner").append(m)}$(".carousel").carousel({interval:!1}),s>1&&(G.show(),_=s,j=1,G.find("#thumb-counter").text(j+" / "+_)),N.html("Your "+l.format+" is ready to download."),"landscape"===l.orient&&H.addClass("cont-landscape"),ee(".img","canvas"),ne(t,"",!1)},o.send()}else H.html("<div class='img'><img id='pdfImg' src='"+a+"' /></div>"),N.html("Your "+l.format+" is ready to download."),ee(".img","img"),ne(t,"pdfImg");else{var i="Your "+l.format+" is ready to download.";O.html(i).show(),ne(t),S.hide(),H.hide()}else{var i="Preview<br><div class='thumbnail-container'><div class='img'><img id='pngImg' src='"+a+"' /> </div></div>";i+="Your "+l.format+" is ready to download.",M.html(i),ee(".img","img"),ne(t,"pngImg")}},error:function(e){N.text(e.Message),M.text(e.Message),oe(),clearTimeout(h),E.removeClass("disable-btns"),D.removeClass("disable-select")},complete:function(){}})},ne=function(t,a,n){var o=e.ExportPreviewSaveToBlobEnabled?t.Data.exportPath:t.Message;if(n="undefined"==typeof n||n,u=!1,clearTimeout(h),n){var i=$("#"+a);i.prop("complete")?oe():i.on("load",function(){oe()})}else setTimeout(function(){oe()},1e3);E.removeClass("disable-btns"),D.removeClass("disable-select"),P.attr("href",o).html('<i class="fi-download"></i> Download').addClass("download")},oe=function(){F.hide(),q.hide(),Y.hide()};P.on("click",function(a){if(P.hasClass("download")||a.preventDefault(),!K||v&&0===g)t.push(b),t.message({heading:"Upgrade or add credits",message:"Exporting as PDF/PNG is a premium feature. Please add credits or upgrade to a paid plan.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){t.payment()}});else{if(!P.hasClass("download")){var o=$.extend({paper:"612x792"},l);d=r.expOpt||{},m=d.Scale||1,f=d.Margin||0;$(window).width()>1367?$(window).width():1367;if(null==o.paper&&(o.paper="612x792"),"print"==o.mode&&"PDF"==o.format){var i=o.paper.split("x");d.Landscape="landscape"==o.orient,d.Width=i[0],d.Height=i[1],d.Breaks=o.sec?1:0,d.Breaks|=o.pers?2:0,d.Breaks|=o.rb?4:0,d.BrowserWidth=1276*m,d.Landscape||"421x595"!=o.paper||(d.BrowserWidth=1250*m)}else d.OnePage=!0,d.Fit=!0,d.BrowserWidth=1367,d.Width=1367,d.Height=c.$el.height()>0?c.$el.height():0;return d.ExportPreviewEnabled=null!=e.ExportPreviewEnabled&&"not-set"!=e.ExportPreviewEnabled,d.IsFreeUser=!(e.Team.Id>0)&&V,console.log(d.IsFreeUser),console.log("settings",d),"PDF"===o.format?e.ExportPreviewEnabled?(N.html("Generating preview. <br>This may take up to a minute...").show(),"landscape"===o.orient?q.find(".loader").addClass("landscape"):q.find(".loader").removeClass("landscape"),q.show()):F.show():"PNG"===o.format&&Y.show(),e.isTeam&&e.Team.Id?n.getStyleGuides({data:{team_Id:e.Team.Id},success:function(e){d.styleGuide=JSON.parse(e.Data),c.cb(d.BrowserWidth,function(e){d.Height=Math.min(14400,d.Height||Math.round(.75*c.$el.height())),ae(e)})}}):c.cb(d.BrowserWidth,function(e){d.Height=Math.min(14400,d.Height||Math.round(.75*c.$el.height())),ae(e)}),console.log("export settings",d),te(o.format),D.addClass("disable-select"),!1}setTimeout(function(){p&&e.ExportPreviewSaveToBlobEnabled&&$.post("/ReportExportSuccess/"+p),t.close(b)},300)}});var ie=function(){u=!0,B.hide(),n.getCreditsLeft({success:function(e){console.log("getCreditsLeft response",e);var t=JSON.parse(e.Data),a=r&&r.Role||2;g=t.CreditsLeft,v=t.LimitsImposed,console.log("userFolioRole",a),a>1&&v===!0?(b.find(".icon-Close").css({top:"85px"}),L.show(),se(),0===g&&P.html('Preview and Export <i class="fa fa-lock"></i>')):(b.find(".popup-content").removeClass("remove-top-border"),L.hide(),P.hasClass("download")||P.html("Preview and Export"))},error:function(e){console.log("error: ",e)},complete:function(){u=!1}})},se=function(){var e=0===g?"Purchase credits":"Purchase more credits",t=0===g?" to download.":".",a=1===g?"credit":"credits";L.find("h2 span").text(g+" "+a),L.find("a.purchase-btn").text(e),L.find(".supplement").text(t)};return L.find(".upgrade-btn").click(function(e){e.preventDefault(),t.payment()}),L.find(".purchase-btn").click(function(e){e.preventDefault(),t.payment(),$("#tmp-payment").css("opacity",0),setTimeout(function(){$("#tmp-payment .plan-banner .choose-plan").trigger("click"),setTimeout(function(){$("#tmp-payment").css("opacity",1)},200)},1e3)}),t.reg(b,I),function(a,n,o){r=a,c=o,l=n,"string"==typeof e.ExportPreviewInitialLoadEnabled&&(e.ExportPreviewInitialLoadEnabled="not-set"!==e.ExportPreviewInitialLoadEnabled&&JSON.parse(e.ExportPreviewInitialLoadEnabled.toLowerCase())),"string"==typeof e.ExportPreviewEnabled&&(e.ExportPreviewEnabled="not-set"!==e.ExportPreviewEnabled&&JSON.parse(e.ExportPreviewEnabled.toLowerCase())),"string"==typeof e.ExportPreviewSaveToBlobEnabled&&(e.ExportPreviewSaveToBlobEnabled="not-set"!==e.ExportPreviewSaveToBlobEnabled&&JSON.parse(e.ExportPreviewSaveToBlobEnabled.toLowerCase())),W=!0,i.getData(1,function(a,n,o,s){isfree=0===a.ST||34===a.ST,e.Team.Id>0?i.hasTeam()&&(K=!0,V=!1):(e.exportLimits&&(v=e.exportLimits.LimitsImposed,g=e.exportLimits.CreditsLeft),i.isFree()&&!i.hasCredits()?(K=!1,V=!0):(K=!0,V=!1)),Z(),X(),F.hide(),ie(),u=!K,console.log("meee",K,i.hasCredits()),t.show(b)},!0)}},app.popup.getShareLink=function(e,t,a,n,o,i,s,r){function l(){t.show(M),Ee("Restoring default url"),e.removeFoliosCurl({data:{token:F.Token},success:function(e){ke=F.Token,s.folioStorage(F.Token).store("curl",ke),T(),C(),ge.val(ke),Ee()},error:function(e){t.error(e.Message),Ee()}})}function c(){t.show(M)}function d(e){if(F.isLabel)return!F.Email||F.Email==e;for(var t=0;t<F.Collaborators.length;t++)if(F.Collaborators[t].Email==e&&F.Collaborators[t].Privilege>2&&1==F.Collaborators[t].Accepted)return!0;return!1}function u(e,t){M.toggleClass("mod-share",e>0),M.find(".modh1 .mod-type").text("Canvas"==t?"Canvas":"Module"),M.find(".modp .mod-type").text("Canvas"==t?"canvas":"module")}function m(e){ke=s.folioStorage(F.Token).fetch("curl")||F.Curl||F.Token,e&&e()}function f(e,t){O.animate({"margin-left":"-="+e+"px",width:"+="+e+"px"},t,function(){p(e,t)})}function p(e,t){O.animate({"margin-left":"+="+e+"px",width:"-="+e+"px"},t,function(){f(e,t)})}function h(){O.stop()}function g(){var e=b(O.parent(),"copy-field folio-link");if(e<=386?(Se=e,O.css("width",e+"px")):O.outerWidth()<386&&e>=386&&(Se=386,O.css("width","386px")),e-=1,e>O.outerWidth()){var t=(e-O.outerWidth())/100*3500;t<2e3&&(t=2e3),f(e-O.outerWidth(),t)}else v()}function v(){h(),O.css({"margin-left":"0",width:Se+"px"})}function b(e,t){$tmp=$("<span>"),$tmp.css({visibility:"hidden","white-space":"pre"}).addClass(t+" tmp-calc").html(O.val()),F.isLabel&&$tmp.css({"text-overflow":"unset","font-family":O.css("font-family"),"font-weight":O.css("font-weight"),"font-size":O.css("font-size")}),e.append($tmp);var a=e.find(".tmp-calc").outerWidth();return $tmp.remove(),a}function y(e){if("view"==e)ge.parent().addClass("hidden"),pe.addClass("hidden"),he.removeClass("hidden"),ue.removeClass("hidden"),Ce.addClass("hidden"),N.removeClass("no-border"),Te.html(""),F.isLabel||(v(),g());else if("edit"==e){if(ge.parent().removeClass("hidden"),pe.removeClass("hidden"),he.addClass("hidden"),ue.addClass("hidden"),O.val(a.baseUrl+"/"),N.addClass("no-border"),!F.isLabel){v();var t=b(O.parent(),"copy-field folio-link");ge.parent().css("left",t+"px")}C()}}function C(){var e=s.folioStorage(F.Token).fetch("curl")||F.Curl;e!=F.Token}function T(){var e=a.baseUrl+k();O.val(e),ue.attr({href:e}),U.val('<iframe width="100%" height="100%" src="'+e+'"></iframe>')}function w(e){var o="Upgrade to Business",i="Custom links are only available under the Business Plan. Please Upgrade.";a.isTeam&&a.Team.Role&&!n.isProBusiness()&&!n.isProTeamMember()&&(o="Guests cannot edit the folio URL",i="Please contact your admin for more access."),"password"==e&&(i="Password protecction is only available under the Business Plan. Please Upgrade."),t.message({heading:o,message:i,notMini:!0,btnText:"OK",handleOK:function(){t.show(M)}})}function x(){if(F.isLabel)var e=b($("body"),"copy-field folio-link");else var e=b(O.parent(),"copy-field folio-link");Se=O.outerWidth(),8==O.val().length&&(Se=e,O.css("width",Se+"px")),e<=386&&(Se=e,O.css("width",Se+"px"))}function k(){if(F.isLabel)return"/project/"+F.Token;s.folioStorage(F.Token).fetch("curl")||F.Curl;return"/"+ke}function S(e,i,s){T(),y("view"),F.Role<2&&M.addClass("user-cannot-edit"),F.IsUserTemplate?(M.find(".header-message .private .f-t").text("This template is set to private, only you (and your collaborators) can view/use it."),M.find(".header-message .public .f-t").text("Anyone with the link can use your template."),M.find(".header-pass-desc.f-t").text("Password protect your template"),M.find(".url-content h3.f-t").text("Template share URL"),M.find(".email-content h3.f-t").text("Send template via email"),M.find(".embed-content h3.f-t").text("Embed your template"),we.addClass("hidden")):(M.find(".header-message .private .f-t").html("This folio is set to private. Only you and your collaborators can view or edit it. <br> Warning: If you publicly share the channel(s) this folio is in, <br>others may still be able to view this folio."),M.find(".header-message .public .f-t").text("Anyone with the link can view your folio."),M.find(".header-pass-desc.f-t").text("Password protect your folio"),M.find(".url-content h3.f-t").text("Folio share URL"),M.find(".url-content h3.f-t").text("Send a link"),M.find(".embed-content h3.f-t").text("Embed your folio")),F.isLabel?(le.text(F.Name),url=a.baseUrl+"/project/"+ke,O.val(url),ue.attr({href:url}),U.val('<iframe width="100%" height="100%" src="'+url+'"></iframe>'),Pe(),he.addClass("hidden")):(i=i||0,$e=i,i>0?url=a.baseUrl+"/folio"+k()+"/"+i:url=a.baseUrl+k()+"",O.val(url),ue.attr({href:url}),U.val('<iframe width="100%" height="100%" src="'+url+'"></iframe>'),u(i,s),i>0?he.addClass("hidden"):a.isTeam&&a.Team.Role?(a.Team.Role<4?(he.removeClass("hidden"),ge.val(ke),o.remove(me)):o.add(me,"Guests cannot edit the folio URL",1e3),(n.isProBusiness()||n.isProTeamMember())&&o.add(me,De,1e3)):o.add(me,De,1e3)),Pe(),Me(url),Ae(),t.show(M),x(),F.isLabel||g()}function D(){F.HasPass?n.isSingleFolioGuest()?V.val(""):V.val("****"):V.val(""),X=M.find(".pass-section").toggle(F.HasPass),ee=M.find(".pass-protect").toggleClass("selected",F.HasPass),X.removeClass("show-pass"),F.HasPass&&X.show()}function I(){xe.addClass("hidden"),F.isLabel||F.Role&&1===F.Role?we.addClass("hidden"):(we.removeClass("hidden"),E(F))}function P(){return function(){return t.collaborators(F),!1}}function E(e){if(!(e.Version<2)){we.removeClass("hidden"),xe.html(""),$.each(e.Collaborators,function(e,t){if(t.Accepted&&t.Privilege>0&&t.Email!=a.userEmail){xe.removeClass("hidden"),we.addClass("hidden");var n=$('<div class="outer"><div class="initials">MN</div></div>');n.find(".initials").text(r.getInitials(t.FullName||t.Email)).attr("data-tip",t.FullName),xe.prepend(n.find(".initials"))}});var o=$('<div class="initials add"><i class="icon-AddCollaborator2"></i></div>');n.isSingleFolioGuest()?(o.attr("data-tip","Guests can not add/remove people"),o.click(function(){t.teamUserActionBlocked("add-remove-collab","Guests")})):(1===e.Role?o.addClass("hidden"):o.removeClass("hidden"),o.attr("data-tip","Add / Remove People"),o.click(P(e))),xe.append(o)}}var F={},A=!1,M=$("#tmp-popup-folio-share-link"),N=M.find(".copy-field"),O=M.find(".copy-field.folio-link"),U=M.find(".embed-url").copier(),R=M.find(".popup-content"),L=M.find(".tabs span"),B=M.find(".tab"),G=M.find(".button-bg"),H=G.find(".button-out"),q=G.find(".button-in"),Y=M.find(".msg-content").hide(),z=M.find(".email-link"),j=Y.find(".close-msg-btn"),_=Y.find(".email-msg").val(""),K=M.find(".add-msg"),V=M.find(".input-pass-dot"),W=(M.find(".input-pass-visible"),M.find(".icon-Preview"),M.find(".send-email")),J=M.find(".btn-save-pass"),X=M.find(".pass-section"),Q=X.find(".error"),Z=M.find(".busy .msg"),ee=(M.find(".loading-animation").html(t.spinner),
M.find(".pass-protect")),te=M.find(".change-indexed"),ae=M.find(".change-present"),ne=M.find(".email-result"),oe=M.find("h1"),ie=$("#spinner-container > .loading-animation").clone().addClass("size-30"),se=M.find(".share-url-desc-up.desc-btn"),re=M.find(".label-footer"),le=M.find(".labelnam"),ce=re.find(".save-label-detail"),de=re.find(".no"),ue=(M.find(".header-desc"),M.find(".preview")),me=M.find(".btn-edit-link"),fe=M.find(".btn-default-link"),pe=M.find(".edit-mode"),he=M.find(".view-mode"),ge=M.find(".edit-field"),ve=M.find(".btn-cancel"),be=M.find(".btn-save-link"),ye=M.find(".btn-copy-link"),Ce=M.find(".error-messge"),Te=M.find(".error"),we=M.find(".add-people"),xe=M.find(".collabs"),ke="",$e=0,Se=370,De="Premium Feature";$(".input-pass").xpassword({preview:!0,previewFontClass:"icon-Preview"}),O.on("click",function(){window.open(O.val(),"_blank")});var Ie=function(){(a.editMode||a.isDashboard)&&n.setLock(function(e,t){var i=M.find(".pass-select"),t="https://xtensio.com/pricing/",s='<div><a href="'+t+'" target="_blank">'+De+"</a></div>",r=!0;if(F&&F.Collaborators){var l=d(a.userEmail);l||(s="Only folio owner can set/remove the password",r=!1)}n.hasTeam()?n.isSingleFolioGuest()?(s=n.getRoleName()+" can not set/remove folio password",r=!1):n.isProBusiness()||n.isProTeamMember()?(t="https://xtensio.com/pricing/",s='<div><a href="'+t+'" target="_blank">'+De+"</a></div>",r=!1):r=!0:(n.isFree()||n.isPlus())&&(r=!1),r?o.remove(i):o.add(i,s,1e3)})};i.addListener("plusUnlocked",function(){Ie()}),i.addListener("plusCancelled",function(){Ie()}),ce.click(function(){Ee("Saving"),F.Title=M.find(".title").val(),F.Description=M.find(".desc").val(),e.changeLabelProps(F,{success:function(){ce.find("i").removeClass("hidden"),ce.find("span").text("Saved"),de.text("Close"),setTimeout(function(){ce.find("i").addClass("hidden"),ce.find("span").text("Save"),de.click()},2e3)},error:function(e){t.error(e.Message)},complete:function(){Ee()}})});var Pe=function(){F.isLabel?(oe.text("Link Sharing"),G.attr("title","Link Sharing is "+(F.Private?"Off":"On")),F.Private?(H.text(""),q.text("Off")):(H.text("On"),q.text(""))):(oe.text("Link Sharing is "+(F.Private?"Off":"On")),G.attr("title","Link Sharing is "+(F.Private?"Off":"On"))),M.find(".title").val(F.Title),M.find(".desc").val(F.Description)};J.find(".loading-animation").html(t.spinner);var Ee=function(e){A=!!e,Z.text(e),R.toggleClass("busy",A)},Fe=function(){e.updatePrivacy(F,{success:function(){},error:function(e){t.error(e.Message)},complete:function(){Ee(),R.toggleClass("private",F.Private),x(),te.prop("checked",F.Indexed)}})};fe.on("click",function(e){e.preventDefault(),t.message({heading:"Restore to Default",message:"You are about to restore the default url for this folio.",btnText:"Go ahead",cancelText:"Cancel",handleOK:l,handleNo:c})}),G.on("click",function(){return n.isSingleFolioGuest()?void t.teamUserActionBlocked("link"):(Ee(F.IsUserTemplate?"Making template "+(F.Private?"public.":"private."):F.isLabel?"Making Label "+(F.Private?"public.":"private."):"Making folio "+(F.Private?"public.":"private.")),F.Private=!F.Private,F.Private&&(F.Indexed=!1),Fe(),void Pe())}),te.on("click",function(){return n.isSingleFolioGuest()?(te.prop("checked",F.Indexed),t.push(M),void t.teamUserActionBlocked("link")):(F.Indexed=$(this).is(":checked"),void Fe())}),ae.on("click",function(){if(n.isSingleFolioGuest())return ae.prop("checked",F.PresentationMode),t.push(M),void t.teamUserActionBlocked("link");var a=F.PresentationMode=$(this).is(":checked");e.changePresentMode({token:F.Token,present:a,error:function(e){t.error(e.Message)}})}),ee.on("click",function(){var o=d(a.userEmail),i=$(this);if(t.push(M),Q.hide(),a.Team&&a.Team.Id){if(n.isProBusiness()||n.isProTeamMember())return void w("password");if(5===a.Team.Role)return void t.teamUserActionBlocked("link")}a.Team.Id>0&&a.Team.Role>0&&a.Team.Role<5?(t.pop(),o?(X.show(),Ee("Removing folio password."),e.removeObjPass({isLabel:F.isLabel,token:F.Token,success:function(){i.toggleClass("selected"),F.HasPass=!1,M.find(".input-pass-dot").val(""),n.isSingleFolioGuest()&&ee.removeClass("selected"),i.hasClass("selected")?X.show():X.hide()},error:function(e){t.push(M),t.error(e.Message)},complete:function(){Ee()}})):t.error("Only the folio owner can set/remove the password. Get in touch with the owner of this folio to add a password.")):(t.pop(),o?(X.show(),Ee("Removing folio password."),e.removeObjPass({isLabel:F.isLabel,token:F.Token,success:function(){i.toggleClass("selected"),F.HasPass=!1,M.find(".input-pass-dot").val(""),i.hasClass("locked")&&ee.removeClass("selected"),i.hasClass("selected")?X.show():X.hide()},error:function(e){t.push(M),t.message({heading:"Error",message:e.Message,btnText:"Close",handleOK:function(){D()}})},complete:function(){Ee()}})):t.error("Only the folio owner can set/remove the password. Get in touch with the owner of this folio to add a password."))}),J.click(function(){var n=d(a.userEmail);t.push(M);var o=M.find(".input-pass-dot").val();o?(Q.hide(),a.Team.Id>0&&a.Team.Role>0?(t.pop(),n?(J.find(".loading-animation").removeClass("hidden"),J.find("span").text("Saving"),e.setObjPass({isLabel:F.isLabel,token:F.Token,pass:o,success:function(){F.HasPass=!0},error:function(e){t.push(M),t.error(e.Message)},complete:function(){J.find(".loading-animation").addClass("hidden"),J.find("img").removeClass("hidden"),J.find("span").text("Saved"),setTimeout(function(){J.find("img").addClass("hidden"),J.find("span").text("Save")},3e3)}})):t.error("Only the folio owner can set/remove the password. Get in touch with the owner of this folio to add a password.")):n?(J.find(".loading-animation").removeClass("hidden"),J.find("span").text("Saving"),e.setObjPass({isLabel:F.isLabel,token:F.Token,pass:o,success:function(){F.HasPass=!0},error:function(e){t.push(M),t.error(e.Message)},complete:function(){J.find(".loading-animation").addClass("hidden"),J.find("img").removeClass("hidden"),J.find("span").text("Saved"),setTimeout(function(){J.find("img").addClass("hidden"),J.find("span").text("Save")},3e3)}})):t.error("Only the folio owner can set the password. Get in touch with the owner of this folio to add a password.")):Q.show()}),K.on("click",function(){Y.show(),K.hide()}),j.on("click",function(){Y.hide(),_.val(""),K.show()}),L.on("click",function(){L.removeClass("selected"),B.removeClass("selected").filter(":eq("+$(this).addClass("selected").index()+")").addClass("selected"),F.isLabel&&(re.hide(),se.show())}),W.click(function(){if(!A){var t=$.trim(z.val()),a=_.val();if(ne.removeClass("error success").hide(),t&&t.length>0){var n=t.split(","),o=[];if($.each(n,function(e,t){validator.isEmail($.trim(t))||o.push(t)}),o.length)1==o.length?ne.text('"'+o[0]+'" is not a valid email.').addClass("error").show():ne.text(o.map(function(e){return'"'+e+'"'}).join(", ")+" are not valid email addresses.").addClass("error").show();else{W.find("span").text("Sending"),W.prepend(ie),A=!0;var i={token:F.Token,addresses:t,message:a,modId:$e,success:function(){W.addClass("sent").find("span").text("Sent"),setTimeout(function(){W.removeClass("sent").find("span").text("Send Email")},3e3)},error:function(e){ne.text(e.Message).addClass("error").show(),W.find("span").text("Send Email")},complete:function(){A=!1,ie.remove()}};F.isLabel?e.sendLabelEmail(i):e.sendShareEmail(i)}}else ne.text("Please type one or more valid emails addresses to send message.").addClass("error").show()}});var Ae=function(){F.isLabel?(se.show(),re.hide(),(F.Title||F.Description)&&se.text("Edit page title and description")):(se.hide(),re.hide())};se.on("click",function(){se.hide(),re.show()}),de.on("click",function(){F.Title||F.Description?se.text("Edit page title and description"):se.text("Add page title and description"),se.show(),re.hide()});var Me=function(e){var t,a;F.isLabel?(t=F.Title||F.Name,a=F.Description||'All my folios labelled "'+F.Name+'" on Xtensio. #'+F.Name.replace(/ /g,"")):(t=F.FolioName,a='My folio "'+F.FolioName+'" on Xtensio.'),$.shareLinks(e,M,t,a,".share-googleplus",".share-facebook",".share-twitter",".share-linkedin")};return t.reg(M,M.find(".icon-Close")),me.on("click",function(){return me.hasClass("locked")?(w(),!1):void y("edit")}),ve.on("click",function(){T(),y("view")}),ye.click(function(){if(console.log("isSafari",r.isSafari()),ye.find(".loading-animation").removeClass("hidden"),r.isSafari()){var e=document.querySelector("#tmp-popup-folio-share-link .copy-field"),t=e.contentEditable,a=e.readOnly;e.contentEditable=!0,e.readOnly=!0;var n=document.createRange();n.selectNodeContents(e);var o=window.getSelection();o.removeAllRanges(),o.addRange(n),e.setSelectionRange(0,999999),e.contentEditable=t,e.readOnly=a}else N.select();document.execCommand("copy"),ye.find("span").text("Copied"),ye.find(".loading-animation").addClass("hidden"),ye.find("img").removeClass("hidden"),setTimeout(function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),ye.find("img").addClass("hidden"),ye.find("span").text("Copy link")},2e3)}),be.on("click",function(){Ce.addClass("hidden"),Te.html("");var n=/^[a-z\d\-_\s]+$/i,o=ge.val().trim(),i=a.baseUrl+"/"+o;o.match(n)?i.length>255?(Ce.removeClass("hidden"),Te.html("Url can have maximum of 255 characters.")):(o=o.replace(/ /g,"-"),be.find(".loading-animation").removeClass("hidden"),e.checkCurlAvailability({curl:o,token:F.Token,success:function(a){1==a.StatusCode?(be.find(".loading-animation").removeClass("hidden"),e.updateFolioCurl({curl:o,token:F.Token,success:function(){},error:function(e){t.push(M),t.error(e.Message)},complete:function(){be.find("img").removeClass("hidden"),be.find("span").text("Saved"),be.find(".loading-animation").addClass("hidden"),ke=o,s.folioStorage(F.Token).store("curl",ke),T(),setTimeout(function(){be.find("img").addClass("hidden"),be.find("span").text("Save"),y("view")},3e3)}})):(be.find(".loading-animation").addClass("hidden"),t.push(M),t.error(a.Message))},error:function(e){3==e.StatusCode?(be.find("img").removeClass("hidden"),be.find("span").text("Saved"),be.find(".loading-animation").addClass("hidden"),setTimeout(function(){be.find("img").addClass("hidden"),be.find("span").text("Save"),y("view"),F.isLabel||g()},3e3)):4==e.StatusCode?(be.find("img").removeClass("hidden"),be.find("span").text("Saved"),be.find(".loading-animation").addClass("hidden"),ke=o,s.folioStorage(F.Token).store("curl",ke),T(),setTimeout(function(){be.find("img").addClass("hidden"),be.find("span").text("Save"),y("view")},3e3)):(be.find(".loading-animation").addClass("hidden"),t.push(M),t.error(e.Message))},complete:function(){}})):(Ce.removeClass("hidden"),Te.html("Please provide valid url"))}),we.click(function(e){t.collaborators(F)}),function(e,t,a){F=e,Ie(),R=M.find(".popup-content").toggleClass("private",F.Private),D(),te.prop("checked",F.Indexed),ae.prop("checked",F.PresentationMode),M.find(".popup-wrapper").toggleClass("all-label",!!F.isLabel),M.find(".tab, .tabs span").removeClass("selected"),M.find(".tabs span:eq(0), .url-content").addClass("selected"),I(),m(function(){S(e,t,a)})}},app.popup.folioPass=function(e){var t,a=$("#tmp-get-fpass"),n=a.find(".pass"),o=a.find(".agree-box"),i=a.find(".agree"),s=a.find(".folio-msg"),r=a.find(".project-msg"),l=a.find("form"),c=a.find(".error-msg").text(e.passError),d=a.find("button");a.find(".token").val(e.verificationToken),e.isProject&&(s.hide(),r.removeClass("hidden"),i.prop("checked",!e.disclaimer),e.disclaimer&&o.removeClass("hidden")),n.on("keyup",function(e){t=!n.val(),d.prop("disabled",t)}),l.submit(function(){return n.val()?e.isProject&&i[0].checked!==!0?(c.text("You must agree with the Disclaimer first."),!1):void 0:(c.text("No password given."),!1)}),$("body").append(a.addClass("show"))},app.popup.getTeamSelector=function(e,t,a,n,o){function i(t,a,n){return function(){0===t?e.close():window.location=n}}var s=$("#tmp-select-team-to-login"),r=s.find(".no-show"),l=s.find(".cancel, .icon-Close"),c=s.find(".teams");if(s.find(".loading-animation").html(e.spinner),t.UserTeams&&t.Team&&0!=t.Team){var d=$(r.html());d.find("h3").text("Personal Dashboard");var u="https://app.xtensio.com";"dev"==t.Environment?u="https://app.xtensio.tech":"local"==t.Environment&&(u="https://www.localhost.com:44301"),d.on("click",i(0,"Personal Account",u)),c.append(d);for(var m=0;m<t.UserTeams.length;m++)d=$(r.html()),d.find("h3").text(t.UserTeams[m].Name),d.on("click",i(t.UserTeams[m].Id,t.UserTeams[m].Name,t.UserTeams[m].TeamUrl)),c.append(d)}return e.reg(s,l),function(t,a){e.show(s)}},app.popup.getAddMembers=function(e,t,a){var n=$("#tmp-add-member"),o=n.find(".no, .icon-Close"),i=n.find(".ok"),s=n.find("input");return n.find(".loading-animation").html(t.spinner),i.click(function(){console.log(s.val())}),t.reg(n,o),function(e){t.show(n)}},app.popup.getTeamUserActionBlocked=function(e,t){var a,n;return a="You can not perform this action.",function(e,o,i){n='<div style="text-align:center;font-size: 16px;">Sorry, '+(o||"Single Folio Guests")+" are not allowed to ","pwd"==e?n+="edit password of this folio.":"collab"==e?n+="modify the Collaborators.":"duplicate"==e?n+="duplicate folios.":"create"==e?n+="create folios.":"link"==e?n+="modify link sharing settings.":"transfer"==e?n+="transfer folio.":"label"==e?n+="create new channels.":"non-team-member"==e?"Premium Guests"==o?n='<div style="text-align:center;font-size: 16px;">Sorry, Premium Guests can only invite existing team members':n+="invite non team members.":n+="invite-member"==e?"add new paid users to the team.":"stats"==e?"see folio stats.":"save-as-template"==e?"create templates.":"add-remove-collab"==e?"add/remove people.":"perform this action.",n+='<p style="margin-top: 15px;margin-bottom: -5px;">Please contact your admin for more access.</p></div>',"existing-sfg"==e&&(n="This user is already a single folio guest on this team. Please contact your team admin to upgrade."),t.message({heading:a,message:n,btnText:"Ok",notMini:!0,handleOK:!!i&&i})}},app.popup.getTransferFolioToSpace=function(e,t,a,n,o){function i(n,o,i){console.log("transferFolioToSpace => doSaveFolio..."),console.log("token teamId url",n,o,i),a.getFolioByToken({token:n,success:function(s){var r=JSON.parse(s.Data);a.getFolioCollaborators({token:g,success:function(s){console.log("response collaborators",s),a.getWorkspaceChannels({teamId:o,success:function(a){console.log("response channels",a),b=!1,d.find(".loading-animation").hide(),e.saveFolioTransferWithTeam={FolioName:r.FolioName,Token:n,collaborators:JSON.parse(s.Data),labels:JSON.parse(a.Data),baseUrl:i},console.log("saveFolioTransferWithTeam",e.saveFolioTransferWithTeam),t.saveFolio()},error:function(e){console.log("error in getWorkspaceChannels",e)}})},error:function(e){console.log("error in getFolioCollaborators",e)}})},error:function(e){console.log("error in getFolioByToken",e)}})}function s(n,o){console.log("transferFolioToSpace => moveToAnySpace..."),b=!0,d.find(".loading-animation").show(),a.moveUserFolios({userEmail:e.userEmail,source:y,destination:n,folios:g,success:function(e){var t=$("#folio-items-container").find(".folio-item-shell[data-token='"+g+"']");t.animate({width:0,opacity:0,padding:0},500,"linear",function(){t.remove()}),i(g,n,o)},error:function(e){b=!1,d.find(".loading-animation").hide(),5==e.StatusCode?t.plusPrompt("create",null,!0):10==e.StatusCode?t.plusPrompt("create",null,!1,!0):t.error(e.Message)}})}function r(n,o){b||(console.log("transferFolioToSpace => addFolioToId..."),b=!0,d.find(".loading-animation").show(),a.setUserDefinedTeam({notificationId:h,teamId:n,success:function(){a.processTransfer({data:{verb:"accept",secret:v,teamId:n},success:function(){if(0==n&&e.Team.Id==y&&C==e.userName&&e.isHome){var t=$("#folio-items-container").find(".folio-item-shell[data-token='"+g+"']");t.animate({width:0,opacity:0,padding:0},500,"linear",function(){t.remove()})}i(g,n,o)},error:function(e){b=!1,d.find(".loading-animation").hide(),5==e.StatusCode?t.plusPrompt("create",null,!0):10==e.StatusCode?t.plusPrompt("create",null,!1,!0):t.error(e.Message)}})},error:function(e){t.error(e.Message)}}))}function l(e,t){return function(){w?s(e,t):r(e,t)}}function c(){if(console.log("transferFolioToSpace => init..."),e.UserTeams&&e.Team&&0!=e.Team){f.empty();var t=$(u.html());t.find("h3").text("Personal Account"),t.on("click",l(0,"")),f.append(t);for(var a=0;a<e.UserTeams.length;a++){var n=!1;5!=e.UserTeams[a].Role&&(console.log(w,e.UserTeams[a].Id,e.Team.Id),w&&e.UserTeams[a].Id==e.Team.Id&&(n=!0),n||(t=$(u.html()),4!=e.UserTeams[a].Role&&5!=e.UserTeams[a].Role||(t.find("h3").hide(),t.find(".left").hide(),t.find(".right").hide(),t.find("h3").text(e.UserTeams[a].Name).hide()),t.find("h3").text(e.UserTeams[a].Name),t.on("click",l(e.UserTeams[a].Id,e.UserTeams[a].TeamUrl)),f.append(t)))}}}var d=$("#tmp-transfer-folio-to-space"),u=d.find(".no-show"),m=d.find(".cancel, .icon-Close"),f=d.find(".teams"),p=d.find(".btn-decline"),h=0,g=null,v=null,b=!1,y=0,C="",T="",w=!1;d.find(".loading-animation").html(t.spinner);return p.click(function(){a.processTransfer({data:{verb:"reject",secret:v},success:function(){location.reload()},error:function(e){t.error(e.Message)}})}),t.reg(d,m),function(e){console.trace("on transferFolioToSpace"),e&&e.sameUser?(w=e.sameUser,g=e.Data.Token,y=e.Data.TeamID,C=e.Owner):e&&(h=e.Id,g=e.Data.Token,v=e.Data.Code,y=e.Data.TeamID,C=e.Owner),e.verb&&(T=e.verb),console.log("verb",T),"reject"===T?p.trigger("click"):(c(),t.show(d))}},app.popup.getTransferTeamFolio=function(e,t,a,n,o){function i(e){var t=m.height()+16;switch(r=e,p.prop("readonly",!0),m.css("min-height",""),m.removeClass("busy search sent found not-found"),r){case d.busy:m.css("min-height",t).addClass("busy"),g.hide();break;case d.found:m.addClass("found"),k.text(l),P.text("Transfer"),b&&g.show();break;case d.notFound:m.addClass("not-found"),D.text(c),P.text("Invite & Transfer"),g.hide();break;case d.sent:m.addClass("sent"),P.addClass("no").removeClass("yes").text("Close"),E.find(".name").text(l||F.val()+" signs up and"),g.hide();break;default:m.addClass("search"),p.prop("readonly",!1),P.text("Search")}}function s(){i(d.busy);var e=v.hasClass("selected");console.log("keepOwnerAsCollaborator",e),b||(e=!1),n.transfer({data:{token:N,name:l||F.val(),email:c,message:y.val(),AllowOutside:O,keepOwnerAsCollaborator:e},success:function(e){i(d.sent)},error:function(e){i(d.search),w.show().text(e.Message||"There was an error. Please try later.")}})}var r,l,c,d={search:1,busy:2,found:3,notFound:4,sent:5},u=$("#tmp-team-transfer"),m=u.find(".paper"),f=u.find(".popup-header h1"),p=m.find(".email").val(""),h=m.find(".msg-box"),g=u.find(".keep-collaborator"),v=g.find(".keep-cb"),b=!1,y=h.find(".msg"),C=h.find(".msg-content"),T=h.find(".close-msg-btn"),w=m.find(".error"),x=m.find(".found"),k=x.find(".name"),S=m.find(".not-found"),D=S.find(".name"),I=m.find(".add-msg"),P=m.find(".popup-cta"),E=m.find(".result"),F=m.find(".full-name").val(""),A=m.find(".back-btn"),M=u.find(".team-select"),N=e.token,O=!1;return m.find(".loading-animation").html(t.spinner),v.click(function(e){e.preventDefault(),v.toggleClass("selected"),console.log(v.hasClass("selected"))}),I.click(function(){I.hide(),C.show()}),T.click(function(){I.show(),C.hide(),y.val("")}),A.click(function(){p.val(""),i(d.search)}),P.click(function(){switch(r){case d.search:c=$.trim(p.val()),""==c&&(c=M.find(".item.active").data("value"),c&&p.val(c));var a=validator.isEmail(c);a&&c==e.userEmail&&e.Team&&e.Team.Id>0&&1==e.Team.Role?t.transferFolioToSpace({sameUser:!0,Data:{Token:N,TeamID:e.Team.Id,Owner:c}}):a?(w.hide(),i(d.busy),n.findUser({email:c,success:function(a){b=!1,e.Team&&e.Team.Id>0&&e.Team.Role<4&&a.Message&&(O?i(d.found):n.listTeamMembers({data:{teamId:e.Team.Id},success:function(e){for(var a=!1,n=!1,o=0;o<e.Data.Data.length;o++)e.Data.Data[o].Email==c&&(a=!0,l=e.Data.Data[o].UserName,5==e.Data.Data[o].Role&&(a=!1,i(d.search),w.show().text(e.Message||"This user is a Single Folio User on this team."),n=!0));a?(b=!0,console.log("states.found"),i(d.found)):t.message({heading:"Can not transfer folio",message:"You can transfer your folio's ownership only to another team member. Please contact your team admin if you need to transfer your folio over to someone outside your team.",btnText:"Ok",notMini:!0})},error:function(e){w.show().text(e.Message||"There was an error. Please try later.")}})),e.Team&&e.Team.Id>0&&e.Team.Role<4&&!a.Message?t.message({heading:"User Not found",message:"Team folios can only be transferred to existing Xtensio users. Please ask this person to create a free Xtensio account and try again.",btnText:"Ok",notMini:!0}):(l=a.Message||l,i(a.Message?d.found:d.notFound))},error:function(){i(d.search),w.show().text("There was an error. Please try later.")}})):w.show().text("Invalid Email");break;case d.found:s();break;case d.notFound:l=F.val(),S.toggleClass("no-name",!l),l&&s();break;default:t.close()}}),u.find(".is-team-admin").click(function(){t.transferTeamFolio(N,{allowOutside:!0})}),t.reg(u,u.find(".icon-Close"),function(){$(document).off(".enterOnTransfer")}),function(a,o){return m.addClass("busy"),O=!1,g.hide(),o&&(O=o.allowOutside||!1),O?(u.addClass("is-outside"),f.html('Transfer Ownership<br><span style="font-size: 16px;">Outside Team</span>')):(u.removeClass("is-outside"),f.html("Transfer Ownership")),console.log(o),e.Team&&e.Team.Id>0&&5==e.Team.Role?void t.teamUserActionBlocked("transfer"):e.Team&&e.Team.Id>0&&4==e.Team.Role?void t.teamUserActionBlocked("transfer","Premium Guests"):(e.Team&&e.Team.Id>0&&(1==e.Team.Role||2==e.Team.Role)&&!O?u.addClass("team-allow-out"):u.removeClass("team-allow-out"),N=a||N,w.hide(),i(d.search),p.val(""),P.addClass("yes"),T.trigger("click"),$(document).on("keydown.enterOnTransfer",function(e){13==(e.keyCode||e.which)&&P.click()}),n.listTeamMembers({data:{teamId:e.Team.Id},success:function(t){M.find(".filter-popup-menu .item").remove();for(var a=0;a<t.Data.Data.length;a++)4!=t.Data.Data[a].Role&&5!=t.Data.Data[a].Role&&t.Data.Data[a].Email!=e.userEmail&&M.find(".filter-popup-menu").append('<div class="item" data-value="'+t.Data.Data[a].Email+'">'+(t.Data.Data[a].FullName||t.Data.Data[a].Email)+"</div>");m.removeClass("busy")},error:function(e){w.show().text(e.Message||"There was an error. Please try later."),m.removeClass("busy")}}),void t.show(u))}},app.popup.getAddTeamMemberPopup=function(e,t,a){var n=$("#tmp-add-team-member"),o=n.find(".cancel, .icon-Close"),i=n.find(".loading-animation"),s=n.find("#member-search");n.find(".loading-animation").html(t.spinner);var r=function(e,t){};return s.on("submit",function(e){var t=$(e.target[0]).val();return i.show(),validator.isEmail(t)?a.findUser({email:t,success:function(e){i.hide(),console.log(e)},error:function(e){r(e.Message,"error")}}):r("Please provide a valid email address.","error"),!1}),t.reg(n,o),function(){t.show(n),i.hide()}},app.popup.getChoosePlanPopup=function(e,t,a,n){var o=$("#tmp-choose-plan"),i=o.find(".select"),s=o.find(".ok");return t.reg(o,o.find(".icon-Close")),i.click(function(e){$(this).toggleClass("selected"),s.toggleClass("disabled",!(o.find(".select.selected").length>0)),e.preventDefault()}),function(e){e?t.push(o):t.show(o)}},app.popup.getPersonalChannelPopup=function(e,t,a,n){function o(){$nameInput.val(""),$applied.addClass("hidden"),$collabCont.hide(),$addCollab.show(),$filterAccessButton.addClass("perma-disable"),$addCollab.addClass("perma-disable"),r.find('[for="channel_access"]').addClass("perma-disable"),r.find('[for="collab"]').addClass("perma-disable")}function i(e){busy=!e,e?($anim.hide(),$createChanBtn.removeClass("disable")):($anim.show(),$createChanBtn.addClass("disable"))}function s(e,t){t=t||"success",$anim.hide(),$applied.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){$applied.addClass("hidden"),busy=!1},3e3)}var r=$("#tmp-personal-channel"),l=r.find(".cancel, .popup-close");return $anim=r.find(".loading-animation").html(t.spinner),busy=!1,$applied=r.find(".changes-applied"),$nameInput=$("#pchannel_name"),$collabCont=$("#pcollab-channel-cont"),$addCollab=r.find(".add-new"),$filterAccessButton=r.find(".private-button"),$createChanBtn=r.find(".create-channel"),createCB={},$createChanBtn.click(function(){if(!busy){i(!1);var e=a.sanitizeText($nameInput.val().trim());if($nameInput.val(e),e.length<3)return s("Please provide a valid channel name.","error"),$createChanBtn.removeClass("disable"),void i(!0);a.createLabel({name:e,success:function(e){t.close(),window.location.reload()},error:function(e){var t=e.Message||"Error creating new channel. Please try again later";s(t,"error")},complete:function(){i(!0)}})}}),t.reg(r,l),function(e){o(),createCB=e,t.show(r)}},app.popup.getSetupTeamPopup=function(e,t){var a=function(){t.message({heading:"Welcome to "+e.Team.Name+"!<br><h3>Let's finalize your setup.</h3>",message:'<div style="margin: 0 -20px; text-align: center;"><h3 style="margin-bottom: 10px;">Would you like to import any folios from your personal dashboard?</h3><span style="font-family: Proxima-Bold;">Tip:</span> This option is also available under your profile menu.</div>',btnText:"Import Folios",cancelText:"Skip",noClose:!0,notMini:!0,isSwitchCta:!0,okClass:"ok-blue",handleOK:function(){t.importFolioPopup()},handleNo:function(){t.close()}})};return function(){e.isFirstTime,a()}},app.popup.getSfgUpgradePopup=function(e,t,a,n){function o(e){a.getFolioByToken({token:e,success:function(e){c=JSON.parse(e.Data)},error:function(e){console.log("error",e)}})}function i(e){a.findUser({email:e,success:function(e){console.log("name:::",e.Message),f.find(".username").text(w||e.Message)},error:function(e){C.hide(),S(e.Message,"error")}})}function s(){if(C.show(),console.log("username???",w),h.find(".email").text(T),h.find(".email").val(T),h.find(".item input.email").attr("readonly",!0),e.Team.Id>0&&(1===e.Team.Role||2===e.Team.Role)){var t=k(),a="You will be charged $"+t+"/mo/user. Our payments are non-refundable.";console.log("config.Team.ST",e.Team.ST),console.log("msg",a),h.find(".msg-mem").html(a),C.hide()}else C.hide()}function r(n,o,i,s){a.changeMemberAccess({userEmail:n,userRole:o,teamId:e.Team.Id,folioToken:i,accessType:s,success:function(e){C.show(),setTimeout(function(){t.message({heading:"Success",message:"<b>"+n+"</b> has been successfully upgraded to <b>"+D(o)+"</b>",btnText:"Ok",notMini:!0,handleOK:function(){}})},2e3),C.hide()},error:function(e){C.hide(),S(e.Message,"error")}})}var l,c,d=$("#tmp-sfg-upgrade"),u=d.find(".popup-content"),m=d.find(".paper"),f=d.find(".popup-header"),p=m.find(".success-panel"),h=m.find(".sfg-user"),g=m.find(".status"),v=m.find(".cancel, .popup-close"),b=m.find(".btn-cancel"),y=m.find(".add-collab"),C=(m.find(".custom-msg"),m.find(".msg-content .icon-Close"),u.find(".loading-animation")),T="",w="",x="";C.html(t.spinner);var k=function(){var t=0;switch(e.Team.ST){case 19:case 25:t=30;break;case 14:case 22:t=25;break;case 31:t=20;break;case 28:t=15}return t},S=function(e,t){C.hide(),g.text(e),g.show("slow"),"error"==t?(g.addClass("error"),g.removeClass("success")):(g.removeClass("error"),g.addClass("success")),setTimeout(function(){g.hide("slow")},3e3)};p.find(".back-to").click(function(){t.close()}),h.find(".back-to, .cancel").click(function(){t.close()}),b.click(function(){t.close()}),y.click(function(){if(C.show(),T){var e=h.find(".role").data("value")?h.find(".role").data("value"):4,t=h.data("email")||T;console.log("apiData???",t,e,x,l),r(t,e,x,l)}else S("Please add an Email to invite","error")});var D=function(t){if(e.TeamRoles)for(var a=0;a<e.TeamRoles.length;a++)if(t===e.TeamRoles[a].Id)return e.TeamRoles[a].Name;return"Error in Team ID"};return t.reg(d,v),function(e,a,n,r){console.log("sfg data??",e,a,n,r),T=a,x=n,l=r,w=e,i(T),o(n),s(),t.show(d)}},app.popup.getStyleGuidePopup=function(e,t,a,n,o,i,s,r){function l(){if(e.StyleGuides)for(var t=0;t<e.StyleGuides.length;t++){var a=e.StyleGuides[t];if(a.TeamId==e.Team.Id)return X=a.DefaultFontFamily,he=a.FallbackFontFamily,be=a.maxNumberOfFonts,a}return!1}function c(e){return X==e}function d(e){return he==e}function u(e){var t=document.createElement("style");t.appendChild(document.createTextNode("\t    @font-face {\t        font-family: '"+e.FontLocalName+"';\t        font-weight: "+e.FontWeight+"; \t        font-style: "+e.FontStyle+"; \t        src: local("+e.FontLocalName+"), url("+e.FontUrl+")  format('woff2');\t        unicode-range: "+e.UnicodeRange+"; \t    }\t    ")),document.head.appendChild(t)}function m(e){return console.log("loading font: ",e),!fe[e.IdString]&&(fe[e.IdString]="Loaded",void u(e))}function f(){var e=$(".autocomplete-items");return e.length||(e=$("<div>"),e.addClass("autocomplete-items").css({width:se.css("width")}),se.parent().append(e)),e}function p(){ye||(V=se.xautocomplete({source:function(e){a.getAllFonts({success:function(t){var a=JSON.parse(t.Data),n=$.map(a,function(e){var t=JSON.parse(e.FontJson);return"Xtensio"==e.SourceString||"System"==e.SourceString?{label:e.Name,value:t.IdString,data:{data:t,id:e.SourceIdentifier,title:e.Name,"default":c(e.SourceIdentifier),owner:e.SourceString,family:t.IdString}}:{label:e.Name,value:t.FontLocalName,data:{data:t,id:e.SourceIdentifier,title:e.Name,"default":c(e.SourceIdentifier),owner:e.SourceString,family:t.FontLocalName}}});e(n)},error:function(e){return console.log(e),!1}})},minLength:3,errorMsg:ve,select:function(e,t,a,n){},close:function(e,t){t.each(function(){$(e).closest(".autocomplete-items").get(0)!=$(this).get(0)&&$(this).remove()})},addElement:function(e,t,a,n,o,i){m(i.data);var s=$(ne.html());return s.find(".owner").text(i.owner),$family=s.find(".title .family"),$family.html(n),$family.css("font-family",i.family),$default=s.find(".title .default"),$default.append(ze()),s.find(".add-font").on("click",function(e){console.log(i),T($(this),i,1,e)}),s}}),D(),ye=!0)}function h(e,a,n){return e.find(".loading-animation").html(t.spinner),e.find(".owner").text(a.owner),$family=e.find(".title .family"),$family.text(a.title),$family.css({"font-family":a.family}),e}function g(e,t){m(e.data),$template=h($(ne.html()),e,t),$template.addClass("search-font-entry"),$default=$template.find(".title .default"),$default.append(ze()),$template.find(".add-font").on("click",function(a){T($(this),e,t,a)}),W=f(),W.append($template)}function v(e,t,a){pe[e.id]=e,"styleguide"==a?console.log("font already added by froalasetup"):"Xtensio"!=e.owner&&"System"!=e.owner&&(console.log("fonts added by search fonts "),m(e.data),w(e)),$template=h($(ae.html()),e,t),$template.addClass("user-font-entry"),$template.attr("id",e.id),$template.attr("data-default",e["default"]),$default=$template.find(".title .default"),c(e.id)?(y(e),$default.append(Ke())):$default.append(Ve()),$template.find(".make-default").on("click",function(e){var a=$(this).closest(".user-font-entry").attr("id");b($(this),a,t,e)}),$template.find(".remove").on("click",function(a){C($(this),e,t,a)}),oe.append($template)}function b(e,t,n,o){var i=e.closest(".font-entry"),s=i.closest("#user-font-list"),r=pe[t];i.addClass("loading"),a.makeDefault({data:{fontStringIdentifier:r.id,team_Id:J.TeamId,styleGuideId:J.Id},success:function(e){$("[data-default]").attr("data-default",!1),i.attr("data-default",!0),X=r.id,Je(r.family+" is now default font for the style guide.",i);JSON.parse(e.Data);y(r),i.removeClass("loading").addTimedClass("done",3e3),$fontDefaultEntry=s.find(".default .default").parent(),$fontDefaultEntry.empty().html(Ve()),$fontDefaultEntry.find(".make-default").on("click",function(e){var t=$(this).closest(".user-font-entry").attr("id");b($(this),t,n,e)}),i.find(".default:eq(0)").empty().html(Ke())},error:function(e){i.removeClass("loading"),console.log(e)}})}function y(e){$("#edit-sections, #modules-preview-main").css({"font-family":"'"+e.family+"', "+ge})}function C(e,t,n,o){var i=t.id,s=e.closest(".font-entry");return s.addClass("loading"),"true"==s.attr("data-default")?(s.removeClass("loading"),
We("Default font can not be removed from the style guide.",s),!1):void a.removeFont({data:{fontStringIdentifier:t.id,team_Id:J.TeamId,styleGuideId:J.Id},success:function(e){Je(t.family+" is removed from the style guide.",s),pe[i]&&delete pe[i],setTimeout(function(){s.remove()},5e3),x(t),s.removeClass("loading")},error:function(e){s.removeClass("loading"),console.log(e)}})}function T(e,t,n,o){var i=t.id,s=e.closest(".font-entry");return Object.keys(pe).length>=be?(We("You can't add more than "+be+" fonts to style guide.",s),!1):!pe[i]&&(s.addClass("loading"),pe[i]=t,void a.addFont({data:{fontStringIdentifier:t.id,team_Id:J.TeamId,styleGuideId:J.Id},success:function(e){Je(t.family+" is added to the style guide.",s),s.removeClass("loading").addTimedClass("done",3e3),v(t,n,"search"),s.removeClass("loading")},error:function(e){s.removeClass("loading"),console.log(e)}}))}function w(e){console.log("adding font to froala ",e.family);var t=$('<li role="presentation">'),a=$('<a class="fr-command">');a.attr({"data-id":e.id,tabindex:"-1",role:"option","data-cmd":"fontFamily","data-param1":"'"+e.family+"', "+ge,title:e.title,"aria-selected":"false"}).attr("style","font-family : '"+e.family+"', "+ge+";").text(e.title),t.append(a),_.append(t)}function x(e){console.log("removing font from froala ",e.family);var t="li a[data-param1^='\\'"+e.family+"\\',']",a=_.find(t);console.log("xtensio/system/google",t),console.log("font to remove",a),a.length?a.closest("li").remove():console.log(a,"not found")}function k(){o.hasTeam()?t.message({heading:"You can not perform this action",message:"Only team admins can manage the style guide. Please contact the admin for more access.",btnText:"Ok",bodyCentered:!0,notMini:!0}):t.message({heading:"Upgrade your account",message:"Style guide is only available on premium plans. Please upgrade or switch to your team dashboard.",btnText:"See Plans",notMini:!0,bodyCentered:!0,cancelText:"Nevermind",handleOK:function(){t.payment()}})}function S(){if(j.hasClass("locked"))return k(),!1;p();var e=$.trim(window.location.hash.substr(1));Te=""===e?"styleguide":e,t.show(te,Te)}function D(){Ce||(Ce=!0,ke.minicolors({inline:!0,letterCase:"lowercase",control:"brightness",opacity:!1,scale:1.9,change:function(e,t){if(e){try{xe.val(e),te.find(".minicolors-swatch-color").css({backgroundColor:e})}catch(a){console.log("error in color picker",error)}$(this).select()}},theme:"bootstrap"}),e.StyleGuides&&"undefined"!=typeof e.StyleGuides&&("undefined"!=typeof e.StyleGuides[0].maxNumberOfColors&&(Ee=e.StyleGuides[0].maxNumberOfColors),"undefined"!=typeof e.StyleGuides[0].StylePickerApi&&(Fe=e.StyleGuides[0].StylePickerApi),console.log("maxColorSwatches",Ee),console.log("stylePickerApi",Fe)),R(),I(),Ae.click(function(){O($(this))}),app.plugin.tooltip(),q(te.find(".palette-item:eq(0)")))}function I(){xe.keyup(function(){var e=$(this).val().toString(),t=/(^#[0-9A-F]{6}$)/i.test(e);t&&e.indexOf("#")!==-1&&(console.log("input value is",e),ke.minicolors("value",e))}),we.on("click",".palette-item",function(){var e=r.rgb2hex($(this).css("backgroundColor"));ke.minicolors("value",e),q($(this))}),we.on("click",".add-item",function(){G(!0);var e=setInterval(function(){var t=!0,n=r.generateRandomColor(),o=r.getColorBrightness(n);o<123?t=!1:te.find(".palette-item").each(function(e){var a=r.rgb2hex($(this).css("backgroundColor"));r.trimUppercase(a)===n&&(t=!1)}),t&&(clearInterval(e),a.addColor({data:{hexCode:n,team_Id:J.TeamId,styleGuideId:J.Id||0},success:function(e){console.log("addColor response",e),z("Color added to your list.","success"),te.find(".add-item").remove(),we.append('<div class="palette-item" style="background-color: '+n+'"></div>'),q(te.find(".palette-item:last")),Y()},error:function(e){z("There was a problem processing your request. Try again later.","error"),console.log("addColor error",e)},complete:function(){G(!1)}}))},500)}),te.find(".save-color").click(function(){G(!0);var e=r.trimUppercase(r.rgb2hex(ke.minicolors("value"))),t=""!==Q.html(),n=!0;return console.log("oldHex",Z),console.log("hex",e),console.log("isDefault",t),r.trimUppercase(Z)===e?void G(!1):(te.find(".palette-item").each(function(t){var a=r.rgb2hex($(this).css("backgroundColor"));e===r.trimUppercase(a)&&(n=!1)}),void(n?a.updateColor({data:{oldHexCode:Z,newHexCode:e,isDefault:t,team_Id:J.TeamId,styleGuideId:J.Id||0},success:function(t){console.log("updateColor response",t),z("Color is updated.","success"),Q.css("backgroundColor",e),Z=e},error:function(e){z("There was a problem processing your request. Try again later.","error"),console.log("updateColor error",e)},complete:function(){G(!1)}}):(G(!1),z("Selected color already exists.","error"))))}),te.find(".undo").click(function(){console.log("revert to ",Z),ke.minicolors("value",Z)}),te.find(".make-color-default").click(function(){G(!0);var e=r.rgb2hex(ke.minicolors("value"));a.makeColorDefault({data:{hexCode:e,team_Id:J.TeamId,styleGuideId:J.Id||0},success:function(e){console.log("makeColorDefault response",e),z("Selected color is now the default color.","success"),H(Q)},error:function(e){z("There was a problem processing your request. Try again later.","error"),console.log("makeColorDefault error",e)},complete:function(){G(!1)}})}),te.find(".icon-btn.delete").click(function(){""===Q.html()?(G(!0),a.removeColor({data:{hexCode:Z,team_Id:J.TeamId,styleGuideId:J.Id||0},success:function(e){console.log("removeColor response",e),z("Selected color is deleted from your list.","success"),Q.addClass("hide-palette"),setTimeout(function(){Q.remove(),q(te.find(".palette-item:eq(0)")),Y()},400)},error:function(e){z("There was a problem processing your request. Try again later.","error"),console.log("removeColor error",e)},complete:function(){G(!1)}})):(console.log("error, cant delete default color"),z("Can not delete the default color. Please make another color default to delete the selected color.","error"))}),te.find(".restore-link").click(function(e){e.preventDefault(),t.push(te),t.message({heading:"Restore colors to default",message:"Your colors list will be updated with default Xtensio colors. This can not be undone.",btnText:"Restore",cancelText:"Cancel",notMini:!0,okClass:"ok-blue",handleOK:function(){G(!0),a.restoreDefaultColors({data:{team_Id:J.TeamId,styleGuideId:J.Id||0},success:function(e){console.log("restoreDefaultColors",e),window.location.hash="managecolors",setTimeout(function(){window.location.reload()},50)},error:function(e){z("There was a problem processing your request. Try again later.","error"),console.log("restoreDefaultColors error",e)},complete:function(){G(!1)}})}})}),te.find(".pick-url-btn").click(function(){var e=te.find(".url-input").val();Oe.hide(),Ue.hide(),console.log("url input is",e),console.log(r.isValidURL(e)),e.indexOf("http://")===-1&&e.indexOf("https://")===-1&&(e="http://"+e),r.isValidURL(e)?L(e):z("Please provide a valid website URL")}),Ue.click(function(){P(Oe,Re)}),Oe.on("click",".palette-res-item",function(){var e=r.rgb2hex($(this).css("backgroundColor")),t=A(e);$(this).toggleClass("selected"),$(this).hasClass("selected")?$(this).html(t):$(this).html(""),N($(this),Oe,Me,Re)}),te.find(".results-url .x-select .item").on("click",function(){if(!Ie)return Re=$(this).attr("data-value"),te.find(".results-url .x-select .text").text($(this).text()),console.log("siteUpdateSwatch",Re),E(Oe,Re,Me),!0}),Ye.click(function(){te.find(".uploader").click()}),te.find(".uploader").change(function(){var e=this,t=e.files&&e.files[0];if(t){G(!0),Ge.hide(),He.hide();var n=te.find("#uploadswatch-form")[0];a.uploadSwatch(n,t,{source:1,success:function(e){if(console.log("uploadSwatch response",e),e.Data&&"undefined"!=typeof e.Data){var t=$.parseJSON(e.Data),a=[],n=[];console.log("dataArr",t),t.forEach(function(e,t){a.push(e.HexCode)}),$.each(a,function(e,t){n.indexOf(t)===-1&&n.push(t)}),console.log("swatchColors",n),Be.html(""),n.forEach(function(e,t){Be.append('<div class="palette-res-item" style="background-color: '+e+'"></div>')}),M(Le,Be,0),Ge.show(),He.show(),G(!1),z("Colors are successfully retrieved from swatch file","success")}else{var o="undefined"!=typeof e.Message?e.Message:"There was a problem processing your file.";z(o,"error"),G(!1)}},error:function(e){G(!1),console.log("uploadSwatch error",e),z("There was a problem processing your request. Try again later.","error")}})}}),te.find(".results-upload .x-select .item").on("click",function(){if(!Ie)return qe=$(this).attr("data-value"),te.find(".results-upload .x-select .text").text($(this).text()),console.log("uploadUpdateSwatch",qe),E(Ge,qe,Le),!0}),Ge.on("click",".palette-res-item",function(){var e=r.rgb2hex($(this).css("backgroundColor")),t=A(e);$(this).toggleClass("selected"),$(this).hasClass("selected")?$(this).html(t):$(this).html(""),N($(this),Ge,Le,qe)}),He.click(function(){P(Ge,qe)})}function P(e,n){var o=e.find(".palette-res-item.selected"),i=o.length,s="Limit reached. You can't have more than "+Ee+" colors in you palette.",l=!0;if(console.log("counter",i),console.log("updateSwatchType",n),0===i)l=!1,s="Please select at least one color.";else if("add"===n){var c=Ee-te.find(".palette-item").length;i>c&&(l=!1)}else"replace"===n&&i>Ee&&(l=!1);l?(t.push(te),t.message({heading:"Update Color List",message:"Your color list will be updated with the selected colors. This can not be undone.",btnText:"Update",cancelText:"Cancel",notMini:!0,okClass:"ok-blue",handleOK:function(){G(!0);var e=[],t=we.find(".palette-item");o.each(function(a){var o=r.trimUppercase(r.rgb2hex($(this).css("backgroundColor"))),i=!0;console.log("hex",o),console.log("checkDupes","add"===n),e.indexOf({HexCode:o,IsDefault:!1})===-1&&("add"===n&&t.each(function(e,t){var a=r.trimUppercase(r.rgb2hex($(t).css("backgroundColor")));a===o&&(i=!1)}),i&&e.push({HexCode:o,IsDefault:!1}))}),"replace"===n&&(e[0].isDefault=!0),console.log("colorArray",e),a.savePalette({data:{colors:JSON.stringify(e),team_Id:J.TeamId,styleGuideId:J.Id||0,append:"add"===n?1:0},success:function(e){console.log("savePalette",e),window.location.hash="managecolors",setTimeout(function(){window.location.reload()},50)},error:function(e){z("There was a problem processing your request. Try again later.","error"),console.log("savePalette error",e)},complete:function(){G(!1)}})}})):z(s,"error")}function E(e,t,a){var n=e.find(".palette-res-item.selected").length,o=F(t);if(console.log("max",o),console.log("counter",n),n>o){var i=0,s=n-o;console.log("difference",s),e.find(".palette-res-item.selected").each(function(e,t){i<s&&($(t).removeClass("selected").html(""),i++)})}n=e.find(".palette-res-item.selected").length,M(a,e,n)}function F(e){return"add"===e?Ee-te.find(".palette-item").length:Ee}function A(e){var t=r.getColorContrast(e);return'<i class="icon-CheckMark" style="color: '+t+'"></i>'}function M(e,t,a){var n=t.find(".palette-res-item").length;e.html("<h3>"+a+" of "+n+" selected</h3>")}function N(e,t,a,n){var o=t.find(".palette-res-item.selected").length,i=F(n);o<=i?M(a,t,o):e.hasClass("selected")&&(e.removeClass("selected"),e.html(""),z("Limit reached. You can't have more than "+Ee+" colors in you palette.","error"))}function O(e){Ae.removeClass("selected"),e.addClass("selected"),e.hasClass("color-picker")?U(".color-mid-content"):e.hasClass("color-site")?(Oe.hide(),Ue.hide(),U(".color-site-content")):e.hasClass("color-upload")&&(Ge.hide(),He.hide(),U(".color-upload-content"))}function U(e){te.find(".color-content-tabs").hide(),".color-mid-content"===e?te.find(".color-bot-content").show():te.find(".color-bot-content").hide(),te.find(e).show()}function R(){if("undefined"!=typeof e.StyleGuides){we.html("");for(var t=e.StyleGuides[0].TeamColors,a=t.length>Ee?Ee:t.length,n=0;n<a;n++)we.append('<div class="palette-item" style="background-color: '+t[n].HexCode+'"></div>'),t[n].IsDefault&&H(we.find(".palette-item").last());Y()}}function L(e){var t=Fe+e;G(!0),$.ajax({url:t}).done(function(t){if(console.log("stylePickerApi response",t),"undefined"!=typeof t.coloursBg&&"undefined"!=typeof t.coloursText){var a=$.merge(B(t.coloursBg),B(t.coloursText)),n=[];$.each(a,function(e,t){n.indexOf(t)===-1&&n.push(t)}),console.log("websiteColors",n),Ne.html(""),n.forEach(function(e,t){Ne.append('<div class="palette-res-item" style="background-color: '+e+'"></div>')}),M(Me,Ne,0),Oe.show(),Ue.show(),z("Colors are successfully retrieved from "+e,"success")}else{var o="undefined"!=typeof t.error?t.error:"Your URL did not return any valid color values.";z(o,"error"),G(!1)}}).fail(function(e){console.log("stylePickerApi error",e),z("There was a problem processing your request. Try again later.","error")}).always(function(){G(!1)})}function B(e){var t=[];return e.forEach(function(e,a){e[0].indexOf("#")!==-1&&t.push(r.trimUppercase(e[0]))}),t}function G(e){Ie=e,Ie?(te.find(".pick-url-btn").addClass("disable-ui"),Ue.addClass("disable-ui"),Pe.addClass("disable-ui"),te.find(".icon-btn").addClass("disable-ui"),De.show()):(te.find(".pick-url-btn").removeClass("disable-ui"),Ue.removeClass("disable-ui"),Pe.removeClass("disable-ui"),te.find(".icon-btn").removeClass("disable-ui"),De.hide())}function H(e){var t=r.rgb2hex(e.css("backgroundColor")),a=r.getColorContrast(t);we.find(".palette-item").html(""),e.html('<i class="icon-Star" style="color: '+a+'"></i>')}function q(e){Q=e;var t=r.rgb2hex(Q.css("backgroundColor"));Z=t,ke.minicolors("value",t),we.find(".palette-item").removeClass("selected"),e.addClass("selected")}function Y(){te.find(".palette-item").length<Ee&&0===te.find(".add-item").length&&we.append($e)}function z(e,t){var a="success",n="error",o="success"===t?a:n;Se.html(e).removeClass(n).removeClass(a).addClass(o).show("slow"),setTimeout(function(){Se.hide("slow").removeClass(o)},5e3)}var j,_,K="Premium Feature";o.setLock(function(e,t){ee(e,t)});var V,W,J,X,Q,Z,ee=function(e,t,a){if(j=$(".user-menu-popup .style-guide"),_=$("#dropdown-menu-fontFamily-1 .fr-dropdown-list[role=presentation]"),!j.length&&!a)return console.log("menu item not created yet, wait for 2000"),setTimeout(function(){ee(e,t,1)},2200),!1;var n=!1,i=K;if(o.hasTeam()){var i="Needs admin access";(o.isOwner()||o.isAdmin())&&(n=!0)}n?s.remove(j):s.add(j,i,0)},te=$("#tmp-style-guide"),ae=te.find("#template-user-font-entry"),ne=te.find("#template-search-font-entry"),oe=(te.find("#font-list"),te.find("#user-font-list")),ie=te.find(".cancel, .popup-close"),se=te.find(".search-font"),re=te.find(".popup-cta.search"),le=te.find(".tabs > span[data-to]"),ce=te.find(".tab"),de=(te.find(".msg"),te.find("#team-name")),ue=te.find("#restore-defaults"),me=te.find(".loading-animation.forpopup"),fe={},pe={},he="proxima-light",ge="Proxima-Light, Helvetica, sans-serif",ve="No fonts found matching search keywords",be=15,ye=!1,Ce=!1,Te="",we=te.find(".color-palette-cont"),xe=te.find("#colorinput"),ke=$("#colorpicker"),$e='<div class="add-item"><span>+</span></div>',Se=te.find(".color-message"),De=te.find(".loading-animation.color-loader"),Ie=!1,Pe=te.find(".save-palette"),Ee=24,Fe="",Ae=te.find(".color-tab"),Me=te.find(".url-selected-swatch"),Ne=te.find(".results-url .colors-found"),Oe=te.find(".results-url"),Ue=te.find(".results-url .update-color-palette"),Re="add",Le=te.find(".upload-selected-swatch"),Be=te.find(".results-upload .colors-found"),Ge=te.find(".results-upload"),He=te.find(".results-upload .update-color-palette"),qe="add",Ye=te.find(".btn-upload");te.find(".loading-animation").html(t.spinner),de.text(e.Team.Name),t.reg(te,ie),J=l();var ze=function(){return'<span class="add-font"><i class="icon icon-CheckMark"></i> Add to Team</span>'},je=function(){t.show(te),me.show(),a.restoreDefaultFonts({data:{team_Id:J.TeamId,styleGuideId:J.Id},success:function(t){pe={},me.hide();for(var a=!1,n=JSON.parse(t.Data),o=0;o<n.length;o++)n[o].TeamId==e.Team.Id&&(a=n[o]);if(!a)return!1;if(oe.empty(),fonts=$.map(a.TeamFonts,function(e){var t=d(e.SourceIdentifier);return t&&(X=e.SourceIdentifier),{data:e.FontJson,id:e.SourceIdentifier,title:e.Name,"default":t,owner:e.SourceString,family:e.FontJson.FontLocalName}}),fonts.length)for(var o=0;o<fonts.length;o++){var i=fonts[o];v(i,o,"styleguide")}},error:function(e){return console.log(e),!1}})},_e=function(){t.show(te)};ue.on("click",function(){t.message({heading:"Warning",message:"You are going to restore fonts for style guide.",btnText:"Go ahead",cancelText:"Cancel",handleOK:je,handleNo:_e})});var Ke=function(){return'<span class="default"><i class="icon icon-Star"></i> Default Font</span>'},Ve=function(){return'<span class="make-default"><i class="icon icon-Star"></i> Make Default</span>'};re.on("click",function(e){e.stopPropagation(),W=f(),W.empty(),me.show();var t=se.val();a.searchFonts({data:{searchQuery:t},success:function(e){var t=JSON.parse(e.Data);if(fonts=$.map(t,function(e){var t=JSON.parse(e.FontJson);return{data:t,id:e.SourceIdentifier,title:e.Name,"default":c(e.SourceIdentifier),owner:e.SourceString,family:t.FontLocalName}}),fonts.length)for(var a=0;a<fonts.length;a++){var n=fonts[a];g(n,a)}else W.html(ve);me.hide()},error:function(){return me.hide(),!1}})}),J&&(fonts=$.map(J.TeamFonts,function(e){return{id:e.SourceIdentifier,data:e.FontJson,title:e.Name,"default":c(e.SourceIdentifier),owner:e.SourceString,family:e.FontJson.FontLocalName?e.FontJson.FontLocalName:e.FontJson.IdString}}),fonts.length&&setTimeout(function(){for(var e=0;e<fonts.length;e++){var t=fonts[e];v(t,e,"styleguide")}},2e3)),le.on("click",function(){var e=$(this).addClass("selected");le.not(e).removeClass("selected"),current=e.index(),ce.removeClass("selected").filter(":eq("+current+")").addClass("selected")});var We=function(e,t){if(t)var a=t.find(".inline-msg");a.html(e).removeClass("success").addClass("error").show("slow"),setTimeout(function(){a.hide("slow").removeClass("error")},5e3),me.hide()},Je=function(e,t){if(t)var a=t.find(".inline-msg");a.html(e).addClass("success").removeClass("error").show("slow"),setTimeout(function(){a.hide("slow").removeClass("success")},5e3),me.hide()};return te.find(".tabs span:eq(1)").click(function(){D()}),te.addClass("no-close"),te.find(".popup-close").click(function(){window.location.hash="",setTimeout(function(){window.location.reload()},10)}),function(){var e=$.trim(window.location.hash.substr(1));return"styleguide"!=e&&"managecolors"!=e||(Te=e,!o.hasTeam()||!o.isOwner()&&!o.isAdmin())?("styleguide"!==e&&""!==e||r.doSetFocus(se,1),console.log("in popup ",(new Date).getTime()),void(j?S():setTimeout(function(){console.log("in popup again",(new Date).getTime()),j=$(".user-menu-popup .style-guide"),S()},2250))):(console.log("showing styleguide before waiting to load menu",(new Date).getTime()),t.show(te,e),p(),!0)}},app.popup.getTeamChannelPopup=function(e,t,a,n){function o(){h.val(""),x=!1,S=[],f.addClass("hidden"),y.empty(),b.hide(),C.show(),v.show(),T.find(".item").removeClass("active"),T.find("div[data-name='private']").addClass("active"),T.find(".text").html(P+$downArrow),g.easyAutocomplete({getValue:"UserName",data:w,theme:"bootstrap",list:{match:{enabled:!0}}}),S.push(e.userEmail),i({email:e.userEmail,fullName:e.userName,owner:!0})}function i(e){var t=$(p.html()),a="";e.email&&(a=e.email.toLowerCase().trim()),t.find(".name").html(e.fullName||a),t.find(".email").html(a||e.fullName),t.find(".remove").on("click",s(e)),t.find(".role").css("display","none"),t.find(".isOwner").text("Channel Owner"),e.owner?(ownerEmail=a,t.find(".remove").hide()):t.find(".isOwner").css("opacity",0),e.owner?y.prepend(t):y.append(t)}function s(t){return function(){if(m=!0,u.show(),t.owner)return void r("Cannot remove channel owner.","error");var a=e.userEmail;if(t.email===a.toLowerCase().trim())return void r("Cannot remove yourself as collaborator.","error");var n=[];S.forEach(function(e){e!==t.email&&n.push(e)}),S=n,$(this).closest(".item").remove(),r((t.fullName||t.email)+" has been removed from channel.")}}function r(e,t){t=t||"success",u.hide(),f.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){f.addClass("hidden"),m=!1},3e3)}function l(e){m=!e,e?(u.hide(),I.removeClass("disable")):(u.show(),I.addClass("disable"))}var c=$("#tmp-team-channel"),d=c.find(".cancel, .popup-close"),u=c.find(".loading-animation").html(t.spinner),m=!1,f=c.find(".changes-applied"),p=$("#tmp-channel-single-email"),h=$("#channel_name"),g=$("#collab-channel-input"),v=c.find(".add-collaborators"),b=$("#collab-channel-cont"),y=$("#collab-channel-list"),C=c.find(".add-new"),T=c.find(".private-button"),w=[],x=!1,k=c.find(".add-btn"),S=[],D="private",I=c.find(".create-channel"),P='<i class="icon-PadlockBig"></i> Private <span class="desc">Only channel members can access and edit</span>',E='<i class="icon-UsersGroup"></i> Team Visible <span class="desc">All team members can access and edit</span>';return $downArrow='<i class="icon-Down-Arrow"></i>',C.click(function(){b.show(),C.hide(),x=!0}),T.change(function(){var e=$(this).data("value"),t="";console.log("action",e),"private"===e?(t=P,v.show(),x&&b.show()):(t=E,v.hide(),b.hide()),T.find(".text").html(t+$downArrow),D=e}),k.click(function(a){a.preventDefault();var o=n.standardizeEmail(g.val());if(console.log("email",o),console.log("email indexof teamMembersList",n.findIndex(o,"UserName",w)===-1),validator.isEmail(o))if(S.indexOf(o)===-1)if(n.findIndex(o,"UserName",w)===-1){var s={heading:"This user is not on your team yet",message:"Please add this user as a team member or premium guest before giving them access to this channel.",bodyCentered:!0,notMini:!0};1!==e.Team.Role&&2!==e.Team.Role||(s.btnText="Invite People",s.cancelText="Cancel",s.handleOK=function(){t.teamManagePopup()}),t.push(c),t.message(s)}else S.push(o),g.val(""),i({email:o}),r("Collaborator added successfully.","success"),console.log("collabEmails",S);else r("Collaborator already added.","error");else r("Please provide a valid email address.","error")}),I.click(function(){if(!m){l(!1);var t=a.sanitizeText(h.val().trim());if(h.val(t),t.length<3)return r("Please provide a valid channel name.","error"),I.removeClass("disable"),void l(!0);var n=S.indexOf(e.userEmail);n!==-1&&S.splice(n,1);var o={data:{name:t,newAccessType:"private"===D?1:2,membersAdded:S.join(",")},success:function(e){console.log("createCollabChan res",e),window.location.reload()},error:function(e){console.log("createCollabChan error",e);var t=e.Message||"Error creating new channel. Please try again later";r(t,"error")},complete:function(){l(!0)}};console.log("apiData",o),a.createCollabChan(o)}}),t.reg(c,d),function(){l(!1),t.show(c),a.listALLMembers({data:{teamId:e.Team.Id},success:function(e){console.log("listALLMembers response",e);var t=e.Data.Data;t.forEach(function(e,t){e.Id&&w.push(e)}),l(!0),o(),n.doSetFocus(h)},error:function(e){console.log("listALLMembers error",e)}})}},app.popup.getTeamChannelManagePopup=function(e,t,a,n,o,i,s){function r(){D=[],k.addClass("hidden"),F.find(".owner-list").empty(),F.find(".members.title").hide(),F.find(".members.list").empty(),F.find(".guests.title").hide(),F.find(".guests.list").empty(),P.easyAutocomplete({getValue:function(e){return e.Email+" "+e.FullName},data:S,theme:"bootstrap",list:{match:{enabled:!0},onClickEvent:function(){var e=P.getSelectedItemData();console.log(e),P.val(e.Email)}}})}function l(){if(U.hide(),R.empty(),L=[],2!==v.AccessType&&S.length>0){var e=_.reverse(S),t=e.length>3?3:e.length;console.log("reversed",e),console.log("maxNumToGet",t),console.log("collabEmails",D);for(var a=0;a<e.length;a++){var n=e[a].Email,o=""===e[a].FullName?n:e[a].FullName;if(console.log("memberEmail",n),L.length<t&&D.indexOf(n)===-1&&n!==y.Email){var i=$(B.html());i.click(function(){c({email:$(this).find(".email").text(),fullName:$(this).find(".name").text(),owner:!1,isGuest:!1}),l()}),L.push(n),i.find(".name").text(o),i.find(".email").text(n),R.append(i)}}console.log("recentList",L),L.length>0&&U.show()}}function c(e){D.push(e.email),d(e)}function d(e){var t=$(w.html()),a="";e.email&&(a=e.email.toLowerCase().trim()),t.find(".name").html(e.fullName||a),t.find(".email").html(a||e.fullName),t.find(".remove").on("click",u(e)),t.find(".role").css("display","none"),t.find(".isOwner").text("Channel Owner"),e.owner?(ownerEmail=a,t.find(".remove").hide(),F.find(".owner-list").empty().append(t)):(t.find(".isOwner").css("opacity",0),e.isGuest?(t.find(".remove").show(),F.find(".guests.list").append(t)):(2===v.AccessType?t.find(".remove").hide():t.find(".remove").show(),F.find(".members.list").append(t)),f())}function u(e){return function(){if(e.owner)return void m("Cannot remove channel owner.","error");var a=(e.fullName||e.email,$(this));t.push(C),t.message({heading:"Are you sure?",message:"Removing this user will revoke their editing access to all folios given at channel level. It will also remove any folios they own from the channel. You can still add collaborators to individual folios.",btnText:"Yes, Remove User",cancelText:"Cancel",bodyCentered:!0,enterAsOK:!0,notMini:!0,handleOK:function(){var t=[];D.forEach(function(a){a!==e.email&&t.push(a)}),D=t,a.closest(".item").remove(),l(),m((e.fullName||e.email)+" has been removed from list."),f()}})}}function m(e,t){t=t||"success",K.hide(),k.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){k.addClass("hidden"),I=!1},3e3)}function f(){F.find(".guests.list").children().length>0?A.show():A.hide(),F.find(".members.list").children().length>0?M.show():M.hide()}function p(e){I=!e,e?(K.hide(),N.removeClass("disable")):(K.show(),N.addClass("disable"))}function h(){p(!1),S=[],a.listALLMembers({data:{teamId:e.Team.Id},success:function(t){console.log("listALLMembers response",t);var n=t.Data.Data;n.forEach(function(e,t){e.Id&&S.push(e)}),console.log("teamMembersList",S),r();var o=x.find(".item.active");""===j&&""===z?(g=o.data("name"),O=o.find("span.name").text(),z=g,j=O):(g=z,O=j),console.log("channelToken",g),console.log("channelName",O);var i=_.findIndex(e.labels,["Token",g]);if(i!==-1){v=e.labels[i];var s,d,u;2===v.AccessType?(s="All team members will have access to this channel. <br>You can also add premium guests as additional collaborators.",d=q,Y="team"):(d=H,Y="private",s="Only you and the individual collaborators you add to this channel will have access."),u='<span class="text-current">'+d+'</span><i class="icon-Down-Arrow"></i>',G.find(".text").html(u),G.find(".item").removeClass("active"),G.find("div[data-name='"+Y+"']").addClass("active"),C.find(".popup-header .access-desc").html(s),console.log("channelData",v)}else console.log("Error getting current label data");C.find(".popup-header .channel").text(O),a.getChannelCollaborators({data:{token:g},success:function(e){console.log("getChannelCollaborators response",e),a.getLabelOwner({data:{token:g},success:function(t){console.log("getLabelOwner response",t),y=JSON.parse(t.Data),c({email:y.Email,fullName:y.FullName,owner:!0}),b=JSON.parse(e.Data),console.log("collaboratorsData",b),b.length>0&&b.forEach(function(e,t){var a=_.findIndex(S,["Email",e.Email]),n=!1;a!==-1&&(n=4===S[a].Role),D.indexOf(e.Email)===-1&&e.Email!==y.Email&&c({email:e.Email,fullName:e.FullName,owner:!1,isGuest:n})}),l()},error:function(e){console.log("getLabelOwner error",e);var t=e.Message||"Error fetching channel owner details";m(t,"error")},complete:function(){p(!0)}})},error:function(e){console.log("getChannelCollaborators error",e);var t=e.Message||"Error fetching channel collaborators list";m(t,"error")}})},error:function(e){console.log("listALLMembers error",e);var t=error.Message||"Error fetching team members list";m(t,"error")}})}var g,v,b,y,C=$("#tmp-team-channel-manage"),T=C.find(".cancel, .popup-close"),w=$("#tmp-channel-single-email"),x=$("#all-labels-container"),k=C.find(".changes-applied"),S=[],D=[],I=!1,P=$("#collab-manage-channel-input"),E=C.find(".add-btn"),F=$("#collab-manage-channel-list"),A=F.find(".guests.title"),M=F.find(".members.title"),N=$(".save-list"),O="",U=C.find(".recent-members"),R=U.find(".recent-container"),L=[],B=$("#tmp-channel-single-recent"),G=C.find(".private-button"),H='<i class="icon-PadlockBig"></i> Private',q='<i class="icon-UsersGroup"></i> Team Visible',Y="private",z="",j="",K=C.find(".loading-animation").html(t.spinner);return G.change(function(){function n(e){var t="private"===e?H:q;t='<span class="text-current">'+t+'</span><i class="icon-Down-Arrow"></i>',G.find(".text").html(t)}if(!I){var o=$(this).data("value"),i=$("#all-labels-container").find(".item.active").data("name"),s=_.findIndex(e.labels,["Token",i]);s!==-1&&(console.log("config.labels[labelID]",e.labels[s]),Y=2===e.labels[s].AccessType?"team":"private"),console.log("private-button change",o),console.log("labelToken",i),n(o);var r="Are you sure you want to make this channel private? Your team members will be removed from folios within this channel. You can still add individual collaborators to the channel and folios.";"team"===o&&(r="Are you sure you want to make this channel team visible? All of your team members will have editing access to all folios added to this channel."),t.push(C),t.message({heading:"Channel Access Change",message:r,btnText:"Ok",cancelText:"Cancel",bodyCentered:!0,enterAsOK:!0,notMini:!0,handleOK:function(){p(!1),a.changeChannelAccess({data:{labelToken:i,newAccessType:"private"===o?1:2},success:function(e){Y=o,console.log("changeChannelAccess response",e)},error:function(e){o=Y,console.log("changeChannelAccess err",e)},complete:function(){p(!0),G.find(".item").removeClass("active"),G.find("div[data-name='"+o+"']").addClass("active"),n(o)}})},handleNo:function(){p(!0),n(Y)}})}}),E.click(function(a){a.preventDefault();var n=o.standardizeEmail(P.val()),i=_.findIndex(S,["Email",n]);if(console.log("email",n),console.log("email indexof teamMembersList",i===-1),validator.isEmail(n))if(D.indexOf(n)===-1)if(i===-1){var s={heading:"This user is not on your team yet",message:"Please add this user as a team member or premium guest before giving them access to this channel.",bodyCentered:!0,cancelText:"Ok",enterAsOK:!0,notMini:!0};1!==e.Team.Role&&2!==e.Team.Role||(s.btnText="Invite People",s.cancelText="Cancel",s.handleOK=function(){t.teamManagePopup()}),t.push(C),t.message(s)}else P.val(""),c({email:n,isGuest:4===S[i].Role}),l(),m("Collaborator email address added successfully.","success"),console.log("collabEmails",D);else m("Email address already added.","error");else m("Please provide a valid email address.","error")}),N.click(function(){if(!I){p(!1),D.forEach(function(e,t){var a=o.findIndex(e,"Email",b);if(a===-1&&e!==y.Email){var n=S[o.findIndex(e,"UserName",S)];console.log("member id",o.findIndex(e,"UserName",S)),console.log("member",n),b.push({New:!0,Deleted:!1,Email:e,FullName:n.FullName,UserName:e})}}),b.forEach(function(e,t){D.indexOf(e.Email)===-1&&e.Email!==y.Email&&(b[t].Deleted=!0)}),console.log("collaboratorsData",b);var e={labelToken:g,memberList:JSON.stringify(b)};console.log("apiData",e),a.saveChannelCollaborators({data:e,success:function(e){console.log("addMultipleChannelCollaborators response",e),t.close()},error:function(e){console.log("addMultipleChannelCollaborators error",e);var t=e.Message||"Error processing save list, please try again later";m(t,"error")},complete:function(){p(!0)}})}}),s.addListener("collabChanFolioMixItUp",function(){setTimeout(function(){h()},200)}),t.reg(C,T),function(){t.show(C),h(),o.doSetFocus(P,1)}},app.popup.getTeamCollaborationPopup=function(e,t,a,n,o,i,s){function r(){var e=oe?"OK":"See Plans",a=oe?null:"Nevermind";t.push(M),t.message({heading:"Upgrade your account",message:"Collaboration is available only on premium plans. Please upgrade or switch to your team dashboard to add people",btnText:e,cancelText:a,notMini:!oe,handleOK:function(){oe?t.close():t.payment()}})}function l(e){for(var t=0;t<folioCollabList.length;t++)if(a.standardizeEmail(folioCollabList[t].Email)===e&&folioCollabList[t].Privilege>0&&null===folioCollabList[t].Accepted)return!0;return!1}function c(n,o,i,s){switch(M.removeClass("belong-to-team"),se=o?a.standardizeEmail(o.email):"",Y.removeClass("not-user"),
M.removeClass("team-deny-non-xtensio add-paidmem add-guest"),Y.find(".not-user input.email").attr("readonly",!1),n){case N.main:H.removeClass("selected"),H.find(".back-button").removeClass("hidden");break;case N.notUser:if(H.addClass("selected"),H.find(".back-button").addClass("hidden"),e.Team&&0!=e.Team.Id&&!i.teamMember){if(e.Team.Role>2){if(3!==e.Team.Role){var r=4===e.Team.Role?"Premium Guests":"Team Member";return void t.teamUserActionBlocked("invite-member",r)}Q.find(".r1").addClass("disabled"),Q.find(".r2").addClass("disabled")}else Q.find(".r1").removeClass("disabled"),Q.find(".r2").removeClass("disabled");s?(M.addClass(s),Y.find(".username").text(re)):M.addClass("add-mem"),J.text(e.Team.Name),X.text(o.email),Q.find(".email").text(se),Q.find(".team").text(e.Team.Name),Y.find(".email").val(re),Y.find(".full-name").val(""),Y.addClass("not-user").removeClass("a-user pending-user"),Y.find(".not-user input.email").attr("readonly",!0)}else Y.find(".email").val(se),Y.addClass("not-user").removeClass("a-user pending-user");break;case N.aUser:if(H.addClass("selected"),H.find(".back-button").addClass("hidden"),e.Team&&0!=e.Team.Id&&!i.teamMember){if(e.Team.Role>2){if(3!==e.Team.Role){var r=4===e.Team.Role?"Premium Guests":"Team Member";return void t.teamUserActionBlocked("invite-member",r)}Q.find(".r1").addClass("disabled"),Q.find(".r2").addClass("disabled")}else Q.find(".r1").removeClass("disabled"),Q.find(".r2").removeClass("disabled");s?(M.addClass(s),Y.find(".username").text(re)):M.addClass("add-mem"),J.text(e.Team.Name),X.text(se),Q.find(".email").text(se),Q.find(".team").text(e.Team.Name),H.addClass("selected"),H.find(".back-button").addClass("hidden"),Y.find(".email").val(re),Y.addClass("a-user").removeClass("not-user pending-user"),Y.find(".a-user input.email").attr("readonly",!0)}else e.Team&&0!=e.Team.Id&&i.teamMember&&(M.addClass("belong-to-team"),Y.find(".team-role").text(" ("+i.RoleName+")"),Y.find(".acc-lvl-txt").hide()),Y.data("email",se).find(".username").text(o.name||se),Y.find(".email").val(se),Y.addClass("a-user").removeClass("not-user pending-user");break;case N.pendingUser:H.addClass("selected"),H.find(".back-button").addClass("hidden"),Y.data("email",se).find(".username").text(o.name),Y.addClass("pending-user").removeClass("not-user a-user")}}function d(e){Y.addClass(e),M.find(".popup-close").addClass(e),u("",{email:re},e)}function u(o,i,s){if(K.find("input").val(""),M.removeClass("add-mem add-sfg contact-supp non-user-add"),e.Team&&i&&0!=e.Team.Id){var r=a.standardizeEmail(i.email);n.findUser({email:r,success:function(d){if(d.Message)o=l(r)?N.pendingUser:N.aUser,n.listALLMembers({data:{teamId:e.Team.Id},success:function(n){var l={};l.isXUser=!0,l.teamMember=!1;for(var d=0;d<n.Data.Data.length;d++)a.standardizeEmail(n.Data.Data[d].Email)===r&&(l.teamMember=!0,l.RoleName=n.Data.Data[d].RoleName,l.Role=n.Data.Data[d].Role);e.Team&&4===e.Team.Role&&!l.teamMember&&t.teamUserActionBlocked("non-team-member","Premium Guests"),5===l.Role?m("This user is already a Single Folio Guest on this team.","error"):c(o,i,l,s),M.find(".loading-animation").hide()},error:function(e){M.find(".loading-animation").hide()}});else{o=N.notUser;var u={};u.teamMember=!1,u.RoleName="",u.Role=0,u.isXUser=!1,c(o,i,u,s)}},error:function(e){m(e.Message,"error")}})}else c(o,i,null,s)}function m(e,t,a){t=t||"success",_.hide(),a||u(N.main),R.removeClass("hidden success error").addClass(t).text(e),setTimeout(function(){R.addClass("hidden")},3e3)}function f(e){for(var t=0;t<folioCollabList.length;t++)if(a.standardizeEmail(folioCollabList[t].Email)===e)return folioCollabList[t];return null}function p(t,a,n,o){if(M.hasClass("belong-to-team"))_.hide(),m("A request has been sent to "+a),g(t,a,ce,parseInt(n),o);else if(M.hasClass("add-guest")){var i={Email:t,FullName:a,TeamId:e.Team.Id,Message:o,FolioToken:le,Accepted:ce,AccessType:n,Privilege:n,Role:5},s=y(i);s?(_.hide(),m(t+" has been added as a Single Folio Guest."),g(t,a,ce,parseInt(n),o)):m(t+" is already added on your list.","error")}else if(M.hasClass("add-paidmem")||M.hasClass("add-pg")){var r;M.hasClass("add-paidmem")?r=3:M.hasClass("add-pg")&&(r=4);var i={Email:t,FullName:a,TeamId:e.Team.Id,Message:o,FolioToken:le,Accepted:ce,AccessType:n,Privilege:n,Role:de},s=y(i);s?(_.hide(),M.find(".success-panel .list-mems span").text(re),M.addClass("success"),g(t,a,ce,parseInt(n),o)):m(t+" is already added on your list.","error")}}function h(e){for(var t=a.standardizeEmail(e.Email),n=0;n<folioCollabList.length;n++)if(a.standardizeEmail(folioCollabList[n].Email)===t&&folioCollabList[n].Privilege>0&&folioCollabList[n].Accepted===!0)return!0;return!1}function g(n,o,i,s,r){var l={};l.Email=n,l.FullName=o,l.Accepted=i,l.Privilege=s,l.Message=r;var c=a.standardizeEmail(l.Email);if(!validator.isEmail(c))return void m("Please provide a valid email address.","error");if(c===e.userEmail)return void m("You cannot add your email address as collaborator.","error");if(e.Team&&5===e.Team.Role)return t.teamUserActionBlocked("collab"),!1;var d=v(l);d.length>0?m("User is already added on your list.","error"):folioCollabList.push(l),A()}function v(e){return Faltu(folioCollabList).filter(function(t){return t.Email&&t.Email==e.Email&&t.Privilege>0}).get()}function b(e){return Faltu(newTeamList).filter(function(t){return t.Email&&t.Email==e.Email&&t.Privilege>0}).get()}function y(n){var o=!1;a.standardizeEmail(n.Email);if(e.Team&&5===e.Team.Role)return t.teamUserActionBlocked("collab"),!1;var i=b(n);return i.length>0?m("User is already added on your list.","error"):(newTeamList.push(n),o=!0),o}function C(e){$.each(folioCollabList,function(t,a){a&&a.Email===e.Email&&(folioCollabList[t].Privilege=0,folioCollabList[t].Accepted=null)}),T(e),he(),A()}function T(e){$.each(newTeamList,function(t,a){a&&a.Email===e.Email&&(newTeamList[t].Privilege=0,newTeamList[t].Accepted=null)}),he()}function w(e,t){return _.hide(),t.remove(),3===e.Privilege?void m("Cannot remove Folio owner.","error"):(T(e),C(e),void m((e.FullName||e.Email)+" has been removed from folio."))}function x(e,t){$.each(folioCollabList,function(a,n){n&&n.Email===t&&(folioCollabList[a].Privilege=e,folioCollabList[a].Accepted=null)})}function k(a,n){var o=a.Email==e.userEmail;return o?void(e.isHome?t.close():t.archive(folio,function(){window.location.href="/"})):(_.show(),n.remove(),C(a),_.hide(),m(a.Accepted?(a.FullName||a.Email)+" has been removed from folio.":"Invitation for "+(a.FullName||a.Email)+" has been cancelled."),void 0)}function S(a){return function(){var o=!1,i=$(this).closest(".person");return e.Team&&e.Team.Id?(_.show(),void n.listALLMembers({data:{teamId:e.Team.Id},success:function(n){for(var s=0;s<n.Data.Data.length;s++)n.Data.Data[s].Email==a.Email&&5===n.Data.Data[s].Role&&(w(a,i),o=!0);!o&&e.Team&&5===e.Team.Role?(t.teamUserActionBlocked("collab"),_.hide()):o||k(a,i)},error:function(e){_.hide(),m(err.Message,"error")}})):void k(a,i)}}function D(a){return function(){if(e.Team&&5===e.Team.Role)return t.teamUserActionBlocked("collab"),!1;var n=$(this);x(n.data("value"),a.Email),a.Privilege=n.data("value"),m((a.FullName||a.Email)+" can "+(1==a.Privilege?"now view only.":"view and edit now."))}}function I(e){if(ue)for(var t=0;t<ue.length;t++)if(ue[t].Email==e)return ue[t].Role;return 0}function P(t){var a=9;if(e.Team&&e.Team.Id>0&&(a=I(t.Email)),0!==t.Privilege&&t.Accepted!==!1){var n=3===t.Privilege&&t.Email===e.userEmail&&t.Accepted===!0;3===t.Privilege&&t.Email===e.userEmail&&t.Accepted===!0&&(owner=t);var o=t.Privilege<3&&t.Email==e.userEmail,i=$(O.html());i.data("person",t).addClass(t.Privilege>2||o?"owner":"collabo").find(".isOwner").text(o?"You":"Owner"),i.addClass(null===t.Accepted&&t.Privilege>0&&t.Privilege<3?"pending":""),i.addClass("team-role-"+a).attr("team-role",a),i.find(".name").text(t.FullName||t.Email),i.find(".email").text(t.Email||t.FullName),setTimeout(function(){i.find(".role").trigger("val",["value",t.Privilege]).on("change",D(t))},500),i.find(".remove").on("click",S(t)).attr("data-tip",t.Accepted?n||o?"Leave Folio":"Remove Collaborator":"Cancel Invitation"),t.Email!=e.userEmail&&3===t.Privilege?i.find(".remove").remove():t.Email===fOwner.Email&&n&&i.find(".remove").remove(),q.append(i)}}function E(){var t=0;q.empty(),$.each(folioCollabList,function(e,a){a.Privilege>0&&a.Accepted&&t++,a.Privilege=void 0===a.Privilege?1:a.Privilege,P(a)}),t>(e.isHome?0:1)&&q.addClass("hasCollabs"),app.plugin.tooltip(),app.menu.xSelect()}function F(e){return function(){ne&&ie?(re=e.Email||e.FullName,u(N.aUser,{name:e.FullName,email:e.Email})):r()}}function A(){E(),he()}var M=$("#tmp-team-collaboration"),N={main:1,notUser:2,aUser:3,pendingUser:4},O=$("#collab-single-person"),U=M.find(".toggle"),R=M.find(".changes-applied"),L=$("#team-single-recent"),B=$(".recently-added"),G=M.find(".header-collaboration-blocker"),H=M.find(".popup-content"),q=H.find(".list"),Y=H.find(".selected"),z=Y.find(".a-user"),j=Y.find(".not-user"),_=M.find(".loading-animation"),K=M.find("#member-search"),V=K.find("#member_search"),W=M.find(".search-btn"),J=M.find(".popup-header h1.am-h .team"),X=M.find(".popup-header p.am-h .email"),Q=M.find(".team-add"),Z=(M.find(".team-add div"),M.find(".add-team-member")),ee=M.find(".add-team-member"),te=ee.find(".custom-msg"),ae=ee.find(".msg-content .icon-Close"),ne=(M.find(".success-panel"),!0),oe=!1,ie=!1,se="",re="",le="",ce=null,de=0,ue=null;folioCollabList=[],newTeamList=[],sfgList=[],sfgArr=[],fOwner={},currStep=0,isInvite=!1,tooltipFreeMsg="Premium Feature",_.html(t.spinner),W.on("click",function(){ne&&ie||r()});var me=function(t,a){var n=M.find(".search-btn"),s=tooltipFreeMsg;o.getData(1,function(t,a,r,l){console.log("data.ST",t.ST),14!==t.ST&&19!==t.ST||(oe=!0),e.Team.Id>0&&4!==e.Team.Role&&5!==e.Team.Role&&(ie=!0),o.hasTeam()?(o.isSingleFolioGuest()||o.isPremiumGuest())&&(s="Guests can not add collaborators.",ne=!1):(o.isFree()||o.isPlus())&&(ne=!1),ne?i.remove(n):i.add(n,s,0)},!0)},fe=function(e){o.setLock(function(e,t){me(e,t)},e)};fe();var pe=function(){var e=ne?"15px":"130px";ne?(M.find(".popup-content").removeClass("remove-top-border"),G.addClass("hidden"),V.removeClass("disable-btns")):(M.find(".popup-content").addClass("remove-top-border"),G.removeClass("hidden"),V.addClass("disable-btns")),M.find(".icon-Close").css({top:e})};G.find("a.btn").on("click",function(e){e.preventDefault(),window.location.hash="billing"}),te.click(function(){ee.find(".msg-content").show("slow")}),ae.click(function(){ee.find(".msg-content").hide("slow")}),Z.find(".invite-confirm").click(function(){var e=Z.find(".block:eq(1) .left input").val(),t=Z.find(".block:eq(1) .right input").val(),a=Z.find(".block:eq(2) .role .popup-menu .item.active").data("value"),n=Z.find(".opts .msg-content textarea").val();return validator.isEmail(e)?(_.show(),void p(e,t,a,n)):void m("Please provide a valid email address.","error",1)}),_.html(t.spinner),Q.find(".get-in-touch").click(function(){HelpCrunch("sendUserMessage","I would like to add a new team member.")}),Q.find(".add-single-folio-guest").click(function(){d("add-guest")}),Q.find(".add-member").click(function(){t.push(),t.teamManagePopup(!0)}),H.on("click",".pending-user .btn.yes",function(){var e=f(a.standardizeEmail(Y.data("email")));m("An invitation has been sent again to "+e.FullName)}),H.on("click",".pending-actions .b",function(){var e=$(this),t=e.closest(".person");t.data("person");_.show(),e.text("Sending ...").css("cursor","default"),_.hide(),e.text("Invitation Sent!"),t.find(".actions").addClass("active"),setTimeout(function(){e.text("Resend Invitation").css("cursor","pointer"),t.find(".actions").removeClass("active")},3e3)}),Y.find(".cancel").click(function(){u(N.main)}),j.find(".add-collab").on("click",function(){var t=j.find(".full-name").val(),a=j.find(".email").val(),n=j.find(".role").data("value")?j.find(".role").data("value"):2,o=j.find(".msg-area.open").length?j.find("textarea").val():"";return validator.isEmail(a)?(_.show(),e.Team&&e.Team.Id>0?void p(a,t,n,o):(_.hide(),m("A request has been sent to "+t),void g(a,t,ce,parseInt(n),o))):void m("Please provide an valid email address.","error",1)}),z.find(".add-collab").on("click",function(){_.show();var t=z.find(".username").text(),a=z.find(".role").data("value")?z.find(".role").data("value"):2,n=Y.find(".email").val()||re,o=z.find(".msg-area.open").length?j.find("textarea").val():"";return e.Team&&e.Team.Id>0?void p(n,t,a,o):(m("A request has been sent to "+t),void g(n,t,ce,parseInt(a),z.find(".msg-area.open").length?z.find("textarea").val():""))}),K.on("submit",function(o){if(!ne)return event.preventDefault(),!1;var i=a.standardizeEmail($(o.target[0]).val());return re=i,e.Team&&5===e.Team.Role?(t.teamUserActionBlocked("collab"),!1):(_.show(),validator.isEmail(i)?n.findUser({email:i,success:function(e){_.hide(),u(e.Message?l(i)?N.pendingUser:N.aUser:N.notUser,{name:e.Message,email:i})},error:function(e){m(e.Message,"error")}}):m("Please provide a valid email address.","error"),!1)});var he=function(){B.empty(),K.removeClass("hasRecent");var e=0;$.each(ue,function(t,a){if(!(e>=3||h(a)||l(a.Email))){var n=$(L.html());n.find(".name").text(a.FullName||a.Email),n.find(".email").text(a.Email||a.FullName),n.on("click",F(a)),B.append(n),K.addClass("hasRecent"),e++}})};return H.on("click",".team-role-5 .resend-team-inv, .team-role-0 .resend-team-inv",function(){var e=$(this),t=e.closest(".person");t.data("person");_.show(),e.text("Sending ...").css("cursor","default"),_.hide(),e.text("Invitation Sent!"),t.find(".actions").addClass("active"),setTimeout(function(){e.text("Remind").css("cursor","pointer"),t.find(".actions").removeClass("active")},3e3)}),Q.find(".r1").click(function(){if($(this).hasClass("disabled")){var a=4==e.Team.Role?"Premium Guests":"Team Member";t.teamUserActionBlocked("invite-member",a,function(e,a){t.show(M)})}else 4==e.Team.Role?t.teamUserActionBlocked("non-team-member","Premium Guests"):(M.find(".popup-header h1.am-h .mem").text("Team Member "),M.find(".popup-header p.am-h").addClass("hidden"),e.Team&&e.Team.ST&&(14==e.Team.ST||19==e.Team.ST||22==e.Team.ST||25==e.Team.ST||28==e.Team.ST||31==e.Team.ST)?(Z.find(".block:eq(1) .left input").val(re),de=3,d("add-paidmem")):M.addClass("contact-supp"))}),Q.find(".r2").click(function(){if($(this).hasClass("disabled")){var a=4==e.Team.Role?"Premium Guests":"Team Member";t.teamUserActionBlocked("invite-member",a,function(e,a){t.show(M)})}else 4==e.Team.Role?t.teamUserActionBlocked("non-team-member","Premium Guests"):(M.find(".popup-header h1.am-h .mem").text("Premium Guest "),M.find(".popup-header p.am-h").addClass("hidden"),e.Team&&e.Team.ST&&(14==e.Team.ST||19==e.Team.ST||22==e.Team.ST||25==e.Team.ST||28==e.Team.ST||31==e.Team.ST)?(Z.find(".block:eq(1) .left input").val(re),de=4,d("add-paidmem")):M.addClass("add-pg"))}),Q.find(".r3").click(function(){4==e.Team.Role?t.teamUserActionBlocked("non-team-member","Premium Guests"):(M.find(".popup-header h1.am-h .mem").text("Single Folio Guest "),Q.find(".add-single-folio-guest").trigger("click"))}),t.reg(M,M.find(".popup-close, .btn-close, .back-to, .back-button"),function(){U.off("click"),t.saveFolio(1,folioCollabList,newTeamList)}),function(a){M.removeClass("success"),ue=null,M.find(".loading-animation").show(),_.show(),folioCollabList=[],newTeamList=[],fOwner={Email:e.userEmail,FullName:e.FullName,Privilege:3,Accepted:!0},"undefined"!=a&&a.length>0?a.forEach(function(e){folioCollabList.push(e)}):folioCollabList.push(fOwner),E(),M.find(".popup-header h1.am-h .mem").text(""),M.find(".popup-header p.am-h").removeClass("hidden"),e.Team&&e.Team.Id>0?n.listALLMembers({data:{teamId:e.Team.Id},success:function(e){M.find(".loading-animation").hide(),ue=e.Data.Data,u(1),E(),he(),U.parent().removeClass("open"),U.on("click",function(){$(this).parent().toggleClass("open")}),_.hide()},error:function(e){M.find(".loading-animation").hide()}}):(M.find(".loading-animation").hide(),u(1),E(),he(),U.parent().removeClass("open"),U.on("click",function(){$(this).parent().toggleClass("open")}),_.hide()),pe(),t.show(M)}},app.popup.getTeamManagePopup=function(e,t,a,n,o,i,s){function r(){console.log("currstep",_),console.log("isInvite ",K),K?_<2?k.hide():k.show():0==_?k.hide():k.show(),0==_?(L.hide(),y.removeClass("add-mem")):1==_?(L.show(),y.addClass("add-mem"),y.removeClass("find-mem"),F.removeClass("mem-block"),F.removeClass("pg-block"),F.removeClass("guest-block")):2===_&&(L.hide(),o.doSetFocus(F.find(".block.members .left input").eq(0)))}function l(e){for(var t=0;t<b.length;t++){var a=o.standardizeEmail(b[t].Email);if(a===e&&1==b[t].Accepted&&null!=b[t].ProcessedTime)return!0}return!1}function c(e){for(var t=0;t<b.length;t++){var a=o.standardizeEmail(b[t].Email);if(a===e&&null==b[t].Accepted&&null==b[t].ProcessedTime)return!0}return!1}function d(e){var t=!1;if(a.findUser({email:e,success:function(e){t=!0},error:function(e){H.hide(),W(e.Message,"error")}}),t)for(var n=0;n<b.length;n++){var i=o.standardizeEmail(b[n].Email);i===e&&null==b[n].Accepted&&null==b[n].ProcessedTime&&(t=!0)}return t}function u(){for(var e=0;e<3;e++){var t=$(M.html());F.find(".blocks").append(t)}}function m(t,n,o,i,s,r){var l=r.closest(".each");l.addClass("loading"),y.find(".team-det").addClass("disabled"),a.changeMemberAccess({userEmail:t,userRole:n,teamId:e.Team.Id,folioToken:o,accessType:i,success:function(e){l.removeClass("loading"),l.addClass("done"),setTimeout(function(){l.removeClass("done");for(var e=0;e<b.length;e++)b[e].Email==t&&(b[e].Role=n,b[e].RoleName=X(n));Q(b),y.find(".team-det").removeClass("disabled")},3e3)},error:function(e){y.find(".team-det").removeClass("disabled"),l.removeClass("loading"),H.hide(),W(e.Message,"error")}})}function f(e,a,n,o){return function(){var i=$(this),s=i.data("value"),r="",l=i.closest(".each"),c="";if(y.find(".team-det .each:eq("+a+"1) .action .role .text").text(X(s)),l.removeClass("show-sfg"),console.log(i.data("value"),e,a,r),o){if(s=5,r=l.find(".folios .folio .item.active").data("token"),c=l.find(".folios .access .item.active").data("value"),!r)return void t.error("Please Select a folio to add Single Folio Guest to.")}else l.find(".action .item").removeClass("active"),i.addClass("active");if(s==n);else if(5!=s||o){var d="";5==s||5==n?(5==n?d="<br><b>You will be charged a prorated amount minus any credits on your account.</b>":5==s&&(d="<br><b>You will be credited a prorated amount on your account.</b>"),t.push(y),t.message({heading:"Change Team Member Access ",message:"Do you really want to change access for <b>"+e+"</b> to <b>"+X(s)+"</b>?"+d,btnText:"Confirm",notMini:!0,cancelText:"Cancel",handleOK:function(){m(e,s,r,c,a,i)}})):m(e,s,r,c,a,i)}else l.addClass("show-sfg")}}function p(e,n,o){var i=""!==o?o:e;return function(){H.show(),t.push(y),t.message({heading:"Remove Member",message:"Your account will be credited a prorated amount. Any folios this user owned will be transferred to the team owner.",bodyCentered:!0,btnText:"Confirm",notMini:!0,cancelText:"Cancel",handleOK:function(){a.removeMember({userEmail:e,success:function(e){y.find(".team .each:eq("+n+"1)").hide("slow",function(){y.find(".team .each:eq("+n+"1)").remove()}),H.hide(),t.message({heading:"Success",message:i+" has been successfully removed from your team.",btnText:"Ok",notMini:!0})},error:function(e){H.hide(),W(e.Message,"error")}})},handleNo:function(){H.hide()}})}}function h(){F.find(".folio-select .folio .text").text("Please choose a folio"),F.find(".folio-select .folio .popup-menu").empty();for(var e=0;e<v.length;e++)v[e].IsUserTemplate||F.find(".folio-select .folio .popup-menu").append('<div class="item" title="'+v[e].FolioName+'" data-token="'+v[e].Token+'">'+v[e].FolioName+"</div>")}function g(){F.find(".block.members").removeClass("error"),D.empty(),P.empty(),y.removeClass("success"),y.removeClass("add-mem"),y.removeClass("find-mem"),F.find("input").val(""),F.find("textarea").val(""),F.find(".msg-content").hide(),H.show(),a.listALLMembers({data:{teamId:e.Team.Id},success:function(t){console.log("listALLMembers",t),b=t.Data.Data,a.getUserFolios({teamId:e.Team.Id,success:function(t){if(v=JSON.parse(t.Data),console.log("userFolioList",v),Q(b),h(),console.log("config.Team.Id",e.Team.Id),console.log("config.Team.Role",e.Team.Role),e.Team.Id>0&&(1===e.Team.Role||2===e.Team.Role)){var a=Z(),n=ee(),o="$"+a+"/month paid "+n;console.log("config.Team.ST",e.Team.ST),console.log("msg",o),y.find(".team-add .r1 .left h3 span").html(o),y.find(".team-add .r2 .left h3 span").html(o),H.hide()}else H.hide()},error:function(e){Q(b),H.hide()}})},error:function(e){console.log("listALLMembers Error",e),H.hide()}})}var v,b,y=$("#tmp-team-manage"),C=y.find(".popup-content"),T=y.find(".add-member"),w=(y.find(".remove"),y.find(".success-panel")),x=y.find(".sfg-user"),k=y.find(".back-btn"),S=y.find(".status"),D=y.find(".paper .team"),I=y.find(".paper .team-h"),P=y.find(".paper .free"),E=y.find(".paper .free-h"),F=y.find(".outer-shell"),A=$("#tmp-team-manage-single .b1"),M=$("#tmp-team-manage-single .b2"),N=y.find(".cancel, .popup-close"),O=A.find(".action .popup-menu"),U=(A.find(".action .pending-member"),y.find(".am-h")),R=y.find(".team-add div"),L=y.find(".team-add"),B=y.find("#member-search"),G=null,H=y.find(".loading-animation.forpopup"),q=F.find(".custom-msg"),Y=F.find(".msg-content .icon-Close"),z=F.find(".opts .more"),j=F.find(".invite-confirm"),_=0,K=!1;H.html(t.spinner),i.setLock(function(e,t){V(e,t)});var V=function(e,t,a){if($invitePeopleLink=$(".user-menu-popup .invite-people"),!$invitePeopleLink.length&&!a)return console.log("menu item not created yet, wait for 2000"),setTimeout(function(){V(e,t,1)},2200),!1;var o=!1;if(i.hasTeam()&&(i.isOwner()||i.isAdmin())&&(o=!0),o)n.remove($invitePeopleLink);else{var s="Needs admin access";n.add($invitePeopleLink,s,0)}},W=function(e,t){H.hide(),S.text(e),S.show("slow"),"error"==t?(S.addClass("error"),S.removeClass("success")):(S.removeClass("error"),S.addClass("success")),setTimeout(function(){S.hide("slow")},1e4)};if(w.find(".back-to").click(function(){t.close()}),k.click(function(){_-=1,r()}),x.find(".back-to, .cancel").click(function(){t.close()}),q.click(function(){F.find(".msg-content").show("slow")}),Y.click(function(){F.find(".msg-content").hide("slow")}),z.click(function(){var e=$(M.html());F.find(".blocks").append(e)}),j.click(function(){H.show();for(var e=[],n=F.find(".block.members"),i=!1,s=0;s<n.length;s++){var r=F.find(".block.members:eq("+s+")");if(r.find(".left input").val()){var u=r.find(".left input").val();u=o.standardizeEmail(u);var m=r.find(".right input").val();m=m.trim();var f=G,p="",h="",g=0;F.find(".msg-content:visible").length>0&&(p=F.find(".email-msg").val()),5==f&&(d(u)||l(u))?t.sfgUpgradePopup(m,u,h,g):5!=f||c(u)&&l(u)?5==f&&(F.find(".folio-select .folio .popup-menu .item.active").length>0?(h=F.find(".folio-select .folio .popup-menu .item.active").data("token"),g=F.find(".folio-select .access .popup-menu .item.active").data("value")):(W("Kindly select a folio to add Single Folio Guest.","error"),i=!0)):F.find(".folio-select .folio .popup-menu .item.active").length>0?(h=F.find(".folio-select .folio .popup-menu .item.active").data("token"),g=F.find(".folio-select .access .popup-menu .item.active").data("value")):(W("Kindly select a folio to add Single Folio Guest.","error"),i=!0),l(u)?(r.addClass("error"),r.find(".email-err").text("User is already a member.","error"),i=!0):c(u)?(r.addClass("error"),r.find(".email-err").text("User is already a pending member.","error"),i=!0):validator.isEmail(u)?(3==G&&(f=r.find(".right .popup-menu .item.active").data("value")),e.push({email:u,fullName:m,role:f,message:p,folioToken:h,accessType:g})):(r.addClass("error"),r.find(".email-err").text("Invalid email address.","error"),i=!0)}}if(i)return void H.hide();if(console.log("TeamMembersAdded: ",e),e.length>0)if(5==f){for(var v=[],b=[],s=0;s<e.length;s++)v.push(e[s].email),b.push(e[s].fullName);a.addSingleFolioGuest({data:e,success:function(t){W("This user added to Folio successfully!"),y.find(".success-panel .list-mems").empty();for(var a=0;a<e.length;a++)y.find(".success-panel .list-mems").append("<span>"+e[a].email+"</span>");y.addClass("success"),F.find("input").val(""),F.find("textarea").val(""),F.find(".msg-content").hide(),H.hide()},error:function(e){W(e.Message,"error")}})}else a.addMembers({data:{teamMembers:e},success:function(t){W("This user added to team successfully!"),y.find(".success-panel .list-mems").empty();for(var a=0;a<e.length;a++)y.find(".success-panel .list-mems").append("<span>"+e[a].email+"</span>");y.addClass("success"),F.find("input").val(""),F.find("textarea").val(""),F.find(".msg-content").hide(),H.hide()},error:function(e){H.hide(),W(e.Message,"error")}});else W("Please add an Email to invite","error")}),F.find(".blocks").on("click",".delete",function(){$(this).closest(".block").remove()}),B.on("submit",function(t){var n=$(t.target[0]).val();return H.show(),validator.isEmail(n)?a.resendTeamUser({userEmail:n,userRole:G,teamId:e.Team.Id,folioToken:"",accessType:"",success:function(e){},error:function(e){H.hide(),W(e.Message,"error")}}):W("Please provide a valid email address.","error"),!1}),u(),T.click(function(){_=1,r(),y.addClass("add-mem"),U.find("span").text(e.Team.Name)}),R.click(function(){var e=$(this);y.addClass("find-mem"),F.removeClass("mem-block"),F.removeClass("pg-block"),F.removeClass("guest-block"),_=2,r(),e.hasClass("r1")?(G=3,F.addClass("mem-block")):e.hasClass("r2")?(G=4,F.addClass("pg-block")):e.hasClass("r3")&&(G=5,F.addClass("guest-block"))}),e.TeamRoles)for(var J=0;J<e.TeamRoles.length-1;J++)O.prepend('<div class="item" data-value="'+e.TeamRoles[J].Id+'">'+e.TeamRoles[J].Name+"</div>");var X=function(t){if(e.TeamRoles)for(var a=0;a<e.TeamRoles.length;a++)if(t===e.TeamRoles[a].Id)return e.TeamRoles[a].Name;return"Error in Team ID"},Q=function(e){console.log("membersList",e),D.empty(),P.empty(),I.hide(),E.hide();for(var a=0;a<e.length;a++){var n=$(A.html());n.data("each",e[a]).addClass(1===e[a].Role?"owner":"").find(".is-owner").text("Owner"),n.addClass(null===e[a].Accepted&&e[a].Role>0?"pending":""),n.addClass("team-role-"+e[a].Role).attr("team-role",e[a].Role),n.find(".loading-animation").html(t.spinner),n.find(".name").text(e[a].FullName),n.find(".email").text(e[a].Email),n.find(".action .popup-menu .item[data-value="+e[a].Role+"]").addClass("active"),n.find(".action .role .text").text(X(e[a].Role)),n.find(".remove").on("click",p(e[a].Email,a,e[a].FullName)),n.find(".action .popup-menu .item").on("click",f(e[a].Email,a,e[a].Role,!1));for(var o=0;o<v.length;o++)v[o].IsUserTemplate||n.find(".folios .folio .popup-menu").append('<div class="item" title="'+v[o].FolioName+'" data-token="'+v[o].Token+'">'+v[o].FolioName+"</div>");n.find(".folios .confirm-sfg").on("click",f(e[a].Email,a,e[a].Role,!0)),1===e[a].Role?(D.prepend(n.addClass("owner")),I.show()):5===e[a].Role?(P.append(null===e[a].Accepted?n.addClass("pending"):n.addClass("free-member")),E.show()):(D.append(null===e[a].Accepted?n.addClass("pending"):n.addClass("team-member")),I.show())}app.menu.xSelect()};t.reg(y,N),C.on("click",".pending-actions .b",function(){var t=$(this),n=t.closest(".each"),o=n.data("each");H.show(),t.text("Sending ...").css("cursor","default"),a.resendTeamUser({userEmail:o.Email,userRole:o.Role,teamId:e.Team.Id,folioToken:o.FolioToken,accessType:o.AccessType,success:function(e){H.hide(),t.text("Invitation Sent!"),n.find(".action").addClass("active"),setTimeout(function(){t.text("Resend Invitation").css("cursor","pointer"),n.find(".action").removeClass("active")},3e3)},error:function(e){H.hide(),W(e.Message,"error")}})}),C.on("click",".team-role-5 .resend-team-inv, .team-role-0 .resend-team-inv",function(){var t=$(this),n=t.closest(".each"),o=n.data("each");H.show(),t.text("Sending ...").css("cursor","default"),a.resendSFGEmailNotification({data:{userEmail:o.Email,teamId:e.Team.Id,folioToken:o.FolioToken,accessType:o.AccessType},success:function(e){H.hide(),t.text("Invitation Sent!"),n.find(".action").addClass("active"),setTimeout(function(){t.text("Remind").css("cursor","pointer"),n.find(".action").removeClass("active")},3e3)},error:function(e){t.text("Remind").css("cursor","pointer"),n.find(".action").removeClass("active"),W(e.Message,"error")}})});var Z=function(){var t=0;switch(e.Team.ST){case 19:case 25:t=30;break;case 14:case 22:t=25;break;case 31:t=20;break;case 28:t=15}return t},ee=function(){var t="";switch(e.Team.ST){case 19:case 25:case 31:t="monthly";break;default:t="yearly"}return t};return s.addListener("collabChanFolioMixItUp",function(){g()}),function(a){K=a,g(),K&&(_=1,r(),y.addClass("add-mem"),U.find("span").text(e.Team.Name)),t.show(y)}},app.popup.getTeamSettingPopup=function(e,t,a,n){var o=$("#tmp-team-settings"),i=(o.find(".btn-upload"),o.find(".right")),s=o.find(".team-logo img"),r=o.find(".team-url"),l=o.find(".left input"),c=o.find(".cta-btns"),d=o.find(".cancel, .popup-close"),u=c.find(".btn.popup-cta.update"),m=o.find(".url-info"),f=o.find(".msg"),p=null,h=null,g="",v=null;o.find(".loading-animation").html(t.spinner),t.reg(o,d);var b=function(e){f.html(e).removeClass("success").addClass("error").show("slow"),setTimeout(function(){f.hide("slow").removeClass("error")},5e3),o.find(".loading-animation").hide()},y=function(e){f.html(e).addClass("success").removeClass("error").show("slow"),setTimeout(function(){f.hide("slow").removeClass("success")},5e3),o.find(".loading-animation").hide()};i.click(function(){o.find(".uploader").trigger("click")}),m.click(function(e){$(e.target).is(m.find(".icon-Close"))?m.removeClass("show-info"):m.addClass("show-info")}),o.find(".uploader").change(function(){o.addClass("busy");var e=this,t=e.files&&e.files[0];t&&(form=o.find("#ts-uploadimage-form")[0],o.find(".loading-animation").show(),a.uploadTeamImage(form,t,{type:"logo",isProgress:!1,success:function(e){console.log("res",e),v=e.Data,g=e.Message,s.attr("src",g).prop("title",p),o.find(".loading-animation").hide()},error:b}))});var C=function(){v&&(o.find(".loading-animation").hide(),$("#logo-bar .app-title a").html('<img style="max-width: 80px; max-height: 40px; margin-top: -4px; max-height:calc(100% - 4px);" src="'+g+'">').css({textAlign:"center"}))};return u.click(function(){var t,n=[];t=v?g:"",p=l.val(),o.find(".loading-animation").show(),a.saveTeam({data:{email:"",teamId:e.Team.Id,imageID:v,members:n,data:{Name:p,Status:e.Team.Status,TeamUrl:"",LogoURL:t}},success:function(e){y("Updated Successfully."),C()},error:function(e){b(e.Message),o.find(".loading-animation").hide()}})}),function(){p=e.Team.Name,h=e.Team.TeamUrl,g=e.Team.LogoUrl,s.attr("src",g),r.text(h),l.val(p),t.show(o),n.doSetFocus(l)}},app.menutcopy=function(e,t,a,n,o){function i(a,o){t.getWorkspaceChannels({teamId:0,success:function(t){console.log("response from getWorkspaceChannels on copytemplatemenu",t),e.saveFolioTransferItem={FolioName:a,Token:o,labels:JSON.parse(t.Data),template:e.FolioName,isUseTemplate:!0},console.log("saveFolioTransferItem",e.saveFolioTransferItem),n.saveFolio()},error:function(e){console.log("error",e)}})}var s=$("#tmp-copy-template-topbar"),r=s.find(".ok"),l=(s.find(".edit-preview-template"),s.find(".present")),c=app.editor.present(a);console.log("config.EditTemplate: ",e.EditTemplate,e.isUserTemplate,e),"true"==e.EditTemplate||e.isUserTemplate?(e.isUserTemplate&&e.Team.Id>0&&(s.find("i.icon-Logo").remove(),s.find(".app-title a").append('<img src ="'+e.Team.LogoUrl+'" title="'+e.Team.Name+'" style="max-height:35px;margin-top: -12px;">'),s.find(".text").text(e.FolioName)),e.isUserTemplate&&r.text("Use This Template"),$(document).click(function(e){n.close()}),$("#popup-container .popup-content").click(function(e){e.stopPropagation()}),$("#antiForgeryContainer").length>0?$("#antiForgeryContainer").after(s):$("body").prepend(s),$("#home-page").css({paddingTop:"50px"})):$("body").append(l.addClass("fly")),e.presentationMode||l.hide(),"dash-explore"==e.EditTemplate&&(l.addClass("fly").css({
top:"55px"}).show(),$("#tmp-dashboard-content .folios-container.explore").append(l));var d=function(e,t){},u=function(){o.setLock(function(e,t){d(e,t)})};u(),l.on("click",function(){s.hide(),l.hide();var e=$("#home-page").css("paddingTop");$("#home-page").css({paddingTop:"0px"}),c.start(function(){s.show(),l.show(),$("#home-page").css({paddingTop:e})})}),e.userName||s.find(".app-title a").attr("href","https://xtensio.com"),r.on("click",function(){var a=($(this),e.token),s=e.FolioName?"Untitled ("+e.FolioName+")":"Untitled";if(console.log("Fname: "+s),e.userName){var r=!!e.UserTeams&&e.UserTeams.length>0;if(console.log("in copytemplatemenu.js"),r){if(e.UserTeams&&e.UserTeams.length>0){if(o.isSingleFolioGuest()||o.isPremiumGuest())return n.teamUserActionBlocked("create",o.getRoleName()),!1;console.log("token name",a,s),n.addFolioToSpace(a,s)}}else e.Team&&0===e.Team.Id&&o.isFree()?t.getUserActiveFoliosCount({success:function(e){return console.log("getUserActiveFoliosCount response",e),e.Data>=1?void n.message({heading:"Upgrade your account",message:"Folio Limit reached for Free User. Please upgrade for unlimited folios and other premium features.",btnText:"See Plans",cancelText:"Nevermind",bodyCentered:!0,notMini:!0,handleOK:function(){n.payment()}}):void i(s,a)},error:function(e){console.log("getUserActiveFoliosCount error",e)}}):i(s,a)}else n.signUp(!0);return!1})},app.main=function(e,t){function a(e){var t=$("#tmp-power-by-footer");return t.removeClass("hidden").find("upgrade"==e?".normal":".upgrade").addClass("hidden"),t.find("."+e).removeClass("hidden"),t}function n(e){var t=[];return e.forEach(function(e,a){t.push(e.HexCode)}),t}app.console=consologs(e);var o=$("#notify-popup");app.isconsole="localhost"==window.location.hostname||"app.xtensio.tech"==window.location.hostname||e.isAdmin;var i=["#66D7C4","#FFD271","#FD9F4D","#F67157","#E95F5E","#FFFFFF","#DCBB9F","#76D5E5","#6486A5","#2E5668","#D45D77","#9D557C","#7E8589","#FFFFFF","#000000","#052B3E"];if(0!==e.Team.Id&&"undefined"!=typeof e.StyleGuides?i=n(e.StyleGuides[0].TeamColors):"undefined"!=typeof e.DefaultColors&&(i=n(e.DefaultColors)),e.colors=i,app.menu.xSelect(),(e.isBlocked||e.IsDelinquent)&&(location.href="/"),window.location.hostname.indexOf("localhost")>-1||"app.xtensio.tech"==window.location.hostname||e.isAdmin||(console.log("Disabling Logs"),logger.disableLogger()),app.console(e),e.isProject)e.banner&&$("#view-project").after(a("normal")),(e.getPass||t&&t.GetPass)&&app.popup.folioPass(e);else if(e.getPass||t&&t.GetPass)app.popup.folioPass(e);else{var s,r,l,c,d,u=app.core.main(e,t),m=u.utility,f=u.apiHelper,p=u.eventManager,h=u.pageManager,g=u.store,v=u.modStore,b=u.folioStore,y=u.configStore,C=u.appHub,T=u.plusHelper,w=b.get("style")||"",x='<style id="folio-style" type="text/css">'+w+"</style>";$("head").append(x),app.plugin.main(e,u,t,T),l=app.popup.main(e,p,m,f,h,T,v,g,t,b,y),s=e.editMode?app.menu.main(e,t,u,l):{},r=app.managers.main(e,t,u,s,l),c=r.modManager,d=r.rddm,app.factory.main(e,t,u,s,l,c,d),e.editMode?(t.IsUserTemplate&&$("#tmp-collaborators").remove(),app.common.main(e,f,p,m,l,g,C,t,app.plugin,T),app.editor.main(e,t,f,p,h,l,m,g,c,b,T),h.setupEditPage(e,t,c),e.banner&&a("upgrade"),t.Version<1&&1!=g.get("upgrade-"+e.token)&&l.message({heading:"Upgrade Editor?",message:"This folio was created using an older version of our text editor.<br/>(Upgrading may affect the existing formatting minimally,<br/> but gives you super powers.)",btnText:"Use New Editor",cancelText:"Keep Existing",handleNo:function(){g.set("upgrade-"+e.token,1)},handleOK:function(){l.busy(),f.upgradeFolio({success:function(){l.message({heading:"Success",btnText:"Refresh Page",message:"The folio has been successfully upgraded. You need to refresh this page.",handleOK:function(){location.reload()}})},error:function(e){l.error(e.Message)}})}}),app.editor.viewOnly(t),$("#tmp-secondary-bar").length>0&&($(".module-container").length<1||$(".empty-module-container").length==$(".module-container").length)&&$("#tmp-secondary-bar .add-module-button").trigger("click"),setTimeout(function(){function e(e,t){t?e.addClass("highlight"):e.removeClass("highlight")}console.log("plusHelper.isFree()",T.isFree());var t="";$("#edit-sections").on("mouseover",".module-container",function(){var a=$(this);if(!a.hasClass("canvas-module-container")&&!a.hasClass("empty-module-container")){if(1===a.parents(".canvas-module-container").length){var n=a.parents(".canvas-module-container");e($("#edit-sections .module-container"),!1),t=n.attr("id"),e(n,!0)}else t="",e($("#edit-sections .module-container"),!1);e(a,!0)}}),$("#edit-sections").on("mouseover",".canvas-module-container",function(){t!==$(this).attr("id")&&(e($("#edit-sections .module-container"),!1),t=$(this).attr("id"),e($(this),!0))})},500)):($("#edit-page").remove(),c.activatePreview(),app.dash.archivedFolioTopBanner(e,l,t),app.menutcopy(e,f,p,l,T),$("#home-page").after($("#presentation-buttons").addClass("public"))),app.editor.addWatermark(e,l,T)}var k=function(){e.UserTeams&&e.editMode&&e.UserTeams.length>0&&(e.Team&&0!=e.Team.Id?(o.find(".logged-in .text").html("You are logged into team <b>"+e.Team.Name+"</b>"),$("#tmp-user-menu .upgrade-btn").remove()):o.find(".logged-in .text").html("You are logged into your <b>Personal Account</b>"),o.finish(),o.removeClass("on").addClass("logged-in").show(),setTimeout(function(){o.hide("slow").removeClass("logged-in")},2500))};if(e.editMode&&window.location.toString().indexOf("#new")>-1){console.log(window.location.toString().indexOf("#new")+"    :::::::::");var S="Personal Dashboard";e.Team&&0!=e.Team.Id&&(S=e.Team.Name),o.find(".logged-in .text").html("Folio is saved to <b>"+S+"</b>"),o.removeClass("on").addClass("logged-in").show(),setTimeout(function(){o.hide("slow").removeClass("logged-in")},2500)}else e.editMode||k()},app.dashboard=function(e){app.console=consologs(e),window.location.hostname.indexOf("localhost")>-1||"app.xtensio.tech"==window.location.hostname||e.isAdmin||(console.log("Disabling Logs"),logger.disableLogger()),console.log(e),e.isDashboard=!0;var t=["#66D7C4","#FFD271","#D45D77","#9D557C","#3C688F","#1ab9d3","#fd9f4c","#c93555","#7e8589","#dcbc9f"];e.colors=t,e.myLabel={ID:0,Name:"My Templates",TimeStamp:0,Token:"own",HasPass:!1,GetPass:!1,Private:!0,Title:"",Description:"",Data:null,FolioTokens:null,color:"#FF0000"},e.xtensioLabel={ID:0,Name:"Xtensio Templates",TimeStamp:0,Token:"xtensio",HasPass:!1,GetPass:!1,Private:!0,Title:"",Description:"",Data:null,FolioTokens:null,color:"#FF0000"};var a,n,o,i=app.core.main(e),s=i.utility,r=i.apiHelper,l=i.eventManager,c=i.pageManager,d=i.store,u=i.appHub,m=i.modStore,f=i.plusHelper,p=i.configStore;app.plugin.main(e,i,null,f),a=app.popup.main(e,l,s,r,c,f,m,d,n,o,p);var h=document.location.href;if(h=h.toLowerCase(),h.indexOf("teams/create")>-1)a.signUpTeam();else if(e.isSignup)a.signUp();else if(e.loginState)a.signIn();else{app.common.main(e,r,l,s,a,d,u,{},app.plugin,f),app.dash.main(e,l,r,s,a,f),app.menu.xSelect(),"not-set"!=e.ExploreTabFolioToken?($("#tmp-dash-topbar .explore").show(),$("#tmp-dash-topbar .explore").click(function(){$("#tmp-dashboard-content .explore.not-populated").length>0&&(app.dash.getExploreFolio(e,r,a),$("#tmp-dashboard-content .explore.not-populated").removeClass("not-populated"))})):($("#tmp-dash-topbar a.explore").hide(),$("#tmp-dashboard-content .explore.not-populated").removeClass("not-populated"));var g=!1;e.FromLogin&&e.UserTeams&&e.UserTeams.length>0&&(!e.Team||e.Team.Id<1)&&(g=!0,a.teamSelector())}var v=$("#notify-popup");e.UserTeams&&e.UserTeams.length>0&&(e.Team&&0!=e.Team.Id?(v.find(".logged-in .text").html("You are logged into team: <b>"+e.Team.Name+"</b>"),$("#tmp-user-menu .upgrade-btn").remove()):v.find(".logged-in .text").html("You are logged into your <b>Personal Account</b>"),v.removeClass("on").addClass("logged-in").show(),setTimeout(function(){v.hide("slow").removeClass("logged-in")},2500))};